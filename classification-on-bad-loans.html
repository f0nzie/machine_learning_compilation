<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 16 Classification on bad loans | A Machine Learning Book</title>
<meta name="author" content="Alfonso R. Reyes">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Machine Learning Book</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prerequisites</a></li>
<li class="book-part">The Basics of Machine Learning</li>
<li><a class="" href="introduction-to-pca.html"><span class="header-section-number">1</span> Introduction to PCA</a></li>
<li><a class="" href="comparison-of-two-pca-packages.html"><span class="header-section-number">2</span> Comparison of two PCA packages</a></li>
<li><a class="" href="detailed-study-of-principal-component-analysis.html"><span class="header-section-number">3</span> Detailed study of Principal Component Analysis</a></li>
<li><a class="" href="detection-of-diabetes-using-logistic-regression.html"><span class="header-section-number">4</span> Detection of diabetes using Logistic Regression</a></li>
<li><a class="" href="sensitivity-analysis-for-a-neural-network.html"><span class="header-section-number">5</span> Sensitivity analysis for a neural network</a></li>
<li><a class="" href="data-visualization-for-ml-models.html"><span class="header-section-number">6</span> Data Visualization for ML models</a></li>
<li class="book-part">Feature Engineering</li>
<li><a class="" href="ten-methods-to-assess-variable-importance.html"><span class="header-section-number">7</span> Ten methods to assess Variable Importance</a></li>
<li><a class="" href="employee-attrition-using-feature-importance.html"><span class="header-section-number">8</span> Employee Attrition using Feature Importance</a></li>
<li><a class="" href="feature-selection-to-enhance-cancer-detection.html"><span class="header-section-number">9</span> Feature Selection to enhance cancer detection</a></li>
<li><a class="" href="dealing-with-unbalanced-data.html"><span class="header-section-number">10</span> Dealing with unbalanced data</a></li>
<li><a class="" href="imputting-missing-values-with-random-forest.html"><span class="header-section-number">11</span> Imputting missing values with Random Forest</a></li>
<li class="book-part">Algorithms Comparison</li>
<li><a class="" href="introduction-to-algorithms-for-classification.html"><span class="header-section-number">12</span> Introduction to algorithms for Classification</a></li>
<li><a class="" href="comparing-classification-algorithms.html"><span class="header-section-number">13</span> Comparing Classification algorithms</a></li>
<li><a class="" href="linear-and-non-linear-algorithms-for-classification.html"><span class="header-section-number">14</span> Linear and Non-Linear Algorithms for Classification</a></li>
<li><a class="" href="predicting-flu-outcome-comparing-eight-classification-algorithms.html"><span class="header-section-number">15</span> Predicting Flu outcome comparing eight classification algorithms</a></li>
<li><a class="active" href="classification-on-bad-loans.html"><span class="header-section-number">16</span> Classification on bad loans</a></li>
<li><a class="" href="comparison-of-six-linear-regression-algorithms.html"><span class="header-section-number">17</span> Comparison of six Linear Regression algorithms</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="a-gentle-introduction-to-support-vector-machines.html"><span class="header-section-number">18</span> A gentle introduction to Support Vector Machines</a></li>
<li><a class="" href="broad-view-of-svm.html"><span class="header-section-number">19</span> Broad view of SVM</a></li>
<li><a class="" href="tuning-of-support-vector-machine-prediction.html"><span class="header-section-number">20</span> Tuning of Support Vector Machine prediction</a></li>
<li><a class="" href="who-buys-social-network-ads.html"><span class="header-section-number">21</span> Who buys Social Network ads</a></li>
<li><a class="" href="predicting-ozone-levels.html"><span class="header-section-number">22</span> Predicting Ozone levels</a></li>
<li><a class="" href="building-a-naive-bayes-classifier.html"><span class="header-section-number">23</span> Building a Naive Bayes Classifier</a></li>
<li><a class="" href="detect-mines-vs-rocks-with-random-forest.html"><span class="header-section-number">24</span> Detect mines vs rocks with Random Forest</a></li>
<li><a class="" href="predicting-the-type-of-glass.html"><span class="header-section-number">25</span> Predicting the type of glass</a></li>
<li><a class="" href="naive-bayes-for-sms-spam.html"><span class="header-section-number">26</span> Naive Bayes for SMS spam</a></li>
<li><a class="" href="vehicles-classiification-with-decision-trees.html"><span class="header-section-number">27</span> Vehicles classiification with Decision Trees</a></li>
<li><a class="" href="applying-naive-bayes-on-the-titanic-case.html"><span class="header-section-number">28</span> Applying Naive-Bayes on the Titanic case</a></li>
<li><a class="" href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></li>
<li class="book-part">Linear Regression</li>
<li><a class="" href="linear-regression-with-islr.html"><span class="header-section-number">30</span> Linear Regression with ISLR</a></li>
<li><a class="" href="evaluation-of-three-linear-regression-models.html"><span class="header-section-number">31</span> Evaluation of three linear regression models</a></li>
<li><a class="" href="comparing-regression-models.html"><span class="header-section-number">32</span> Comparing regression models</a></li>
<li><a class="" href="finding-the-factors-of-happiness.html"><span class="header-section-number">33</span> Finding the factors of happiness</a></li>
<li><a class="" href="regression-with-a-neural-network.html"><span class="header-section-number">34</span> Regression with a neural network</a></li>
<li><a class="" href="comparing-multiple-regression-vs-a-neural-network.html"><span class="header-section-number">35</span> Comparing Multiple Regression vs a Neural Network</a></li>
<li><a class="" href="temperature-modeling-using-nested-dataframes.html"><span class="header-section-number">36</span> Temperature modeling using nested dataframes</a></li>
<li class="book-part">Neural Networks</li>
<li><a class="" href="credit-scoring-with-neuralnet.html"><span class="header-section-number">37</span> Credit Scoring with neuralnet</a></li>
<li><a class="" href="wine-classification-with-neuralnet.html"><span class="header-section-number">38</span> Wine classification with neuralnet</a></li>
<li><a class="" href="predicting-the-rating-of-cereals.html"><span class="header-section-number">39</span> Predicting the rating of cereals</a></li>
<li><a class="" href="fitting-a-linear-model-with-neural-networks.html"><span class="header-section-number">40</span> Fitting a linear model with neural networks</a></li>
<li><a class="" href="visualization-of-neural-networks.html"><span class="header-section-number">41</span> Visualization of neural networks</a></li>
<li><a class="" href="build-a-fully-connected-r-neural-network-from-scratch.html"><span class="header-section-number">42</span> Build a fully connected R neural network from scratch</a></li>
<li><a class="" href="tuning-hyperparameters-in-a-neural-network.html"><span class="header-section-number">43</span> Tuning Hyperparameters in a Neural Network</a></li>
<li><a class="" href="deep-learning-tips-for-classification-and-regression.html"><span class="header-section-number">44</span> Deep Learning tips for Classification and Regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="what-is-dot-hat-in-a-regression-output.html"><span class="header-section-number">A</span> What is dot hat in a regression output</a></li>
<li><a class="" href="q-q-normal-to-compare-data-to-distributions.html"><span class="header-section-number">B</span> Q-Q normal to compare data to distributions</a></li>
<li><a class="" href="qq-and-pp-plots.html"><span class="header-section-number">C</span> QQ and PP Plots</a></li>
<li><a class="" href="visualizing-residuals.html"><span class="header-section-number">D</span> Visualizing residuals</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hadley/r-pkgs">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="classification-on-bad-loans" class="section level1">
<h1>
<span class="header-section-number">16</span> Classification on bad loans<a class="anchor" aria-label="anchor" href="#classification-on-bad-loans"><i class="fas fa-link"></i></a>
</h1>
<ul>
<li>Datasets: <code>loan.csv</code>
</li>
<li>Algorithms:
1. Generalized Linear Model (GLM)
2. Random Forest (RF)
3. Gradient Boosting Machine (GBM)
4. Deep Learning (DL)
5. Naive Bayes (NB)</li>
</ul>
<div id="comparison-of-glm-rf-gbm-dl-nb" class="section level2">
<h2>
<span class="header-section-number">16.1</span> Comparison of <em>GLM, RF, GBM, DL, NB</em><a class="anchor" aria-label="anchor" href="#comparison-of-glm-rf-gbm-dl-nb"><i class="fas fa-link"></i></a>
</h2>
<p>Source: <a href="https://github.com/h2oai/h2o-tutorials/blob/master/h2o-open-tour-2016/chicago/intro-to-h2o.R" class="uri">https://github.com/h2oai/h2o-tutorials/blob/master/h2o-open-tour-2016/chicago/intro-to-h2o.R</a></p>
</div>
<div id="introduction-9" class="section level2">
<h2>
<span class="header-section-number">16.2</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-9"><i class="fas fa-link"></i></a>
</h2>
<p>Introductory H2O Machine Learning Tutorial
Prepared for H2O Open Chicago 2016: <a href="http://open.h2o.ai/chicago.html" class="uri">http://open.h2o.ai/chicago.html</a></p>
<div id="install-and-download-h2o" class="section level3">
<h3>
<span class="header-section-number">16.2.1</span> Install and download <code>h2o</code><a class="anchor" aria-label="anchor" href="#install-and-download-h2o"><i class="fas fa-link"></i></a>
</h3>
<p>First step is to download &amp; install the h2o R library
The latest version is available by clicking on the R tab here: <a href="http://h2o-release.s3.amazonaws.com/h2o/latest_stable.html" class="uri">http://h2o-release.s3.amazonaws.com/h2o/latest_stable.html</a></p>
<p>Load the H2O library and start up the H2O cluster locally on your machine:</p>
<div class="sourceCode" id="cb459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load the H2O library and start up the H2O cluster locally on your machine</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/h2oai/h2o-3">h2o</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.init.html">h2o.init</a></span><span class="op">(</span>nthreads <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, <span class="co">#Number of threads -1 means use all cores on your machine</span>
         max_mem_size <span class="op">=</span> <span class="st">"8G"</span><span class="op">)</span>  <span class="co">#max mem size is the maximum memory to allocate to H2O</span>
<span class="co">#&gt;  Connection successful!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R is connected to the H2O cluster: </span>
<span class="co">#&gt;     H2O cluster uptime:         15 minutes 7 seconds </span>
<span class="co">#&gt;     H2O cluster timezone:       Etc/UTC </span>
<span class="co">#&gt;     H2O data parsing timezone:  UTC </span>
<span class="co">#&gt;     H2O cluster version:        3.30.0.1 </span>
<span class="co">#&gt;     H2O cluster version age:    7 months and 14 days !!! </span>
<span class="co">#&gt;     H2O cluster name:           H2O_started_from_R_root_mwl453 </span>
<span class="co">#&gt;     H2O cluster total nodes:    1 </span>
<span class="co">#&gt;     H2O cluster total memory:   7.81 GB </span>
<span class="co">#&gt;     H2O cluster total cores:    8 </span>
<span class="co">#&gt;     H2O cluster allowed cores:  8 </span>
<span class="co">#&gt;     H2O cluster healthy:        TRUE </span>
<span class="co">#&gt;     H2O Connection ip:          localhost </span>
<span class="co">#&gt;     H2O Connection port:        54321 </span>
<span class="co">#&gt;     H2O Connection proxy:       NA </span>
<span class="co">#&gt;     H2O Internal Security:      FALSE </span>
<span class="co">#&gt;     H2O API Extensions:         Amazon S3, XGBoost, Algos, AutoML, Core V3, TargetEncoder, Core V4 </span>
<span class="co">#&gt;     R Version:                  R version 3.6.3 (2020-02-29)</span></code></pre></div>
</div>
<div id="load-the-dataset" class="section level3">
<h3>
<span class="header-section-number">16.2.2</span> Load the dataset<a class="anchor" aria-label="anchor" href="#load-the-dataset"><i class="fas fa-link"></i></a>
</h3>
<p>Next we will import a cleaned up version of the Lending Club “Bad Loans” dataset The purpose here is to predict whether a loan will be bad (not repaid to the lender). The response column, bad_loan, is <span class="math inline">\(1\)</span> if the loan was bad, and <span class="math inline">\(0\)</span> otherwise</p>
<p>Import the data
<code>loan_csv &lt;- "/Volumes/H2OTOUR/loan.csv"</code><br>
Alternatively, you can import the data directly from a URL</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb460-1" data-line-number="1"><span class="co"># modify this for your machine</span></a>
<a class="sourceLine" id="cb460-2" data-line-number="2">loan_csv &lt;-<span class="st"> "https://raw.githubusercontent.com/h2oai/app-consumer-loan/master/data/loan.csv"</span></a>
<a class="sourceLine" id="cb460-3" data-line-number="3">data &lt;-<span class="st"> </span><span class="kw">h2o.importFile</span>(loan_csv)  <span class="co"># 163,987 rows x 15 columns</span></a>
<a class="sourceLine" id="cb460-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb460-5" data-line-number="5">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb460-6" data-line-number="6"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb460-7" data-line-number="7">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb460-8" data-line-number="8"><span class="st">  </span><span class="er">|=======</span><span class="st">                                                               </span><span class="er">|</span><span class="st">   </span><span class="dv">9</span>%</a>
<a class="sourceLine" id="cb460-9" data-line-number="9">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb460-10" data-line-number="10"><span class="st">  </span><span class="er">|=====================================</span><span class="st">                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">53</span>%</a>
<a class="sourceLine" id="cb460-11" data-line-number="11">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb460-12" data-line-number="12"><span class="st">  </span><span class="er">|===============================================================</span><span class="st">       </span><span class="er">|</span><span class="st">  </span><span class="dv">91</span>%</a>
<a class="sourceLine" id="cb460-13" data-line-number="13">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb460-14" data-line-number="14"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a>
<a class="sourceLine" id="cb460-15" data-line-number="15"><span class="kw">dim</span>(data)</a>
<a class="sourceLine" id="cb460-16" data-line-number="16"><span class="co">#&gt; [1] 163987     15</span></a>
<a class="sourceLine" id="cb460-17" data-line-number="17"><span class="co"># [1] 163987     15</span></a></code></pre></div>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/h2oai/app-consumer-loan/master/data/loan.csv"</span>
<span class="va">loans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">loans</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data_raw_dir</span>, <span class="st">"loan.csv"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="feature-engineering" class="section level3">
<h3>
<span class="header-section-number">16.2.3</span> Feature Engineering<a class="anchor" aria-label="anchor" href="#feature-engineering"><i class="fas fa-link"></i></a>
</h3>
<p>Since we want to train a binary classification model, we must ensure that the response is coded as a <strong>factor</strong> If the response is <span class="math inline">\(0/1\)</span>, <em>H2O</em> will assume it’s numeric, which means that <em>H2O</em> will train a regression model instead</p>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span><span class="op">$</span><span class="va">bad_loan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">bad_loan</span><span class="op">)</span>  <span class="co">#encode the binary response as a factor</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.levels.html">h2o.levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">bad_loan</span><span class="op">)</span>  <span class="co">#optional: after encoding, this shows the two factor levels, '0' and '1'</span>
<span class="co">#&gt; [1] "0" "1"</span>
<span class="co"># [1] "0" "1"</span></code></pre></div>
</div>
<div id="partition-the-data" class="section level3">
<h3>
<span class="header-section-number">16.2.4</span> Partition the data<a class="anchor" aria-label="anchor" href="#partition-the-data"><i class="fas fa-link"></i></a>
</h3>
<p>Partition the data into training, validation and test sets:</p>
<div class="sourceCode" id="cb463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Partition the data into training, validation and test sets</span>
<span class="va">splits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.splitFrame.html">h2o.splitFrame</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, 
                         ratios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.15</span><span class="op">)</span>,  <span class="co">#partition data into 70%, 15%, 15% chunks</span>
                         seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="co">#setting a seed will guarantee reproducibility</span>
<span class="va">train</span> <span class="op">&lt;-</span> <span class="va">splits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">valid</span> <span class="op">&lt;-</span> <span class="va">splits</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="va">test</span> <span class="op">&lt;-</span> <span class="va">splits</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>Take a look at the size of each partition. Notice that <code>h2o.splitFrame</code> uses approximate splitting, not exact splitting, (for efficiency), so, these are not exactly 70%, 15% and 15% of the total rows.</p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">train</span><span class="op">)</span>  <span class="co"># 114908</span>
<span class="co">#&gt; [1] 114908</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">valid</span><span class="op">)</span> <span class="co"># 24498</span>
<span class="co">#&gt; [1] 24498</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span>  <span class="co"># 24581</span>
<span class="co">#&gt; [1] 24581</span></code></pre></div>
</div>
<div id="identify-response-and-predictor-variables" class="section level3">
<h3>
<span class="header-section-number">16.2.5</span> Identify response and predictor variables<a class="anchor" aria-label="anchor" href="#identify-response-and-predictor-variables"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Identify response and predictor variables</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"bad_loan"</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"int_rate"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># remove the interest rate column because it's correlated with the outcome</span>
<span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt;  [1] "loan_amnt"             "term"                  "emp_length"           </span>
<span class="co">#&gt;  [4] "home_ownership"        "annual_inc"            "purpose"              </span>
<span class="co">#&gt;  [7] "addr_state"            "dti"                   "delinq_2yrs"          </span>
<span class="co">#&gt; [10] "revol_util"            "total_acc"             "longest_credit_length"</span>
<span class="co">#&gt; [13] "verification_status"</span>
<span class="co"># [1] "loan_amnt"             "term"                 </span>
<span class="co"># [3] "emp_length"            "home_ownership"       </span>
<span class="co"># [5] "annual_inc"            "verification_status"  </span>
<span class="co"># [7] "purpose"               "addr_state"           </span>
<span class="co"># [9] "dti"                   "delinq_2yrs"          </span>
<span class="co"># [11] "revol_util"            "total_acc"            </span>
<span class="co"># [13] "longest_credit_length"</span></code></pre></div>
</div>
</div>
<div id="algorithms-1" class="section level2">
<h2>
<span class="header-section-number">16.3</span> Algorithms<a class="anchor" aria-label="anchor" href="#algorithms-1"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have prepared the data, we can train some models. We will start by training a single model from each of the <em>H2O</em> supervised algos:</p>
<ol style="list-style-type: decimal">
<li>Generalized Linear Model (GLM)</li>
<li>Random Forest (RF)</li>
<li>Gradient Boosting Machine (GBM)</li>
<li>Deep Learning (DL)</li>
<li>Naive Bayes (NB)</li>
</ol>
</div>
<div id="glm" class="section level2">
<h2>
<span class="header-section-number">16.4</span> GLM<a class="anchor" aria-label="anchor" href="#glm"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s start with a basic binomial Generalized Linear Model. By default, <code>h2o.glm</code> uses a regularized, elastic net model.</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb466-1" data-line-number="1">glm_fit1 &lt;-<span class="st"> </span><span class="kw">h2o.glm</span>(<span class="dt">x =</span> x, </a>
<a class="sourceLine" id="cb466-2" data-line-number="2">                    <span class="dt">y =</span> y, </a>
<a class="sourceLine" id="cb466-3" data-line-number="3">                    <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb466-4" data-line-number="4">                    <span class="dt">model_id =</span> <span class="st">"glm_fit1"</span>,</a>
<a class="sourceLine" id="cb466-5" data-line-number="5">                    <span class="dt">family =</span> <span class="st">"binomial"</span>)  <span class="co">#similar to R's glm, h2o.glm has the family argument</span></a>
<a class="sourceLine" id="cb466-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb466-7" data-line-number="7">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb466-8" data-line-number="8"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb466-9" data-line-number="9">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb466-10" data-line-number="10"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<p>Next, we will do some automatic tuning by passing in a validation frame and setting <code>lambda_search = True</code>. Since we are training a GLM with regularization, we should try to find the right amount of regularization (to avoid overfitting). The model parameter, <code>lambda</code>, controls the amount of regularization in a GLM model and we can find the optimal value for <code>lambda</code> automatically by setting <code>lambda_search = TRUE</code>, and passing in a validation frame (which is used to evaluate model performance using a particular value of lambda).</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb467-1" data-line-number="1">glm_fit2 &lt;-<span class="st"> </span><span class="kw">h2o.glm</span>(<span class="dt">x =</span> x, </a>
<a class="sourceLine" id="cb467-2" data-line-number="2">                    <span class="dt">y =</span> y, </a>
<a class="sourceLine" id="cb467-3" data-line-number="3">                    <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb467-4" data-line-number="4">                    <span class="dt">model_id =</span> <span class="st">"glm_fit2"</span>,</a>
<a class="sourceLine" id="cb467-5" data-line-number="5">                    <span class="dt">validation_frame =</span> valid,</a>
<a class="sourceLine" id="cb467-6" data-line-number="6">                    <span class="dt">family =</span> <span class="st">"binomial"</span>,</a>
<a class="sourceLine" id="cb467-7" data-line-number="7">                    <span class="dt">lambda_search =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb467-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb467-9" data-line-number="9">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb467-10" data-line-number="10"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb467-11" data-line-number="11">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb467-12" data-line-number="12"><span class="st">  </span><span class="er">|==================</span><span class="st">                                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">26</span>%</a>
<a class="sourceLine" id="cb467-13" data-line-number="13">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb467-14" data-line-number="14"><span class="st">  </span><span class="er">|=====================================</span><span class="st">                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">53</span>%</a>
<a class="sourceLine" id="cb467-15" data-line-number="15">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb467-16" data-line-number="16"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<p>Let’s compare the performance of the two GLMs:</p>
<div class="sourceCode" id="cb468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Let's compare the performance of the two GLMs</span>
<span class="va">glm_perf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.performance.html">h2o.performance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">glm_fit1</span>,
                             newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span>
<span class="va">glm_perf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.performance.html">h2o.performance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">glm_fit2</span>,
                             newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span>

<span class="co"># Print model performance</span>
<span class="va">glm_perf1</span>
<span class="co">#&gt; H2OBinomialMetrics: glm</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.142</span>
<span class="co">#&gt; RMSE:  0.377</span>
<span class="co">#&gt; LogLoss:  0.451</span>
<span class="co">#&gt; Mean Per-Class Error:  0.37</span>
<span class="co">#&gt; AUC:  0.677</span>
<span class="co">#&gt; AUCPR:  0.327</span>
<span class="co">#&gt; Gini:  0.355</span>
<span class="co">#&gt; R^2:  0.0639</span>
<span class="co">#&gt; Residual Deviance:  22176</span>
<span class="co">#&gt; AIC:  22280</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            0    1    Error         Rate</span>
<span class="co">#&gt; 0      13647 6344 0.317343  =6344/19991</span>
<span class="co">#&gt; 1       1939 2651 0.422440   =1939/4590</span>
<span class="co">#&gt; Totals 15586 8995 0.336968  =8283/24581</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold        value idx</span>
<span class="co">#&gt; 1                       max f1  0.193323     0.390283 222</span>
<span class="co">#&gt; 2                       max f2  0.118690     0.556685 308</span>
<span class="co">#&gt; 3                 max f0point5  0.276272     0.354086 146</span>
<span class="co">#&gt; 4                 max accuracy  0.494244     0.814410  29</span>
<span class="co">#&gt; 5                max precision  0.744500     1.000000   0</span>
<span class="co">#&gt; 6                   max recall  0.001225     1.000000 399</span>
<span class="co">#&gt; 7              max specificity  0.744500     1.000000   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.198334     0.210606 216</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.180070     0.627783 236</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.193323     0.630109 222</span>
<span class="co">#&gt; 11                     max tns  0.744500 19991.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.744500  4589.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.001225 19991.000000 399</span>
<span class="co">#&gt; 14                     max tps  0.001225  4590.000000 399</span>
<span class="co">#&gt; 15                     max tnr  0.744500     1.000000   0</span>
<span class="co">#&gt; 16                     max fnr  0.744500     0.999782   0</span>
<span class="co">#&gt; 17                     max fpr  0.001225     1.000000 399</span>
<span class="co">#&gt; 18                     max tpr  0.001225     1.000000 399</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>
<span class="va">glm_perf2</span>
<span class="co">#&gt; H2OBinomialMetrics: glm</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.142</span>
<span class="co">#&gt; RMSE:  0.377</span>
<span class="co">#&gt; LogLoss:  0.451</span>
<span class="co">#&gt; Mean Per-Class Error:  0.372</span>
<span class="co">#&gt; AUC:  0.677</span>
<span class="co">#&gt; AUCPR:  0.327</span>
<span class="co">#&gt; Gini:  0.354</span>
<span class="co">#&gt; R^2:  0.0635</span>
<span class="co">#&gt; Residual Deviance:  22186</span>
<span class="co">#&gt; AIC:  22282</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            0    1    Error         Rate</span>
<span class="co">#&gt; 0      13699 6292 0.314742  =6292/19991</span>
<span class="co">#&gt; 1       1968 2622 0.428758   =1968/4590</span>
<span class="co">#&gt; Totals 15667 8914 0.336032  =8260/24581</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold        value idx</span>
<span class="co">#&gt; 1                       max f1  0.194171     0.388329 215</span>
<span class="co">#&gt; 2                       max f2  0.119200     0.555998 306</span>
<span class="co">#&gt; 3                 max f0point5  0.256488     0.351893 152</span>
<span class="co">#&gt; 4                 max accuracy  0.474001     0.814654  32</span>
<span class="co">#&gt; 5                max precision  0.736186     1.000000   0</span>
<span class="co">#&gt; 6                   max recall  0.001255     1.000000 399</span>
<span class="co">#&gt; 7              max specificity  0.736186     1.000000   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.198114     0.208337 211</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.180131     0.625181 230</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.194171     0.628250 215</span>
<span class="co">#&gt; 11                     max tns  0.736186 19991.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.736186  4589.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.001255 19991.000000 399</span>
<span class="co">#&gt; 14                     max tps  0.001255  4590.000000 399</span>
<span class="co">#&gt; 15                     max tnr  0.736186     1.000000   0</span>
<span class="co">#&gt; 16                     max fnr  0.736186     0.999782   0</span>
<span class="co">#&gt; 17                     max fpr  0.001255     1.000000 399</span>
<span class="co">#&gt; 18                     max tpr  0.001255     1.000000 399</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span></code></pre></div>
<p>Instead of printing the entire model performance metrics object, it is probably easier to print just the metric that you are interested in comparing. Retrieve test set <strong>AUC</strong>:</p>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">glm_perf1</span><span class="op">)</span>  <span class="co">#0.677449084114</span>
<span class="co">#&gt; [1] 0.677</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">glm_perf2</span><span class="op">)</span>  <span class="co">#0.677675858276</span>
<span class="co">#&gt; [1] 0.677</span></code></pre></div>
<p>Compare test AUC, to the training AUC, and validation AUC:</p>
<div class="sourceCode" id="cb470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compare test AUC to the training AUC and validation AUC</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">glm_fit2</span>, train <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co">#0.674306164325 </span>
<span class="co">#&gt; [1] 0.673</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">glm_fit2</span>, valid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co">#0.675512216705</span>
<span class="co">#&gt; [1] 0.675</span>
<span class="va">glm_fit2</span><span class="op">@</span><span class="va">model</span><span class="op">$</span><span class="va">validation_metrics</span>  <span class="co">#0.675512216705</span>
<span class="co">#&gt; H2OBinomialMetrics: glm</span>
<span class="co">#&gt; ** Reported on validation data. **</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.142</span>
<span class="co">#&gt; RMSE:  0.377</span>
<span class="co">#&gt; LogLoss:  0.451</span>
<span class="co">#&gt; Mean Per-Class Error:  0.37</span>
<span class="co">#&gt; AUC:  0.675</span>
<span class="co">#&gt; AUCPR:  0.316</span>
<span class="co">#&gt; Gini:  0.351</span>
<span class="co">#&gt; R^2:  0.0597</span>
<span class="co">#&gt; Residual Deviance:  22101</span>
<span class="co">#&gt; AIC:  22197</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            0    1    Error         Rate</span>
<span class="co">#&gt; 0      13591 6365 0.318952  =6365/19956</span>
<span class="co">#&gt; 1       1916 2626 0.421841   =1916/4542</span>
<span class="co">#&gt; Totals 15507 8991 0.338028  =8281/24498</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold        value idx</span>
<span class="co">#&gt; 1                       max f1  0.193519     0.388088 217</span>
<span class="co">#&gt; 2                       max f2  0.116672     0.555206 309</span>
<span class="co">#&gt; 3                 max f0point5  0.288405     0.343386 132</span>
<span class="co">#&gt; 4                 max accuracy  0.487882     0.815250  29</span>
<span class="co">#&gt; 5                max precision  0.576333     0.681818   9</span>
<span class="co">#&gt; 6                   max recall  0.004789     1.000000 398</span>
<span class="co">#&gt; 7              max specificity  0.715719     0.999950   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.195417     0.209494 215</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.180760     0.627731 231</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.192639     0.629672 218</span>
<span class="co">#&gt; 11                     max tns  0.715719 19955.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.715719  4542.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.001048 19956.000000 399</span>
<span class="co">#&gt; 14                     max tps  0.004789  4542.000000 398</span>
<span class="co">#&gt; 15                     max tnr  0.715719     0.999950   0</span>
<span class="co">#&gt; 16                     max fnr  0.715719     1.000000   0</span>
<span class="co">#&gt; 17                     max fpr  0.001048     1.000000 399</span>
<span class="co">#&gt; 18                     max tpr  0.004789     1.000000 398</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span></code></pre></div>
</div>
<div id="random-forest-2" class="section level2">
<h2>
<span class="header-section-number">16.5</span> Random Forest<a class="anchor" aria-label="anchor" href="#random-forest-2"><i class="fas fa-link"></i></a>
</h2>
<p>H2O’s Random Forest (RF) implements a distributed version of the standard Random Forest algorithm and variable importance measures. First we will train a basic Random Forest model with default parameters. The Random Forest model will infer the response distribution from the response encoding. A seed is required for reproducibility.</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb471-1" data-line-number="1">rf_fit1 &lt;-<span class="st"> </span><span class="kw">h2o.randomForest</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb471-2" data-line-number="2">                            <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb471-3" data-line-number="3">                            <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb471-4" data-line-number="4">                            <span class="dt">model_id =</span> <span class="st">"rf_fit1"</span>,</a>
<a class="sourceLine" id="cb471-5" data-line-number="5">                            <span class="dt">seed =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb471-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb471-7" data-line-number="7">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb471-8" data-line-number="8"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb471-9" data-line-number="9">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb471-10" data-line-number="10"><span class="st">  </span><span class="er">|====</span><span class="st">                                                                  </span><span class="er">|</span><span class="st">   </span><span class="dv">6</span>%</a>
<a class="sourceLine" id="cb471-11" data-line-number="11">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb471-12" data-line-number="12"><span class="st">  </span><span class="er">|===========</span><span class="st">                                                           </span><span class="er">|</span><span class="st">  </span><span class="dv">16</span>%</a>
<a class="sourceLine" id="cb471-13" data-line-number="13">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb471-14" data-line-number="14"><span class="st">  </span><span class="er">|==================</span><span class="st">                                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">26</span>%</a>
<a class="sourceLine" id="cb471-15" data-line-number="15">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb471-16" data-line-number="16"><span class="st">  </span><span class="er">|=========================</span><span class="st">                                             </span><span class="er">|</span><span class="st">  </span><span class="dv">36</span>%</a>
<a class="sourceLine" id="cb471-17" data-line-number="17">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb471-18" data-line-number="18"><span class="st">  </span><span class="er">|==================================</span><span class="st">                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">48</span>%</a>
<a class="sourceLine" id="cb471-19" data-line-number="19">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb471-20" data-line-number="20"><span class="st">  </span><span class="er">|===========================================</span><span class="st">                           </span><span class="er">|</span><span class="st">  </span><span class="dv">62</span>%</a>
<a class="sourceLine" id="cb471-21" data-line-number="21">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb471-22" data-line-number="22"><span class="st">  </span><span class="er">|====================================================</span><span class="st">                  </span><span class="er">|</span><span class="st">  </span><span class="dv">74</span>%</a>
<a class="sourceLine" id="cb471-23" data-line-number="23">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb471-24" data-line-number="24"><span class="st">  </span><span class="er">|============================================================</span><span class="st">          </span><span class="er">|</span><span class="st">  </span><span class="dv">86</span>%</a>
<a class="sourceLine" id="cb471-25" data-line-number="25">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb471-26" data-line-number="26"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<p>Next, we will increase the number of trees used in the forest by setting <code>ntrees = 100</code>. The default number of trees in an H2O Random Forest is 50, so this RF will be twice as big as the default. Usually increasing the number of trees in a RF will increase performance as well. Unlike Gradient Boosting Machines (GBMs), Random Forests are fairly resistant (although not free from) overfitting. See the GBM example below for additional guidance on preventing overfitting using H2O’s early stopping functionality.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" data-line-number="1">rf_fit2 &lt;-<span class="st"> </span><span class="kw">h2o.randomForest</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb472-2" data-line-number="2">                            <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb472-3" data-line-number="3">                            <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb472-4" data-line-number="4">                            <span class="dt">model_id =</span> <span class="st">"rf_fit2"</span>,</a>
<a class="sourceLine" id="cb472-5" data-line-number="5">                            <span class="co">#validation_frame = valid,  #only used if stopping_rounds &gt; 0</span></a>
<a class="sourceLine" id="cb472-6" data-line-number="6">                            <span class="dt">ntrees =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb472-7" data-line-number="7">                            <span class="dt">seed =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb472-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb472-9" data-line-number="9">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-10" data-line-number="10"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb472-11" data-line-number="11">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-12" data-line-number="12"><span class="st">  </span><span class="er">|====</span><span class="st">                                                                  </span><span class="er">|</span><span class="st">   </span><span class="dv">5</span>%</a>
<a class="sourceLine" id="cb472-13" data-line-number="13">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-14" data-line-number="14"><span class="st">  </span><span class="er">|========</span><span class="st">                                                              </span><span class="er">|</span><span class="st">  </span><span class="dv">11</span>%</a>
<a class="sourceLine" id="cb472-15" data-line-number="15">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-16" data-line-number="16"><span class="st">  </span><span class="er">|===========</span><span class="st">                                                           </span><span class="er">|</span><span class="st">  </span><span class="dv">16</span>%</a>
<a class="sourceLine" id="cb472-17" data-line-number="17">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-18" data-line-number="18"><span class="st">  </span><span class="er">|===============</span><span class="st">                                                       </span><span class="er">|</span><span class="st">  </span><span class="dv">22</span>%</a>
<a class="sourceLine" id="cb472-19" data-line-number="19">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-20" data-line-number="20"><span class="st">  </span><span class="er">|====================</span><span class="st">                                                  </span><span class="er">|</span><span class="st">  </span><span class="dv">29</span>%</a>
<a class="sourceLine" id="cb472-21" data-line-number="21">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-22" data-line-number="22"><span class="st">  </span><span class="er">|=========================</span><span class="st">                                             </span><span class="er">|</span><span class="st">  </span><span class="dv">36</span>%</a>
<a class="sourceLine" id="cb472-23" data-line-number="23">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-24" data-line-number="24"><span class="st">  </span><span class="er">|=============================</span><span class="st">                                         </span><span class="er">|</span><span class="st">  </span><span class="dv">42</span>%</a>
<a class="sourceLine" id="cb472-25" data-line-number="25">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-26" data-line-number="26"><span class="st">  </span><span class="er">|==================================</span><span class="st">                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">49</span>%</a>
<a class="sourceLine" id="cb472-27" data-line-number="27">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-28" data-line-number="28"><span class="st">  </span><span class="er">|=========================================</span><span class="st">                             </span><span class="er">|</span><span class="st">  </span><span class="dv">58</span>%</a>
<a class="sourceLine" id="cb472-29" data-line-number="29">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-30" data-line-number="30"><span class="st">  </span><span class="er">|==============================================</span><span class="st">                        </span><span class="er">|</span><span class="st">  </span><span class="dv">65</span>%</a>
<a class="sourceLine" id="cb472-31" data-line-number="31">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-32" data-line-number="32"><span class="st">  </span><span class="er">|==================================================</span><span class="st">                    </span><span class="er">|</span><span class="st">  </span><span class="dv">72</span>%</a>
<a class="sourceLine" id="cb472-33" data-line-number="33">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-34" data-line-number="34"><span class="st">  </span><span class="er">|=========================================================</span><span class="st">             </span><span class="er">|</span><span class="st">  </span><span class="dv">81</span>%</a>
<a class="sourceLine" id="cb472-35" data-line-number="35">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-36" data-line-number="36"><span class="st">  </span><span class="er">|==============================================================</span><span class="st">        </span><span class="er">|</span><span class="st">  </span><span class="dv">89</span>%</a>
<a class="sourceLine" id="cb472-37" data-line-number="37">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-38" data-line-number="38"><span class="st">  </span><span class="er">|=====================================================================</span><span class="st"> </span><span class="er">|</span><span class="st">  </span><span class="dv">98</span>%</a>
<a class="sourceLine" id="cb472-39" data-line-number="39">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb472-40" data-line-number="40"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<p>Let’s compare the performance of the two RFs:</p>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Let's compare the performance of the two RFs</span>
<span class="va">rf_perf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.performance.html">h2o.performance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">rf_fit1</span>,
                            newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span>
<span class="va">rf_perf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.performance.html">h2o.performance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">rf_fit2</span>,
                            newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span>

<span class="co"># Print model performance</span>
<span class="va">rf_perf1</span>
<span class="co">#&gt; H2OBinomialMetrics: drf</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.144</span>
<span class="co">#&gt; RMSE:  0.379</span>
<span class="co">#&gt; LogLoss:  0.459</span>
<span class="co">#&gt; Mean Per-Class Error:  0.379</span>
<span class="co">#&gt; AUC:  0.663</span>
<span class="co">#&gt; AUCPR:  0.312</span>
<span class="co">#&gt; Gini:  0.327</span>
<span class="co">#&gt; R^2:  0.0519</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            0    1    Error         Rate</span>
<span class="co">#&gt; 0      12842 7149 0.357611  =7149/19991</span>
<span class="co">#&gt; 1       1839 2751 0.400654   =1839/4590</span>
<span class="co">#&gt; Totals 14681 9900 0.365648  =8988/24581</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold        value idx</span>
<span class="co">#&gt; 1                       max f1  0.193397     0.379710 229</span>
<span class="co">#&gt; 2                       max f2  0.077797     0.547982 344</span>
<span class="co">#&gt; 3                 max f0point5  0.277524     0.344251 158</span>
<span class="co">#&gt; 4                 max accuracy  0.543639     0.813799  29</span>
<span class="co">#&gt; 5                max precision  0.817454     1.000000   0</span>
<span class="co">#&gt; 6                   max recall  0.001181     1.000000 399</span>
<span class="co">#&gt; 7              max specificity  0.817454     1.000000   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.252480     0.195090 178</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.186549     0.619826 235</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.192603     0.620890 230</span>
<span class="co">#&gt; 11                     max tns  0.817454 19991.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.817454  4589.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.001181 19991.000000 399</span>
<span class="co">#&gt; 14                     max tps  0.001181  4590.000000 399</span>
<span class="co">#&gt; 15                     max tnr  0.817454     1.000000   0</span>
<span class="co">#&gt; 16                     max fnr  0.817454     0.999782   0</span>
<span class="co">#&gt; 17                     max fpr  0.001181     1.000000 399</span>
<span class="co">#&gt; 18                     max tpr  0.001181     1.000000 399</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>
<span class="va">rf_perf2</span>
<span class="co">#&gt; H2OBinomialMetrics: drf</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.143</span>
<span class="co">#&gt; RMSE:  0.378</span>
<span class="co">#&gt; LogLoss:  0.454</span>
<span class="co">#&gt; Mean Per-Class Error:  0.377</span>
<span class="co">#&gt; AUC:  0.669</span>
<span class="co">#&gt; AUCPR:  0.32</span>
<span class="co">#&gt; Gini:  0.339</span>
<span class="co">#&gt; R^2:  0.0584</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            0    1    Error         Rate</span>
<span class="co">#&gt; 0      13172 6819 0.341103  =6819/19991</span>
<span class="co">#&gt; 1       1891 2699 0.411983   =1891/4590</span>
<span class="co">#&gt; Totals 15063 9518 0.354339  =8710/24581</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold        value idx</span>
<span class="co">#&gt; 1                       max f1  0.196407     0.382620 225</span>
<span class="co">#&gt; 2                       max f2  0.092270     0.549691 331</span>
<span class="co">#&gt; 3                 max f0point5  0.291396     0.349342 144</span>
<span class="co">#&gt; 4                 max accuracy  0.555908     0.813840  20</span>
<span class="co">#&gt; 5                max precision  0.651522     0.785714   5</span>
<span class="co">#&gt; 6                   max recall  0.004212     1.000000 398</span>
<span class="co">#&gt; 7              max specificity  0.711667     0.999950   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.229251     0.204236 194</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.184594     0.619829 235</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.196407     0.623457 225</span>
<span class="co">#&gt; 11                     max tns  0.711667 19990.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.711667  4590.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.002687 19991.000000 399</span>
<span class="co">#&gt; 14                     max tps  0.004212  4590.000000 398</span>
<span class="co">#&gt; 15                     max tnr  0.711667     0.999950   0</span>
<span class="co">#&gt; 16                     max fnr  0.711667     1.000000   0</span>
<span class="co">#&gt; 17                     max fpr  0.002687     1.000000 399</span>
<span class="co">#&gt; 18                     max tpr  0.004212     1.000000 398</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>

<span class="co"># Retrieve test set AUC:</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">rf_perf1</span><span class="op">)</span>  <span class="co"># 0.662266990734</span>
<span class="co">#&gt; [1] 0.663</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">rf_perf2</span><span class="op">)</span>  <span class="co"># 0.66525468051</span>
<span class="co">#&gt; [1] 0.669</span></code></pre></div>
<div id="cross-validate-performance" class="section level3">
<h3>
<span class="header-section-number">16.5.1</span> Cross-validate performance<a class="anchor" aria-label="anchor" href="#cross-validate-performance"><i class="fas fa-link"></i></a>
</h3>
<p>Rather than using held-out test set to evaluate model performance, a user may wish to estimate model performance using cross-validation. Using the RF algorithm (with default model parameters) as an example, we demonstrate how to perform <strong>k-fold</strong> cross-validation using H2O. No custom code or loops are required; you simply specify the number of desired folds in the nfolds argument. Since we are not going to use a test set here, we can use the original (full) dataset, which we called data rather than the subsampled <code>train</code> dataset. Note that this will take approximately <span class="math inline">\(k\)</span> (<code>nfolds</code>) times longer than training a single RF model, since it will train <span class="math inline">\(k\)</span> models in the cross-validation process (trained on <span class="math inline">\(n(k-1)/k\)</span> rows), in addition to the final model trained on the full <code>training_frame</code> dataset with <span class="math inline">\(n\)</span> rows.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" data-line-number="1">rf_fit3 &lt;-<span class="st"> </span><span class="kw">h2o.randomForest</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb474-2" data-line-number="2">                            <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb474-3" data-line-number="3">                            <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb474-4" data-line-number="4">                            <span class="dt">model_id =</span> <span class="st">"rf_fit3"</span>,</a>
<a class="sourceLine" id="cb474-5" data-line-number="5">                            <span class="dt">seed =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb474-6" data-line-number="6">                            <span class="dt">nfolds =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb474-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb474-8" data-line-number="8">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-9" data-line-number="9"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb474-10" data-line-number="10">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-11" data-line-number="11"><span class="st">  </span><span class="er">|=</span><span class="st">                                                                     </span><span class="er">|</span><span class="st">   </span><span class="dv">2</span>%</a>
<a class="sourceLine" id="cb474-12" data-line-number="12">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-13" data-line-number="13"><span class="st">  </span><span class="er">|==</span><span class="st">                                                                    </span><span class="er">|</span><span class="st">   </span><span class="dv">3</span>%</a>
<a class="sourceLine" id="cb474-14" data-line-number="14">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-15" data-line-number="15"><span class="st">  </span><span class="er">|===</span><span class="st">                                                                   </span><span class="er">|</span><span class="st">   </span><span class="dv">4</span>%</a>
<a class="sourceLine" id="cb474-16" data-line-number="16">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-17" data-line-number="17"><span class="st">  </span><span class="er">|====</span><span class="st">                                                                  </span><span class="er">|</span><span class="st">   </span><span class="dv">6</span>%</a>
<a class="sourceLine" id="cb474-18" data-line-number="18">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-19" data-line-number="19"><span class="st">  </span><span class="er">|======</span><span class="st">                                                                </span><span class="er">|</span><span class="st">   </span><span class="dv">8</span>%</a>
<a class="sourceLine" id="cb474-20" data-line-number="20">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-21" data-line-number="21"><span class="st">  </span><span class="er">|=======</span><span class="st">                                                               </span><span class="er">|</span><span class="st">  </span><span class="dv">11</span>%</a>
<a class="sourceLine" id="cb474-22" data-line-number="22">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-23" data-line-number="23"><span class="st">  </span><span class="er">|=========</span><span class="st">                                                             </span><span class="er">|</span><span class="st">  </span><span class="dv">13</span>%</a>
<a class="sourceLine" id="cb474-24" data-line-number="24">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-25" data-line-number="25"><span class="st">  </span><span class="er">|===========</span><span class="st">                                                           </span><span class="er">|</span><span class="st">  </span><span class="dv">16</span>%</a>
<a class="sourceLine" id="cb474-26" data-line-number="26">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-27" data-line-number="27"><span class="st">  </span><span class="er">|============</span><span class="st">                                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">17</span>%</a>
<a class="sourceLine" id="cb474-28" data-line-number="28">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-29" data-line-number="29"><span class="st">  </span><span class="er">|=============</span><span class="st">                                                         </span><span class="er">|</span><span class="st">  </span><span class="dv">19</span>%</a>
<a class="sourceLine" id="cb474-30" data-line-number="30">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-31" data-line-number="31"><span class="st">  </span><span class="er">|==============</span><span class="st">                                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">20</span>%</a>
<a class="sourceLine" id="cb474-32" data-line-number="32">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-33" data-line-number="33"><span class="st">  </span><span class="er">|===============</span><span class="st">                                                       </span><span class="er">|</span><span class="st">  </span><span class="dv">22</span>%</a>
<a class="sourceLine" id="cb474-34" data-line-number="34">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-35" data-line-number="35"><span class="st">  </span><span class="er">|================</span><span class="st">                                                      </span><span class="er">|</span><span class="st">  </span><span class="dv">23</span>%</a>
<a class="sourceLine" id="cb474-36" data-line-number="36">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-37" data-line-number="37"><span class="st">  </span><span class="er">|==================</span><span class="st">                                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">26</span>%</a>
<a class="sourceLine" id="cb474-38" data-line-number="38">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-39" data-line-number="39"><span class="st">  </span><span class="er">|====================</span><span class="st">                                                  </span><span class="er">|</span><span class="st">  </span><span class="dv">28</span>%</a>
<a class="sourceLine" id="cb474-40" data-line-number="40">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-41" data-line-number="41"><span class="st">  </span><span class="er">|=====================</span><span class="st">                                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">31</span>%</a>
<a class="sourceLine" id="cb474-42" data-line-number="42">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-43" data-line-number="43"><span class="st">  </span><span class="er">|=======================</span><span class="st">                                               </span><span class="er">|</span><span class="st">  </span><span class="dv">32</span>%</a>
<a class="sourceLine" id="cb474-44" data-line-number="44">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-45" data-line-number="45"><span class="st">  </span><span class="er">|========================</span><span class="st">                                              </span><span class="er">|</span><span class="st">  </span><span class="dv">34</span>%</a>
<a class="sourceLine" id="cb474-46" data-line-number="46">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-47" data-line-number="47"><span class="st">  </span><span class="er">|=========================</span><span class="st">                                             </span><span class="er">|</span><span class="st">  </span><span class="dv">36</span>%</a>
<a class="sourceLine" id="cb474-48" data-line-number="48">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-49" data-line-number="49"><span class="st">  </span><span class="er">|==========================</span><span class="st">                                            </span><span class="er">|</span><span class="st">  </span><span class="dv">37</span>%</a>
<a class="sourceLine" id="cb474-50" data-line-number="50">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-51" data-line-number="51"><span class="st">  </span><span class="er">|===========================</span><span class="st">                                           </span><span class="er">|</span><span class="st">  </span><span class="dv">39</span>%</a>
<a class="sourceLine" id="cb474-52" data-line-number="52">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-53" data-line-number="53"><span class="st">  </span><span class="er">|============================</span><span class="st">                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">41</span>%</a>
<a class="sourceLine" id="cb474-54" data-line-number="54">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-55" data-line-number="55"><span class="st">  </span><span class="er">|==============================</span><span class="st">                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">43</span>%</a>
<a class="sourceLine" id="cb474-56" data-line-number="56">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-57" data-line-number="57"><span class="st">  </span><span class="er">|===============================</span><span class="st">                                       </span><span class="er">|</span><span class="st">  </span><span class="dv">45</span>%</a>
<a class="sourceLine" id="cb474-58" data-line-number="58">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-59" data-line-number="59"><span class="st">  </span><span class="er">|=================================</span><span class="st">                                     </span><span class="er">|</span><span class="st">  </span><span class="dv">47</span>%</a>
<a class="sourceLine" id="cb474-60" data-line-number="60">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-61" data-line-number="61"><span class="st">  </span><span class="er">|===================================</span><span class="st">                                   </span><span class="er">|</span><span class="st">  </span><span class="dv">50</span>%</a>
<a class="sourceLine" id="cb474-62" data-line-number="62">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-63" data-line-number="63"><span class="st">  </span><span class="er">|====================================</span><span class="st">                                  </span><span class="er">|</span><span class="st">  </span><span class="dv">51</span>%</a>
<a class="sourceLine" id="cb474-64" data-line-number="64">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-65" data-line-number="65"><span class="st">  </span><span class="er">|=====================================</span><span class="st">                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">53</span>%</a>
<a class="sourceLine" id="cb474-66" data-line-number="66">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-67" data-line-number="67"><span class="st">  </span><span class="er">|======================================</span><span class="st">                                </span><span class="er">|</span><span class="st">  </span><span class="dv">54</span>%</a>
<a class="sourceLine" id="cb474-68" data-line-number="68">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-69" data-line-number="69"><span class="st">  </span><span class="er">|=======================================</span><span class="st">                               </span><span class="er">|</span><span class="st">  </span><span class="dv">55</span>%</a>
<a class="sourceLine" id="cb474-70" data-line-number="70">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-71" data-line-number="71"><span class="st">  </span><span class="er">|========================================</span><span class="st">                              </span><span class="er">|</span><span class="st">  </span><span class="dv">57</span>%</a>
<a class="sourceLine" id="cb474-72" data-line-number="72">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-73" data-line-number="73"><span class="st">  </span><span class="er">|==========================================</span><span class="st">                            </span><span class="er">|</span><span class="st">  </span><span class="dv">60</span>%</a>
<a class="sourceLine" id="cb474-74" data-line-number="74">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-75" data-line-number="75"><span class="st">  </span><span class="er">|===========================================</span><span class="st">                           </span><span class="er">|</span><span class="st">  </span><span class="dv">62</span>%</a>
<a class="sourceLine" id="cb474-76" data-line-number="76">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-77" data-line-number="77"><span class="st">  </span><span class="er">|=============================================</span><span class="st">                         </span><span class="er">|</span><span class="st">  </span><span class="dv">64</span>%</a>
<a class="sourceLine" id="cb474-78" data-line-number="78">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-79" data-line-number="79"><span class="st">  </span><span class="er">|==============================================</span><span class="st">                        </span><span class="er">|</span><span class="st">  </span><span class="dv">66</span>%</a>
<a class="sourceLine" id="cb474-80" data-line-number="80">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-81" data-line-number="81"><span class="st">  </span><span class="er">|===============================================</span><span class="st">                       </span><span class="er">|</span><span class="st">  </span><span class="dv">68</span>%</a>
<a class="sourceLine" id="cb474-82" data-line-number="82">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-83" data-line-number="83"><span class="st">  </span><span class="er">|=================================================</span><span class="st">                     </span><span class="er">|</span><span class="st">  </span><span class="dv">69</span>%</a>
<a class="sourceLine" id="cb474-84" data-line-number="84">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-85" data-line-number="85"><span class="st">  </span><span class="er">|=================================================</span><span class="st">                     </span><span class="er">|</span><span class="st">  </span><span class="dv">71</span>%</a>
<a class="sourceLine" id="cb474-86" data-line-number="86">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-87" data-line-number="87"><span class="st">  </span><span class="er">|==================================================</span><span class="st">                    </span><span class="er">|</span><span class="st">  </span><span class="dv">72</span>%</a>
<a class="sourceLine" id="cb474-88" data-line-number="88">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-89" data-line-number="89"><span class="st">  </span><span class="er">|====================================================</span><span class="st">                  </span><span class="er">|</span><span class="st">  </span><span class="dv">74</span>%</a>
<a class="sourceLine" id="cb474-90" data-line-number="90">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-91" data-line-number="91"><span class="st">  </span><span class="er">|======================================================</span><span class="st">                </span><span class="er">|</span><span class="st">  </span><span class="dv">77</span>%</a>
<a class="sourceLine" id="cb474-92" data-line-number="92">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-93" data-line-number="93"><span class="st">  </span><span class="er">|========================================================</span><span class="st">              </span><span class="er">|</span><span class="st">  </span><span class="dv">79</span>%</a>
<a class="sourceLine" id="cb474-94" data-line-number="94">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-95" data-line-number="95"><span class="st">  </span><span class="er">|=========================================================</span><span class="st">             </span><span class="er">|</span><span class="st">  </span><span class="dv">82</span>%</a>
<a class="sourceLine" id="cb474-96" data-line-number="96">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-97" data-line-number="97"><span class="st">  </span><span class="er">|==========================================================</span><span class="st">            </span><span class="er">|</span><span class="st">  </span><span class="dv">83</span>%</a>
<a class="sourceLine" id="cb474-98" data-line-number="98">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-99" data-line-number="99"><span class="st">  </span><span class="er">|============================================================</span><span class="st">          </span><span class="er">|</span><span class="st">  </span><span class="dv">85</span>%</a>
<a class="sourceLine" id="cb474-100" data-line-number="100">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-101" data-line-number="101"><span class="st">  </span><span class="er">|=============================================================</span><span class="st">         </span><span class="er">|</span><span class="st">  </span><span class="dv">87</span>%</a>
<a class="sourceLine" id="cb474-102" data-line-number="102">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-103" data-line-number="103"><span class="st">  </span><span class="er">|==============================================================</span><span class="st">        </span><span class="er">|</span><span class="st">  </span><span class="dv">89</span>%</a>
<a class="sourceLine" id="cb474-104" data-line-number="104">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-105" data-line-number="105"><span class="st">  </span><span class="er">|===============================================================</span><span class="st">       </span><span class="er">|</span><span class="st">  </span><span class="dv">91</span>%</a>
<a class="sourceLine" id="cb474-106" data-line-number="106">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-107" data-line-number="107"><span class="st">  </span><span class="er">|=================================================================</span><span class="st">     </span><span class="er">|</span><span class="st">  </span><span class="dv">93</span>%</a>
<a class="sourceLine" id="cb474-108" data-line-number="108">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-109" data-line-number="109"><span class="st">  </span><span class="er">|===================================================================</span><span class="st">   </span><span class="er">|</span><span class="st">  </span><span class="dv">96</span>%</a>
<a class="sourceLine" id="cb474-110" data-line-number="110">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-111" data-line-number="111"><span class="st">  </span><span class="er">|=====================================================================</span><span class="st"> </span><span class="er">|</span><span class="st">  </span><span class="dv">99</span>%</a>
<a class="sourceLine" id="cb474-112" data-line-number="112">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb474-113" data-line-number="113"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<p>To evaluate the cross-validated AUC, do the following:</p>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># To evaluate the cross-validated AUC, do the following:</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">rf_fit3</span>, xval <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># 0.661201482614</span>
<span class="co">#&gt; [1] 0.659</span></code></pre></div>
</div>
</div>
<div id="gradient-boosting-machine-gbm" class="section level2">
<h2>
<span class="header-section-number">16.6</span> Gradient Boosting Machine (GBM)<a class="anchor" aria-label="anchor" href="#gradient-boosting-machine-gbm"><i class="fas fa-link"></i></a>
</h2>
<p>H2O’s Gradient Boosting Machine (GBM) offers a Stochastic GBM, which can
increase performance quite a bit compared to the original GBM implementation.</p>
<p>Now we will train a basic GBM model. The GBM model will infer the response distribution from the response encoding if not specified explicitly through the <code>distribution</code> argument. A seed is required for reproducibility.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" data-line-number="1">gbm_fit1 &lt;-<span class="st"> </span><span class="kw">h2o.gbm</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb476-2" data-line-number="2">                    <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb476-3" data-line-number="3">                    <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb476-4" data-line-number="4">                    <span class="dt">model_id =</span> <span class="st">"gbm_fit1"</span>,</a>
<a class="sourceLine" id="cb476-5" data-line-number="5">                    <span class="dt">seed =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb476-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb476-7" data-line-number="7">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb476-8" data-line-number="8"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb476-9" data-line-number="9">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb476-10" data-line-number="10"><span class="st">  </span><span class="er">|===============</span><span class="st">                                                       </span><span class="er">|</span><span class="st">  </span><span class="dv">22</span>%</a>
<a class="sourceLine" id="cb476-11" data-line-number="11">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb476-12" data-line-number="12"><span class="st">  </span><span class="er">|==================================</span><span class="st">                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">48</span>%</a>
<a class="sourceLine" id="cb476-13" data-line-number="13">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb476-14" data-line-number="14"><span class="st">  </span><span class="er">|====================================================</span><span class="st">                  </span><span class="er">|</span><span class="st">  </span><span class="dv">74</span>%</a>
<a class="sourceLine" id="cb476-15" data-line-number="15">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb476-16" data-line-number="16"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<p>Next, we will increase the number of trees used in the GBM by setting <code>ntrees=500</code>. The default number of trees in an H2O GBM is <code>50</code>, so this GBM will trained using ten times the default. Increasing the number of trees in a GBM is one way to increase performance of the model, however, you have to be careful not to overfit your model to the training data by using too many trees. To automatically find the optimal number of trees, you must use H2O’s early stopping functionality. This example will not do that, however, the following example will.</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb477-1" data-line-number="1">gbm_fit2 &lt;-<span class="st"> </span><span class="kw">h2o.gbm</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb477-2" data-line-number="2">                    <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb477-3" data-line-number="3">                    <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb477-4" data-line-number="4">                    <span class="dt">model_id =</span> <span class="st">"gbm_fit2"</span>,</a>
<a class="sourceLine" id="cb477-5" data-line-number="5">                    <span class="co">#validation_frame = valid,  #only used if stopping_rounds &gt; 0</span></a>
<a class="sourceLine" id="cb477-6" data-line-number="6">                    <span class="dt">ntrees =</span> <span class="dv">500</span>,</a>
<a class="sourceLine" id="cb477-7" data-line-number="7">                    <span class="dt">seed =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb477-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb477-9" data-line-number="9">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb477-10" data-line-number="10"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb477-11" data-line-number="11">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb477-12" data-line-number="12"><span class="st">  </span><span class="er">|==</span><span class="st">                                                                    </span><span class="er">|</span><span class="st">   </span><span class="dv">3</span>%</a>
<a class="sourceLine" id="cb477-13" data-line-number="13">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb477-14" data-line-number="14"><span class="st">  </span><span class="er">|====</span><span class="st">                                                                  </span><span class="er">|</span><span class="st">   </span><span class="dv">6</span>%</a>
<a class="sourceLine" id="cb477-15" data-line-number="15">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb477-16" data-line-number="16"><span class="st">  </span><span class="er">|======</span><span class="st">                                                                </span><span class="er">|</span><span class="st">   </span><span class="dv">9</span>%</a>
<a class="sourceLine" id="cb477-17" data-line-number="17">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb477-18" data-line-number="18"><span class="st">  </span><span class="er">|========</span><span class="st">                                                              </span><span class="er">|</span><span class="st">  </span><span class="dv">11</span>%</a>
<a class="sourceLine" id="cb477-19" data-line-number="19">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb477-20" data-line-number="20"><span class="st">  </span><span class="er">|============</span><span class="st">                                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">18</span>%</a>
<a class="sourceLine" id="cb477-21" data-line-number="21">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb477-22" data-line-number="22"><span class="st">  </span><span class="er">|==================</span><span class="st">                                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">25</span>%</a>
<a class="sourceLine" id="cb477-23" data-line-number="23">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb477-24" data-line-number="24"><span class="st">  </span><span class="er">|=================================</span><span class="st">                                     </span><span class="er">|</span><span class="st">  </span><span class="dv">48</span>%</a>
<a class="sourceLine" id="cb477-25" data-line-number="25">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb477-26" data-line-number="26"><span class="st">  </span><span class="er">|===================================================</span><span class="st">                   </span><span class="er">|</span><span class="st">  </span><span class="dv">73</span>%</a>
<a class="sourceLine" id="cb477-27" data-line-number="27">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb477-28" data-line-number="28"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<p>We will again set <code>ntrees = 500</code>, however, this time we will use early stopping in order to prevent overfitting (from too many trees). All of H2O’s algorithms have early stopping available, however early stopping is not enabled by default (with the exception of Deep Learning).</p>
<p>There are several parameters that should be used to control early stopping. The three that are common to all the algorithms are: <code>stopping_rounds</code>, <code>stopping_metric</code> and <code>stopping_tolerance</code>. The stopping metric is the metric by which you’d like to measure performance, and so we will choose AUC here. The <code>score_tree_interval</code> is a parameter specific to the Random Forest model and the GBM. Setting <code>score_tree_interval = 5</code> will score the model after every five trees. The parameters we have set below specify that the model will stop training after there have been three scoring intervals where the AUC has not increased more than <span class="math inline">\(0.0005\)</span>. Since we have specified a validation frame, the stopping tolerance will be computed on validation AUC rather than training AUC.</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb478-1" data-line-number="1">gbm_fit3 &lt;-<span class="st"> </span><span class="kw">h2o.gbm</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb478-2" data-line-number="2">                    <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb478-3" data-line-number="3">                    <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb478-4" data-line-number="4">                    <span class="dt">model_id =</span> <span class="st">"gbm_fit3"</span>,</a>
<a class="sourceLine" id="cb478-5" data-line-number="5">                    <span class="dt">validation_frame =</span> valid,  <span class="co">#only used if stopping_rounds &gt; 0</span></a>
<a class="sourceLine" id="cb478-6" data-line-number="6">                    <span class="dt">ntrees =</span> <span class="dv">500</span>,</a>
<a class="sourceLine" id="cb478-7" data-line-number="7">                    <span class="dt">score_tree_interval =</span> <span class="dv">5</span>,      <span class="co">#used for early stopping</span></a>
<a class="sourceLine" id="cb478-8" data-line-number="8">                    <span class="dt">stopping_rounds =</span> <span class="dv">3</span>,          <span class="co">#used for early stopping</span></a>
<a class="sourceLine" id="cb478-9" data-line-number="9">                    <span class="dt">stopping_metric =</span> <span class="st">"AUC"</span>,      <span class="co">#used for early stopping</span></a>
<a class="sourceLine" id="cb478-10" data-line-number="10">                    <span class="dt">stopping_tolerance =</span> <span class="fl">0.0005</span>,  <span class="co">#used for early stopping</span></a>
<a class="sourceLine" id="cb478-11" data-line-number="11">                    <span class="dt">seed =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb478-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb478-13" data-line-number="13">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb478-14" data-line-number="14"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb478-15" data-line-number="15">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb478-16" data-line-number="16"><span class="st">  </span><span class="er">|===</span><span class="st">                                                                   </span><span class="er">|</span><span class="st">   </span><span class="dv">4</span>%</a>
<a class="sourceLine" id="cb478-17" data-line-number="17">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb478-18" data-line-number="18"><span class="st">  </span><span class="er">|======</span><span class="st">                                                                </span><span class="er">|</span><span class="st">   </span><span class="dv">9</span>%</a>
<a class="sourceLine" id="cb478-19" data-line-number="19">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb478-20" data-line-number="20"><span class="st">  </span><span class="er">|==========</span><span class="st">                                                            </span><span class="er">|</span><span class="st">  </span><span class="dv">14</span>%</a>
<a class="sourceLine" id="cb478-21" data-line-number="21">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb478-22" data-line-number="22"><span class="st">  </span><span class="er">|============</span><span class="st">                                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">18</span>%</a>
<a class="sourceLine" id="cb478-23" data-line-number="23">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb478-24" data-line-number="24"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<p>Let’s compare the performance of the two GBMs:</p>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Let's compare the performance of the two GBMs</span>
<span class="va">gbm_perf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.performance.html">h2o.performance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">gbm_fit1</span>,
                             newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span>
<span class="va">gbm_perf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.performance.html">h2o.performance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">gbm_fit2</span>,
                             newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span>
<span class="va">gbm_perf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.performance.html">h2o.performance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">gbm_fit3</span>,
                             newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span>

<span class="co"># Print model performance</span>
<span class="va">gbm_perf1</span>
<span class="co">#&gt; H2OBinomialMetrics: gbm</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.141</span>
<span class="co">#&gt; RMSE:  0.376</span>
<span class="co">#&gt; LogLoss:  0.448</span>
<span class="co">#&gt; Mean Per-Class Error:  0.367</span>
<span class="co">#&gt; AUC:  0.684</span>
<span class="co">#&gt; AUCPR:  0.332</span>
<span class="co">#&gt; Gini:  0.368</span>
<span class="co">#&gt; R^2:  0.0684</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            0     1    Error         Rate</span>
<span class="co">#&gt; 0      12143  7848 0.392577  =7848/19991</span>
<span class="co">#&gt; 1       1571  3019 0.342266   =1571/4590</span>
<span class="co">#&gt; Totals 13714 10867 0.383182  =9419/24581</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold        value idx</span>
<span class="co">#&gt; 1                       max f1  0.171139     0.390632 251</span>
<span class="co">#&gt; 2                       max f2  0.108885     0.560103 328</span>
<span class="co">#&gt; 3                 max f0point5  0.285149     0.356430 146</span>
<span class="co">#&gt; 4                 max accuracy  0.510077     0.814410  27</span>
<span class="co">#&gt; 5                max precision  0.601699     0.636364   8</span>
<span class="co">#&gt; 6                   max recall  0.037543     1.000000 398</span>
<span class="co">#&gt; 7              max specificity  0.719189     0.999950   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.220471     0.215401 199</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.176689     0.628540 244</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.170225     0.632624 252</span>
<span class="co">#&gt; 11                     max tns  0.719189 19990.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.719189  4590.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.033483 19991.000000 399</span>
<span class="co">#&gt; 14                     max tps  0.037543  4590.000000 398</span>
<span class="co">#&gt; 15                     max tnr  0.719189     0.999950   0</span>
<span class="co">#&gt; 16                     max fnr  0.719189     1.000000   0</span>
<span class="co">#&gt; 17                     max fpr  0.033483     1.000000 399</span>
<span class="co">#&gt; 18                     max tpr  0.037543     1.000000 398</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>
<span class="va">gbm_perf2</span>
<span class="co">#&gt; H2OBinomialMetrics: gbm</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.142</span>
<span class="co">#&gt; RMSE:  0.376</span>
<span class="co">#&gt; LogLoss:  0.449</span>
<span class="co">#&gt; Mean Per-Class Error:  0.367</span>
<span class="co">#&gt; AUC:  0.684</span>
<span class="co">#&gt; AUCPR:  0.329</span>
<span class="co">#&gt; Gini:  0.368</span>
<span class="co">#&gt; R^2:  0.0673</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            0    1    Error         Rate</span>
<span class="co">#&gt; 0      13661 6330 0.316642  =6330/19991</span>
<span class="co">#&gt; 1       1918 2672 0.417865   =1918/4590</span>
<span class="co">#&gt; Totals 15579 9002 0.335544  =8248/24581</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold        value idx</span>
<span class="co">#&gt; 1                       max f1  0.189615     0.393172 234</span>
<span class="co">#&gt; 2                       max f2  0.096969     0.558918 332</span>
<span class="co">#&gt; 3                 max f0point5  0.278776     0.359560 160</span>
<span class="co">#&gt; 4                 max accuracy  0.521287     0.814287  38</span>
<span class="co">#&gt; 5                max precision  0.901295     1.000000   0</span>
<span class="co">#&gt; 6                   max recall  0.018504     1.000000 398</span>
<span class="co">#&gt; 7              max specificity  0.901295     1.000000   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.231089     0.217255 196</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.174914     0.630834 249</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.156944     0.633792 267</span>
<span class="co">#&gt; 11                     max tns  0.901295 19991.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.901295  4589.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.010794 19991.000000 399</span>
<span class="co">#&gt; 14                     max tps  0.018504  4590.000000 398</span>
<span class="co">#&gt; 15                     max tnr  0.901295     1.000000   0</span>
<span class="co">#&gt; 16                     max fnr  0.901295     0.999782   0</span>
<span class="co">#&gt; 17                     max fpr  0.010794     1.000000 399</span>
<span class="co">#&gt; 18                     max tpr  0.018504     1.000000 398</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>
<span class="va">gbm_perf3</span>
<span class="co">#&gt; H2OBinomialMetrics: gbm</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.141</span>
<span class="co">#&gt; RMSE:  0.376</span>
<span class="co">#&gt; LogLoss:  0.448</span>
<span class="co">#&gt; Mean Per-Class Error:  0.367</span>
<span class="co">#&gt; AUC:  0.684</span>
<span class="co">#&gt; AUCPR:  0.331</span>
<span class="co">#&gt; Gini:  0.369</span>
<span class="co">#&gt; R^2:  0.0683</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            0    1    Error         Rate</span>
<span class="co">#&gt; 0      13652 6339 0.317093  =6339/19991</span>
<span class="co">#&gt; 1       1917 2673 0.417647   =1917/4590</span>
<span class="co">#&gt; Totals 15569 9012 0.335869  =8256/24581</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold        value idx</span>
<span class="co">#&gt; 1                       max f1  0.189870     0.393030 234</span>
<span class="co">#&gt; 2                       max f2  0.109837     0.559580 321</span>
<span class="co">#&gt; 3                 max f0point5  0.294571     0.356508 148</span>
<span class="co">#&gt; 4                 max accuracy  0.510869     0.814572  40</span>
<span class="co">#&gt; 5                max precision  0.797620     1.000000   0</span>
<span class="co">#&gt; 6                   max recall  0.026373     1.000000 397</span>
<span class="co">#&gt; 7              max specificity  0.797620     1.000000   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.231530     0.218255 197</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.176566     0.631808 248</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.175468     0.633400 249</span>
<span class="co">#&gt; 11                     max tns  0.797620 19991.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.797620  4589.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.016648 19991.000000 399</span>
<span class="co">#&gt; 14                     max tps  0.026373  4590.000000 397</span>
<span class="co">#&gt; 15                     max tnr  0.797620     1.000000   0</span>
<span class="co">#&gt; 16                     max fnr  0.797620     0.999782   0</span>
<span class="co">#&gt; 17                     max fpr  0.016648     1.000000 399</span>
<span class="co">#&gt; 18                     max tpr  0.026373     1.000000 397</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>

<span class="co"># Retreive test set AUC</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">gbm_perf1</span><span class="op">)</span>  <span class="co"># 0.682765594191</span>
<span class="co">#&gt; [1] 0.684</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">gbm_perf2</span><span class="op">)</span>  <span class="co"># 0.671854616713</span>
<span class="co">#&gt; [1] 0.684</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">gbm_perf3</span><span class="op">)</span>  <span class="co"># 0.68309902855</span>
<span class="co">#&gt; [1] 0.684</span></code></pre></div>
<p>To examine the scoring history, use the <code>scoring_history</code> method on a trained model. If <code>score_tree_interval</code> is not specified, it will score at various intervals, as we can see for <code><a href="https://rdrr.io/pkg/h2o/man/h2o.scoreHistory.html">h2o.scoreHistory()</a></code> below. However, regular 5-tree intervals are used for <code><a href="https://rdrr.io/pkg/h2o/man/h2o.scoreHistory.html">h2o.scoreHistory()</a></code>. The <code>gbm_fit2</code> was trained only using a training set (no validation set), so the scoring history is calculated for training set performance metrics only.</p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.scoreHistory.html">h2o.scoreHistory</a></span><span class="op">(</span><span class="va">gbm_fit2</span><span class="op">)</span>
<span class="co">#&gt; Scoring History: </span>
<span class="co">#&gt;             timestamp   duration number_of_trees training_rmse training_logloss</span>
<span class="co">#&gt; 1 2020-11-18 07:56:22  0.001 sec               0       0.38563          0.47403</span>
<span class="co">#&gt; 2 2020-11-18 07:56:22  0.073 sec               1       0.38370          0.46913</span>
<span class="co">#&gt; 3 2020-11-18 07:56:22  0.115 sec               2       0.38206          0.46512</span>
<span class="co">#&gt; 4 2020-11-18 07:56:22  0.158 sec               3       0.38069          0.46184</span>
<span class="co">#&gt; 5 2020-11-18 07:56:22  0.200 sec               4       0.37954          0.45912</span>
<span class="co">#&gt;   training_auc training_pr_auc training_lift training_classification_error</span>
<span class="co">#&gt; 1      0.50000         0.18175       1.00000                       0.81825</span>
<span class="co">#&gt; 2      0.65779         0.30158       2.68330                       0.40069</span>
<span class="co">#&gt; 3      0.66583         0.31082       2.79399                       0.33325</span>
<span class="co">#&gt; 4      0.66851         0.31576       2.97100                       0.34475</span>
<span class="co">#&gt; 5      0.67011         0.31825       2.97544                       0.33180</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt;              timestamp   duration number_of_trees training_rmse</span>
<span class="co">#&gt; 54 2020-11-18 07:56:26  3.796 sec              53       0.36668</span>
<span class="co">#&gt; 55 2020-11-18 07:56:26  3.868 sec              54       0.36659</span>
<span class="co">#&gt; 56 2020-11-18 07:56:26  3.941 sec              55       0.36651</span>
<span class="co">#&gt; 57 2020-11-18 07:56:26  4.016 sec              56       0.36642</span>
<span class="co">#&gt; 58 2020-11-18 07:56:30  8.019 sec             358       0.36129</span>
<span class="co">#&gt; 59 2020-11-18 07:56:31  9.101 sec             500       0.36129</span>
<span class="co">#&gt;    training_logloss training_auc training_pr_auc training_lift</span>
<span class="co">#&gt; 54          0.42934      0.71695         0.37739       3.70322</span>
<span class="co">#&gt; 55          0.42915      0.71733         0.37780       3.71279</span>
<span class="co">#&gt; 56          0.42899      0.71764         0.37855       3.70801</span>
<span class="co">#&gt; 57          0.42877      0.71805         0.37921       3.71279</span>
<span class="co">#&gt; 58          0.41770      0.74024         0.41870       4.25823</span>
<span class="co">#&gt; 59          0.41770      0.74024         0.41870       4.25823</span>
<span class="co">#&gt;    training_classification_error</span>
<span class="co">#&gt; 54                       0.29613</span>
<span class="co">#&gt; 55                       0.30007</span>
<span class="co">#&gt; 56                       0.29464</span>
<span class="co">#&gt; 57                       0.29746</span>
<span class="co">#&gt; 58                       0.25719</span>
<span class="co">#&gt; 59                       0.25719</span></code></pre></div>
<p>When early stopping is used, we see that training stopped at <span class="math inline">\(105\)</span> trees instead of the full <span class="math inline">\(500\)</span>. Since we used a validation set in <code>gbm_fit3</code>, both training and validation performance metrics are stored in the scoring history object. Take a look at the validation AUC to observe that the correct stopping tolerance was enforced.</p>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.scoreHistory.html">h2o.scoreHistory</a></span><span class="op">(</span><span class="va">gbm_fit3</span><span class="op">)</span>
<span class="co">#&gt; Scoring History: </span>
<span class="co">#&gt;              timestamp   duration number_of_trees training_rmse</span>
<span class="co">#&gt; 1  2020-11-18 07:56:32  0.002 sec               0       0.38563</span>
<span class="co">#&gt; 2  2020-11-18 07:56:33  0.202 sec               5       0.37853</span>
<span class="co">#&gt; 3  2020-11-18 07:56:33  0.442 sec              10       0.37508</span>
<span class="co">#&gt; 4  2020-11-18 07:56:33  0.691 sec              15       0.37307</span>
<span class="co">#&gt; 5  2020-11-18 07:56:33  0.909 sec              20       0.37152</span>
<span class="co">#&gt; 6  2020-11-18 07:56:34  1.131 sec              25       0.37041</span>
<span class="co">#&gt; 7  2020-11-18 07:56:34  1.345 sec              30       0.36947</span>
<span class="co">#&gt; 8  2020-11-18 07:56:34  1.557 sec              35       0.36877</span>
<span class="co">#&gt; 9  2020-11-18 07:56:34  1.769 sec              40       0.36808</span>
<span class="co">#&gt; 10 2020-11-18 07:56:34  1.983 sec              45       0.36748</span>
<span class="co">#&gt; 11 2020-11-18 07:56:35  2.230 sec              50       0.36699</span>
<span class="co">#&gt; 12 2020-11-18 07:56:35  2.439 sec              55       0.36651</span>
<span class="co">#&gt; 13 2020-11-18 07:56:35  2.649 sec              60       0.36607</span>
<span class="co">#&gt; 14 2020-11-18 07:56:35  2.870 sec              65       0.36574</span>
<span class="co">#&gt; 15 2020-11-18 07:56:36  3.131 sec              70       0.36531</span>
<span class="co">#&gt; 16 2020-11-18 07:56:36  3.380 sec              75       0.36503</span>
<span class="co">#&gt; 17 2020-11-18 07:56:36  3.615 sec              80       0.36460</span>
<span class="co">#&gt; 18 2020-11-18 07:56:36  3.853 sec              85       0.36426</span>
<span class="co">#&gt; 19 2020-11-18 07:56:37  4.100 sec              90       0.36394</span>
<span class="co">#&gt; 20 2020-11-18 07:56:37  4.338 sec              95       0.36362</span>
<span class="co">#&gt;    training_logloss training_auc training_pr_auc training_lift</span>
<span class="co">#&gt; 1           0.47403      0.50000         0.18175       1.00000</span>
<span class="co">#&gt; 2           0.45676      0.67362         0.32214       3.04518</span>
<span class="co">#&gt; 3           0.44884      0.68117         0.33334       3.19128</span>
<span class="co">#&gt; 4           0.44424      0.68708         0.34115       3.30132</span>
<span class="co">#&gt; 5           0.44060      0.69499         0.34944       3.46878</span>
<span class="co">#&gt; 6           0.43800      0.69983         0.35483       3.47356</span>
<span class="co">#&gt; 7           0.43578      0.70425         0.36018       3.48792</span>
<span class="co">#&gt; 8           0.43410      0.70747         0.36382       3.53576</span>
<span class="co">#&gt; 9           0.43252      0.71082         0.36841       3.61710</span>
<span class="co">#&gt; 10          0.43116      0.71346         0.37187       3.66495</span>
<span class="co">#&gt; 11          0.43002      0.71567         0.37501       3.66016</span>
<span class="co">#&gt; 12          0.42899      0.71764         0.37855       3.70801</span>
<span class="co">#&gt; 13          0.42801      0.71952         0.38161       3.73193</span>
<span class="co">#&gt; 14          0.42726      0.72093         0.38415       3.78934</span>
<span class="co">#&gt; 15          0.42632      0.72277         0.38738       3.82762</span>
<span class="co">#&gt; 16          0.42572      0.72396         0.38959       3.85154</span>
<span class="co">#&gt; 17          0.42477      0.72595         0.39290       3.95202</span>
<span class="co">#&gt; 18          0.42407      0.72713         0.39553       3.99508</span>
<span class="co">#&gt; 19          0.42338      0.72852         0.39823       4.02857</span>
<span class="co">#&gt; 20          0.42272      0.72984         0.40073       4.02378</span>
<span class="co">#&gt;    training_classification_error validation_rmse validation_logloss</span>
<span class="co">#&gt; 1                        0.81825         0.38864            0.47953</span>
<span class="co">#&gt; 2                        0.32117         0.38233            0.46398</span>
<span class="co">#&gt; 3                        0.32202         0.37958            0.45742</span>
<span class="co">#&gt; 4                        0.32027         0.37828            0.45428</span>
<span class="co">#&gt; 5                        0.33371         0.37739            0.45210</span>
<span class="co">#&gt; 6                        0.32537         0.37676            0.45053</span>
<span class="co">#&gt; 7                        0.29722         0.37636            0.44949</span>
<span class="co">#&gt; 8                        0.29544         0.37604            0.44866</span>
<span class="co">#&gt; 9                        0.28871         0.37587            0.44818</span>
<span class="co">#&gt; 10                       0.30181         0.37574            0.44781</span>
<span class="co">#&gt; 11                       0.30144         0.37560            0.44744</span>
<span class="co">#&gt; 12                       0.29464         0.37552            0.44718</span>
<span class="co">#&gt; 13                       0.30343         0.37547            0.44703</span>
<span class="co">#&gt; 14                       0.28692         0.37543            0.44694</span>
<span class="co">#&gt; 15                       0.28579         0.37536            0.44676</span>
<span class="co">#&gt; 16                       0.26903         0.37536            0.44673</span>
<span class="co">#&gt; 17                       0.28476         0.37534            0.44664</span>
<span class="co">#&gt; 18                       0.26950         0.37537            0.44671</span>
<span class="co">#&gt; 19                       0.27036         0.37538            0.44671</span>
<span class="co">#&gt; 20                       0.26573         0.37540            0.44673</span>
<span class="co">#&gt;    validation_auc validation_pr_auc validation_lift</span>
<span class="co">#&gt; 1         0.50000           0.18540         1.00000</span>
<span class="co">#&gt; 2         0.66168           0.30468         2.75098</span>
<span class="co">#&gt; 3         0.66766           0.30982         2.68582</span>
<span class="co">#&gt; 4         0.67061           0.31310         2.70784</span>
<span class="co">#&gt; 5         0.67427           0.31780         2.79590</span>
<span class="co">#&gt; 6         0.67684           0.32143         2.99403</span>
<span class="co">#&gt; 7         0.67865           0.32334         2.97202</span>
<span class="co">#&gt; 8         0.68006           0.32479         3.03806</span>
<span class="co">#&gt; 9         0.68113           0.32495         2.90597</span>
<span class="co">#&gt; 10        0.68183           0.32551         2.88396</span>
<span class="co">#&gt; 11        0.68252           0.32661         2.86194</span>
<span class="co">#&gt; 12        0.68326           0.32629         2.86194</span>
<span class="co">#&gt; 13        0.68354           0.32687         2.88396</span>
<span class="co">#&gt; 14        0.68363           0.32706         2.83993</span>
<span class="co">#&gt; 15        0.68405           0.32755         2.97202</span>
<span class="co">#&gt; 16        0.68423           0.32748         2.88396</span>
<span class="co">#&gt; 17        0.68453           0.32738         2.86194</span>
<span class="co">#&gt; 18        0.68432           0.32727         2.83993</span>
<span class="co">#&gt; 19        0.68434           0.32719         2.95000</span>
<span class="co">#&gt; 20        0.68436           0.32679         2.92799</span>
<span class="co">#&gt;    validation_classification_error</span>
<span class="co">#&gt; 1                          0.81460</span>
<span class="co">#&gt; 2                          0.35387</span>
<span class="co">#&gt; 3                          0.35285</span>
<span class="co">#&gt; 4                          0.39028</span>
<span class="co">#&gt; 5                          0.36770</span>
<span class="co">#&gt; 6                          0.35240</span>
<span class="co">#&gt; 7                          0.34848</span>
<span class="co">#&gt; 8                          0.34386</span>
<span class="co">#&gt; 9                          0.34807</span>
<span class="co">#&gt; 10                         0.38681</span>
<span class="co">#&gt; 11                         0.33774</span>
<span class="co">#&gt; 12                         0.34215</span>
<span class="co">#&gt; 13                         0.34431</span>
<span class="co">#&gt; 14                         0.34146</span>
<span class="co">#&gt; 15                         0.34329</span>
<span class="co">#&gt; 16                         0.33872</span>
<span class="co">#&gt; 17                         0.34276</span>
<span class="co">#&gt; 18                         0.34256</span>
<span class="co">#&gt; 19                         0.34289</span>
<span class="co">#&gt; 20                         0.35097</span></code></pre></div>
<p>Look at scoring history for third GBM model:</p>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Look at scoring history for third GBM model</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">gbm_fit3</span>, 
     timestep <span class="op">=</span> <span class="st">"number_of_trees"</span>, 
     metric <span class="op">=</span> <span class="st">"AUC"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">gbm_fit3</span>, 
     timestep <span class="op">=</span> <span class="st">"number_of_trees"</span>, 
     metric <span class="op">=</span> <span class="st">"logloss"</span><span class="op">)</span></code></pre></div>
<p><img src="202-algo-classification_907-bad_loans-h2o_files/figure-html/plot-gbm-fit3-1.png" width="70%" style="display: block; margin: auto;"><img src="202-algo-classification_907-bad_loans-h2o_files/figure-html/plot-gbm-fit3-2.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div id="deep-learning" class="section level2">
<h2>
<span class="header-section-number">16.7</span> Deep Learning<a class="anchor" aria-label="anchor" href="#deep-learning"><i class="fas fa-link"></i></a>
</h2>
<p>H2O’s <em>Deep Learning (DL)</em> algorithm is a multilayer feed-forward artificial neural network. It can also be used to train an autoencoder. In this example we will train a standard supervised prediction model.</p>
<div id="train-a-default-dl" class="section level3">
<h3>
<span class="header-section-number">16.7.1</span> Train a default DL<a class="anchor" aria-label="anchor" href="#train-a-default-dl"><i class="fas fa-link"></i></a>
</h3>
<p>First, we will train a basic DL model with default parameters. The DL model will infer the response distribution from the response encoding if it is not specified explicitly through the <code>distribution</code> argument. H2O’s DL will not be reproducible if it is run on more than a single core; so, in this example, the performance metrics below may vary slightly from what you see on your machine. In H2O’s DL, early stopping is enabled by default, so, below, it will use the training set and default stopping parameters to perform early stopping.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb483-1" data-line-number="1">dl_fit1 &lt;-<span class="st"> </span><span class="kw">h2o.deeplearning</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb483-2" data-line-number="2">                            <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb483-3" data-line-number="3">                            <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb483-4" data-line-number="4">                            <span class="dt">model_id =</span> <span class="st">"dl_fit1"</span>,</a>
<a class="sourceLine" id="cb483-5" data-line-number="5">                            <span class="dt">seed =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb483-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb483-7" data-line-number="7">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-8" data-line-number="8"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb483-9" data-line-number="9">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-10" data-line-number="10"><span class="st">  </span><span class="er">|======</span><span class="st">                                                                </span><span class="er">|</span><span class="st">   </span><span class="dv">9</span>%</a>
<a class="sourceLine" id="cb483-11" data-line-number="11">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-12" data-line-number="12"><span class="st">  </span><span class="er">|============</span><span class="st">                                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">17</span>%</a>
<a class="sourceLine" id="cb483-13" data-line-number="13">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-14" data-line-number="14"><span class="st">  </span><span class="er">|==================</span><span class="st">                                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">26</span>%</a>
<a class="sourceLine" id="cb483-15" data-line-number="15">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-16" data-line-number="16"><span class="st">  </span><span class="er">|========================</span><span class="st">                                              </span><span class="er">|</span><span class="st">  </span><span class="dv">35</span>%</a>
<a class="sourceLine" id="cb483-17" data-line-number="17">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-18" data-line-number="18"><span class="st">  </span><span class="er">|==============================</span><span class="st">                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">44</span>%</a>
<a class="sourceLine" id="cb483-19" data-line-number="19">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-20" data-line-number="20"><span class="st">  </span><span class="er">|=====================================</span><span class="st">                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">52</span>%</a>
<a class="sourceLine" id="cb483-21" data-line-number="21">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-22" data-line-number="22"><span class="st">  </span><span class="er">|===========================================</span><span class="st">                           </span><span class="er">|</span><span class="st">  </span><span class="dv">61</span>%</a>
<a class="sourceLine" id="cb483-23" data-line-number="23">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-24" data-line-number="24"><span class="st">  </span><span class="er">|=================================================</span><span class="st">                     </span><span class="er">|</span><span class="st">  </span><span class="dv">70</span>%</a>
<a class="sourceLine" id="cb483-25" data-line-number="25">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-26" data-line-number="26"><span class="st">  </span><span class="er">|=======================================================</span><span class="st">               </span><span class="er">|</span><span class="st">  </span><span class="dv">78</span>%</a>
<a class="sourceLine" id="cb483-27" data-line-number="27">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-28" data-line-number="28"><span class="st">  </span><span class="er">|=============================================================</span><span class="st">         </span><span class="er">|</span><span class="st">  </span><span class="dv">87</span>%</a>
<a class="sourceLine" id="cb483-29" data-line-number="29">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-30" data-line-number="30"><span class="st">  </span><span class="er">|===================================================================</span><span class="st">   </span><span class="er">|</span><span class="st">  </span><span class="dv">96</span>%</a>
<a class="sourceLine" id="cb483-31" data-line-number="31">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb483-32" data-line-number="32"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
</div>
<div id="train-a-dl-with-new-architecture-and-more-epochs." class="section level3">
<h3>
<span class="header-section-number">16.7.2</span> Train a DL with new architecture and more epochs.<a class="anchor" aria-label="anchor" href="#train-a-dl-with-new-architecture-and-more-epochs."><i class="fas fa-link"></i></a>
</h3>
<p>Next we will increase the number of epochs used in the GBM by setting <code>epochs=20</code> (the default is <span class="math inline">\(10\)</span>). Increasing the number of epochs in a deep neural net may increase performance of the model, however, you have to be careful not to overfit your model to your training data. To automatically find the optimal number of epochs, you must use H2O’s early stopping functionality. Unlike the rest of the H2O algorithms, H2O’s DL will use early stopping by default, so for comparison we will first turn off early stopping. We do this in the next example by setting <code>stopping_rounds=0</code>.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" data-line-number="1">dl_fit2 &lt;-<span class="st"> </span><span class="kw">h2o.deeplearning</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb484-2" data-line-number="2">                            <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb484-3" data-line-number="3">                            <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb484-4" data-line-number="4">                            <span class="dt">model_id =</span> <span class="st">"dl_fit2"</span>,</a>
<a class="sourceLine" id="cb484-5" data-line-number="5">                            <span class="co">#validation_frame = valid,  #only used if stopping_rounds &gt; 0</span></a>
<a class="sourceLine" id="cb484-6" data-line-number="6">                            <span class="dt">epochs =</span> <span class="dv">20</span>,</a>
<a class="sourceLine" id="cb484-7" data-line-number="7">                            <span class="dt">hidden=</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb484-8" data-line-number="8">                            <span class="dt">stopping_rounds =</span> <span class="dv">0</span>,  <span class="co"># disable early stopping</span></a>
<a class="sourceLine" id="cb484-9" data-line-number="9">                            <span class="dt">seed =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb484-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb484-11" data-line-number="11">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb484-12" data-line-number="12"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb484-13" data-line-number="13">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb484-14" data-line-number="14"><span class="st">  </span><span class="er">|===============</span><span class="st">                                                       </span><span class="er">|</span><span class="st">  </span><span class="dv">22</span>%</a>
<a class="sourceLine" id="cb484-15" data-line-number="15">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb484-16" data-line-number="16"><span class="st">  </span><span class="er">|==================================</span><span class="st">                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">48</span>%</a>
<a class="sourceLine" id="cb484-17" data-line-number="17">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb484-18" data-line-number="18"><span class="st">  </span><span class="er">|=======================================================</span><span class="st">               </span><span class="er">|</span><span class="st">  </span><span class="dv">78</span>%</a>
<a class="sourceLine" id="cb484-19" data-line-number="19">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb484-20" data-line-number="20"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
</div>
<div id="train-a-dl-with-early-stopping" class="section level3">
<h3>
<span class="header-section-number">16.7.3</span> Train a DL with early stopping<a class="anchor" aria-label="anchor" href="#train-a-dl-with-early-stopping"><i class="fas fa-link"></i></a>
</h3>
<p>This example will use the same model parameters as <code>dl_fit2</code>. This time, we will turn on early stopping and specify the stopping criterion. We will also pass a validation set, as is recommended for early stopping.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb485-1" data-line-number="1">dl_fit3 &lt;-<span class="st"> </span><span class="kw">h2o.deeplearning</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb485-2" data-line-number="2">                            <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb485-3" data-line-number="3">                            <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb485-4" data-line-number="4">                            <span class="dt">model_id =</span> <span class="st">"dl_fit3"</span>,</a>
<a class="sourceLine" id="cb485-5" data-line-number="5">                            <span class="dt">validation_frame =</span> valid,  <span class="co">#in DL, early stopping is on by default</span></a>
<a class="sourceLine" id="cb485-6" data-line-number="6">                            <span class="dt">epochs =</span> <span class="dv">20</span>,</a>
<a class="sourceLine" id="cb485-7" data-line-number="7">                            <span class="dt">hidden =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb485-8" data-line-number="8">                            <span class="dt">score_interval =</span> <span class="dv">1</span>,           <span class="co">#used for early stopping</span></a>
<a class="sourceLine" id="cb485-9" data-line-number="9">                            <span class="dt">stopping_rounds =</span> <span class="dv">3</span>,          <span class="co">#used for early stopping</span></a>
<a class="sourceLine" id="cb485-10" data-line-number="10">                            <span class="dt">stopping_metric =</span> <span class="st">"AUC"</span>,      <span class="co">#used for early stopping</span></a>
<a class="sourceLine" id="cb485-11" data-line-number="11">                            <span class="dt">stopping_tolerance =</span> <span class="fl">0.0005</span>,  <span class="co">#used for early stopping</span></a>
<a class="sourceLine" id="cb485-12" data-line-number="12">                            <span class="dt">seed =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb485-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb485-14" data-line-number="14">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb485-15" data-line-number="15"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb485-16" data-line-number="16">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb485-17" data-line-number="17"><span class="st">  </span><span class="er">|===============</span><span class="st">                                                       </span><span class="er">|</span><span class="st">  </span><span class="dv">22</span>%</a>
<a class="sourceLine" id="cb485-18" data-line-number="18">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb485-19" data-line-number="19"><span class="st">  </span><span class="er">|==================================</span><span class="st">                                    </span><span class="er">|</span><span class="st">  </span><span class="dv">48</span>%</a>
<a class="sourceLine" id="cb485-20" data-line-number="20">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb485-21" data-line-number="21"><span class="st">  </span><span class="er">|=======================================================</span><span class="st">               </span><span class="er">|</span><span class="st">  </span><span class="dv">78</span>%</a>
<a class="sourceLine" id="cb485-22" data-line-number="22">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb485-23" data-line-number="23"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<p>Let’s compare the performance of the three DL models:</p>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Let's compare the performance of the three DL models</span>
<span class="va">dl_perf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.performance.html">h2o.performance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">dl_fit1</span>,
                            newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span>
<span class="va">dl_perf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.performance.html">h2o.performance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">dl_fit2</span>,
                            newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span>
<span class="va">dl_perf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.performance.html">h2o.performance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">dl_fit3</span>,
                            newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span>

<span class="co"># Print model performance</span>
<span class="va">dl_perf1</span>
<span class="co">#&gt; H2OBinomialMetrics: deeplearning</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.143</span>
<span class="co">#&gt; RMSE:  0.378</span>
<span class="co">#&gt; LogLoss:  0.454</span>
<span class="co">#&gt; Mean Per-Class Error:  0.367</span>
<span class="co">#&gt; AUC:  0.679</span>
<span class="co">#&gt; AUCPR:  0.327</span>
<span class="co">#&gt; Gini:  0.359</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            0     1    Error         Rate</span>
<span class="co">#&gt; 0      12663  7328 0.366565  =7328/19991</span>
<span class="co">#&gt; 1       1683  2907 0.366667   =1683/4590</span>
<span class="co">#&gt; Totals 14346 10235 0.366584  =9011/24581</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold        value idx</span>
<span class="co">#&gt; 1                       max f1  0.152482     0.392175 237</span>
<span class="co">#&gt; 2                       max f2  0.079939     0.555425 329</span>
<span class="co">#&gt; 3                 max f0point5  0.259001     0.354285 136</span>
<span class="co">#&gt; 4                 max accuracy  0.410331     0.814206  50</span>
<span class="co">#&gt; 5                max precision  0.920331     1.000000   0</span>
<span class="co">#&gt; 6                   max recall  0.007278     1.000000 397</span>
<span class="co">#&gt; 7              max specificity  0.920331     1.000000   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.178899     0.215787 206</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.152482     0.633333 237</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.152482     0.633384 237</span>
<span class="co">#&gt; 11                     max tns  0.920331 19991.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.920331  4589.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.000686 19991.000000 399</span>
<span class="co">#&gt; 14                     max tps  0.007278  4590.000000 397</span>
<span class="co">#&gt; 15                     max tnr  0.920331     1.000000   0</span>
<span class="co">#&gt; 16                     max fnr  0.920331     0.999782   0</span>
<span class="co">#&gt; 17                     max fpr  0.000686     1.000000 399</span>
<span class="co">#&gt; 18                     max tpr  0.007278     1.000000 397</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>
<span class="va">dl_perf2</span>
<span class="co">#&gt; H2OBinomialMetrics: deeplearning</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.142</span>
<span class="co">#&gt; RMSE:  0.377</span>
<span class="co">#&gt; LogLoss:  0.45</span>
<span class="co">#&gt; Mean Per-Class Error:  0.369</span>
<span class="co">#&gt; AUC:  0.68</span>
<span class="co">#&gt; AUCPR:  0.33</span>
<span class="co">#&gt; Gini:  0.359</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            0    1    Error         Rate</span>
<span class="co">#&gt; 0      13649 6342 0.317243  =6342/19991</span>
<span class="co">#&gt; 1       1929 2661 0.420261   =1929/4590</span>
<span class="co">#&gt; Totals 15578 9003 0.336479  =8271/24581</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold        value idx</span>
<span class="co">#&gt; 1                       max f1  0.213027     0.391525 206</span>
<span class="co">#&gt; 2                       max f2  0.112544     0.557077 313</span>
<span class="co">#&gt; 3                 max f0point5  0.288516     0.353889 136</span>
<span class="co">#&gt; 4                 max accuracy  0.513363     0.814776   8</span>
<span class="co">#&gt; 5                max precision  0.532756     0.875000   1</span>
<span class="co">#&gt; 6                   max recall  0.016794     1.000000 396</span>
<span class="co">#&gt; 7              max specificity  0.536152     0.999950   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.213027     0.212323 206</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.198137     0.630065 221</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.198137     0.631325 221</span>
<span class="co">#&gt; 11                     max tns  0.536152 19990.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.536152  4587.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.001613 19991.000000 399</span>
<span class="co">#&gt; 14                     max tps  0.016794  4590.000000 396</span>
<span class="co">#&gt; 15                     max tnr  0.536152     0.999950   0</span>
<span class="co">#&gt; 16                     max fnr  0.536152     0.999346   0</span>
<span class="co">#&gt; 17                     max fpr  0.001613     1.000000 399</span>
<span class="co">#&gt; 18                     max tpr  0.016794     1.000000 396</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>
<span class="va">dl_perf3</span>
<span class="co">#&gt; H2OBinomialMetrics: deeplearning</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.143</span>
<span class="co">#&gt; RMSE:  0.378</span>
<span class="co">#&gt; LogLoss:  0.452</span>
<span class="co">#&gt; Mean Per-Class Error:  0.368</span>
<span class="co">#&gt; AUC:  0.679</span>
<span class="co">#&gt; AUCPR:  0.325</span>
<span class="co">#&gt; Gini:  0.357</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            0    1    Error         Rate</span>
<span class="co">#&gt; 0      13564 6427 0.321495  =6427/19991</span>
<span class="co">#&gt; 1       1900 2690 0.413943   =1900/4590</span>
<span class="co">#&gt; Totals 15464 9117 0.338758  =8327/24581</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold        value idx</span>
<span class="co">#&gt; 1                       max f1  0.224847     0.392500 219</span>
<span class="co">#&gt; 2                       max f2  0.100674     0.555728 335</span>
<span class="co">#&gt; 3                 max f0point5  0.306972     0.349238 154</span>
<span class="co">#&gt; 4                 max accuracy  0.566319     0.814287  28</span>
<span class="co">#&gt; 5                max precision  0.813185     1.000000   0</span>
<span class="co">#&gt; 6                   max recall  0.008017     1.000000 398</span>
<span class="co">#&gt; 7              max specificity  0.813185     1.000000   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.228563     0.213823 216</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.207751     0.629833 233</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.223665     0.632364 220</span>
<span class="co">#&gt; 11                     max tns  0.813185 19991.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.813185  4589.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.001293 19991.000000 399</span>
<span class="co">#&gt; 14                     max tps  0.008017  4590.000000 398</span>
<span class="co">#&gt; 15                     max tnr  0.813185     1.000000   0</span>
<span class="co">#&gt; 16                     max fnr  0.813185     0.999782   0</span>
<span class="co">#&gt; 17                     max fpr  0.001293     1.000000 399</span>
<span class="co">#&gt; 18                     max tpr  0.008017     1.000000 398</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>

<span class="co"># Retreive test set AUC</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">dl_perf1</span><span class="op">)</span>  <span class="co"># 0.6774335</span>
<span class="co">#&gt; [1] 0.679</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">dl_perf2</span><span class="op">)</span>  <span class="co"># 0.678446</span>
<span class="co">#&gt; [1] 0.68</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">dl_perf3</span><span class="op">)</span>  <span class="co"># 0.6770498</span>
<span class="co">#&gt; [1] 0.679</span></code></pre></div>
<p>Look at scoring history for third DL model:</p>
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Look at scoring history for third DL model</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">dl_fit3</span>, 
     timestep <span class="op">=</span> <span class="st">"epochs"</span>, 
     metric <span class="op">=</span> <span class="st">"AUC"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="202-algo-classification_907-bad_loans-h2o_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="scoring-history" class="section level3">
<h3>
<span class="header-section-number">16.7.4</span> Scoring history<a class="anchor" aria-label="anchor" href="#scoring-history"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Scoring history</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.scoreHistory.html">h2o.scoreHistory</a></span><span class="op">(</span><span class="va">dl_fit3</span><span class="op">)</span>
<span class="co">#&gt; Scoring History: </span>
<span class="co">#&gt;             timestamp   duration training_speed   epochs iterations</span>
<span class="co">#&gt; 1 2020-11-18 07:57:13  0.000 sec             NA  0.00000          0</span>
<span class="co">#&gt; 2 2020-11-18 07:57:13  0.323 sec 420134 obs/sec  0.87019          1</span>
<span class="co">#&gt; 3 2020-11-18 07:57:14  1.353 sec 578461 obs/sec  6.09129          7</span>
<span class="co">#&gt; 4 2020-11-18 07:57:16  2.375 sec 599377 obs/sec 11.31383         13</span>
<span class="co">#&gt; 5 2020-11-18 07:57:17  3.434 sec 632244 obs/sec 17.40888         20</span>
<span class="co">#&gt; 6 2020-11-18 07:57:17  3.921 sec 639681 obs/sec 20.01859         23</span>
<span class="co">#&gt; 7 2020-11-18 07:57:17  3.976 sec 639504 obs/sec 20.01859         23</span>
<span class="co">#&gt;          samples training_rmse training_logloss training_r2 training_auc</span>
<span class="co">#&gt; 1       0.000000            NA               NA          NA           NA</span>
<span class="co">#&gt; 2   99992.000000       0.37935          0.45689     0.04786      0.65884</span>
<span class="co">#&gt; 3  699938.000000       0.37796          0.45326     0.05482      0.67190</span>
<span class="co">#&gt; 4 1300050.000000       0.37846          0.45280     0.05230      0.67444</span>
<span class="co">#&gt; 5 2000420.000000       0.38531          0.47635     0.01772      0.67839</span>
<span class="co">#&gt; 6 2300296.000000       0.37945          0.46081     0.04733      0.67684</span>
<span class="co">#&gt; 7 2300296.000000       0.37846          0.45280     0.05230      0.67444</span>
<span class="co">#&gt;   training_pr_auc training_lift training_classification_error validation_rmse</span>
<span class="co">#&gt; 1              NA            NA                            NA              NA</span>
<span class="co">#&gt; 2         0.30042       2.39491                       0.42405         0.37915</span>
<span class="co">#&gt; 3         0.31670       2.72149                       0.39017         0.37711</span>
<span class="co">#&gt; 4         0.31629       2.50377                       0.38936         0.37743</span>
<span class="co">#&gt; 5         0.32098       2.66706                       0.35639         0.38536</span>
<span class="co">#&gt; 6         0.32067       2.83035                       0.37237         0.37980</span>
<span class="co">#&gt; 7         0.31629       2.50377                       0.38936         0.37743</span>
<span class="co">#&gt;   validation_logloss validation_r2 validation_auc validation_pr_auc</span>
<span class="co">#&gt; 1                 NA            NA             NA                NA</span>
<span class="co">#&gt; 2            0.45626       0.04818        0.66083           0.30191</span>
<span class="co">#&gt; 3            0.45150       0.05838        0.67887           0.31749</span>
<span class="co">#&gt; 4            0.45117       0.05679        0.67898           0.31901</span>
<span class="co">#&gt; 5            0.47698       0.01675        0.67826           0.31767</span>
<span class="co">#&gt; 6            0.46205       0.04491        0.67466           0.31510</span>
<span class="co">#&gt; 7            0.45117       0.05679        0.67898           0.31901</span>
<span class="co">#&gt;   validation_lift validation_classification_error</span>
<span class="co">#&gt; 1              NA                              NA</span>
<span class="co">#&gt; 2         2.61978                         0.42685</span>
<span class="co">#&gt; 3         2.50970                         0.34072</span>
<span class="co">#&gt; 4         2.68582                         0.35182</span>
<span class="co">#&gt; 5         2.53172                         0.36089</span>
<span class="co">#&gt; 6         2.50970                         0.36223</span>
<span class="co">#&gt; 7         2.68582                         0.35182</span>
<span class="co"># Scoring History: </span>
<span class="co">#   timestamp   duration  training_speed   epochs</span>
<span class="co"># 1 2016-05-03 10:33:29  0.000 sec                  0.00000</span>
<span class="co"># 2 2016-05-03 10:33:29  0.347 sec 424697 rows/sec  0.86851</span>
<span class="co"># 3 2016-05-03 10:33:30  1.356 sec 601925 rows/sec  6.09185</span>
<span class="co"># 4 2016-05-03 10:33:31  2.348 sec 717617 rows/sec 13.05168</span>
<span class="co"># 5 2016-05-03 10:33:32  3.281 sec 777538 rows/sec 20.00783</span>
<span class="co"># 6 2016-05-03 10:33:32  3.345 sec 777275 rows/sec 20.00783</span>
<span class="co"># iterations        samples training_MSE training_r2</span>
<span class="co"># 1          0       0.000000                         </span>
<span class="co"># 2          1   99804.000000      0.14402     0.03691</span>
<span class="co"># 3          7  700039.000000      0.14157     0.05333</span>
<span class="co"># 4         15 1499821.000000      0.14033     0.06159</span>
<span class="co"># 5         23 2299180.000000      0.14079     0.05853</span>
<span class="co"># 6         23 2299180.000000      0.14157     0.05333</span>
<span class="co"># training_logloss training_AUC training_lift</span>
<span class="co"># 1                                            </span>
<span class="co"># 2          0.45930      0.66685       2.20727</span>
<span class="co"># 3          0.45220      0.68133       2.59354</span>
<span class="co"># 4          0.44710      0.67993       2.70390</span>
<span class="co"># 5          0.45100      0.68192       2.81426</span>
<span class="co"># 6          0.45220      0.68133       2.59354</span>
<span class="co"># training_classification_error validation_MSE validation_r2</span>
<span class="co"># 1                                                           </span>
<span class="co"># 2                       0.36145        0.14682       0.03426</span>
<span class="co"># 3                       0.33647        0.14500       0.04619</span>
<span class="co"># 4                       0.37126        0.14411       0.05204</span>
<span class="co"># 5                       0.32868        0.14474       0.04793</span>
<span class="co"># 6                       0.33647        0.14500       0.04619</span>
<span class="co"># validation_logloss validation_AUC validation_lift</span>
<span class="co"># 1                                                  </span>
<span class="co"># 2            0.46692        0.66582         2.53209</span>
<span class="co"># 3            0.46256        0.67354         2.64124</span>
<span class="co"># 4            0.45789        0.66986         2.44478</span>
<span class="co"># 5            0.46292        0.67117         2.70672</span>
<span class="co"># 6            0.46256        0.67354         2.64124</span>
<span class="co"># validation_classification_error</span>
<span class="co"># 1                                </span>
<span class="co"># 2                         0.37197</span>
<span class="co"># 3                         0.34716</span>
<span class="co"># 4                         0.34385</span>
<span class="co"># 5                         0.36544</span>
<span class="co"># 6                         0.34716</span></code></pre></div>
</div>
</div>
<div id="naive-bayes-model" class="section level2">
<h2>
<span class="header-section-number">16.8</span> Naive Bayes model<a class="anchor" aria-label="anchor" href="#naive-bayes-model"><i class="fas fa-link"></i></a>
</h2>
<p>The Naive Bayes (NB) algorithm does not usually beat an algorithm like a Random Forest or GBM, however it is still a popular algorithm, especially in the text domain (when your input is text encoded as “Bag of Words”, for example). The Naive Bayes algorithm is for binary or multiclass classification problems only, not regression. Therefore, your response
must be a factor instead of a numeric.</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb489-1" data-line-number="1"><span class="co"># First we will train a basic NB model with default parameters. </span></a>
<a class="sourceLine" id="cb489-2" data-line-number="2">nb_fit1 &lt;-<span class="st"> </span><span class="kw">h2o.naiveBayes</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb489-3" data-line-number="3">                          <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb489-4" data-line-number="4">                          <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb489-5" data-line-number="5">                          <span class="dt">model_id =</span> <span class="st">"nb_fit1"</span>)</a>
<a class="sourceLine" id="cb489-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb489-7" data-line-number="7">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb489-8" data-line-number="8"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb489-9" data-line-number="9">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb489-10" data-line-number="10"><span class="st">  </span><span class="er">|============</span><span class="st">                                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">17</span>%</a>
<a class="sourceLine" id="cb489-11" data-line-number="11">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb489-12" data-line-number="12"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<div id="train-a-nb-model-with-laplace-smoothing" class="section level3">
<h3>
<span class="header-section-number">16.8.1</span> Train a NB model with Laplace Smoothing<a class="anchor" aria-label="anchor" href="#train-a-nb-model-with-laplace-smoothing"><i class="fas fa-link"></i></a>
</h3>
<p>One of the few tunable model parameters for the Naive Bayes algorithm is the amount of Laplace smoothing. The H2O Naive Bayes model will not use any Laplace smoothing by default.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" data-line-number="1">nb_fit2 &lt;-<span class="st"> </span><span class="kw">h2o.naiveBayes</span>(<span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb490-2" data-line-number="2">                          <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb490-3" data-line-number="3">                          <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb490-4" data-line-number="4">                          <span class="dt">model_id =</span> <span class="st">"nb_fit2"</span>,</a>
<a class="sourceLine" id="cb490-5" data-line-number="5">                          <span class="dt">laplace =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb490-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-7" data-line-number="7">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb490-8" data-line-number="8"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb490-9" data-line-number="9">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb490-10" data-line-number="10"><span class="st">  </span><span class="er">|==========================================================</span><span class="st">            </span><span class="er">|</span><span class="st">  </span><span class="dv">83</span>%</a>
<a class="sourceLine" id="cb490-11" data-line-number="11">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb490-12" data-line-number="12"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a>
<a class="sourceLine" id="cb490-13" data-line-number="13"></a>
<a class="sourceLine" id="cb490-14" data-line-number="14"><span class="co"># Let's compare the performance of the two NB models</span></a>
<a class="sourceLine" id="cb490-15" data-line-number="15">nb_perf1 &lt;-<span class="st"> </span><span class="kw">h2o.performance</span>(<span class="dt">model =</span> nb_fit1,</a>
<a class="sourceLine" id="cb490-16" data-line-number="16">                            <span class="dt">newdata =</span> test)</a>
<a class="sourceLine" id="cb490-17" data-line-number="17">nb_perf2 &lt;-<span class="st"> </span><span class="kw">h2o.performance</span>(<span class="dt">model =</span> nb_fit2,</a>
<a class="sourceLine" id="cb490-18" data-line-number="18">                            <span class="dt">newdata =</span> test)</a>
<a class="sourceLine" id="cb490-19" data-line-number="19"></a>
<a class="sourceLine" id="cb490-20" data-line-number="20"><span class="co"># Print model performance</span></a>
<a class="sourceLine" id="cb490-21" data-line-number="21">nb_perf1</a>
<a class="sourceLine" id="cb490-22" data-line-number="22"><span class="co">#&gt; H2OBinomialMetrics: naivebayes</span></a>
<a class="sourceLine" id="cb490-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-24" data-line-number="24"><span class="co">#&gt; MSE:  0.15</span></a>
<a class="sourceLine" id="cb490-25" data-line-number="25"><span class="co">#&gt; RMSE:  0.387</span></a>
<a class="sourceLine" id="cb490-26" data-line-number="26"><span class="co">#&gt; LogLoss:  0.489</span></a>
<a class="sourceLine" id="cb490-27" data-line-number="27"><span class="co">#&gt; Mean Per-Class Error:  0.39</span></a>
<a class="sourceLine" id="cb490-28" data-line-number="28"><span class="co">#&gt; AUC:  0.651</span></a>
<a class="sourceLine" id="cb490-29" data-line-number="29"><span class="co">#&gt; AUCPR:  0.297</span></a>
<a class="sourceLine" id="cb490-30" data-line-number="30"><span class="co">#&gt; Gini:  0.303</span></a>
<a class="sourceLine" id="cb490-31" data-line-number="31"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-32" data-line-number="32"><span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span></a>
<a class="sourceLine" id="cb490-33" data-line-number="33"><span class="co">#&gt;            0    1    Error         Rate</span></a>
<a class="sourceLine" id="cb490-34" data-line-number="34"><span class="co">#&gt; 0      13184 6807 0.340503  =6807/19991</span></a>
<a class="sourceLine" id="cb490-35" data-line-number="35"><span class="co">#&gt; 1       2021 2569 0.440305   =2021/4590</span></a>
<a class="sourceLine" id="cb490-36" data-line-number="36"><span class="co">#&gt; Totals 15205 9376 0.359139  =8828/24581</span></a>
<a class="sourceLine" id="cb490-37" data-line-number="37"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-38" data-line-number="38"><span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span></a>
<a class="sourceLine" id="cb490-39" data-line-number="39"><span class="co">#&gt;                         metric threshold        value idx</span></a>
<a class="sourceLine" id="cb490-40" data-line-number="40"><span class="co">#&gt; 1                       max f1  0.225948     0.367893 235</span></a>
<a class="sourceLine" id="cb490-41" data-line-number="41"><span class="co">#&gt; 2                       max f2  0.090634     0.545538 346</span></a>
<a class="sourceLine" id="cb490-42" data-line-number="42"><span class="co">#&gt; 3                 max f0point5  0.340471     0.335807 165</span></a>
<a class="sourceLine" id="cb490-43" data-line-number="43"><span class="co">#&gt; 4                 max accuracy  0.999554     0.812945   0</span></a>
<a class="sourceLine" id="cb490-44" data-line-number="44"><span class="co">#&gt; 5                max precision  0.559607     0.428747  69</span></a>
<a class="sourceLine" id="cb490-45" data-line-number="45"><span class="co">#&gt; 6                   max recall  0.000196     1.000000 399</span></a>
<a class="sourceLine" id="cb490-46" data-line-number="46"><span class="co">#&gt; 7              max specificity  0.999554     0.999550   0</span></a>
<a class="sourceLine" id="cb490-47" data-line-number="47"><span class="co">#&gt; 8             max absolute_mcc  0.287231     0.188641 195</span></a>
<a class="sourceLine" id="cb490-48" data-line-number="48"><span class="co">#&gt; 9   max min_per_class_accuracy  0.207470     0.604672 250</span></a>
<a class="sourceLine" id="cb490-49" data-line-number="49"><span class="co">#&gt; 10 max mean_per_class_accuracy  0.225948     0.609596 235</span></a>
<a class="sourceLine" id="cb490-50" data-line-number="50"><span class="co">#&gt; 11                     max tns  0.999554 19982.000000   0</span></a>
<a class="sourceLine" id="cb490-51" data-line-number="51"><span class="co">#&gt; 12                     max fns  0.999554  4589.000000   0</span></a>
<a class="sourceLine" id="cb490-52" data-line-number="52"><span class="co">#&gt; 13                     max fps  0.000196 19991.000000 399</span></a>
<a class="sourceLine" id="cb490-53" data-line-number="53"><span class="co">#&gt; 14                     max tps  0.000196  4590.000000 399</span></a>
<a class="sourceLine" id="cb490-54" data-line-number="54"><span class="co">#&gt; 15                     max tnr  0.999554     0.999550   0</span></a>
<a class="sourceLine" id="cb490-55" data-line-number="55"><span class="co">#&gt; 16                     max fnr  0.999554     0.999782   0</span></a>
<a class="sourceLine" id="cb490-56" data-line-number="56"><span class="co">#&gt; 17                     max fpr  0.000196     1.000000 399</span></a>
<a class="sourceLine" id="cb490-57" data-line-number="57"><span class="co">#&gt; 18                     max tpr  0.000196     1.000000 399</span></a>
<a class="sourceLine" id="cb490-58" data-line-number="58"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-59" data-line-number="59"><span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span></a>
<a class="sourceLine" id="cb490-60" data-line-number="60">nb_perf2</a>
<a class="sourceLine" id="cb490-61" data-line-number="61"><span class="co">#&gt; H2OBinomialMetrics: naivebayes</span></a>
<a class="sourceLine" id="cb490-62" data-line-number="62"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-63" data-line-number="63"><span class="co">#&gt; MSE:  0.15</span></a>
<a class="sourceLine" id="cb490-64" data-line-number="64"><span class="co">#&gt; RMSE:  0.387</span></a>
<a class="sourceLine" id="cb490-65" data-line-number="65"><span class="co">#&gt; LogLoss:  0.489</span></a>
<a class="sourceLine" id="cb490-66" data-line-number="66"><span class="co">#&gt; Mean Per-Class Error:  0.39</span></a>
<a class="sourceLine" id="cb490-67" data-line-number="67"><span class="co">#&gt; AUC:  0.651</span></a>
<a class="sourceLine" id="cb490-68" data-line-number="68"><span class="co">#&gt; AUCPR:  0.297</span></a>
<a class="sourceLine" id="cb490-69" data-line-number="69"><span class="co">#&gt; Gini:  0.303</span></a>
<a class="sourceLine" id="cb490-70" data-line-number="70"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-71" data-line-number="71"><span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span></a>
<a class="sourceLine" id="cb490-72" data-line-number="72"><span class="co">#&gt;            0    1    Error         Rate</span></a>
<a class="sourceLine" id="cb490-73" data-line-number="73"><span class="co">#&gt; 0      14002 5989 0.299585  =5989/19991</span></a>
<a class="sourceLine" id="cb490-74" data-line-number="74"><span class="co">#&gt; 1       2207 2383 0.480828   =2207/4590</span></a>
<a class="sourceLine" id="cb490-75" data-line-number="75"><span class="co">#&gt; Totals 16209 8372 0.333428  =8196/24581</span></a>
<a class="sourceLine" id="cb490-76" data-line-number="76"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-77" data-line-number="77"><span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span></a>
<a class="sourceLine" id="cb490-78" data-line-number="78"><span class="co">#&gt;                         metric threshold        value idx</span></a>
<a class="sourceLine" id="cb490-79" data-line-number="79"><span class="co">#&gt; 1                       max f1  0.242206     0.367690 222</span></a>
<a class="sourceLine" id="cb490-80" data-line-number="80"><span class="co">#&gt; 2                       max f2  0.088529     0.545649 347</span></a>
<a class="sourceLine" id="cb490-81" data-line-number="81"><span class="co">#&gt; 3                 max f0point5  0.362995     0.336012 152</span></a>
<a class="sourceLine" id="cb490-82" data-line-number="82"><span class="co">#&gt; 4                 max accuracy  0.999564     0.812945   0</span></a>
<a class="sourceLine" id="cb490-83" data-line-number="83"><span class="co">#&gt; 5                max precision  0.574610     0.428775  63</span></a>
<a class="sourceLine" id="cb490-84" data-line-number="84"><span class="co">#&gt; 6                   max recall  0.000207     1.000000 399</span></a>
<a class="sourceLine" id="cb490-85" data-line-number="85"><span class="co">#&gt; 7              max specificity  0.999564     0.999550   0</span></a>
<a class="sourceLine" id="cb490-86" data-line-number="86"><span class="co">#&gt; 8             max absolute_mcc  0.286635     0.189479 192</span></a>
<a class="sourceLine" id="cb490-87" data-line-number="87"><span class="co">#&gt; 9   max min_per_class_accuracy  0.207609     0.604357 248</span></a>
<a class="sourceLine" id="cb490-88" data-line-number="88"><span class="co">#&gt; 10 max mean_per_class_accuracy  0.247906     0.609878 218</span></a>
<a class="sourceLine" id="cb490-89" data-line-number="89"><span class="co">#&gt; 11                     max tns  0.999564 19982.000000   0</span></a>
<a class="sourceLine" id="cb490-90" data-line-number="90"><span class="co">#&gt; 12                     max fns  0.999564  4589.000000   0</span></a>
<a class="sourceLine" id="cb490-91" data-line-number="91"><span class="co">#&gt; 13                     max fps  0.000207 19991.000000 399</span></a>
<a class="sourceLine" id="cb490-92" data-line-number="92"><span class="co">#&gt; 14                     max tps  0.000207  4590.000000 399</span></a>
<a class="sourceLine" id="cb490-93" data-line-number="93"><span class="co">#&gt; 15                     max tnr  0.999564     0.999550   0</span></a>
<a class="sourceLine" id="cb490-94" data-line-number="94"><span class="co">#&gt; 16                     max fnr  0.999564     0.999782   0</span></a>
<a class="sourceLine" id="cb490-95" data-line-number="95"><span class="co">#&gt; 17                     max fpr  0.000207     1.000000 399</span></a>
<a class="sourceLine" id="cb490-96" data-line-number="96"><span class="co">#&gt; 18                     max tpr  0.000207     1.000000 399</span></a>
<a class="sourceLine" id="cb490-97" data-line-number="97"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-98" data-line-number="98"><span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span></a>
<a class="sourceLine" id="cb490-99" data-line-number="99"></a>
<a class="sourceLine" id="cb490-100" data-line-number="100"><span class="co"># Retreive test set AUC</span></a>
<a class="sourceLine" id="cb490-101" data-line-number="101"><span class="kw">h2o.auc</span>(nb_perf1)  <span class="co"># 0.6488014</span></a>
<a class="sourceLine" id="cb490-102" data-line-number="102"><span class="co">#&gt; [1] 0.651</span></a>
<a class="sourceLine" id="cb490-103" data-line-number="103"><span class="kw">h2o.auc</span>(nb_perf2)  <span class="co"># 0.6490678</span></a>
<a class="sourceLine" id="cb490-104" data-line-number="104"><span class="co">#&gt; [1] 0.651</span></a></code></pre></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="predicting-flu-outcome-comparing-eight-classification-algorithms.html"><span class="header-section-number">15</span> Predicting Flu outcome comparing eight classification algorithms</a></div>
<div class="next"><a href="comparison-of-six-linear-regression-algorithms.html"><span class="header-section-number">17</span> Comparison of six Linear Regression algorithms</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#classification-on-bad-loans"><span class="header-section-number">16</span> Classification on bad loans</a></li>
<li><a class="nav-link" href="#comparison-of-glm-rf-gbm-dl-nb"><span class="header-section-number">16.1</span> Comparison of GLM, RF, GBM, DL, NB</a></li>
<li>
<a class="nav-link" href="#introduction-9"><span class="header-section-number">16.2</span> Introduction</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#install-and-download-h2o"><span class="header-section-number">16.2.1</span> Install and download h2o</a></li>
<li><a class="nav-link" href="#load-the-dataset"><span class="header-section-number">16.2.2</span> Load the dataset</a></li>
<li><a class="nav-link" href="#feature-engineering"><span class="header-section-number">16.2.3</span> Feature Engineering</a></li>
<li><a class="nav-link" href="#partition-the-data"><span class="header-section-number">16.2.4</span> Partition the data</a></li>
<li><a class="nav-link" href="#identify-response-and-predictor-variables"><span class="header-section-number">16.2.5</span> Identify response and predictor variables</a></li>
</ul>
</li>
<li><a class="nav-link" href="#algorithms-1"><span class="header-section-number">16.3</span> Algorithms</a></li>
<li><a class="nav-link" href="#glm"><span class="header-section-number">16.4</span> GLM</a></li>
<li>
<a class="nav-link" href="#random-forest-2"><span class="header-section-number">16.5</span> Random Forest</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#cross-validate-performance"><span class="header-section-number">16.5.1</span> Cross-validate performance</a></li></ul>
</li>
<li><a class="nav-link" href="#gradient-boosting-machine-gbm"><span class="header-section-number">16.6</span> Gradient Boosting Machine (GBM)</a></li>
<li>
<a class="nav-link" href="#deep-learning"><span class="header-section-number">16.7</span> Deep Learning</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#train-a-default-dl"><span class="header-section-number">16.7.1</span> Train a default DL</a></li>
<li><a class="nav-link" href="#train-a-dl-with-new-architecture-and-more-epochs."><span class="header-section-number">16.7.2</span> Train a DL with new architecture and more epochs.</a></li>
<li><a class="nav-link" href="#train-a-dl-with-early-stopping"><span class="header-section-number">16.7.3</span> Train a DL with early stopping</a></li>
<li><a class="nav-link" href="#scoring-history"><span class="header-section-number">16.7.4</span> Scoring history</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#naive-bayes-model"><span class="header-section-number">16.8</span> Naive Bayes model</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#train-a-nb-model-with-laplace-smoothing"><span class="header-section-number">16.8.1</span> Train a NB model with Laplace Smoothing</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hadley/r-pkgs/blob/master/202-algo-classification_907-bad_loans-h2o.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hadley/r-pkgs/edit/master/202-algo-classification_907-bad_loans-h2o.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Machine Learning Book</strong>" was written by Alfonso R. Reyes. It was last built on 2020-11-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
