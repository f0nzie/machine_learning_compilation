<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 39 Credit Scoring with neuralnet | A Machine Learning Compilation</title>
<meta name="author" content="Several authors. Compiled by Alfonso R. Reyes">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Machine Learning Compilation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preface</a></li>
<li class="book-part">The Basics of Machine Learning</li>
<li><a class="" href="introduction-to-pca.html"><span class="header-section-number">2</span> Introduction to PCA</a></li>
<li><a class="" href="comparison-of-two-pca-packages.html"><span class="header-section-number">3</span> Comparison of two PCA packages</a></li>
<li><a class="" href="detailed-study-of-principal-component-analysis.html"><span class="header-section-number">4</span> Detailed study of Principal Component Analysis</a></li>
<li><a class="" href="detection-of-diabetes-using-logistic-regression.html"><span class="header-section-number">5</span> Detection of diabetes using Logistic Regression</a></li>
<li><a class="" href="sensitivity-analysis-for-a-neural-network.html"><span class="header-section-number">6</span> Sensitivity analysis for a neural network</a></li>
<li><a class="" href="data-visualization-for-ml-models.html"><span class="header-section-number">7</span> Data Visualization for ML models</a></li>
<li class="book-part">Feature Engineering</li>
<li><a class="" href="ten-methods-to-assess-variable-importance.html"><span class="header-section-number">8</span> Ten methods to assess Variable Importance</a></li>
<li><a class="" href="employee-attrition-using-feature-importance.html"><span class="header-section-number">9</span> Employee Attrition using Feature Importance</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="a-gentle-introduction-to-support-vector-machines.html"><span class="header-section-number">10</span> A gentle introduction to Support Vector Machines</a></li>
<li><a class="" href="broad-view-of-svm.html"><span class="header-section-number">11</span> Broad view of SVM</a></li>
<li><a class="" href="feature-selection-to-enhance-cancer-detection.html"><span class="header-section-number">12</span> Feature Selection to enhance cancer detection</a></li>
<li><a class="" href="dealing-with-unbalanced-data.html"><span class="header-section-number">13</span> Dealing with unbalanced data</a></li>
<li><a class="" href="imputting-missing-values-with-random-forest.html"><span class="header-section-number">14</span> Imputting missing values with Random Forest</a></li>
<li><a class="" href="tuning-of-support-vector-machine-prediction.html"><span class="header-section-number">15</span> Tuning of Support Vector Machine prediction</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="introduction-to-algorithms-for-classification.html"><span class="header-section-number">16</span> Introduction to algorithms for Classification</a></li>
<li><a class="" href="comparing-classification-algorithms.html"><span class="header-section-number">17</span> Comparing Classification algorithms</a></li>
<li><a class="" href="who-buys-social-network-ads.html"><span class="header-section-number">18</span> Who buys Social Network ads</a></li>
<li><a class="" href="predicting-ozone-levels.html"><span class="header-section-number">19</span> Predicting Ozone levels</a></li>
<li><a class="" href="building-a-naive-bayes-classifier.html"><span class="header-section-number">20</span> Building a Naive Bayes Classifier</a></li>
<li><a class="" href="linear-and-non-linear-algorithms-for-classification.html"><span class="header-section-number">21</span> Linear and Non-Linear Algorithms for Classification</a></li>
<li><a class="" href="detect-mines-vs-rocks-with-random-forest.html"><span class="header-section-number">22</span> Detect mines vs rocks with Random Forest</a></li>
<li><a class="" href="predicting-the-type-of-glass.html"><span class="header-section-number">23</span> Predicting the type of glass</a></li>
<li><a class="" href="naive-bayes-for-sms-spam.html"><span class="header-section-number">24</span> Naive Bayes for SMS spam</a></li>
<li><a class="" href="vehicles-classiification-with-decision-trees.html"><span class="header-section-number">25</span> Vehicles classiification with Decision Trees</a></li>
<li><a class="" href="applying-naive-bayes-on-the-titanic-case.html"><span class="header-section-number">26</span> Applying Naive-Bayes on the Titanic case</a></li>
<li><a class="" href="classification-on-bad-loans.html"><span class="header-section-number">27</span> Classification on bad loans</a></li>
<li><a class="" href="predicting-flu-outcome-comparing-eight-classification-algorithms.html"><span class="header-section-number">28</span> Predicting Flu outcome comparing eight classification algorithms</a></li>
<li><a class="" href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></li>
<li><a class="" href="prediction-of-arrhythmia-with-deep-neural-nets.html"><span class="header-section-number">30</span> Prediction of arrhythmia with deep neural nets</a></li>
<li class="book-part">Linear Regression</li>
<li><a class="" href="linear-regression-with-islr.html"><span class="header-section-number">31</span> Linear Regression with ISLR</a></li>
<li><a class="" href="evaluation-of-three-linear-regression-models.html"><span class="header-section-number">32</span> Evaluation of three linear regression models</a></li>
<li><a class="" href="comparison-of-six-linear-regression-algorithms.html"><span class="header-section-number">33</span> Comparison of six Linear Regression algorithms</a></li>
<li><a class="" href="comparing-regression-models.html"><span class="header-section-number">34</span> Comparing regression models</a></li>
<li><a class="" href="finding-the-factors-of-happiness.html"><span class="header-section-number">35</span> Finding the factors of happiness</a></li>
<li><a class="" href="regression-with-a-neural-network.html"><span class="header-section-number">36</span> Regression with a neural network</a></li>
<li><a class="" href="comparing-multiple-regression-vs-a-neural-network.html"><span class="header-section-number">37</span> Comparing Multiple Regression vs a Neural Network</a></li>
<li><a class="" href="temperature-modeling-using-nested-dataframes.html"><span class="header-section-number">38</span> Temperature modeling using nested dataframes</a></li>
<li class="book-part">Neural Networks</li>
<li><a class="active" href="credit-scoring-with-neuralnet.html"><span class="header-section-number">39</span> Credit Scoring with neuralnet</a></li>
<li><a class="" href="wine-classification-with-neuralnet.html"><span class="header-section-number">40</span> Wine classification with neuralnet</a></li>
<li><a class="" href="predicting-the-rating-of-cereals.html"><span class="header-section-number">41</span> Predicting the rating of cereals</a></li>
<li><a class="" href="fitting-a-linear-model-with-neural-networks.html"><span class="header-section-number">42</span> Fitting a linear model with neural networks</a></li>
<li><a class="" href="visualization-of-neural-networks.html"><span class="header-section-number">43</span> Visualization of neural networks</a></li>
<li><a class="" href="build-a-fully-connected-r-neural-network-from-scratch.html"><span class="header-section-number">44</span> Build a fully connected R neural network from scratch</a></li>
<li><a class="" href="tuning-hyperparameters-in-a-neural-network.html"><span class="header-section-number">45</span> Tuning Hyperparameters in a Neural Network</a></li>
<li><a class="" href="deep-learning-tips-for-classification-and-regression.html"><span class="header-section-number">46</span> Deep Learning tips for Classification and Regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="what-is-dot-hat-in-a-regression-output.html"><span class="header-section-number">A</span> What is dot hat in a regression output</a></li>
<li><a class="" href="q-q-normal-to-compare-data-to-distributions.html"><span class="header-section-number">B</span> Q-Q normal to compare data to distributions</a></li>
<li><a class="" href="qq-and-pp-plots.html"><span class="header-section-number">C</span> QQ and PP Plots</a></li>
<li><a class="" href="visualizing-residuals.html"><span class="header-section-number">D</span> Visualizing residuals</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hadley/r-pkgs">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="credit-scoring-with-neuralnet" class="section level1">
<h1>
<span class="header-section-number">39</span> Credit Scoring with <code>neuralnet</code><a class="anchor" aria-label="anchor" href="#credit-scoring-with-neuralnet"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-21" class="section level2">
<h2>
<span class="header-section-number">39.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-21"><i class="fas fa-link"></i></a>
</h2>
<p>Source: <a href="https://www.r-bloggers.com/using-neural-networks-for-credit-scoring-a-simple-example/" class="uri">https://www.r-bloggers.com/using-neural-networks-for-credit-scoring-a-simple-example/</a></p>
</div>
<div id="motivation-1" class="section level2">
<h2>
<span class="header-section-number">39.2</span> Motivation<a class="anchor" aria-label="anchor" href="#motivation-1"><i class="fas fa-link"></i></a>
</h2>
<p>Credit scoring is the practice of analysing a persons background and credit application in order to assess the creditworthiness of the person. One can take numerous approaches on analysing this creditworthiness. In the end it basically comes down to first selecting the correct independent variables (e.g. income, age, gender) that lead to a given level of creditworthiness.</p>
<p>In other words: <code>creditworthiness = f(income, age, gender, …)</code>.</p>
<p>A creditscoring system can be represented by linear regression, logistic regression, machine learning or a combination of these. Neural networks are situated in the domain of machine learning. The following is an strongly simplified example. The actual procedure of building a credit scoring system is much more complex and the resulting model will most likely not consist of solely or even a neural network.</p>
<p>If you’re unsure on what a neural network exactly is, I find this a good place to start.</p>
<p>For this example the R package <code>neuralnet</code> is used, for a more in-depth view on the exact workings of the package see neuralnet: <code>Training of Neural Networks</code> by F. Günther and S. Fritsch.</p>
</div>
<div id="load-the-data" class="section level2">
<h2>
<span class="header-section-number">39.3</span> load the data<a class="anchor" aria-label="anchor" href="#load-the-data"><i class="fas fa-link"></i></a>
</h2>
<p>Dataset downloaded: <a href="https://gist.github.com/Bart6114/8675941#file-creditset-csv" class="uri">https://gist.github.com/Bart6114/8675941#file-creditset-csv</a></p>
<div class="sourceCode" id="cb961"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234567890</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bips-hb/neuralnet">neuralnet</a></span><span class="op">)</span>

<span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data_raw_dir</span>, <span class="st">"creditset.csv"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span>
<span class="co">#&gt;   clientid income  age   loan      LTI default10yr</span>
<span class="co">#&gt; 1        1  66156 59.0 8106.5 0.122537           0</span>
<span class="co">#&gt; 2        2  34415 48.1 6564.7 0.190752           0</span>
<span class="co">#&gt; 3        3  57317 63.1 8021.0 0.139940           0</span>
<span class="co">#&gt; 4        4  42710 45.8 6103.6 0.142911           0</span>
<span class="co">#&gt; 5        5  66953 18.6 8770.1 0.130989           1</span>
<span class="co">#&gt; 6        6  24904 57.5   15.5 0.000622           0</span></code></pre></div>
<div class="sourceCode" id="cb962"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span>
<span class="co">#&gt; [1] "clientid"    "income"      "age"         "loan"        "LTI"        </span>
<span class="co">#&gt; [6] "default10yr"</span></code></pre></div>
<div class="sourceCode" id="cb963"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span>
<span class="co">#&gt;     clientid        income           age            loan            LTI        </span>
<span class="co">#&gt;  Min.   :   1   Min.   :20014   Min.   :18.1   Min.   :    1   Min.   :0.0000  </span>
<span class="co">#&gt;  1st Qu.: 501   1st Qu.:32796   1st Qu.:29.1   1st Qu.: 1940   1st Qu.:0.0479  </span>
<span class="co">#&gt;  Median :1000   Median :45789   Median :41.4   Median : 3975   Median :0.0994  </span>
<span class="co">#&gt;  Mean   :1000   Mean   :45332   Mean   :40.9   Mean   : 4444   Mean   :0.0984  </span>
<span class="co">#&gt;  3rd Qu.:1500   3rd Qu.:57791   3rd Qu.:52.6   3rd Qu.: 6432   3rd Qu.:0.1476  </span>
<span class="co">#&gt;  Max.   :2000   Max.   :69996   Max.   :64.0   Max.   :13766   Max.   :0.1999  </span>
<span class="co">#&gt;   default10yr   </span>
<span class="co">#&gt;  Min.   :0.000  </span>
<span class="co">#&gt;  1st Qu.:0.000  </span>
<span class="co">#&gt;  Median :0.000  </span>
<span class="co">#&gt;  Mean   :0.142  </span>
<span class="co">#&gt;  3rd Qu.:0.000  </span>
<span class="co">#&gt;  Max.   :1.000</span></code></pre></div>
<div class="sourceCode" id="cb964"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># distribution of defaults</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">default10yr</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    0    1 </span>
<span class="co">#&gt; 1717  283</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">LTI</span><span class="op">)</span>
<span class="co">#&gt; [1] 4.91e-05</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/jitter.html">jitter</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">default10yr</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/jitter.html">jitter</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">LTI</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="600-nn-classification_900-credit_neuralnet_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb965"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># convert LTI continuous variable to categorical</span>
<span class="va">dataset</span><span class="op">$</span><span class="va">LTIrng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">LTI</span>, breaks <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">LTIrng</span><span class="op">)</span>
<span class="co">#&gt;  [1] (0.12,0.14]      (0.18,0.2]       (0.14,0.16]      (-0.000151,0.02]</span>
<span class="co">#&gt;  [5] (0.1,0.12]       (0.04,0.06]      (0.06,0.08]      (0.08,0.1]      </span>
<span class="co">#&gt;  [9] (0.16,0.18]      (0.02,0.04]     </span>
<span class="co">#&gt; 10 Levels: (-0.000151,0.02] (0.02,0.04] (0.04,0.06] (0.06,0.08] ... (0.18,0.2]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">LTIrng</span>, <span class="va">dataset</span><span class="op">$</span><span class="va">default10yr</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="600-nn-classification_900-credit_neuralnet_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb966"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># what age and LTI is more likely to default</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">LTI</span>, col <span class="op">=</span> <span class="va">default10yr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="600-nn-classification_900-credit_neuralnet_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb967"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># what age and loan size is more likely to default</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">loan</span>, col <span class="op">=</span> <span class="va">default10yr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="600-nn-classification_900-credit_neuralnet_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="objective" class="section level2">
<h2>
<span class="header-section-number">39.4</span> Objective<a class="anchor" aria-label="anchor" href="#objective"><i class="fas fa-link"></i></a>
</h2>
<p>The dataset contains information on different clients who received a loan at least 10 years ago. The variables income (yearly), age, loan (size in euros) and LTI (the loan to yearly income ratio) are available. Our goal is to devise a model which predicts, based on the input variables LTI and age, whether or not a default will occur within 10 years.</p>
</div>
<div id="steps" class="section level2">
<h2>
<span class="header-section-number">39.5</span> Steps<a class="anchor" aria-label="anchor" href="#steps"><i class="fas fa-link"></i></a>
</h2>
<p>The dataset will be split up in a subset used for training the neural network and another set used for testing. As the ordering of the dataset is completely random, we do not have to extract random rows and can just take the first x rows.</p>
<div class="sourceCode" id="cb968"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## extract a set to train the NN</span>
<span class="va">trainset</span> <span class="op">&lt;-</span> <span class="va">dataset</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">800</span>, <span class="op">]</span>

<span class="co">## select the test set</span>
<span class="va">testset</span> <span class="op">&lt;-</span> <span class="va">dataset</span><span class="op">[</span><span class="fl">801</span><span class="op">:</span><span class="fl">2000</span>, <span class="op">]</span></code></pre></div>
<div id="build-the-neural-network" class="section level3">
<h3>
<span class="header-section-number">39.5.1</span> Build the neural network<a class="anchor" aria-label="anchor" href="#build-the-neural-network"><i class="fas fa-link"></i></a>
</h3>
<p>Now we’ll build a neural network with 4 hidden nodes (a neural network is comprised of an input, hidden and output nodes). The number of nodes is chosen here without a clear method, however there are some rules of thumb. The <code>lifesign</code> option refers to the verbosity. The <code>ouput</code> is not linear and we will use a <code>threshold</code> value of 10%. The <code>neuralnet</code> package uses resilient backpropagation with weight backtracking as its standard algorithm.</p>
<div class="sourceCode" id="cb969"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## build the neural network (NN)</span>
<span class="va">creditnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html">neuralnet</a></span><span class="op">(</span><span class="va">default10yr</span> <span class="op">~</span> <span class="va">LTI</span> <span class="op">+</span> <span class="va">age</span>, <span class="va">trainset</span>, 
                       hidden <span class="op">=</span> <span class="fl">4</span>, 
                       lifesign <span class="op">=</span> <span class="st">"minimal"</span>, 
                       linear.output <span class="op">=</span> <span class="cn">FALSE</span>, 
                       threshold <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="co">#&gt; hidden: 4    thresh: 0.1    rep: 1/1    steps:   44487   error: 0.20554  time: 8.49 secs</span></code></pre></div>
<p>The neuralnet package also has the possibility to visualize the generated model and show the found weights.</p>
<div class="sourceCode" id="cb970"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## plot the NN</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">creditnet</span>, rep <span class="op">=</span> <span class="st">"best"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="600-nn-classification_900-credit_neuralnet_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="test-the-neural-network" class="section level2">
<h2>
<span class="header-section-number">39.6</span> Test the neural network<a class="anchor" aria-label="anchor" href="#test-the-neural-network"><i class="fas fa-link"></i></a>
</h2>
<p>Once we’ve trained the neural network we are ready to test it. We use the testset subset for this. The <code>compute</code> function is applied for computing the outputs based on the LTI and age inputs from the testset.</p>
<div class="sourceCode" id="cb971"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## test the resulting output</span>
<span class="va">temp_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">testset</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LTI"</span>, <span class="st">"age"</span><span class="op">)</span><span class="op">)</span>

<span class="va">creditnet.results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/compute.html">compute</a></span><span class="op">(</span><span class="va">creditnet</span>, <span class="va">temp_test</span><span class="op">)</span></code></pre></div>
<p>The temp dataset contains only the columns LTI and age of the train set. Only these variables are used for input. The set looks as follows:</p>
<div class="sourceCode" id="cb972"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">temp_test</span><span class="op">)</span>
<span class="co">#&gt;        LTI  age</span>
<span class="co">#&gt; 801 0.0231 25.9</span>
<span class="co">#&gt; 802 0.1373 40.8</span>
<span class="co">#&gt; 803 0.1046 32.5</span>
<span class="co">#&gt; 804 0.1599 53.2</span>
<span class="co">#&gt; 805 0.1116 46.5</span>
<span class="co">#&gt; 806 0.1149 47.1</span></code></pre></div>
<p>Let’s have a look at what the neural network produced:</p>
<div class="sourceCode" id="cb973"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">testset</span><span class="op">$</span><span class="va">default10yr</span>, prediction <span class="op">=</span> <span class="va">creditnet.results</span><span class="op">$</span><span class="va">net.result</span><span class="op">)</span>
<span class="va">results</span><span class="op">[</span><span class="fl">100</span><span class="op">:</span><span class="fl">115</span>, <span class="op">]</span>
<span class="co">#&gt;     actual prediction</span>
<span class="co">#&gt; 900      0   7.29e-32</span>
<span class="co">#&gt; 901      0   8.17e-11</span>
<span class="co">#&gt; 902      0   4.33e-45</span>
<span class="co">#&gt; 903      1   1.00e+00</span>
<span class="co">#&gt; 904      0   8.06e-04</span>
<span class="co">#&gt; 905      0   3.54e-40</span>
<span class="co">#&gt; 906      0   1.48e-24</span>
<span class="co">#&gt; 907      1   1.00e+00</span>
<span class="co">#&gt; 908      0   1.11e-02</span>
<span class="co">#&gt; 909      0   8.05e-44</span>
<span class="co">#&gt; 910      0   6.72e-07</span>
<span class="co">#&gt; 911      1   1.00e+00</span>
<span class="co">#&gt; 912      0   9.97e-59</span>
<span class="co">#&gt; 913      1   1.00e+00</span>
<span class="co">#&gt; 914      0   3.39e-37</span>
<span class="co">#&gt; 915      0   1.18e-07</span></code></pre></div>
<p>We can round to the nearest integer to improve readability:</p>
<div class="sourceCode" id="cb974"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span><span class="op">$</span><span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.round.html">round</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">prediction</span><span class="op">)</span>
<span class="va">results</span><span class="op">[</span><span class="fl">100</span><span class="op">:</span><span class="fl">115</span>, <span class="op">]</span>
<span class="co">#&gt;     actual prediction</span>
<span class="co">#&gt; 900      0          0</span>
<span class="co">#&gt; 901      0          0</span>
<span class="co">#&gt; 902      0          0</span>
<span class="co">#&gt; 903      1          1</span>
<span class="co">#&gt; 904      0          0</span>
<span class="co">#&gt; 905      0          0</span>
<span class="co">#&gt; 906      0          0</span>
<span class="co">#&gt; 907      1          1</span>
<span class="co">#&gt; 908      0          0</span>
<span class="co">#&gt; 909      0          0</span>
<span class="co">#&gt; 910      0          0</span>
<span class="co">#&gt; 911      1          1</span>
<span class="co">#&gt; 912      0          0</span>
<span class="co">#&gt; 913      1          1</span>
<span class="co">#&gt; 914      0          0</span>
<span class="co">#&gt; 915      0          0</span></code></pre></div>
<p>As you can see it is pretty close! As already stated, this is a strongly simplified example. But it might serve as a basis for you to play around with your first neural network.</p>
<div class="sourceCode" id="cb975"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># how many predictions were wrong</span>
<span class="va">indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">actual</span> <span class="op">!=</span> <span class="va">results</span><span class="op">$</span><span class="va">prediction</span><span class="op">)</span>
<span class="va">indices</span>
<span class="co">#&gt; [1]  330 1008</span></code></pre></div>
<div class="sourceCode" id="cb976"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># what are the predictions that failed</span>
<span class="va">results</span><span class="op">[</span><span class="va">indices</span>,<span class="op">]</span>
<span class="co">#&gt;      actual prediction</span>
<span class="co">#&gt; 1130      0          1</span>
<span class="co">#&gt; 1808      1          0</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="temperature-modeling-using-nested-dataframes.html"><span class="header-section-number">38</span> Temperature modeling using nested dataframes</a></div>
<div class="next"><a href="wine-classification-with-neuralnet.html"><span class="header-section-number">40</span> Wine classification with neuralnet</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#credit-scoring-with-neuralnet"><span class="header-section-number">39</span> Credit Scoring with neuralnet</a></li>
<li><a class="nav-link" href="#introduction-21"><span class="header-section-number">39.1</span> Introduction</a></li>
<li><a class="nav-link" href="#motivation-1"><span class="header-section-number">39.2</span> Motivation</a></li>
<li><a class="nav-link" href="#load-the-data"><span class="header-section-number">39.3</span> load the data</a></li>
<li><a class="nav-link" href="#objective"><span class="header-section-number">39.4</span> Objective</a></li>
<li>
<a class="nav-link" href="#steps"><span class="header-section-number">39.5</span> Steps</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#build-the-neural-network"><span class="header-section-number">39.5.1</span> Build the neural network</a></li></ul>
</li>
<li><a class="nav-link" href="#test-the-neural-network"><span class="header-section-number">39.6</span> Test the neural network</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hadley/r-pkgs/blob/master/600-nn-classification_900-credit_neuralnet.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hadley/r-pkgs/edit/master/600-nn-classification_900-credit_neuralnet.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Machine Learning Compilation</strong>" was written by Several authors. Compiled by Alfonso R. Reyes. It was last built on 2020-11-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
