<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 30 Prediction of arrhythmia with deep neural nets | A Machine Learning Compilation</title>
<meta name="author" content="Several authors. Compiled by Alfonso R. Reyes">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Machine Learning Compilation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preface</a></li>
<li class="book-part">The Basics of Machine Learning</li>
<li><a class="" href="introduction-to-pca.html"><span class="header-section-number">2</span> Introduction to PCA</a></li>
<li><a class="" href="comparison-of-two-pca-packages.html"><span class="header-section-number">3</span> Comparison of two PCA packages</a></li>
<li><a class="" href="detailed-study-of-principal-component-analysis.html"><span class="header-section-number">4</span> Detailed study of Principal Component Analysis</a></li>
<li><a class="" href="detection-of-diabetes-using-logistic-regression.html"><span class="header-section-number">5</span> Detection of diabetes using Logistic Regression</a></li>
<li><a class="" href="sensitivity-analysis-for-a-neural-network.html"><span class="header-section-number">6</span> Sensitivity analysis for a neural network</a></li>
<li><a class="" href="data-visualization-for-ml-models.html"><span class="header-section-number">7</span> Data Visualization for ML models</a></li>
<li class="book-part">Feature Engineering</li>
<li><a class="" href="ten-methods-to-assess-variable-importance.html"><span class="header-section-number">8</span> Ten methods to assess Variable Importance</a></li>
<li><a class="" href="employee-attrition-using-feature-importance.html"><span class="header-section-number">9</span> Employee Attrition using Feature Importance</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="a-gentle-introduction-to-support-vector-machines.html"><span class="header-section-number">10</span> A gentle introduction to Support Vector Machines</a></li>
<li><a class="" href="broad-view-of-svm.html"><span class="header-section-number">11</span> Broad view of SVM</a></li>
<li><a class="" href="feature-selection-to-enhance-cancer-detection.html"><span class="header-section-number">12</span> Feature Selection to enhance cancer detection</a></li>
<li><a class="" href="dealing-with-unbalanced-data.html"><span class="header-section-number">13</span> Dealing with unbalanced data</a></li>
<li><a class="" href="imputting-missing-values-with-random-forest.html"><span class="header-section-number">14</span> Imputting missing values with Random Forest</a></li>
<li><a class="" href="tuning-of-support-vector-machine-prediction.html"><span class="header-section-number">15</span> Tuning of Support Vector Machine prediction</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="introduction-to-algorithms-for-classification.html"><span class="header-section-number">16</span> Introduction to algorithms for Classification</a></li>
<li><a class="" href="comparing-classification-algorithms.html"><span class="header-section-number">17</span> Comparing Classification algorithms</a></li>
<li><a class="" href="who-buys-social-network-ads.html"><span class="header-section-number">18</span> Who buys Social Network ads</a></li>
<li><a class="" href="predicting-ozone-levels.html"><span class="header-section-number">19</span> Predicting Ozone levels</a></li>
<li><a class="" href="building-a-naive-bayes-classifier.html"><span class="header-section-number">20</span> Building a Naive Bayes Classifier</a></li>
<li><a class="" href="linear-and-non-linear-algorithms-for-classification.html"><span class="header-section-number">21</span> Linear and Non-Linear Algorithms for Classification</a></li>
<li><a class="" href="detect-mines-vs-rocks-with-random-forest.html"><span class="header-section-number">22</span> Detect mines vs rocks with Random Forest</a></li>
<li><a class="" href="predicting-the-type-of-glass.html"><span class="header-section-number">23</span> Predicting the type of glass</a></li>
<li><a class="" href="naive-bayes-for-sms-spam.html"><span class="header-section-number">24</span> Naive Bayes for SMS spam</a></li>
<li><a class="" href="vehicles-classiification-with-decision-trees.html"><span class="header-section-number">25</span> Vehicles classiification with Decision Trees</a></li>
<li><a class="" href="applying-naive-bayes-on-the-titanic-case.html"><span class="header-section-number">26</span> Applying Naive-Bayes on the Titanic case</a></li>
<li><a class="" href="classification-on-bad-loans.html"><span class="header-section-number">27</span> Classification on bad loans</a></li>
<li><a class="" href="predicting-flu-outcome-comparing-eight-classification-algorithms.html"><span class="header-section-number">28</span> Predicting Flu outcome comparing eight classification algorithms</a></li>
<li><a class="" href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></li>
<li><a class="active" href="prediction-of-arrhythmia-with-deep-neural-nets.html"><span class="header-section-number">30</span> Prediction of arrhythmia with deep neural nets</a></li>
<li class="book-part">Linear Regression</li>
<li><a class="" href="linear-regression-with-islr.html"><span class="header-section-number">31</span> Linear Regression with ISLR</a></li>
<li><a class="" href="evaluation-of-three-linear-regression-models.html"><span class="header-section-number">32</span> Evaluation of three linear regression models</a></li>
<li><a class="" href="comparison-of-six-linear-regression-algorithms.html"><span class="header-section-number">33</span> Comparison of six Linear Regression algorithms</a></li>
<li><a class="" href="comparing-regression-models.html"><span class="header-section-number">34</span> Comparing regression models</a></li>
<li><a class="" href="finding-the-factors-of-happiness.html"><span class="header-section-number">35</span> Finding the factors of happiness</a></li>
<li><a class="" href="regression-with-a-neural-network.html"><span class="header-section-number">36</span> Regression with a neural network</a></li>
<li><a class="" href="comparing-multiple-regression-vs-a-neural-network.html"><span class="header-section-number">37</span> Comparing Multiple Regression vs a Neural Network</a></li>
<li><a class="" href="temperature-modeling-using-nested-dataframes.html"><span class="header-section-number">38</span> Temperature modeling using nested dataframes</a></li>
<li class="book-part">Neural Networks</li>
<li><a class="" href="credit-scoring-with-neuralnet.html"><span class="header-section-number">39</span> Credit Scoring with neuralnet</a></li>
<li><a class="" href="wine-classification-with-neuralnet.html"><span class="header-section-number">40</span> Wine classification with neuralnet</a></li>
<li><a class="" href="predicting-the-rating-of-cereals.html"><span class="header-section-number">41</span> Predicting the rating of cereals</a></li>
<li><a class="" href="fitting-a-linear-model-with-neural-networks.html"><span class="header-section-number">42</span> Fitting a linear model with neural networks</a></li>
<li><a class="" href="visualization-of-neural-networks.html"><span class="header-section-number">43</span> Visualization of neural networks</a></li>
<li><a class="" href="build-a-fully-connected-r-neural-network-from-scratch.html"><span class="header-section-number">44</span> Build a fully connected R neural network from scratch</a></li>
<li><a class="" href="tuning-hyperparameters-in-a-neural-network.html"><span class="header-section-number">45</span> Tuning Hyperparameters in a Neural Network</a></li>
<li><a class="" href="deep-learning-tips-for-classification-and-regression.html"><span class="header-section-number">46</span> Deep Learning tips for Classification and Regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="what-is-dot-hat-in-a-regression-output.html"><span class="header-section-number">A</span> What is dot hat in a regression output</a></li>
<li><a class="" href="q-q-normal-to-compare-data-to-distributions.html"><span class="header-section-number">B</span> Q-Q normal to compare data to distributions</a></li>
<li><a class="" href="qq-and-pp-plots.html"><span class="header-section-number">C</span> QQ and PP Plots</a></li>
<li><a class="" href="visualizing-residuals.html"><span class="header-section-number">D</span> Visualizing residuals</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/f0nzie/machine_learning_compilation">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="prediction-of-arrhythmia-with-deep-neural-nets" class="section level1">
<h1>
<span class="header-section-number">30</span> Prediction of arrhythmia with deep neural nets<a class="anchor" aria-label="anchor" href="#prediction-of-arrhythmia-with-deep-neural-nets"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-14" class="section level2">
<h2>
<span class="header-section-number">30.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-14"><i class="fas fa-link"></i></a>
</h2>
<p>27 February 2017</p>
<p>This week, I am showing how to build feed-forward deep neural networks or multilayer perceptrons. The models in this example are built to classify ECG data into being either from healthy hearts or from someone suffering from arrhythmia. I will show how to prepare a dataset for modeling, setting weights and other modeling parameters, and finally, how to evaluate model performance with the <code>h2o</code> package.</p>
<div id="deep-learning-with-neural-networks" class="section level3">
<h3>
<span class="header-section-number">30.1.1</span> Deep learning with neural networks<a class="anchor" aria-label="anchor" href="#deep-learning-with-neural-networks"><i class="fas fa-link"></i></a>
</h3>
<p>Deep learning with neural networks is arguably one of the most rapidly growing applications of machine learning and AI today. They allow building complex models that consist of multiple hidden layers within artificial networks and are able to find non-linear patterns in unstructured data. Deep neural networks are usually feed-forward, which means that each layer feeds its output to subsequent layers, but recurrent or feed-back neural networks can also be built. Feed-forward neural networks are also called multilayer perceptrons (MLPs).</p>
</div>
<div id="h2o" class="section level3">
<h3>
<span class="header-section-number">30.1.2</span> H2O<a class="anchor" aria-label="anchor" href="#h2o"><i class="fas fa-link"></i></a>
</h3>
<p>The R package h2o provides a convenient interface to <strong>H2O</strong>, which is an open-source machine learning and deep learning platform. H2O distributes a wide range of common machine learning algorithms for classification, regression and deep learning.</p>
</div>
<div id="preparing-the-r-session" class="section level3">
<h3>
<span class="header-section-number">30.1.3</span> Preparing the R session<a class="anchor" aria-label="anchor" href="#preparing-the-r-session"><i class="fas fa-link"></i></a>
</h3>
<p>First, we need to load the packages.</p>
<div class="sourceCode" id="cb730"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/h2oai/h2o-3">h2o</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/h2oai/h2o-3">h2o</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.init.html">h2o.init</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;  Connection successful!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R is connected to the H2O cluster: </span>
<span class="co">#&gt;     H2O cluster uptime:         24 minutes 57 seconds </span>
<span class="co">#&gt;     H2O cluster timezone:       Etc/UTC </span>
<span class="co">#&gt;     H2O data parsing timezone:  UTC </span>
<span class="co">#&gt;     H2O cluster version:        3.30.0.1 </span>
<span class="co">#&gt;     H2O cluster version age:    7 months and 16 days !!! </span>
<span class="co">#&gt;     H2O cluster name:           H2O_started_from_R_root_mwl453 </span>
<span class="co">#&gt;     H2O cluster total nodes:    1 </span>
<span class="co">#&gt;     H2O cluster total memory:   7.25 GB </span>
<span class="co">#&gt;     H2O cluster total cores:    8 </span>
<span class="co">#&gt;     H2O cluster allowed cores:  8 </span>
<span class="co">#&gt;     H2O cluster healthy:        TRUE </span>
<span class="co">#&gt;     H2O Connection ip:          localhost </span>
<span class="co">#&gt;     H2O Connection port:        54321 </span>
<span class="co">#&gt;     H2O Connection proxy:       NA </span>
<span class="co">#&gt;     H2O Internal Security:      FALSE </span>
<span class="co">#&gt;     H2O API Extensions:         Amazon S3, XGBoost, Algos, AutoML, Core V3, TargetEncoder, Core V4 </span>
<span class="co">#&gt;     R Version:                  R version 3.6.3 (2020-02-29)</span>
<span class="co">#&gt; Warning in h2o.clusterInfo(): </span>
<span class="co">#&gt; Your H2O cluster version is too old (7 months and 16 days)!</span>
<span class="co">#&gt; Please download and install the latest version from http://h2o.ai/download/</span></code></pre></div>
<div class="sourceCode" id="cb731"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_theme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">base_size</span> <span class="op">=</span> <span class="fl">12</span>, <span class="va">base_family</span> <span class="op">=</span> <span class="st">"sans"</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_size</span>, base_family <span class="op">=</span> <span class="va">base_family</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,
    panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,
    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"aliceblue"</span><span class="op">)</span>,
    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkgrey"</span>, color <span class="op">=</span> <span class="st">"grey"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">12</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"right"</span>,
    legend.justification <span class="op">=</span> <span class="st">"top"</span>, 
    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, fill <span class="op">=</span> <span class="cn">NA</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
<div id="arrhythmia-data" class="section level2">
<h2>
<span class="header-section-number">30.2</span> Arrhythmia data<a class="anchor" aria-label="anchor" href="#arrhythmia-data"><i class="fas fa-link"></i></a>
</h2>
<p>The data I am using to demonstrate the building of neural nets is the arrhythmia dataset from <a href="https://archive.ics.uci.edu/ml/datasets/Arrhythmia">UC Irvine’s machine learning database</a>. It contains 279 features from ECG heart rhythm diagnostics and one output column. I am not going to rename the feature columns because they are too many and the descriptions are too complex. Also, we don’t need to know specifically which features we are looking at for building the models.</p>
<blockquote>
<p>For a description of each feature, see <a href="https://archive.ics.uci.edu/ml/machine-learning-databases/arrhythmia/arrhythmia.names" class="uri">https://archive.ics.uci.edu/ml/machine-learning-databases/arrhythmia/arrhythmia.names</a>.</p>
</blockquote>
<p>The output column defines 16 classes: <em>class 1</em> samples are from healthy ECGs, the remaining classes belong to different types of arrhythmia, with <em>class 16</em> being all remaining arrhythmia cases that didn’t fit into distinct classes.</p>
<div class="sourceCode" id="cb732"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">arrhythmia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data_raw_dir</span>, <span class="st">"arrhythmia.data.txt"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span>
<span class="va">arrhythmia</span><span class="op">[</span><span class="va">arrhythmia</span> <span class="op">==</span> <span class="st">"?"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>

<span class="co"># making sure, that all feature columns are numeric</span>
<span class="va">arrhythmia</span><span class="op">[</span><span class="op">-</span><span class="fl">280</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">[</span><span class="op">-</span><span class="fl">280</span><span class="op">]</span>, <span class="va">as.character</span><span class="op">)</span>
<span class="va">arrhythmia</span><span class="op">[</span><span class="op">-</span><span class="fl">280</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">[</span><span class="op">-</span><span class="fl">280</span><span class="op">]</span>, <span class="va">as.numeric</span><span class="op">)</span>

<span class="co">#  renaming output column and converting to factor</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">)</span><span class="op">[</span><span class="fl">280</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"class"</span>
<span class="va">arrhythmia</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></code></pre></div>
<p>As usual, I want to get acquainted with the data and explore it’s properties before I am building any model. So, I am first going to look at the distribution of classes and of healthy and arrhythmia samples.</p>
<div class="sourceCode" id="cb733"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">arrhythmia</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"navy"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Because I am interested in distinguishing healthy from arrhythmia ECGs, I am converting the output to binary format by combining all arrhythmia cases into one class.</p>
<div class="sourceCode" id="cb734"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#  all arrhythmia cases into one class</span>
<span class="va">arrhythmia</span><span class="op">$</span><span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">$</span><span class="va">class</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"healthy"</span>, <span class="st">"arrhythmia"</span><span class="op">)</span>
<span class="va">arrhythmia</span><span class="op">$</span><span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">$</span><span class="va">diagnosis</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb735"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">arrhythmia</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diagnosis</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"navy"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb736"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'gridExtra'</span>
<span class="co">#&gt; The following object is masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     combine</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/plot-cases-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>With binary classification, we have almost the same numbers of healthy and arrhythmia cases in our dataset.</p>
<p>I am also interested in how much the normal and arrhythmia cases cluster in a Principal Component Analysis (PCA). I am first preparing the PCA plotting function and then run it on the feature data.</p>
<div class="sourceCode" id="cb737"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">pcaGoPromoter</span><span class="op">)</span>

<span class="va">pca_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pcaOutput2</span>, <span class="va">group_name</span><span class="op">)</span><span class="op">{</span>
    <span class="va">centroids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mice/man/cbind.html">cbind</a></span><span class="op">(</span><span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span> <span class="op">~</span> <span class="va">groups</span>, <span class="va">pcaOutput2</span>, <span class="va">mean</span><span class="op">)</span>
    <span class="va">conf.rgn</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">pcaOutput2</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span>
          <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>,
                     <span class="fu"><a href="https://rdrr.io/pkg/ellipse/man/ellipse.html">ellipse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">pcaOutput2</span><span class="op">[</span><span class="va">pcaOutput2</span><span class="op">$</span><span class="va">groups</span> <span class="op">==</span> <span class="va">t</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,
                           centre <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">centroids</span><span class="op">[</span><span class="va">centroids</span><span class="op">$</span><span class="va">groups</span> <span class="op">==</span> <span class="va">t</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,
                           level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span>,
                     stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
        
    <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pcaOutput2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, group <span class="op">=</span> <span class="va">groups</span>, 
                                          color <span class="op">=</span> <span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">conf.rgn</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">groups</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">group_name</span><span class="op">)</span>,
           fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">group_name</span><span class="op">)</span>,
           x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC1: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.round.html">round</a></span><span class="op">(</span><span class="va">pcaOutput</span><span class="op">$</span><span class="va">pov</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="st">"% variance"</span><span class="op">)</span>,
           y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC2: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.round.html">round</a></span><span class="op">(</span><span class="va">pcaOutput</span><span class="op">$</span><span class="va">pov</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="st">"% variance"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span>
    
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb738"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Find what columns have NAs and the quantity</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">col</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">n_nas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">[</span>, <span class="va">col</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">n_nas</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">col</span>, <span class="va">n_nas</span>, <span class="st">"\n"</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; V11 8 </span>
<span class="co">#&gt; V12 22 </span>
<span class="co">#&gt; V13 1 </span>
<span class="co">#&gt; V14 376 </span>
<span class="co">#&gt; V15 1</span></code></pre></div>
<div class="sourceCode" id="cb739"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Replace NAs with zeros</span>
<span class="va">arrhythmia</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></code></pre></div>
<p>Find and plot the PCAs.</p>
<div class="sourceCode" id="cb740"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pcaOutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pcaGoPromoter/man/pca.html">pca</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">280</span>, <span class="fl">281</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, printDropped<span class="op">=</span><span class="cn">FALSE</span>, 
                 scale<span class="op">=</span><span class="cn">TRUE</span>, 
                 center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">pcaOutput2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">pcaOutput</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span>

<span class="va">pcaOutput2</span><span class="op">$</span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="va">arrhythmia</span><span class="op">$</span><span class="va">class</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">pca_func</span><span class="op">(</span><span class="va">pcaOutput2</span>, group_name <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span>

<span class="va">pcaOutput2</span><span class="op">$</span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="va">arrhythmia</span><span class="op">$</span><span class="va">diagnosis</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">pca_func</span><span class="op">(</span><span class="va">pcaOutput2</span>, group_name <span class="op">=</span> <span class="st">"diagnosis"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/plot-pca-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>The PCA shows that there is a big overlap between healthy and arrhythmia samples, i.e. there does not seem to be major global differences in all features. The class that is most distinct from all others seems to be class 9.</p>
<p>I want to give the arrhythmia cases that are very different from the rest a stronger weight in the neural network, so I define a <strong>weight column</strong> where every sample outside the central PCA cluster will get a “2”, they will in effect be used twice in the model.</p>
<div class="sourceCode" id="cb741"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">pcaOutput2</span><span class="op">$</span><span class="va">PC1</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">5</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">pcaOutput2</span><span class="op">$</span><span class="va">PC2</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>I also want to know what the variance is within features.</p>
<div class="sourceCode" id="cb742"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HenrikBengtsson/matrixStats">matrixStats</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'matrixStats'</span>
<span class="co">#&gt; The following object is masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     count</span>

<span class="va">colvars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">280</span>, <span class="fl">281</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,
                      variance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/matrixStats/man/rowVars.html">colVars</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">280</span>, <span class="fl">281</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">colvars</span>, <span class="va">variance</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">feature</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">arrhythmia</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">280</span>, <span class="fl">281</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">feature</span>, y <span class="op">=</span> <span class="va">variance</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, fill <span class="op">=</span> <span class="st">"navy"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/plot-feature-variance-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Features with low variance are less likely to strongly contribute to a differentiation between healthy and arrhythmia cases, so I am going to remove them. I am also concatenating the weights column:</p>
<div class="sourceCode" id="cb743"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">arrhythmia_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mice/man/cbind.html">cbind</a></span><span class="op">(</span><span class="va">weights</span>, 
                           <span class="va">arrhythmia</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">281</span>, <span class="fl">280</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">colvars</span><span class="op">$</span><span class="va">variance</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
</div>
<div id="converting-the-dataframe-to-a-h2o-object" class="section level2">
<h2>
<span class="header-section-number">30.3</span> Converting the dataframe to a <code>h2o</code> object<a class="anchor" aria-label="anchor" href="#converting-the-dataframe-to-a-h2o-object"><i class="fas fa-link"></i></a>
</h2>
<p>Now that I have my final data frame for modeling, for working with h2o functions, the data needs to be converted from a <strong>DataFrame</strong> to an <strong>H2O Frame</strong>. This is done with the <code>as_h2o_frame()</code> function.</p>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb744-1" data-line-number="1"><span class="co">#as_h2o_frame(arrhythmia_subset)</span></a>
<a class="sourceLine" id="cb744-2" data-line-number="2">arrhythmia_hf &lt;-<span class="st"> </span><span class="kw">as.h2o</span>(arrhythmia_subset, <span class="dt">key=</span><span class="st">"arrhtythmia.hex"</span>)</a>
<a class="sourceLine" id="cb744-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb744-4" data-line-number="4">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb744-5" data-line-number="5"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb744-6" data-line-number="6">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb744-7" data-line-number="7"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<p>We can now access all functions from the h2o package that are built to work on <code>h2o</code> Frames. A useful such function is <code><a href="https://rdrr.io/pkg/h2o/man/h2o.describe.html">h2o.describe()</a></code>. It is similar to base R’s <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function but outputs many more descriptive measures for our data. To get a good overview about these measures, I am going to plot them.</p>
<div class="sourceCode" id="cb745"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span> <span class="co"># for gathering</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'tidyr'</span>
<span class="co">#&gt; The following object is masked from 'package:S4Vectors':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     expand</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.describe.html">h2o.describe</a></span><span class="op">(</span><span class="va">arrhythmia_hf</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># excluding the weights column</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">Zeros</span><span class="op">:</span><span class="va">Sigma</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span>
    <span class="va">x</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Min"</span>, <span class="st">"Max"</span>, <span class="st">"Mean"</span><span class="op">)</span>, <span class="st">"min, mean, max"</span>, 
    <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NegInf"</span>, <span class="st">"PosInf"</span><span class="op">)</span>, <span class="st">"Inf"</span>, <span class="st">"sigma, zeros"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># separating them into facets makes them easier to see</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Label</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">arrhythmia_hf</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Label</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">.</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Feature"</span>,
         y <span class="op">=</span> <span class="st">"Value"</span>,
         color <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 2 rows containing missing values (geom_point).</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/plot-h2o-describe-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>I am also interested in the correlation between features and the output. We can use the <code><a href="https://rdrr.io/pkg/h2o/man/h2o.cor.html">h2o.cor()</a></code> function to calculate the correlation matrix. It is again much easier to understand the data when we visualize it, so I am going to create another plot.<br></p>
<div class="sourceCode" id="cb746"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span> <span class="co"># for melting</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'reshape2'</span>
<span class="co">#&gt; The following object is masked from 'package:tidyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     smiths</span>

<span class="co"># diagnosis is now a characer column and we need to convert it again</span>
<span class="va">arrhythmia_hf</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.asfactor.html">h2o.asfactor</a></span><span class="op">(</span><span class="va">arrhythmia_hf</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span> 
<span class="va">arrhythmia_hf</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.asfactor.html">h2o.asfactor</a></span><span class="op">(</span><span class="va">arrhythmia_hf</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="co"># same for class</span>

<span class="va">cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.cor.html">h2o.cor</a></span><span class="op">(</span><span class="va">arrhythmia_hf</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">cor</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cor</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">cor</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Var2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">cor</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">cor</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Var2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Var2</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cor</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">variable</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cor</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">variable</span>, y <span class="op">=</span> <span class="va">Var2</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.9</span>, height <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"red"</span>, name <span class="op">=</span> <span class="st">"Cor."</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, 
         y <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co">#&gt; No id variables; using all as measure variables</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/plot-correlation-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="training-test-and-validation-data" class="section level2">
<h2>
<span class="header-section-number">30.4</span> Training, test and validation data<a class="anchor" aria-label="anchor" href="#training-test-and-validation-data"><i class="fas fa-link"></i></a>
</h2>
<p>Now we can use the <code><a href="https://rdrr.io/pkg/h2o/man/h2o.splitFrame.html">h2o.splitFrame()</a></code> function to split the data into training, validation and test data.</p>
<p>Here, I am using 70% for training and 15% each for validation and testing. We could also just split the data into two sections, a training and test set but when we have sufficient samples, it is a good idea to evaluate model performance on an independent test set on top of training with a validation set. Because we can easily overfit a model, we want to get an idea about how generalizable it is - this we can only assess by looking at how well it works on previously unknown data.</p>
<p>I am also defining <code>response</code>, <code>features</code> and <code>weights</code> column names now.</p>
<div class="sourceCode" id="cb747"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">splits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.splitFrame.html">h2o.splitFrame</a></span><span class="op">(</span><span class="va">arrhythmia_hf</span>, 
                         ratios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.15</span><span class="op">)</span>, 
                         seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">train</span> <span class="op">&lt;-</span> <span class="va">splits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">valid</span> <span class="op">&lt;-</span> <span class="va">splits</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="va">test</span> <span class="op">&lt;-</span> <span class="va">splits</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>

<span class="va">response</span> <span class="op">&lt;-</span> <span class="st">"diagnosis"</span>
<span class="va">weights</span> <span class="op">&lt;-</span> <span class="st">"weights"</span>
<span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">train</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">response</span>, <span class="va">weights</span>, <span class="st">"class"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb748"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">train</span><span class="op">$</span><span class="va">diagnosis</span>, exact_quantiles <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt;  diagnosis      </span>
<span class="co">#&gt;  healthy   :163 </span>
<span class="co">#&gt;  arrhythmia:155</span></code></pre></div>
<div class="sourceCode" id="cb749"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">valid</span><span class="op">$</span><span class="va">diagnosis</span>, exact_quantiles <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt;  diagnosis     </span>
<span class="co">#&gt;  healthy   :43 </span>
<span class="co">#&gt;  arrhythmia:25</span></code></pre></div>
<div class="sourceCode" id="cb750"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">diagnosis</span>, exact_quantiles <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt;  diagnosis     </span>
<span class="co">#&gt;  healthy   :39 </span>
<span class="co">#&gt;  arrhythmia:27</span></code></pre></div>
<p>If we had more categorical features, we could use the <code><a href="https://rdrr.io/pkg/h2o/man/h2o.interaction.html">h2o.interaction()</a></code> function to define interaction terms, but since we only have numeric features here, we don’t need this.</p>
<p>We can also run a PCA on the training data, using the <code><a href="https://rdrr.io/pkg/h2o/man/h2o.prcomp.html">h2o.prcomp()</a></code> function to calculate the singular value decomposition of the Gram matrix with the power method.<br></p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb751-1" data-line-number="1">pca &lt;-<span class="st"> </span><span class="kw">h2o.prcomp</span>(<span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb751-2" data-line-number="2">           <span class="dt">x =</span> features,</a>
<a class="sourceLine" id="cb751-3" data-line-number="3">           <span class="dt">validation_frame =</span> valid,</a>
<a class="sourceLine" id="cb751-4" data-line-number="4">           <span class="dt">transform =</span> <span class="st">"NORMALIZE"</span>,</a>
<a class="sourceLine" id="cb751-5" data-line-number="5">           <span class="dt">k =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb751-6" data-line-number="6">           <span class="dt">seed =</span> <span class="dv">42</span>)</a>
<a class="sourceLine" id="cb751-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb751-8" data-line-number="8">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb751-9" data-line-number="9"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb751-10" data-line-number="10">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb751-11" data-line-number="11"><span class="st">  </span><span class="er">|==============</span><span class="st">                                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">20</span>%</a>
<a class="sourceLine" id="cb751-12" data-line-number="12">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb751-13" data-line-number="13"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a>
<a class="sourceLine" id="cb751-14" data-line-number="14"><span class="co">#&gt; Warning in doTryCatch(return(expr), name, parentenv, handler): _train: Dataset</span></a>
<a class="sourceLine" id="cb751-15" data-line-number="15"><span class="co">#&gt; used may contain fewer number of rows due to removal of rows with NA/missing</span></a>
<a class="sourceLine" id="cb751-16" data-line-number="16"><span class="co">#&gt; values. If this is not desirable, set impute_missing argument in pca call to</span></a>
<a class="sourceLine" id="cb751-17" data-line-number="17"><span class="co">#&gt; TRUE/True/true/... depending on the client language.</span></a>
<a class="sourceLine" id="cb751-18" data-line-number="18">pca</a>
<a class="sourceLine" id="cb751-19" data-line-number="19"><span class="co">#&gt; Model Details:</span></a>
<a class="sourceLine" id="cb751-20" data-line-number="20"><span class="co">#&gt; ==============</span></a>
<a class="sourceLine" id="cb751-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb751-22" data-line-number="22"><span class="co">#&gt; H2ODimReductionModel: pca</span></a>
<a class="sourceLine" id="cb751-23" data-line-number="23"><span class="co">#&gt; Model ID:  PCA_model_R_1605840408949_2800 </span></a>
<a class="sourceLine" id="cb751-24" data-line-number="24"><span class="co">#&gt; Importance of components: </span></a>
<a class="sourceLine" id="cb751-25" data-line-number="25"><span class="co">#&gt;                             pc1      pc2      pc3</span></a>
<a class="sourceLine" id="cb751-26" data-line-number="26"><span class="co">#&gt; Standard deviation     0.582620 0.507796 0.421869</span></a>
<a class="sourceLine" id="cb751-27" data-line-number="27"><span class="co">#&gt; Proportion of Variance 0.164697 0.125110 0.086351</span></a>
<a class="sourceLine" id="cb751-28" data-line-number="28"><span class="co">#&gt; Cumulative Proportion  0.164697 0.289808 0.376159</span></a>
<a class="sourceLine" id="cb751-29" data-line-number="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb751-30" data-line-number="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb751-31" data-line-number="31"><span class="co">#&gt; H2ODimReductionMetrics: pca</span></a>
<a class="sourceLine" id="cb751-32" data-line-number="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb751-33" data-line-number="33"><span class="co">#&gt; No model metrics available for PCA</span></a>
<a class="sourceLine" id="cb751-34" data-line-number="34"><span class="co">#&gt; H2ODimReductionMetrics: pca</span></a>
<a class="sourceLine" id="cb751-35" data-line-number="35"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb751-36" data-line-number="36"><span class="co">#&gt; No model metrics available for PCA</span></a></code></pre></div>
<div class="sourceCode" id="cb752"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eigenvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">pca</span><span class="op">@</span><span class="va">model</span><span class="op">$</span><span class="va">eigenvectors</span><span class="op">)</span>
<span class="va">eigenvec</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="va">features</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">eigenvec</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pc1</span>, y <span class="op">=</span> <span class="va">pc2</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"navy"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/plot-eigenvectors-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="modeling" class="section level2">
<h2>
<span class="header-section-number">30.5</span> Modeling<a class="anchor" aria-label="anchor" href="#modeling"><i class="fas fa-link"></i></a>
</h2>
<p>Now, we can build a deep neural network model. We can specify quite a few parameters, like</p>
<ul>
<li><p><strong>Cross-validation</strong>: Cross validation can tell us the training and validation errors for each model. The final model will be overwritten with the best model, if we don’t specify otherwise.</p></li>
<li><p><strong>Adaptive learning rate</strong>: For deep learning with h2o, we by default use stochastic gradient descent optimization with an an adaptive learning rate. The two corresponding parameters rho and epsilon help us find global (or near enough) optima.</p></li>
<li><p><strong>Activation function</strong>: The activation function defines the node output relative to a given set of inputs. We want our activation function to be non-linear and continuously differentiable.</p></li>
<li><p><strong>Hidden nodes</strong>: Defines the number of hidden layers and the number of nodes per layer.</p></li>
<li><p><strong>Epochs</strong>: Increasing the number of epochs (one full training cycle on all training samples) can increase model performance, but we also run the risk of overfitting. To determine the optimal number of epochs, we need to use early stopping.</p></li>
<li><p><strong>Early stopping</strong>: By default, early stopping is enabled. This means that training will be stopped when we reach a certain validation error to prevent overfitting.</p></li>
</ul>
<p>Of course, you need quite a bit of experience and intuition to hit on a good combination of parameters. That’s why it usually makes sense to do a grid search for hyper-parameter tuning. Here, I want to focus on building and evaluating deep learning models, though. I will cover grid search in next week’s post.<br></p>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb753-1" data-line-number="1"><span class="co"># this will take some time and all CPUs</span></a>
<a class="sourceLine" id="cb753-2" data-line-number="2">dl_model &lt;-<span class="st"> </span><span class="kw">h2o.deeplearning</span>(<span class="dt">x =</span> features,</a>
<a class="sourceLine" id="cb753-3" data-line-number="3">                             <span class="dt">y =</span> response,</a>
<a class="sourceLine" id="cb753-4" data-line-number="4">                             <span class="dt">weights_column =</span> weights,</a>
<a class="sourceLine" id="cb753-5" data-line-number="5">                             <span class="dt">model_id =</span> <span class="st">"dl_model"</span>,</a>
<a class="sourceLine" id="cb753-6" data-line-number="6">                             <span class="dt">training_frame =</span> train,</a>
<a class="sourceLine" id="cb753-7" data-line-number="7">                             <span class="dt">validation_frame =</span> valid,</a>
<a class="sourceLine" id="cb753-8" data-line-number="8">                             <span class="dt">nfolds =</span> <span class="dv">15</span>,                                   <span class="co"># 10x cross validation</span></a>
<a class="sourceLine" id="cb753-9" data-line-number="9">                             <span class="dt">keep_cross_validation_fold_assignment =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb753-10" data-line-number="10">                             <span class="dt">fold_assignment =</span> <span class="st">"Stratified"</span>,</a>
<a class="sourceLine" id="cb753-11" data-line-number="11">                             <span class="dt">activation =</span> <span class="st">"RectifierWithDropout"</span>,</a>
<a class="sourceLine" id="cb753-12" data-line-number="12">                             <span class="dt">score_each_iteration =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb753-13" data-line-number="13">                             <span class="dt">hidden =</span> <span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>),           <span class="co"># 5 hidden layers, each of 200 neurons</span></a>
<a class="sourceLine" id="cb753-14" data-line-number="14">                             <span class="dt">epochs =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb753-15" data-line-number="15">                             <span class="dt">variable_importances =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb753-16" data-line-number="16">                             <span class="dt">export_weights_and_biases =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb753-17" data-line-number="17">                             <span class="dt">seed =</span> <span class="dv">42</span>)</a>
<a class="sourceLine" id="cb753-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb753-19" data-line-number="19">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-20" data-line-number="20"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb753-21" data-line-number="21">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-22" data-line-number="22"><span class="st">  </span><span class="er">|==</span><span class="st">                                                                    </span><span class="er">|</span><span class="st">   </span><span class="dv">2</span>%</a>
<a class="sourceLine" id="cb753-23" data-line-number="23">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-24" data-line-number="24"><span class="st">  </span><span class="er">|===</span><span class="st">                                                                   </span><span class="er">|</span><span class="st">   </span><span class="dv">4</span>%</a>
<a class="sourceLine" id="cb753-25" data-line-number="25">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-26" data-line-number="26"><span class="st">  </span><span class="er">|=====</span><span class="st">                                                                 </span><span class="er">|</span><span class="st">   </span><span class="dv">8</span>%</a>
<a class="sourceLine" id="cb753-27" data-line-number="27">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-28" data-line-number="28"><span class="st">  </span><span class="er">|======</span><span class="st">                                                                </span><span class="er">|</span><span class="st">   </span><span class="dv">9</span>%</a>
<a class="sourceLine" id="cb753-29" data-line-number="29">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-30" data-line-number="30"><span class="st">  </span><span class="er">|=======</span><span class="st">                                                               </span><span class="er">|</span><span class="st">  </span><span class="dv">11</span>%</a>
<a class="sourceLine" id="cb753-31" data-line-number="31">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-32" data-line-number="32"><span class="st">  </span><span class="er">|========</span><span class="st">                                                              </span><span class="er">|</span><span class="st">  </span><span class="dv">11</span>%</a>
<a class="sourceLine" id="cb753-33" data-line-number="33">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-34" data-line-number="34"><span class="st">  </span><span class="er">|==========</span><span class="st">                                                            </span><span class="er">|</span><span class="st">  </span><span class="dv">14</span>%</a>
<a class="sourceLine" id="cb753-35" data-line-number="35">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-36" data-line-number="36"><span class="st">  </span><span class="er">|==========</span><span class="st">                                                            </span><span class="er">|</span><span class="st">  </span><span class="dv">15</span>%</a>
<a class="sourceLine" id="cb753-37" data-line-number="37">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-38" data-line-number="38"><span class="st">  </span><span class="er">|===========</span><span class="st">                                                           </span><span class="er">|</span><span class="st">  </span><span class="dv">16</span>%</a>
<a class="sourceLine" id="cb753-39" data-line-number="39">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-40" data-line-number="40"><span class="st">  </span><span class="er">|============</span><span class="st">                                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">18</span>%</a>
<a class="sourceLine" id="cb753-41" data-line-number="41">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-42" data-line-number="42"><span class="st">  </span><span class="er">|==============</span><span class="st">                                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">19</span>%</a>
<a class="sourceLine" id="cb753-43" data-line-number="43">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-44" data-line-number="44"><span class="st">  </span><span class="er">|==============</span><span class="st">                                                        </span><span class="er">|</span><span class="st">  </span><span class="dv">21</span>%</a>
<a class="sourceLine" id="cb753-45" data-line-number="45">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-46" data-line-number="46"><span class="st">  </span><span class="er">|===============</span><span class="st">                                                       </span><span class="er">|</span><span class="st">  </span><span class="dv">22</span>%</a>
<a class="sourceLine" id="cb753-47" data-line-number="47">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-48" data-line-number="48"><span class="st">  </span><span class="er">|=================</span><span class="st">                                                     </span><span class="er">|</span><span class="st">  </span><span class="dv">24</span>%</a>
<a class="sourceLine" id="cb753-49" data-line-number="49">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-50" data-line-number="50"><span class="st">  </span><span class="er">|===================</span><span class="st">                                                   </span><span class="er">|</span><span class="st">  </span><span class="dv">27</span>%</a>
<a class="sourceLine" id="cb753-51" data-line-number="51">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-52" data-line-number="52"><span class="st">  </span><span class="er">|=====================</span><span class="st">                                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">29</span>%</a>
<a class="sourceLine" id="cb753-53" data-line-number="53">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-54" data-line-number="54"><span class="st">  </span><span class="er">|=====================</span><span class="st">                                                 </span><span class="er">|</span><span class="st">  </span><span class="dv">31</span>%</a>
<a class="sourceLine" id="cb753-55" data-line-number="55">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-56" data-line-number="56"><span class="st">  </span><span class="er">|======================</span><span class="st">                                                </span><span class="er">|</span><span class="st">  </span><span class="dv">31</span>%</a>
<a class="sourceLine" id="cb753-57" data-line-number="57">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-58" data-line-number="58"><span class="st">  </span><span class="er">|=======================</span><span class="st">                                               </span><span class="er">|</span><span class="st">  </span><span class="dv">33</span>%</a>
<a class="sourceLine" id="cb753-59" data-line-number="59">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-60" data-line-number="60"><span class="st">  </span><span class="er">|========================</span><span class="st">                                              </span><span class="er">|</span><span class="st">  </span><span class="dv">34</span>%</a>
<a class="sourceLine" id="cb753-61" data-line-number="61">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-62" data-line-number="62"><span class="st">  </span><span class="er">|========================</span><span class="st">                                              </span><span class="er">|</span><span class="st">  </span><span class="dv">35</span>%</a>
<a class="sourceLine" id="cb753-63" data-line-number="63">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-64" data-line-number="64"><span class="st">  </span><span class="er">|==========================</span><span class="st">                                            </span><span class="er">|</span><span class="st">  </span><span class="dv">37</span>%</a>
<a class="sourceLine" id="cb753-65" data-line-number="65">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-66" data-line-number="66"><span class="st">  </span><span class="er">|===========================</span><span class="st">                                           </span><span class="er">|</span><span class="st">  </span><span class="dv">38</span>%</a>
<a class="sourceLine" id="cb753-67" data-line-number="67">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-68" data-line-number="68"><span class="st">  </span><span class="er">|===========================</span><span class="st">                                           </span><span class="er">|</span><span class="st">  </span><span class="dv">39</span>%</a>
<a class="sourceLine" id="cb753-69" data-line-number="69">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-70" data-line-number="70"><span class="st">  </span><span class="er">|============================</span><span class="st">                                          </span><span class="er">|</span><span class="st">  </span><span class="dv">40</span>%</a>
<a class="sourceLine" id="cb753-71" data-line-number="71">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-72" data-line-number="72"><span class="st">  </span><span class="er">|=================================</span><span class="st">                                     </span><span class="er">|</span><span class="st">  </span><span class="dv">48</span>%</a>
<a class="sourceLine" id="cb753-73" data-line-number="73">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-74" data-line-number="74"><span class="st">  </span><span class="er">|=======================================</span><span class="st">                               </span><span class="er">|</span><span class="st">  </span><span class="dv">56</span>%</a>
<a class="sourceLine" id="cb753-75" data-line-number="75">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-76" data-line-number="76"><span class="st">  </span><span class="er">|=============================================</span><span class="st">                         </span><span class="er">|</span><span class="st">  </span><span class="dv">64</span>%</a>
<a class="sourceLine" id="cb753-77" data-line-number="77">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-78" data-line-number="78"><span class="st">  </span><span class="er">|==============================================</span><span class="st">                        </span><span class="er">|</span><span class="st">  </span><span class="dv">65</span>%</a>
<a class="sourceLine" id="cb753-79" data-line-number="79">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb753-80" data-line-number="80"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a></code></pre></div>
<p>Because training can take a while, depending on how many samples, features, nodes and hidden layers you are training on, it is a good idea to save your model.</p>
<div class="sourceCode" id="cb754"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># if file exists, overwrite it</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.saveModel.html">h2o.saveModel</a></span><span class="op">(</span><span class="va">dl_model</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data_out_dir</span>, <span class="st">"dl_model"</span><span class="op">)</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] "/home/rstudio/all/output/data/dl_model/dl_model"</span></code></pre></div>
<p>We can then re-load the model again any time to check the model quality and make predictions on new data.</p>
<div class="sourceCode" id="cb755"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dl_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.loadModel.html">h2o.loadModel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data_out_dir</span>, <span class="st">"dl_model/dl_model"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="model-performance" class="section level2">
<h2>
<span class="header-section-number">30.6</span> Model performance<a class="anchor" aria-label="anchor" href="#model-performance"><i class="fas fa-link"></i></a>
</h2>
<p>We now want to know how our model performed on the validation data. The summary() function will give us a detailed overview of our model. I am not showing the output here, because it is quite extensive.</p>
<div class="sourceCode" id="cb756"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sum_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dl_model</span><span class="op">)</span>
<span class="co">#&gt; Model Details:</span>
<span class="co">#&gt; ==============</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; H2OBinomialModel: deeplearning</span>
<span class="co">#&gt; Model Key:  dl_model </span>
<span class="co">#&gt; Status of Neuron Layers: predicting diagnosis, 2-class classification, bernoulli distribution, CrossEntropy loss, 179,402 weights/biases, 2.1 MB, 34,090 training samples, mini-batch size 1</span>
<span class="co">#&gt;   layer units             type dropout       l1       l2 mean_rate rate_rms</span>
<span class="co">#&gt; 1     1    90            Input  0.00 %       NA       NA        NA       NA</span>
<span class="co">#&gt; 2     2   200 RectifierDropout 50.00 % 0.000000 0.000000  0.004410 0.003566</span>
<span class="co">#&gt; 3     3   200 RectifierDropout 50.00 % 0.000000 0.000000  0.007427 0.004335</span>
<span class="co">#&gt; 4     4   200 RectifierDropout 50.00 % 0.000000 0.000000  0.010675 0.005708</span>
<span class="co">#&gt; 5     5   200 RectifierDropout 50.00 % 0.000000 0.000000  0.009960 0.004888</span>
<span class="co">#&gt; 6     6   200 RectifierDropout 50.00 % 0.000000 0.000000  0.016891 0.033925</span>
<span class="co">#&gt; 7     7     2          Softmax      NA 0.000000 0.000000  0.002348 0.001300</span>
<span class="co">#&gt;   momentum mean_weight weight_rms mean_bias bias_rms</span>
<span class="co">#&gt; 1       NA          NA         NA        NA       NA</span>
<span class="co">#&gt; 2 0.000000    0.003335   0.096079  0.425264 0.057396</span>
<span class="co">#&gt; 3 0.000000   -0.008360   0.074794  0.953139 0.052764</span>
<span class="co">#&gt; 4 0.000000   -0.008134   0.072302  0.965284 0.025436</span>
<span class="co">#&gt; 5 0.000000   -0.005446   0.071378  0.980205 0.032167</span>
<span class="co">#&gt; 6 0.000000   -0.009832   0.071224  0.960465 0.031353</span>
<span class="co">#&gt; 7 0.000000   -0.041027   0.379064 -0.001154 0.102214</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; H2OBinomialMetrics: deeplearning</span>
<span class="co">#&gt; ** Reported on training data. **</span>
<span class="co">#&gt; ** Metrics reported on full training frame **</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.0186</span>
<span class="co">#&gt; RMSE:  0.137</span>
<span class="co">#&gt; LogLoss:  0.0818</span>
<span class="co">#&gt; Mean Per-Class Error:  0.0183</span>
<span class="co">#&gt; AUC:  0.986</span>
<span class="co">#&gt; AUCPR:  0.964</span>
<span class="co">#&gt; Gini:  0.972</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            arrhythmia healthy    Error    Rate</span>
<span class="co">#&gt; arrhythmia        158       6 0.036585  =6/164</span>
<span class="co">#&gt; healthy             0     163 0.000000  =0/163</span>
<span class="co">#&gt; Totals            158     169 0.018349  =6/327</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold      value idx</span>
<span class="co">#&gt; 1                       max f1  0.418479   0.981928 168</span>
<span class="co">#&gt; 2                       max f2  0.418479   0.992692 168</span>
<span class="co">#&gt; 3                 max f0point5  0.777120   0.975460 162</span>
<span class="co">#&gt; 4                 max accuracy  0.418479   0.981651 168</span>
<span class="co">#&gt; 5                max precision  0.994204   1.000000   0</span>
<span class="co">#&gt; 6                   max recall  0.418479   1.000000 168</span>
<span class="co">#&gt; 7              max specificity  0.994204   1.000000   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.418479   0.963956 168</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.777120   0.975460 162</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.418479   0.981707 168</span>
<span class="co">#&gt; 11                     max tns  0.994204 164.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.994204 162.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.000000 164.000000 317</span>
<span class="co">#&gt; 14                     max tps  0.418479 163.000000 168</span>
<span class="co">#&gt; 15                     max tnr  0.994204   1.000000   0</span>
<span class="co">#&gt; 16                     max fnr  0.994204   0.993865   0</span>
<span class="co">#&gt; 17                     max fpr  0.000000   1.000000 317</span>
<span class="co">#&gt; 18                     max tpr  0.418479   1.000000 168</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>
<span class="co">#&gt; H2OBinomialMetrics: deeplearning</span>
<span class="co">#&gt; ** Reported on validation data. **</span>
<span class="co">#&gt; ** Metrics reported on full validation frame **</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.185</span>
<span class="co">#&gt; RMSE:  0.43</span>
<span class="co">#&gt; LogLoss:  1.07</span>
<span class="co">#&gt; Mean Per-Class Error:  0.232</span>
<span class="co">#&gt; AUC:  0.856</span>
<span class="co">#&gt; AUCPR:  0.904</span>
<span class="co">#&gt; Gini:  0.712</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            arrhythmia healthy    Error    Rate</span>
<span class="co">#&gt; arrhythmia         14      11 0.440000  =11/25</span>
<span class="co">#&gt; healthy             1      42 0.023256   =1/43</span>
<span class="co">#&gt; Totals             15      53 0.176471  =12/68</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold     value idx</span>
<span class="co">#&gt; 1                       max f1  0.000010  0.875000  52</span>
<span class="co">#&gt; 2                       max f2  0.000010  0.933333  52</span>
<span class="co">#&gt; 3                 max f0point5  0.532411  0.844749  43</span>
<span class="co">#&gt; 4                 max accuracy  0.026911  0.823529  46</span>
<span class="co">#&gt; 5                max precision  0.994281  1.000000   0</span>
<span class="co">#&gt; 6                   max recall  0.000001  1.000000  60</span>
<span class="co">#&gt; 7              max specificity  0.994281  1.000000   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.000010  0.624149  52</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.837920  0.744186  37</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.026911  0.793488  46</span>
<span class="co">#&gt; 11                     max tns  0.994281 25.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.994281 42.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.000000 25.000000  67</span>
<span class="co">#&gt; 14                     max tps  0.000001 43.000000  60</span>
<span class="co">#&gt; 15                     max tnr  0.994281  1.000000   0</span>
<span class="co">#&gt; 16                     max fnr  0.994281  0.976744   0</span>
<span class="co">#&gt; 17                     max fpr  0.000000  1.000000  67</span>
<span class="co">#&gt; 18                     max tpr  0.000001  1.000000  60</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>
<span class="co">#&gt; H2OBinomialMetrics: deeplearning</span>
<span class="co">#&gt; ** Reported on cross-validation data. **</span>
<span class="co">#&gt; ** 15-fold cross-validation on training data (Metrics computed for combined holdout predictions) **</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.179</span>
<span class="co">#&gt; RMSE:  0.424</span>
<span class="co">#&gt; LogLoss:  0.612</span>
<span class="co">#&gt; Mean Per-Class Error:  0.22</span>
<span class="co">#&gt; AUC:  0.832</span>
<span class="co">#&gt; AUCPR:  0.791</span>
<span class="co">#&gt; Gini:  0.664</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            arrhythmia healthy    Error     Rate</span>
<span class="co">#&gt; arrhythmia        118      46 0.280488  =46/164</span>
<span class="co">#&gt; healthy            26     137 0.159509  =26/163</span>
<span class="co">#&gt; Totals            144     183 0.220183  =72/327</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold      value idx</span>
<span class="co">#&gt; 1                       max f1  0.467012   0.791908 182</span>
<span class="co">#&gt; 2                       max f2  0.010805   0.890487 251</span>
<span class="co">#&gt; 3                 max f0point5  0.818005   0.767511 126</span>
<span class="co">#&gt; 4                 max accuracy  0.479766   0.779817 180</span>
<span class="co">#&gt; 5                max precision  0.990047   1.000000   0</span>
<span class="co">#&gt; 6                   max recall  0.000494   1.000000 285</span>
<span class="co">#&gt; 7              max specificity  0.990047   1.000000   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.467012   0.564026 182</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.642316   0.760736 162</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.467012   0.780001 182</span>
<span class="co">#&gt; 11                     max tns  0.990047 164.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.990047 162.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.000002 164.000000 317</span>
<span class="co">#&gt; 14                     max tps  0.000494 163.000000 285</span>
<span class="co">#&gt; 15                     max tnr  0.990047   1.000000   0</span>
<span class="co">#&gt; 16                     max fnr  0.990047   0.993865   0</span>
<span class="co">#&gt; 17                     max fpr  0.000002   1.000000 317</span>
<span class="co">#&gt; 18                     max tpr  0.000494   1.000000 285</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span>
<span class="co">#&gt; Cross-Validation Metrics Summary: </span>
<span class="co">#&gt;                 mean         sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid</span>
<span class="co">#&gt; accuracy   0.8264511 0.06905811 0.71428573  0.7647059 0.93333334 0.82608694</span>
<span class="co">#&gt; auc       0.85387987 0.08763333 0.72727275 0.73333335  0.9814815 0.88095236</span>
<span class="co">#&gt; aucpr     0.81194234 0.16594325  0.6327996 0.41917738  0.9882933  0.9155332</span>
<span class="co">#&gt; err       0.17354885 0.06905811  0.2857143 0.23529412 0.06666667 0.17391305</span>
<span class="co">#&gt; err_count  4.0666666  2.3441925        8.0        4.0        1.0        4.0</span>
<span class="co">#&gt;           cv_5_valid cv_6_valid cv_7_valid cv_8_valid cv_9_valid cv_10_valid</span>
<span class="co">#&gt; accuracy   0.8888889     0.9375  0.8181818 0.90909094  0.7692308         0.8</span>
<span class="co">#&gt; auc        0.9220779   0.984375      0.875  0.9285714 0.78431374   0.8348214</span>
<span class="co">#&gt; aucpr      0.9566689  0.9852771  0.8248434  0.9663477  0.8781041    0.787485</span>
<span class="co">#&gt; err       0.11111111     0.0625 0.18181819 0.09090909 0.23076923         0.2</span>
<span class="co">#&gt; err_count        2.0        1.0        4.0        1.0        6.0         6.0</span>
<span class="co">#&gt;           cv_11_valid cv_12_valid cv_13_valid cv_14_valid cv_15_valid</span>
<span class="co">#&gt; accuracy    0.8181818   0.7619048        0.75  0.83870965   0.8666667</span>
<span class="co">#&gt; auc        0.88429755         0.7   0.8203125      0.8625   0.8888889</span>
<span class="co">#&gt; aucpr       0.9034981  0.55518734  0.81944454   0.7740876   0.7723875</span>
<span class="co">#&gt; err        0.18181819  0.23809524        0.25  0.16129032  0.13333334</span>
<span class="co">#&gt; err_count         4.0         5.0         8.0         5.0         2.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt;                   mean          sd  cv_1_valid   cv_2_valid cv_3_valid</span>
<span class="co">#&gt; pr_auc      0.81194234  0.16594325   0.6327996   0.41917738  0.9882933</span>
<span class="co">#&gt; precision   0.77556306 0.123630576  0.57894737    0.5714286        0.9</span>
<span class="co">#&gt; r2          0.28461012  0.25423092 -0.15165131 -0.032088812 0.74034876</span>
<span class="co">#&gt; recall      0.92027056 0.094280414         1.0          0.8        1.0</span>
<span class="co">#&gt; rmse         0.4067296 0.074735165    0.524111   0.46289793 0.24963234</span>
<span class="co">#&gt; specificity  0.7232667  0.18531013   0.5294118         0.75  0.8333333</span>
<span class="co">#&gt;             cv_4_valid cv_5_valid cv_6_valid cv_7_valid cv_8_valid cv_9_valid</span>
<span class="co">#&gt; pr_auc       0.9155332  0.9566689  0.9852771  0.8248434  0.9663477  0.8781041</span>
<span class="co">#&gt; precision    0.7777778 0.90909094  0.8888889       0.75        1.0 0.73913044</span>
<span class="co">#&gt; r2           0.3932612 0.43196946   0.566897 0.31167182  0.5744002 0.16804448</span>
<span class="co">#&gt; recall             1.0 0.90909094        1.0       0.75 0.85714287        1.0</span>
<span class="co">#&gt; rmse         0.3801529 0.36741653 0.32905284 0.39910218 0.31382465 0.43393275</span>
<span class="co">#&gt; specificity  0.5555556 0.85714287      0.875 0.85714287        1.0 0.33333334</span>
<span class="co">#&gt;             cv_10_valid cv_11_valid  cv_12_valid cv_13_valid cv_14_valid</span>
<span class="co">#&gt; pr_auc         0.787485   0.9034981   0.55518734  0.81944454   0.7740876</span>
<span class="co">#&gt; precision          0.75   0.8181818    0.6666667   0.6666667   0.8666667</span>
<span class="co">#&gt; r2              0.27393   0.3500686 -0.105942845  0.11054755  0.37114796</span>
<span class="co">#&gt; recall       0.85714287   0.8181818          1.0         1.0      0.8125</span>
<span class="co">#&gt; rmse         0.42510086   0.4030916    0.5252226  0.47155392   0.3962946</span>
<span class="co">#&gt; specificity        0.75   0.8181818   0.54545456         0.5   0.8666667</span>
<span class="co">#&gt;             cv_15_valid</span>
<span class="co">#&gt; pr_auc        0.7723875</span>
<span class="co">#&gt; precision          0.75</span>
<span class="co">#&gt; r2            0.2665479</span>
<span class="co">#&gt; recall              1.0</span>
<span class="co">#&gt; rmse          0.4195575</span>
<span class="co">#&gt; specificity   0.7777778</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Scoring History: </span>
<span class="co">#&gt;              timestamp          duration training_speed    epochs iterations</span>
<span class="co">#&gt; 1  2020-11-20 03:13:16         0.000 sec             NA   0.00000          0</span>
<span class="co">#&gt; 2  2020-11-20 03:13:17  1 min 17.796 sec   6407 obs/sec  10.72013          1</span>
<span class="co">#&gt; 3  2020-11-20 03:13:17  1 min 18.386 sec   6336 obs/sec  21.44025          2</span>
<span class="co">#&gt; 4  2020-11-20 03:13:18  1 min 19.009 sec   6209 obs/sec  32.16038          3</span>
<span class="co">#&gt; 5  2020-11-20 03:13:18  1 min 19.593 sec   6255 obs/sec  42.88050          4</span>
<span class="co">#&gt; 6  2020-11-20 03:13:19  1 min 20.122 sec   6407 obs/sec  53.60063          5</span>
<span class="co">#&gt; 7  2020-11-20 03:13:20  1 min 20.672 sec   6470 obs/sec  64.32075          6</span>
<span class="co">#&gt; 8  2020-11-20 03:13:20  1 min 21.161 sec   6626 obs/sec  75.04088          7</span>
<span class="co">#&gt; 9  2020-11-20 03:13:21  1 min 21.713 sec   6651 obs/sec  85.76101          8</span>
<span class="co">#&gt; 10 2020-11-20 03:13:21  1 min 22.206 sec   6753 obs/sec  96.48113          9</span>
<span class="co">#&gt; 11 2020-11-20 03:13:22  1 min 22.691 sec   6849 obs/sec 107.20126         10</span>
<span class="co">#&gt;         samples training_rmse training_logloss training_r2 training_auc</span>
<span class="co">#&gt; 1      0.000000            NA               NA          NA           NA</span>
<span class="co">#&gt; 2   3409.000000       0.38710          0.50069     0.40061      0.87805</span>
<span class="co">#&gt; 3   6818.000000       0.37006          0.45518     0.45221      0.91819</span>
<span class="co">#&gt; 4  10227.000000       0.31307          0.33984     0.60796      0.93371</span>
<span class="co">#&gt; 5  13636.000000       0.29218          0.28780     0.65851      0.94389</span>
<span class="co">#&gt; 6  17045.000000       0.27788          0.26995     0.69114      0.95470</span>
<span class="co">#&gt; 7  20454.000000       0.24824          0.21679     0.75350      0.96263</span>
<span class="co">#&gt; 8  23863.000000       0.22656          0.17875     0.79468      0.97187</span>
<span class="co">#&gt; 9  27272.000000       0.20888          0.15915     0.82547      0.97684</span>
<span class="co">#&gt; 10 30681.000000       0.20676          0.14910     0.82901      0.97943</span>
<span class="co">#&gt; 11 34090.000000       0.13655          0.08185     0.92541      0.98593</span>
<span class="co">#&gt;    training_pr_auc training_lift training_classification_error validation_rmse</span>
<span class="co">#&gt; 1               NA            NA                            NA              NA</span>
<span class="co">#&gt; 2          0.85608       2.00613                       0.20183         0.42497</span>
<span class="co">#&gt; 3          0.88384       2.00613                       0.13761         0.44540</span>
<span class="co">#&gt; 4          0.90412       2.00613                       0.11927         0.42070</span>
<span class="co">#&gt; 5          0.91572       2.00613                       0.10703         0.39320</span>
<span class="co">#&gt; 6          0.92469       2.00613                       0.08869         0.40088</span>
<span class="co">#&gt; 7          0.93161       2.00613                       0.07339         0.41127</span>
<span class="co">#&gt; 8          0.95640       2.00613                       0.06422         0.42758</span>
<span class="co">#&gt; 9          0.96058       2.00613                       0.04281         0.40838</span>
<span class="co">#&gt; 10         0.96071       2.00613                       0.04893         0.40080</span>
<span class="co">#&gt; 11         0.96352       2.00613                       0.01835         0.42967</span>
<span class="co">#&gt;    validation_logloss validation_r2 validation_auc validation_pr_auc</span>
<span class="co">#&gt; 1                  NA            NA             NA                NA</span>
<span class="co">#&gt; 2             0.65975       0.22316        0.83349           0.86349</span>
<span class="co">#&gt; 3             0.71988       0.14669        0.87163           0.90336</span>
<span class="co">#&gt; 4             0.68549       0.23869        0.86140           0.90503</span>
<span class="co">#&gt; 5             0.60864       0.33498        0.88465           0.92204</span>
<span class="co">#&gt; 6             0.61984       0.30874        0.88465           0.92387</span>
<span class="co">#&gt; 7             0.73716       0.27246        0.85953           0.90783</span>
<span class="co">#&gt; 8             0.78238       0.21362        0.84744           0.89505</span>
<span class="co">#&gt; 9             0.93037       0.28265        0.85581           0.89635</span>
<span class="co">#&gt; 10            0.80015       0.30901        0.87721           0.92082</span>
<span class="co">#&gt; 11            1.06884       0.20591        0.85581           0.90389</span>
<span class="co">#&gt;    validation_lift validation_classification_error</span>
<span class="co">#&gt; 1               NA                              NA</span>
<span class="co">#&gt; 2          1.58140                         0.20588</span>
<span class="co">#&gt; 3          1.58140                         0.16176</span>
<span class="co">#&gt; 4          1.58140                         0.17647</span>
<span class="co">#&gt; 5          1.58140                         0.17647</span>
<span class="co">#&gt; 6          1.58140                         0.17647</span>
<span class="co">#&gt; 7          1.58140                         0.19118</span>
<span class="co">#&gt; 8          1.58140                         0.17647</span>
<span class="co">#&gt; 9          1.58140                         0.17647</span>
<span class="co">#&gt; 10         1.58140                         0.17647</span>
<span class="co">#&gt; 11         1.58140                         0.17647</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Variable Importances: (Extract with `h2o.varimp`) </span>
<span class="co">#&gt; =================================================</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Variable Importances: </span>
<span class="co">#&gt;   variable relative_importance scaled_importance percentage</span>
<span class="co">#&gt; 1     V169            1.000000          1.000000   0.013985</span>
<span class="co">#&gt; 2      V15            0.981259          0.981259   0.013723</span>
<span class="co">#&gt; 3     V239            0.954730          0.954730   0.013352</span>
<span class="co">#&gt; 4     V136            0.952538          0.952538   0.013322</span>
<span class="co">#&gt; 5      V42            0.949366          0.949366   0.013277</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt;    variable relative_importance scaled_importance percentage</span>
<span class="co">#&gt; 85     V218            0.717785          0.717785   0.010038</span>
<span class="co">#&gt; 86     V188            0.713244          0.713244   0.009975</span>
<span class="co">#&gt; 87     V219            0.713025          0.713025   0.009972</span>
<span class="co">#&gt; 88      V12            0.705674          0.705674   0.009869</span>
<span class="co">#&gt; 89     V179            0.680337          0.680337   0.009515</span>
<span class="co">#&gt; 90     V269            0.671023          0.671023   0.009384</span></code></pre></div>
<p>One performance metric we are usually interested in is the mean per class error for training and validation data.</p>
<div class="sourceCode" id="cb757"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.mean_per_class_error.html">h2o.mean_per_class_error</a></span><span class="op">(</span><span class="va">dl_model</span>, train <span class="op">=</span> <span class="cn">TRUE</span>, valid <span class="op">=</span> <span class="cn">TRUE</span>, xval <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt;  train  valid   xval </span>
<span class="co">#&gt; 0.0183 0.2316 0.2200</span></code></pre></div>
<p>The confusion matrix tells us, how many classes have been predicted correctly and how many predictions were accurate. Here, we see the errors in predictions on validation data.</p>
<div class="sourceCode" id="cb758"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.confusionMatrix.html">h2o.confusionMatrix</a></span><span class="op">(</span><span class="va">dl_model</span>, valid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted)  for max f1 @ threshold = 9.50154319453689e-06:</span>
<span class="co">#&gt;            arrhythmia healthy    Error    Rate</span>
<span class="co">#&gt; arrhythmia         14      11 0.440000  =11/25</span>
<span class="co">#&gt; healthy             1      42 0.023256   =1/43</span>
<span class="co">#&gt; Totals             15      53 0.176471  =12/68</span></code></pre></div>
<p>We can also plot the classification error over all epochs or samples.</p>
<div class="sourceCode" id="cb759"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">dl_model</span>,
     timestep <span class="op">=</span> <span class="st">"epochs"</span>,
     metric <span class="op">=</span> <span class="st">"classification_error"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/unnamed-chunk-18-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb760"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">dl_model</span>,
     timestep <span class="op">=</span> <span class="st">"samples"</span>,
     metric <span class="op">=</span> <span class="st">"classification_error"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/unnamed-chunk-19-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Next to the classification error, we are usually interested in the logistic loss (negative log-likelihood or log loss). It describes the sum of errors for each sample in the training or validation data or the negative logarithm of the likelihood of error for a given prediction/ classification. Simply put, the lower the loss, the better the model (if we ignore potential overfitting).</p>
<div class="sourceCode" id="cb761"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">dl_model</span>,
     timestep <span class="op">=</span> <span class="st">"epochs"</span>,
     metric <span class="op">=</span> <span class="st">"logloss"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>We can also plot the mean squared error (MSE). The <strong>MSE</strong> tells us the average of the prediction errors squared, i.e. the estimator’s variance and bias. The closer to zero, the better a model.</p>
<div class="sourceCode" id="cb762"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">dl_model</span>,
     timestep <span class="op">=</span> <span class="st">"epochs"</span>,
     metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/unnamed-chunk-21-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Next, we want to know the area under the curve (AUC). <strong>AUC</strong> is an important metric for measuring binary classification model performances. It gives the area under the curve, i.e. the integral, of true positive vs false positive rates. The closer to 1, the better a model.</p>
<div class="sourceCode" id="cb763"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">dl_model</span>, train <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.986</span></code></pre></div>
<div class="sourceCode" id="cb764"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">dl_model</span>, valid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.856</span></code></pre></div>
<div class="sourceCode" id="cb765"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">dl_model</span>, xval <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.832</span></code></pre></div>
<p>The weights for connecting two adjacent layers and per-neuron biases that we specified the model to save, can be accessed with:</p>
<div class="sourceCode" id="cb766"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.weights.html">h2o.weights</a></span><span class="op">(</span><span class="va">dl_model</span>, matrix_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.biases.html">h2o.biases</a></span><span class="op">(</span><span class="va">dl_model</span>, vector_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Variable importance can be extracted as well (but keep in mind, that variable importance in deep neural networks is difficult to assess and should be considered only as rough estimates).</p>
<div class="sourceCode" id="cb767"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.varimp.html">h2o.varimp</a></span><span class="op">(</span><span class="va">dl_model</span><span class="op">)</span>
<span class="co">#&gt; Variable Importances: </span>
<span class="co">#&gt;   variable relative_importance scaled_importance percentage</span>
<span class="co">#&gt; 1     V169            1.000000          1.000000   0.013985</span>
<span class="co">#&gt; 2      V15            0.981259          0.981259   0.013723</span>
<span class="co">#&gt; 3     V239            0.954730          0.954730   0.013352</span>
<span class="co">#&gt; 4     V136            0.952538          0.952538   0.013322</span>
<span class="co">#&gt; 5      V42            0.949366          0.949366   0.013277</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt;    variable relative_importance scaled_importance percentage</span>
<span class="co">#&gt; 85     V218            0.717785          0.717785   0.010038</span>
<span class="co">#&gt; 86     V188            0.713244          0.713244   0.009975</span>
<span class="co">#&gt; 87     V219            0.713025          0.713025   0.009972</span>
<span class="co">#&gt; 88      V12            0.705674          0.705674   0.009869</span>
<span class="co">#&gt; 89     V179            0.680337          0.680337   0.009515</span>
<span class="co">#&gt; 90     V269            0.671023          0.671023   0.009384</span></code></pre></div>
<div class="sourceCode" id="cb768"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.varimp_plot.html">h2o.varimp_plot</a></span><span class="op">(</span><span class="va">dl_model</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/unnamed-chunk-27-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="test-data" class="section level2">
<h2>
<span class="header-section-number">30.7</span> Test data<a class="anchor" aria-label="anchor" href="#test-data"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have a good idea about model performance on validation data, we want to know how it performed on unseen test data. A good model should find an optimal balance between accuracy on training and test data. A model that has 0% error on the training data but 40% error on the test data is in effect useless. It overfit on the training data and is thus not able to generalize to unknown data.</p>
<div class="sourceCode" id="cb769"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">perf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.performance.html">h2o.performance</a></span><span class="op">(</span><span class="va">dl_model</span>, <span class="va">test</span><span class="op">)</span>
<span class="va">perf</span>
<span class="co">#&gt; H2OBinomialMetrics: deeplearning</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; MSE:  0.241</span>
<span class="co">#&gt; RMSE:  0.491</span>
<span class="co">#&gt; LogLoss:  1.68</span>
<span class="co">#&gt; Mean Per-Class Error:  0.244</span>
<span class="co">#&gt; AUC:  0.791</span>
<span class="co">#&gt; AUCPR:  0.814</span>
<span class="co">#&gt; Gini:  0.582</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted) for F1-optimal threshold:</span>
<span class="co">#&gt;            arrhythmia healthy    Error    Rate</span>
<span class="co">#&gt; arrhythmia         18       9 0.333333   =9/27</span>
<span class="co">#&gt; healthy             6      33 0.153846   =6/39</span>
<span class="co">#&gt; Totals             24      42 0.227273  =15/66</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Maximum Metrics: Maximum metrics at their respective thresholds</span>
<span class="co">#&gt;                         metric threshold     value idx</span>
<span class="co">#&gt; 1                       max f1  0.021631  0.814815  41</span>
<span class="co">#&gt; 2                       max f2  0.000001  0.915493  56</span>
<span class="co">#&gt; 3                 max f0point5  0.960972  0.817610  29</span>
<span class="co">#&gt; 4                 max accuracy  0.021631  0.772727  41</span>
<span class="co">#&gt; 5                max precision  0.992921  1.000000   0</span>
<span class="co">#&gt; 6                   max recall  0.000001  1.000000  56</span>
<span class="co">#&gt; 7              max specificity  0.992921  1.000000   0</span>
<span class="co">#&gt; 8             max absolute_mcc  0.021631  0.524142  41</span>
<span class="co">#&gt; 9   max min_per_class_accuracy  0.705627  0.740741  35</span>
<span class="co">#&gt; 10 max mean_per_class_accuracy  0.960972  0.759259  29</span>
<span class="co">#&gt; 11                     max tns  0.992921 27.000000   0</span>
<span class="co">#&gt; 12                     max fns  0.992921 38.000000   0</span>
<span class="co">#&gt; 13                     max fps  0.000000 27.000000  65</span>
<span class="co">#&gt; 14                     max tps  0.000001 39.000000  56</span>
<span class="co">#&gt; 15                     max tnr  0.992921  1.000000   0</span>
<span class="co">#&gt; 16                     max fnr  0.992921  0.974359   0</span>
<span class="co">#&gt; 17                     max fpr  0.000000  1.000000  65</span>
<span class="co">#&gt; 18                     max tpr  0.000001  1.000000  56</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gains/Lift Table: Extract with `h2o.gainsLift(&lt;model&gt;, &lt;data&gt;)` or `h2o.gainsLift(&lt;model&gt;, valid=&lt;T/F&gt;, xval=&lt;T/F&gt;)`</span></code></pre></div>
<p>Plotting the test performance’s AUC plot shows us approximately how good the predictions are.</p>
<div class="sourceCode" id="cb770"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">perf</span><span class="op">)</span></code></pre></div>
<div class="inline-figure">
<img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/unnamed-chunk-29-1.png" width="70%" style="display: block; margin: auto;">
We also want to know the log loss, MSE and AUC values, as well as other model metrics for the test data:</div>
<div class="sourceCode" id="cb771"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.logloss.html">h2o.logloss</a></span><span class="op">(</span><span class="va">perf</span><span class="op">)</span>
<span class="co">#&gt; [1] 1.68</span></code></pre></div>
<div class="sourceCode" id="cb772"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.mse.html">h2o.mse</a></span><span class="op">(</span><span class="va">perf</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.241</span></code></pre></div>
<div class="sourceCode" id="cb773"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.auc.html">h2o.auc</a></span><span class="op">(</span><span class="va">perf</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.791</span></code></pre></div>
<div class="sourceCode" id="cb774"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.metric.html">h2o.metric</a></span><span class="op">(</span><span class="va">perf</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Metrics for Thresholds: Binomial metrics as a function of classification thresholds</span>
<span class="co">#&gt;   threshold       f1       f2 f0point5 accuracy precision   recall specificity</span>
<span class="co">#&gt; 1  0.992921 0.050000 0.031847 0.116279 0.424242  1.000000 0.025641    1.000000</span>
<span class="co">#&gt; 2  0.992818 0.097561 0.063291 0.212766 0.439394  1.000000 0.051282    1.000000</span>
<span class="co">#&gt; 3  0.992377 0.142857 0.094340 0.294118 0.454545  1.000000 0.076923    1.000000</span>
<span class="co">#&gt; 4  0.992375 0.186047 0.125000 0.363636 0.469697  1.000000 0.102564    1.000000</span>
<span class="co">#&gt; 5  0.992079 0.181818 0.124224 0.338983 0.454545  0.800000 0.102564    0.962963</span>
<span class="co">#&gt; 6  0.992010 0.222222 0.154321 0.396825 0.469697  0.833333 0.128205    0.962963</span>
<span class="co">#&gt;   absolute_mcc min_per_class_accuracy mean_per_class_accuracy tns fns fps tps</span>
<span class="co">#&gt; 1     0.103203               0.025641                0.512821  27  38   0   1</span>
<span class="co">#&gt; 2     0.147087               0.051282                0.525641  27  37   0   2</span>
<span class="co">#&gt; 3     0.181568               0.076923                0.538462  27  36   0   3</span>
<span class="co">#&gt; 4     0.211341               0.102564                0.551282  27  35   0   4</span>
<span class="co">#&gt; 5     0.121754               0.102564                0.532764  26  35   1   4</span>
<span class="co">#&gt; 6     0.155921               0.128205                0.545584  26  34   1   5</span>
<span class="co">#&gt;        tnr      fnr      fpr      tpr idx</span>
<span class="co">#&gt; 1 1.000000 0.974359 0.000000 0.025641   0</span>
<span class="co">#&gt; 2 1.000000 0.948718 0.000000 0.051282   1</span>
<span class="co">#&gt; 3 1.000000 0.923077 0.000000 0.076923   2</span>
<span class="co">#&gt; 4 1.000000 0.897436 0.000000 0.102564   3</span>
<span class="co">#&gt; 5 0.962963 0.897436 0.037037 0.102564   4</span>
<span class="co">#&gt; 6 0.962963 0.871795 0.037037 0.128205   5</span></code></pre></div>
<p>The confusion matrix alone can be seen with the <code><a href="https://rdrr.io/pkg/h2o/man/h2o.confusionMatrix.html">h2o.confusionMatrix()</a></code> function, but is is also part of the performance summary.</p>
<div class="sourceCode" id="cb775"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.confusionMatrix.html">h2o.confusionMatrix</a></span><span class="op">(</span><span class="va">dl_model</span>, <span class="va">test</span><span class="op">)</span>
<span class="co">#&gt; Confusion Matrix (vertical: actual; across: predicted)  for max f1 @ threshold = 0.0216308394253861:</span>
<span class="co">#&gt;            arrhythmia healthy    Error    Rate</span>
<span class="co">#&gt; arrhythmia         18       9 0.333333   =9/27</span>
<span class="co">#&gt; healthy             6      33 0.153846   =6/39</span>
<span class="co">#&gt; Totals             24      42 0.227273  =15/66</span></code></pre></div>
<p>The final predictions with probabilities can be extracted with the <code><a href="https://rdrr.io/pkg/h2o/man/h2o.predict.html">h2o.predict()</a></code> function. Beware though, that the number of correct and wrong classifications can be slightly different from the confusion matrix above.</p>
<p>Here, I combine the predictions with the actual test diagnoses and classes into a data frame. For plotting I also want to have a column, that tells me whether the predictions were correct. By default, a prediction probability above 0.5 will get scored as a prediction for the respective category. I find it often makes sense to be more stringent with this, though and set a higher threshold. Therefore, I am creating another column with stringent predictions, where I only count predictions that were made with more than 80% probability. Everything that does not fall within this range gets scored as “uncertain”. For these stringent predictions, I am also creating a column that tells me whether they were accurate.</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb776-1" data-line-number="1">finalRf_predictions &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">class =</span> <span class="kw">as.vector</span>(test<span class="op">$</span>class), </a>
<a class="sourceLine" id="cb776-2" data-line-number="2">                                  <span class="dt">actual =</span> <span class="kw">as.vector</span>(test<span class="op">$</span>diagnosis), </a>
<a class="sourceLine" id="cb776-3" data-line-number="3">                                  <span class="kw">as.data.frame</span>(<span class="kw">h2o.predict</span>(<span class="dt">object =</span> dl_model, </a>
<a class="sourceLine" id="cb776-4" data-line-number="4">                                                            <span class="dt">newdata =</span> test)))</a>
<a class="sourceLine" id="cb776-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb776-6" data-line-number="6">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb776-7" data-line-number="7"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb776-8" data-line-number="8">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb776-9" data-line-number="9"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a>
<a class="sourceLine" id="cb776-10" data-line-number="10"></a>
<a class="sourceLine" id="cb776-11" data-line-number="11">finalRf_predictions<span class="op">$</span>accurate &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</a>
<a class="sourceLine" id="cb776-12" data-line-number="12">  finalRf_predictions<span class="op">$</span>actual <span class="op">==</span><span class="st"> </span>finalRf_predictions<span class="op">$</span>predict, <span class="st">"yes"</span>, <span class="st">"no"</span>)</a>
<a class="sourceLine" id="cb776-13" data-line-number="13"></a>
<a class="sourceLine" id="cb776-14" data-line-number="14">finalRf_predictions<span class="op">$</span>predict_stringent &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</a>
<a class="sourceLine" id="cb776-15" data-line-number="15">  finalRf_predictions<span class="op">$</span>arrhythmia <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.8</span>, <span class="st">"arrhythmia"</span>,           </a>
<a class="sourceLine" id="cb776-16" data-line-number="16">  <span class="kw">ifelse</span>(finalRf_predictions<span class="op">$</span>healthy <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.8</span>, <span class="st">"healthy"</span>, <span class="st">"uncertain"</span>))</a>
<a class="sourceLine" id="cb776-17" data-line-number="17"></a>
<a class="sourceLine" id="cb776-18" data-line-number="18">finalRf_predictions<span class="op">$</span>accurate_stringent &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</a>
<a class="sourceLine" id="cb776-19" data-line-number="19">  finalRf_predictions<span class="op">$</span>actual <span class="op">==</span><span class="st"> </span>finalRf_predictions<span class="op">$</span>predict_stringent, <span class="st">"yes"</span>, </a>
<a class="sourceLine" id="cb776-20" data-line-number="20">  <span class="kw">ifelse</span>(finalRf_predictions<span class="op">$</span>predict_stringent <span class="op">==</span><span class="st"> "uncertain"</span>, <span class="st">"na"</span>, <span class="st">"no"</span>))</a></code></pre></div>
<div class="sourceCode" id="cb777"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">finalRf_predictions</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">actual</span>, <span class="va">predict</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt; # Groups:   actual [2]</span>
<span class="co">#&gt;   actual     predict        n</span>
<span class="co">#&gt;   &lt;fct&gt;      &lt;fct&gt;      &lt;int&gt;</span>
<span class="co">#&gt; 1 arrhythmia arrhythmia    11</span>
<span class="co">#&gt; 2 arrhythmia healthy       16</span>
<span class="co">#&gt; 3 healthy    arrhythmia     3</span>
<span class="co">#&gt; 4 healthy    healthy       36</span></code></pre></div>
<div class="sourceCode" id="cb778"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">finalRf_predictions</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">actual</span>, <span class="va">predict_stringent</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt; # Groups:   actual [2]</span>
<span class="co">#&gt;   actual     predict_stringent     n</span>
<span class="co">#&gt;   &lt;fct&gt;      &lt;chr&gt;             &lt;int&gt;</span>
<span class="co">#&gt; 1 arrhythmia arrhythmia           19</span>
<span class="co">#&gt; 2 arrhythmia healthy               6</span>
<span class="co">#&gt; 3 arrhythmia uncertain             2</span>
<span class="co">#&gt; 4 healthy    arrhythmia           10</span>
<span class="co">#&gt; 5 healthy    healthy              28</span>
<span class="co">#&gt; 6 healthy    uncertain             1</span></code></pre></div>
<p>To get a better overview, I am going to plot the predictions (default and stringent):</p>
<div class="sourceCode" id="cb779"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">finalRf_predictions</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">actual</span>, fill <span class="op">=</span> <span class="va">accurate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Were\npredictions\naccurate?"</span>,
         title <span class="op">=</span> <span class="st">"Default predictions"</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">finalRf_predictions</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">accurate_stringent</span> <span class="op">!=</span> <span class="st">"na"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">actual</span>, fill <span class="op">=</span> <span class="va">accurate_stringent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Were\npredictions\naccurate?"</span>,
         title <span class="op">=</span> <span class="st">"Stringent predictions"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/unnamed-chunk-38-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Being more stringent with the prediction threshold slightly reduced the number of errors but not by much.</p>
<p>I also want to know whether there are certain classes of arrhythmia that are especially prone to being misclassified:</p>
<div class="sourceCode" id="cb780"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">finalRf_predictions</span>, <span class="va">actual</span> <span class="op">==</span> <span class="st">"arrhythmia"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predict</span>, fill <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Prediction accuracy of arrhythmia cases"</span>,
         subtitle <span class="op">=</span> <span class="st">"Default predictions"</span>,
         x <span class="op">=</span> <span class="st">"predicted to be"</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">finalRf_predictions</span>, <span class="va">actual</span> <span class="op">==</span> <span class="st">"arrhythmia"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predict_stringent</span>, fill <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Prediction accuracy of arrhythmia cases"</span>,
         subtitle <span class="op">=</span> <span class="st">"Stringent predictions"</span>,
         x <span class="op">=</span> <span class="st">"predicted to be"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-nn-classification_239b-arrhythmia-sglander_files/figure-html/unnamed-chunk-39-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>There are no obvious biases towards some classes but with the small number of samples for most classes, this is difficult to assess.</p>
</div>
<div id="final-conclusions-how-useful-is-the-model" class="section level2">
<h2>
<span class="header-section-number">30.8</span> Final conclusions: How useful is the model?<a class="anchor" aria-label="anchor" href="#final-conclusions-how-useful-is-the-model"><i class="fas fa-link"></i></a>
</h2>
<p>Most samples were classified correctly, but the total error was not particularly good. Moreover, when evaluating the usefulness of a specific model, we need to keep in mind what we want to achieve with it and which questions we want to answer. If we wanted to deploy this model in a clinical setting, it should assist with diagnosing patients. So, we need to think about what the consequences of wrong classifications would be. Would it be better to optimize for high sensitivity, in this example as many arrhythmia cases as possible get detected - with the drawback that we probably also diagnose a few healthy people? Or do we want to maximize precision, meaning that we could be confident that a patient who got predicted to have arrhythmia does indeed have it, while accepting that a few arrhythmia cases would remain undiagnosed? When we consider stringent predictions, this model correctly classified 19 out of 27 arrhythmia cases, but 6 were misdiagnosed. This would mean that some patients who were actually sick, wouldn’t have gotten the correct treatment (if decided solely based on this model). For real-life application, this is obviously not sufficient!</p>
<p>Next week, I’ll be trying to improve the model by doing a grid search for hyper-parameter tuning.</p>
<p>So, stay tuned… (sorry, couldn’t resist ;-))</p>
<div class="sourceCode" id="cb781"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 3.6.3 (2020-02-29)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Debian GNU/Linux 10 (buster)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/libopenblasp-r0.3.5.so</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span>
<span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span>
<span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             </span>
<span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span>
<span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt;  [1] stats4    parallel  grid      stats     graphics  grDevices utils    </span>
<span class="co">#&gt;  [8] datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt;  [1] reshape2_1.4.4       tidyr_1.0.2          matrixStats_0.56.0  </span>
<span class="co">#&gt;  [4] pcaGoPromoter_1.30.0 Biostrings_2.54.0    XVector_0.26.0      </span>
<span class="co">#&gt;  [7] IRanges_2.20.2       S4Vectors_0.24.4     BiocGenerics_0.32.0 </span>
<span class="co">#&gt; [10] ellipse_0.4.1        gridExtra_2.3        ggrepel_0.8.2       </span>
<span class="co">#&gt; [13] ggplot2_3.3.0        h2o_3.30.0.1         dplyr_0.8.5         </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] Rcpp_1.0.4.6         utf8_1.1.4           assertthat_0.2.1    </span>
<span class="co">#&gt;  [4] digest_0.6.25        plyr_1.8.6           R6_2.4.1            </span>
<span class="co">#&gt;  [7] RSQLite_2.2.0        evaluate_0.14        pillar_1.4.3        </span>
<span class="co">#&gt; [10] zlibbioc_1.32.0      rlang_0.4.5          data.table_1.12.8   </span>
<span class="co">#&gt; [13] jquerylib_0.1.2      blob_1.2.1           rmarkdown_2.5.3     </span>
<span class="co">#&gt; [16] labeling_0.3         stringr_1.4.0        RCurl_1.98-1.2      </span>
<span class="co">#&gt; [19] bit_1.1-15.2         munsell_0.5.0        compiler_3.6.3      </span>
<span class="co">#&gt; [22] xfun_0.19.4          pkgconfig_2.0.3      htmltools_0.5.0.9003</span>
<span class="co">#&gt; [25] downlit_0.2.1.9000   tidyselect_1.0.0     tibble_3.0.1        </span>
<span class="co">#&gt; [28] bookdown_0.21.4      fansi_0.4.1          crayon_1.3.4        </span>
<span class="co">#&gt; [31] withr_2.2.0          bitops_1.0-6         rappdirs_0.3.1      </span>
<span class="co">#&gt; [34] jsonlite_1.6.1       gtable_0.3.0         lifecycle_0.2.0     </span>
<span class="co">#&gt; [37] DBI_1.1.0            magrittr_1.5         scales_1.1.0        </span>
<span class="co">#&gt; [40] cli_2.0.2            stringi_1.4.6        farver_2.0.3        </span>
<span class="co">#&gt; [43] fs_1.4.1             xml2_1.3.2           bslib_0.2.2.9000    </span>
<span class="co">#&gt; [46] ellipsis_0.3.0       vctrs_0.2.4          RColorBrewer_1.1-2  </span>
<span class="co">#&gt; [49] tools_3.6.3          bit64_0.9-7          Biobase_2.46.0      </span>
<span class="co">#&gt; [52] glue_1.4.0           purrr_0.3.4          yaml_2.2.1          </span>
<span class="co">#&gt; [55] AnnotationDbi_1.48.0 colorspace_1.4-1     memoise_1.1.0       </span>
<span class="co">#&gt; [58] knitr_1.28           sass_0.2.0.9005</span></code></pre></div>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></div>
<div class="next"><a href="linear-regression-with-islr.html"><span class="header-section-number">31</span> Linear Regression with ISLR</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#prediction-of-arrhythmia-with-deep-neural-nets"><span class="header-section-number">30</span> Prediction of arrhythmia with deep neural nets</a></li>
<li>
<a class="nav-link" href="#introduction-14"><span class="header-section-number">30.1</span> Introduction</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#deep-learning-with-neural-networks"><span class="header-section-number">30.1.1</span> Deep learning with neural networks</a></li>
<li><a class="nav-link" href="#h2o"><span class="header-section-number">30.1.2</span> H2O</a></li>
<li><a class="nav-link" href="#preparing-the-r-session"><span class="header-section-number">30.1.3</span> Preparing the R session</a></li>
</ul>
</li>
<li><a class="nav-link" href="#arrhythmia-data"><span class="header-section-number">30.2</span> Arrhythmia data</a></li>
<li><a class="nav-link" href="#converting-the-dataframe-to-a-h2o-object"><span class="header-section-number">30.3</span> Converting the dataframe to a h2o object</a></li>
<li><a class="nav-link" href="#training-test-and-validation-data"><span class="header-section-number">30.4</span> Training, test and validation data</a></li>
<li><a class="nav-link" href="#modeling"><span class="header-section-number">30.5</span> Modeling</a></li>
<li><a class="nav-link" href="#model-performance"><span class="header-section-number">30.6</span> Model performance</a></li>
<li><a class="nav-link" href="#test-data"><span class="header-section-number">30.7</span> Test data</a></li>
<li><a class="nav-link" href="#final-conclusions-how-useful-is-the-model"><span class="header-section-number">30.8</span> Final conclusions: How useful is the model?</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/f0nzie/machine_learning_compilation/blob/master/305-nn-classification_239b-arrhythmia-sglander.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/f0nzie/machine_learning_compilation/edit/master/305-nn-classification_239b-arrhythmia-sglander.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Machine Learning Compilation</strong>" was written by Several authors. Compiled by Alfonso R. Reyes. It was last built on 2020-11-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
