<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 35 Finding the factors of happiness | A Machine Learning Compilation</title>
<meta name="author" content="Several authors. Compiled by Alfonso R. Reyes">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Machine Learning Compilation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preface</a></li>
<li class="book-part">The Basics of Machine Learning</li>
<li><a class="" href="introduction-to-pca.html"><span class="header-section-number">2</span> Introduction to PCA</a></li>
<li><a class="" href="comparison-of-two-pca-packages.html"><span class="header-section-number">3</span> Comparison of two PCA packages</a></li>
<li><a class="" href="detailed-study-of-principal-component-analysis.html"><span class="header-section-number">4</span> Detailed study of Principal Component Analysis</a></li>
<li><a class="" href="detection-of-diabetes-using-logistic-regression.html"><span class="header-section-number">5</span> Detection of diabetes using Logistic Regression</a></li>
<li><a class="" href="sensitivity-analysis-for-a-neural-network.html"><span class="header-section-number">6</span> Sensitivity analysis for a neural network</a></li>
<li><a class="" href="data-visualization-for-ml-models.html"><span class="header-section-number">7</span> Data Visualization for ML models</a></li>
<li class="book-part">Feature Engineering</li>
<li><a class="" href="ten-methods-to-assess-variable-importance.html"><span class="header-section-number">8</span> Ten methods to assess Variable Importance</a></li>
<li><a class="" href="employee-attrition-using-feature-importance.html"><span class="header-section-number">9</span> Employee Attrition using Feature Importance</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="a-gentle-introduction-to-support-vector-machines.html"><span class="header-section-number">10</span> A gentle introduction to Support Vector Machines</a></li>
<li><a class="" href="broad-view-of-svm.html"><span class="header-section-number">11</span> Broad view of SVM</a></li>
<li><a class="" href="feature-selection-to-enhance-cancer-detection.html"><span class="header-section-number">12</span> Feature Selection to enhance cancer detection</a></li>
<li><a class="" href="dealing-with-unbalanced-data.html"><span class="header-section-number">13</span> Dealing with unbalanced data</a></li>
<li><a class="" href="imputting-missing-values-with-random-forest.html"><span class="header-section-number">14</span> Imputting missing values with Random Forest</a></li>
<li><a class="" href="tuning-of-support-vector-machine-prediction.html"><span class="header-section-number">15</span> Tuning of Support Vector Machine prediction</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="introduction-to-algorithms-for-classification.html"><span class="header-section-number">16</span> Introduction to algorithms for Classification</a></li>
<li><a class="" href="comparing-classification-algorithms.html"><span class="header-section-number">17</span> Comparing Classification algorithms</a></li>
<li><a class="" href="who-buys-social-network-ads.html"><span class="header-section-number">18</span> Who buys Social Network ads</a></li>
<li><a class="" href="predicting-ozone-levels.html"><span class="header-section-number">19</span> Predicting Ozone levels</a></li>
<li><a class="" href="building-a-naive-bayes-classifier.html"><span class="header-section-number">20</span> Building a Naive Bayes Classifier</a></li>
<li><a class="" href="linear-and-non-linear-algorithms-for-classification.html"><span class="header-section-number">21</span> Linear and Non-Linear Algorithms for Classification</a></li>
<li><a class="" href="detect-mines-vs-rocks-with-random-forest.html"><span class="header-section-number">22</span> Detect mines vs rocks with Random Forest</a></li>
<li><a class="" href="predicting-the-type-of-glass.html"><span class="header-section-number">23</span> Predicting the type of glass</a></li>
<li><a class="" href="naive-bayes-for-sms-spam.html"><span class="header-section-number">24</span> Naive Bayes for SMS spam</a></li>
<li><a class="" href="vehicles-classiification-with-decision-trees.html"><span class="header-section-number">25</span> Vehicles classiification with Decision Trees</a></li>
<li><a class="" href="applying-naive-bayes-on-the-titanic-case.html"><span class="header-section-number">26</span> Applying Naive-Bayes on the Titanic case</a></li>
<li><a class="" href="classification-on-bad-loans.html"><span class="header-section-number">27</span> Classification on bad loans</a></li>
<li><a class="" href="predicting-flu-outcome-comparing-eight-classification-algorithms.html"><span class="header-section-number">28</span> Predicting Flu outcome comparing eight classification algorithms</a></li>
<li><a class="" href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></li>
<li><a class="" href="prediction-of-arrhythmia-with-deep-neural-nets.html"><span class="header-section-number">30</span> Prediction of arrhythmia with deep neural nets</a></li>
<li class="book-part">Linear Regression</li>
<li><a class="" href="linear-regression-with-islr.html"><span class="header-section-number">31</span> Linear Regression with ISLR</a></li>
<li><a class="" href="evaluation-of-three-linear-regression-models.html"><span class="header-section-number">32</span> Evaluation of three linear regression models</a></li>
<li><a class="" href="comparison-of-six-linear-regression-algorithms.html"><span class="header-section-number">33</span> Comparison of six Linear Regression algorithms</a></li>
<li><a class="" href="comparing-regression-models.html"><span class="header-section-number">34</span> Comparing regression models</a></li>
<li><a class="active" href="finding-the-factors-of-happiness.html"><span class="header-section-number">35</span> Finding the factors of happiness</a></li>
<li><a class="" href="regression-with-a-neural-network.html"><span class="header-section-number">36</span> Regression with a neural network</a></li>
<li><a class="" href="comparing-multiple-regression-vs-a-neural-network.html"><span class="header-section-number">37</span> Comparing Multiple Regression vs a Neural Network</a></li>
<li><a class="" href="temperature-modeling-using-nested-dataframes.html"><span class="header-section-number">38</span> Temperature modeling using nested dataframes</a></li>
<li class="book-part">Neural Networks</li>
<li><a class="" href="credit-scoring-with-neuralnet.html"><span class="header-section-number">39</span> Credit Scoring with neuralnet</a></li>
<li><a class="" href="wine-classification-with-neuralnet.html"><span class="header-section-number">40</span> Wine classification with neuralnet</a></li>
<li><a class="" href="predicting-the-rating-of-cereals.html"><span class="header-section-number">41</span> Predicting the rating of cereals</a></li>
<li><a class="" href="fitting-a-linear-model-with-neural-networks.html"><span class="header-section-number">42</span> Fitting a linear model with neural networks</a></li>
<li><a class="" href="visualization-of-neural-networks.html"><span class="header-section-number">43</span> Visualization of neural networks</a></li>
<li><a class="" href="build-a-fully-connected-r-neural-network-from-scratch.html"><span class="header-section-number">44</span> Build a fully connected R neural network from scratch</a></li>
<li><a class="" href="tuning-hyperparameters-in-a-neural-network.html"><span class="header-section-number">45</span> Tuning Hyperparameters in a Neural Network</a></li>
<li><a class="" href="deep-learning-tips-for-classification-and-regression.html"><span class="header-section-number">46</span> Deep Learning tips for Classification and Regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="what-is-dot-hat-in-a-regression-output.html"><span class="header-section-number">A</span> What is dot hat in a regression output</a></li>
<li><a class="" href="q-q-normal-to-compare-data-to-distributions.html"><span class="header-section-number">B</span> Q-Q normal to compare data to distributions</a></li>
<li><a class="" href="qq-and-pp-plots.html"><span class="header-section-number">C</span> QQ and PP Plots</a></li>
<li><a class="" href="visualizing-residuals.html"><span class="header-section-number">D</span> Visualizing residuals</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/f0nzie/machine_learning_compilation">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="finding-the-factors-of-happiness" class="section level1">
<h1>
<span class="header-section-number">35</span> Finding the factors of happiness<a class="anchor" aria-label="anchor" href="#finding-the-factors-of-happiness"><i class="fas fa-link"></i></a>
</h1>
<p>Dataset: World Happiness, <code>happiness</code></p>
<div id="introduction-18" class="section level2">
<h2>
<span class="header-section-number">35.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-18"><i class="fas fa-link"></i></a>
</h2>
<p>Source: <a href="http://enhancedatascience.com/2017/04/25/r-basics-linear-regression-with-r/" class="uri">http://enhancedatascience.com/2017/04/25/r-basics-linear-regression-with-r/</a>
Data: <a href="https://www.kaggle.com/unsdsn/world-happiness" class="uri">https://www.kaggle.com/unsdsn/world-happiness</a></p>
<p>Linear regression is one of the basics of statistics and machine learning. Hence, it is a must-have to know how to perform a linear regression with R and how to interpret the results.</p>
<p>Linear regression algorithm will fit the best straight line that fits the data? To do so, it will minimise the squared distance between the points of the dataset and the fitted line.</p>
<p>For this tutorial, we will use the World Happiness report dataset from Kaggle. This report analyses the Happiness of each country according to several factors such as wealth, health, family life, … Our goal will be to find the most important factors of happiness. What a noble goal!</p>
</div>
<div id="a-quick-exploration-of-the-data" class="section level2">
<h2>
<span class="header-section-number">35.2</span> A quick exploration of the data<a class="anchor" aria-label="anchor" href="#a-quick-exploration-of-the-data"><i class="fas fa-link"></i></a>
</h2>
<p>Before fitting any model, we need to know our data better. First, let’s import the data into R. Please download the dataset from Kaggle and put it in your working directory.</p>
<p>The code below imports the data as data.table and clean the column names (a lot of . were appearing in the original ones)</p>
<div class="sourceCode" id="cb891"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://r-datatable.com">data.table</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: data.table</span>
<span class="va">data_happiness_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data_raw_dir</span>, <span class="st">"happiness"</span><span class="op">)</span>

<span class="va">Happiness_Data</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data_happiness_dir</span>, <span class="st">'2016.csv'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">Happiness_Data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'.'</span>,<span class="st">''</span>,<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">Happiness_Data</span><span class="op">)</span>, fixed<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>Now, let’s plot a Scatter Plot Matrix to get a grasp of how our variables are related one to another. To do so, the GGally package is great.</p>
<div class="sourceCode" id="cb892"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://ggobi.github.io/ggally">GGally</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: GGally</span>
<span class="co">#&gt; Registered S3 method overwritten by 'GGally':</span>
<span class="co">#&gt;   method from   </span>
<span class="co">#&gt;   +.gg   ggplot2</span>
<span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span><span class="va">Happiness_Data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span>, with<span class="op">=</span><span class="cn">F</span><span class="op">]</span>, lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> continuous <span class="op">=</span> <span class="st">"smooth"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="403-regression_136-happiness_files/figure-html/pairplot-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>All the variables are positively correlated with the Happiness score. We can expect that most of the coefficients in the linear regression will be positive. However, the correlation between the variable is often more than 0.5, so we can expect that multicollinearity will appear in the regression.</p>
<p>In the data, we also have access to the Country where the score was computed. Even if it’s not useful for the regression, let’s plot the data on a map!</p>
<div class="sourceCode" id="cb893"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/AndySouth/rworldmap/">'rworldmap'</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: rworldmap</span>
<span class="co">#&gt; Loading required package: sp</span>
<span class="co">#&gt; ### Welcome to rworldmap ###</span>
<span class="co">#&gt; For a short introduction type :   vignette('rworldmap')</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'reshape2'</span>
<span class="co">#&gt; The following objects are masked from 'package:data.table':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     dcast, melt</span>

<span class="va">map.world</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span>map<span class="op">=</span><span class="st">"world"</span><span class="op">)</span>

<span class="va">dataPlot</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">Happiness_Data</span>, id.vars <span class="op">=</span><span class="st">'Country'</span>, 
                measure.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">Happiness_Data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>

<span class="co">#Correcting names that are different</span>
<span class="va">dataPlot</span><span class="op">[</span><span class="va">Country</span> <span class="op">==</span> <span class="st">'United States'</span>, <span class="va">Country</span><span class="op">:=</span><span class="st">'USA'</span><span class="op">]</span>
<span class="va">dataPlot</span><span class="op">[</span><span class="va">Country</span> <span class="op">==</span> <span class="st">'United Kingdoms'</span>, <span class="va">Country</span><span class="op">:=</span><span class="st">'UK'</span><span class="op">]</span>

<span class="co">##Rescaling each variable to have nice gradient</span>
<span class="va">dataPlot</span><span class="op">[</span>,<span class="va">value</span><span class="op">:=</span><span class="va">value</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, by<span class="op">=</span><span class="va">variable</span><span class="op">]</span>
<span class="va">dataMap</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">map.world</span>, <span class="va">dataPlot</span>, 
                           by.x<span class="op">=</span><span class="st">'region'</span>, 
                           by.y<span class="op">=</span><span class="st">'Country'</span>, 
                           all.x<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="va">dataMap</span> <span class="op">=</span> <span class="va">dataMap</span><span class="op">[</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html">order</a></span><span class="op">(</span><span class="va">order</span><span class="op">)</span><span class="op">]</span>
<span class="va">dataMap</span> <span class="op">=</span> <span class="va">dataMap</span><span class="op">[</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html">order</a></span><span class="op">(</span><span class="va">order</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">]</span>
<span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_map.html">geom_map</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dataMap</span>, map<span class="op">=</span><span class="va">dataMap</span>, 
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>map_id <span class="op">=</span> <span class="va">region</span>, x<span class="op">=</span><span class="va">long</span>, y<span class="op">=</span><span class="va">lat</span>, fill<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="co"># facet_wrap(~variable, scale='free')</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: x, y</span>
<span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"navy"</span>, high <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span>
<span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">gg</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The code above is a classic code for a map. A few important points:</p>
<p>We reordered the point before plotting to avoid some artefacts.
The merge is a right outer join, all the points of the map need to be kept. Otherwise, points will be missing which will mess up the map.
Each variable is rescaled so that a facet_wrap can be used. Here, the absolute level of a variable is not of primary interest. This is the relative level of a variable between countries that we want to visualise.</p>
<div class="sourceCode" id="cb894"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span></code></pre></div>
<div class="inline-figure"><img src="403-regression_136-happiness_files/figure-html/unnamed-chunk-1-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>The distinction between North and South is quite visible. In addition to this, countries that have suffered from the crisis are also really visible.</p>
</div>
<div id="linear-regression-with-r" class="section level2">
<h2>
<span class="header-section-number">35.3</span> Linear regression with R<a class="anchor" aria-label="anchor" href="#linear-regression-with-r"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have taken a look at our data, a first model can be fitted. The explanatory variables are the DGP per capita, the life expectancy, the level of freedom and the trust in the government.</p>
<div class="sourceCode" id="cb895"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">##First model</span>
<span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">HappinessScore</span> <span class="op">~</span> <span class="va">EconomyGDPperCapita</span> <span class="op">+</span> <span class="va">Family</span> <span class="op">+</span> 
                 <span class="va">HealthLifeExpectancy</span> <span class="op">+</span> <span class="va">Freedom</span> <span class="op">+</span> <span class="va">TrustGovernmentCorruption</span>, 
             data<span class="op">=</span><span class="va">Happiness_Data</span><span class="op">)</span></code></pre></div>
</div>
<div id="regression-summary" class="section level2">
<h2>
<span class="header-section-number">35.4</span> Regression summary<a class="anchor" aria-label="anchor" href="#regression-summary"><i class="fas fa-link"></i></a>
</h2>
<p>The summary function provides a very easy way to assess a linear regression in R.</p>
<div class="sourceCode" id="cb896"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">stargazer</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: stargazer</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Please cite as:</span>
<span class="co">#&gt;  Hlavac, Marek (2018). stargazer: Well-Formatted Regression and Summary Statistics Tables.</span>
<span class="co">#&gt;  R package version 5.2.2. https://CRAN.R-project.org/package=stargazer</span>

<span class="co">##Quick summary</span>
<span class="va">sum1</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span>
<span class="va">sum1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = HappinessScore ~ EconomyGDPperCapita + Family + </span>
<span class="co">#&gt;     HealthLifeExpectancy + Freedom + TrustGovernmentCorruption, </span>
<span class="co">#&gt;     data = Happiness_Data)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -1.4833 -0.2817 -0.0277  0.3280  1.4615 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                           Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)                  2.212      0.150   14.73  &lt; 2e-16 ***</span>
<span class="co">#&gt; EconomyGDPperCapita          0.697      0.209    3.33   0.0011 ** </span>
<span class="co">#&gt; Family                       1.234      0.229    5.39  2.6e-07 ***</span>
<span class="co">#&gt; HealthLifeExpectancy         1.462      0.343    4.26  3.5e-05 ***</span>
<span class="co">#&gt; Freedom                      1.559      0.373    4.18  5.0e-05 ***</span>
<span class="co">#&gt; TrustGovernmentCorruption    0.959      0.455    2.11   0.0365 *  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 0.535 on 151 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.787,  Adjusted R-squared:  0.78 </span>
<span class="co">#&gt; F-statistic:  112 on 5 and 151 DF,  p-value: &lt;2e-16</span>

<span class="fu"><a href="https://rdrr.io/pkg/stargazer/man/stargazer.html">stargazer</a></span><span class="op">(</span><span class="va">model1</span>,type<span class="op">=</span><span class="st">'text'</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; =====================================================</span>
<span class="co">#&gt;                               Dependent variable:    </span>
<span class="co">#&gt;                           ---------------------------</span>
<span class="co">#&gt;                                 HappinessScore       </span>
<span class="co">#&gt; -----------------------------------------------------</span>
<span class="co">#&gt; EconomyGDPperCapita                0.697***          </span>
<span class="co">#&gt;                                     (0.209)          </span>
<span class="co">#&gt;                                                      </span>
<span class="co">#&gt; Family                             1.230***          </span>
<span class="co">#&gt;                                     (0.229)          </span>
<span class="co">#&gt;                                                      </span>
<span class="co">#&gt; HealthLifeExpectancy               1.460***          </span>
<span class="co">#&gt;                                     (0.343)          </span>
<span class="co">#&gt;                                                      </span>
<span class="co">#&gt; Freedom                            1.560***          </span>
<span class="co">#&gt;                                     (0.373)          </span>
<span class="co">#&gt;                                                      </span>
<span class="co">#&gt; TrustGovernmentCorruption           0.959**          </span>
<span class="co">#&gt;                                     (0.455)          </span>
<span class="co">#&gt;                                                      </span>
<span class="co">#&gt; Constant                           2.210***          </span>
<span class="co">#&gt;                                     (0.150)          </span>
<span class="co">#&gt;                                                      </span>
<span class="co">#&gt; -----------------------------------------------------</span>
<span class="co">#&gt; Observations                          157            </span>
<span class="co">#&gt; R2                                   0.787           </span>
<span class="co">#&gt; Adjusted R2                          0.780           </span>
<span class="co">#&gt; Residual Std. Error            0.535 (df = 151)      </span>
<span class="co">#&gt; F Statistic                112.000*** (df = 5; 151)  </span>
<span class="co">#&gt; =====================================================</span>
<span class="co">#&gt; Note:                     *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</span></code></pre></div>
<p>A quick interpretation:</p>
<ul>
<li>All the coefficient are significative at a .05 threshold</li>
<li>The overall model is also significative</li>
<li>It explains 78.7% of Happiness in the dataset</li>
<li>As expected all the relationship between the explanatory variables and the output variable are positives.</li>
</ul>
<p>The model is doing well!</p>
<p>You can also easily get a given indicator of the model performance, such as R², the different coefficients or the p-value of the overall model.</p>
<div class="sourceCode" id="cb897"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">##R²</span>
<span class="va">sum1</span><span class="op">$</span><span class="va">r.squared</span><span class="op">*</span><span class="fl">100</span>
<span class="co">#&gt; [1] 78.7</span>
<span class="co">##Coefficients</span>
<span class="va">sum1</span><span class="op">$</span><span class="va">coefficients</span>
<span class="co">#&gt;                           Estimate Std. Error t value Pr(&gt;|t|)</span>
<span class="co">#&gt; (Intercept)                  2.212      0.150   14.73 5.20e-31</span>
<span class="co">#&gt; EconomyGDPperCapita          0.697      0.209    3.33 1.10e-03</span>
<span class="co">#&gt; Family                       1.234      0.229    5.39 2.62e-07</span>
<span class="co">#&gt; HealthLifeExpectancy         1.462      0.343    4.26 3.53e-05</span>
<span class="co">#&gt; Freedom                      1.559      0.373    4.18 5.01e-05</span>
<span class="co">#&gt; TrustGovernmentCorruption    0.959      0.455    2.11 3.65e-02</span>
<span class="co">##p-value</span>
<span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">df</a></span><span class="op">(</span><span class="va">sum1</span><span class="op">$</span><span class="va">fstatistic</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">sum1</span><span class="op">$</span><span class="va">fstatistic</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="va">sum1</span><span class="op">$</span><span class="va">fstatistic</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;    value </span>
<span class="co">#&gt; 3.39e-49</span>
 
<span class="co">##Confidence interval of the coefficient</span>
<span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">model1</span>,level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span>
<span class="co">#&gt;                            2.5 % 97.5 %</span>
<span class="co">#&gt; (Intercept)               1.9152   2.51</span>
<span class="co">#&gt; EconomyGDPperCapita       0.2833   1.11</span>
<span class="co">#&gt; Family                    0.7821   1.69</span>
<span class="co">#&gt; HealthLifeExpectancy      0.7846   2.14</span>
<span class="co">#&gt; Freedom                   0.8212   2.30</span>
<span class="co">#&gt; TrustGovernmentCorruption 0.0609   1.86</span>
<span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">model1</span>,level <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span>
<span class="co">#&gt;                            0.5 % 99.5 %</span>
<span class="co">#&gt; (Intercept)                1.820   2.60</span>
<span class="co">#&gt; EconomyGDPperCapita        0.151   1.24</span>
<span class="co">#&gt; Family                     0.637   1.83</span>
<span class="co">#&gt; HealthLifeExpectancy       0.568   2.36</span>
<span class="co">#&gt; Freedom                    0.585   2.53</span>
<span class="co">#&gt; TrustGovernmentCorruption -0.227   2.14</span>
<span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">model1</span>,level <span class="op">=</span> <span class="fl">0.90</span><span class="op">)</span>
<span class="co">#&gt;                             5 % 95 %</span>
<span class="co">#&gt; (Intercept)               1.963 2.46</span>
<span class="co">#&gt; EconomyGDPperCapita       0.350 1.04</span>
<span class="co">#&gt; Family                    0.856 1.61</span>
<span class="co">#&gt; HealthLifeExpectancy      0.895 2.03</span>
<span class="co">#&gt; Freedom                   0.941 2.18</span>
<span class="co">#&gt; TrustGovernmentCorruption 0.207 1.71</span></code></pre></div>
</div>
<div id="regression-analysis" class="section level2">
<h2>
<span class="header-section-number">35.5</span> Regression analysis<a class="anchor" aria-label="anchor" href="#regression-analysis"><i class="fas fa-link"></i></a>
</h2>
<div id="residual-analysis" class="section level3">
<h3>
<span class="header-section-number">35.5.1</span> Residual analysis<a class="anchor" aria-label="anchor" href="#residual-analysis"><i class="fas fa-link"></i></a>
</h3>
<p>Now that the regression has been done, the analysis and validity of the result can be analysed. Let’s begin with residuals and the assumption of normality and homoscedasticity.</p>
<div class="sourceCode" id="cb898"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Visualisation of residuals</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">model1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins<span class="op">=</span><span class="fl">20</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">'blue'</span>, fill <span class="op">=</span> <span class="st">'blue'</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_function.html">stat_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="va">dnorm</span>, color<span class="op">=</span><span class="st">"red"</span>, size<span class="op">=</span><span class="fl">1</span>, 
                  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span>, 
                            sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.sd.html">sd</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">'residuals values'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="403-regression_136-happiness_files/figure-html/normal-curve-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>The residual versus fitted plot is used to see if the residuals behave the same for the different value of the output (i.e, they have the same variance and mean). The plot shows no strong evidence of heteroscedasticity.</p>
<div class="sourceCode" id="cb899"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">model1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">fitted.values</span>, <span class="va">model1</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.96</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.sd.html">sd</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span>, 
                              <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.sd.html">sd</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">'fitted value'</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">'residuals values'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="403-regression_136-happiness_files/figure-html/residuals-vs-fitted-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="analysis-of-colinearity" class="section level2">
<h2>
<span class="header-section-number">35.6</span> Analysis of colinearity<a class="anchor" aria-label="anchor" href="#analysis-of-colinearity"><i class="fas fa-link"></i></a>
</h2>
<p>The colinearity can be assessed using VIF, the car package provides a function to compute it directly.</p>
<div class="sourceCode" id="cb900"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://r-forge.r-project.org/projects/car/">'car'</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: car</span>
<span class="co">#&gt; Loading required package: carData</span>
<span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span>
<span class="co">#&gt;       EconomyGDPperCapita                    Family      HealthLifeExpectancy </span>
<span class="co">#&gt;                      4.07                      2.03                      3.37 </span>
<span class="co">#&gt;                   Freedom TrustGovernmentCorruption </span>
<span class="co">#&gt;                      1.61                      1.39</span></code></pre></div>
<p>All the VIF are less than 5, and hence there is no sign of colinearity.</p>
</div>
<div id="what-drives-happiness" class="section level2">
<h2>
<span class="header-section-number">35.7</span> What drives happiness<a class="anchor" aria-label="anchor" href="#what-drives-happiness"><i class="fas fa-link"></i></a>
</h2>
<p>Now let’s compute standardised betas to see what really drives happiness.</p>
<div class="sourceCode" id="cb901"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">##Standardized betas</span>
<span class="va">std_betas</span> <span class="op">=</span> <span class="va">sum1</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">*</span> 
    <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">sd</span><span class="op">)</span>, .SDcols<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">/</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.sd.html">sd</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">HappinessScore</span><span class="op">)</span>

<span class="va">std_betas</span>
<span class="co">#&gt;    EconomyGDPperCapita Family HealthLifeExpectancy Freedom</span>
<span class="co">#&gt; 1:               0.252  0.288                0.294   0.199</span>
<span class="co">#&gt;    TrustGovernmentCorruption</span>
<span class="co">#&gt; 1:                    0.0933</span></code></pre></div>
<p>Though the code above may seem complicated, it is just computing the standardised betas for all variables <code>std_beta=beta*sd(x)/sd(y)</code>.</p>
<p>The top three coefficients are <strong>Health and Life expectancy</strong>, <strong>Family</strong> and <strong>GDP per Capita</strong>. Though money does not make happiness it is among the top three factors of Happiness!</p>
<p>Now you know how to perform a linear regression with R!</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="comparing-regression-models.html"><span class="header-section-number">34</span> Comparing regression models</a></div>
<div class="next"><a href="regression-with-a-neural-network.html"><span class="header-section-number">36</span> Regression with a neural network</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#finding-the-factors-of-happiness"><span class="header-section-number">35</span> Finding the factors of happiness</a></li>
<li><a class="nav-link" href="#introduction-18"><span class="header-section-number">35.1</span> Introduction</a></li>
<li><a class="nav-link" href="#a-quick-exploration-of-the-data"><span class="header-section-number">35.2</span> A quick exploration of the data</a></li>
<li><a class="nav-link" href="#linear-regression-with-r"><span class="header-section-number">35.3</span> Linear regression with R</a></li>
<li><a class="nav-link" href="#regression-summary"><span class="header-section-number">35.4</span> Regression summary</a></li>
<li>
<a class="nav-link" href="#regression-analysis"><span class="header-section-number">35.5</span> Regression analysis</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#residual-analysis"><span class="header-section-number">35.5.1</span> Residual analysis</a></li></ul>
</li>
<li><a class="nav-link" href="#analysis-of-colinearity"><span class="header-section-number">35.6</span> Analysis of colinearity</a></li>
<li><a class="nav-link" href="#what-drives-happiness"><span class="header-section-number">35.7</span> What drives happiness</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/f0nzie/machine_learning_compilation/blob/master/403-regression_136-happiness.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/f0nzie/machine_learning_compilation/edit/master/403-regression_136-happiness.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Machine Learning Compilation</strong>" was written by Several authors. Compiled by Alfonso R. Reyes. It was last built on 2020-11-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
