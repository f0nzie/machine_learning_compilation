<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 28 Predicting Flu outcome comparing eight classification algorithms | A Machine Learning Compilation</title>
<meta name="author" content="Several authors. Compiled by Alfonso R. Reyes">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Machine Learning Compilation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preface</a></li>
<li class="book-part">The Basics of Machine Learning</li>
<li><a class="" href="introduction-to-pca.html"><span class="header-section-number">2</span> Introduction to PCA</a></li>
<li><a class="" href="comparison-of-two-pca-packages.html"><span class="header-section-number">3</span> Comparison of two PCA packages</a></li>
<li><a class="" href="detailed-study-of-principal-component-analysis.html"><span class="header-section-number">4</span> Detailed study of Principal Component Analysis</a></li>
<li><a class="" href="detection-of-diabetes-using-logistic-regression.html"><span class="header-section-number">5</span> Detection of diabetes using Logistic Regression</a></li>
<li><a class="" href="sensitivity-analysis-for-a-neural-network.html"><span class="header-section-number">6</span> Sensitivity analysis for a neural network</a></li>
<li><a class="" href="data-visualization-for-ml-models.html"><span class="header-section-number">7</span> Data Visualization for ML models</a></li>
<li class="book-part">Feature Engineering</li>
<li><a class="" href="ten-methods-to-assess-variable-importance.html"><span class="header-section-number">8</span> Ten methods to assess Variable Importance</a></li>
<li><a class="" href="employee-attrition-using-feature-importance.html"><span class="header-section-number">9</span> Employee Attrition using Feature Importance</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="a-gentle-introduction-to-support-vector-machines.html"><span class="header-section-number">10</span> A gentle introduction to Support Vector Machines</a></li>
<li><a class="" href="broad-view-of-svm.html"><span class="header-section-number">11</span> Broad view of SVM</a></li>
<li><a class="" href="feature-selection-to-enhance-cancer-detection.html"><span class="header-section-number">12</span> Feature Selection to enhance cancer detection</a></li>
<li><a class="" href="dealing-with-unbalanced-data.html"><span class="header-section-number">13</span> Dealing with unbalanced data</a></li>
<li><a class="" href="imputting-missing-values-with-random-forest.html"><span class="header-section-number">14</span> Imputting missing values with Random Forest</a></li>
<li><a class="" href="tuning-of-support-vector-machine-prediction.html"><span class="header-section-number">15</span> Tuning of Support Vector Machine prediction</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="introduction-to-algorithms-for-classification.html"><span class="header-section-number">16</span> Introduction to algorithms for Classification</a></li>
<li><a class="" href="comparing-classification-algorithms.html"><span class="header-section-number">17</span> Comparing Classification algorithms</a></li>
<li><a class="" href="who-buys-social-network-ads.html"><span class="header-section-number">18</span> Who buys Social Network ads</a></li>
<li><a class="" href="predicting-ozone-levels.html"><span class="header-section-number">19</span> Predicting Ozone levels</a></li>
<li><a class="" href="building-a-naive-bayes-classifier.html"><span class="header-section-number">20</span> Building a Naive Bayes Classifier</a></li>
<li><a class="" href="linear-and-non-linear-algorithms-for-classification.html"><span class="header-section-number">21</span> Linear and Non-Linear Algorithms for Classification</a></li>
<li><a class="" href="detect-mines-vs-rocks-with-random-forest.html"><span class="header-section-number">22</span> Detect mines vs rocks with Random Forest</a></li>
<li><a class="" href="predicting-the-type-of-glass.html"><span class="header-section-number">23</span> Predicting the type of glass</a></li>
<li><a class="" href="naive-bayes-for-sms-spam.html"><span class="header-section-number">24</span> Naive Bayes for SMS spam</a></li>
<li><a class="" href="vehicles-classiification-with-decision-trees.html"><span class="header-section-number">25</span> Vehicles classiification with Decision Trees</a></li>
<li><a class="" href="applying-naive-bayes-on-the-titanic-case.html"><span class="header-section-number">26</span> Applying Naive-Bayes on the Titanic case</a></li>
<li><a class="" href="classification-on-bad-loans.html"><span class="header-section-number">27</span> Classification on bad loans</a></li>
<li><a class="active" href="predicting-flu-outcome-comparing-eight-classification-algorithms.html"><span class="header-section-number">28</span> Predicting Flu outcome comparing eight classification algorithms</a></li>
<li><a class="" href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></li>
<li><a class="" href="prediction-of-arrhythmia-with-deep-neural-nets.html"><span class="header-section-number">30</span> Prediction of arrhythmia with deep neural nets</a></li>
<li class="book-part">Linear Regression</li>
<li><a class="" href="linear-regression-with-islr.html"><span class="header-section-number">31</span> Linear Regression with ISLR</a></li>
<li><a class="" href="evaluation-of-three-linear-regression-models.html"><span class="header-section-number">32</span> Evaluation of three linear regression models</a></li>
<li><a class="" href="comparison-of-six-linear-regression-algorithms.html"><span class="header-section-number">33</span> Comparison of six Linear Regression algorithms</a></li>
<li><a class="" href="comparing-regression-models.html"><span class="header-section-number">34</span> Comparing regression models</a></li>
<li><a class="" href="finding-the-factors-of-happiness.html"><span class="header-section-number">35</span> Finding the factors of happiness</a></li>
<li><a class="" href="regression-with-a-neural-network.html"><span class="header-section-number">36</span> Regression with a neural network</a></li>
<li><a class="" href="comparing-multiple-regression-vs-a-neural-network.html"><span class="header-section-number">37</span> Comparing Multiple Regression vs a Neural Network</a></li>
<li><a class="" href="temperature-modeling-using-nested-dataframes.html"><span class="header-section-number">38</span> Temperature modeling using nested dataframes</a></li>
<li class="book-part">Neural Networks</li>
<li><a class="" href="credit-scoring-with-neuralnet.html"><span class="header-section-number">39</span> Credit Scoring with neuralnet</a></li>
<li><a class="" href="wine-classification-with-neuralnet.html"><span class="header-section-number">40</span> Wine classification with neuralnet</a></li>
<li><a class="" href="predicting-the-rating-of-cereals.html"><span class="header-section-number">41</span> Predicting the rating of cereals</a></li>
<li><a class="" href="fitting-a-linear-model-with-neural-networks.html"><span class="header-section-number">42</span> Fitting a linear model with neural networks</a></li>
<li><a class="" href="visualization-of-neural-networks.html"><span class="header-section-number">43</span> Visualization of neural networks</a></li>
<li><a class="" href="build-a-fully-connected-r-neural-network-from-scratch.html"><span class="header-section-number">44</span> Build a fully connected R neural network from scratch</a></li>
<li><a class="" href="tuning-hyperparameters-in-a-neural-network.html"><span class="header-section-number">45</span> Tuning Hyperparameters in a Neural Network</a></li>
<li><a class="" href="deep-learning-tips-for-classification-and-regression.html"><span class="header-section-number">46</span> Deep Learning tips for Classification and Regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="what-is-dot-hat-in-a-regression-output.html"><span class="header-section-number">A</span> What is dot hat in a regression output</a></li>
<li><a class="" href="q-q-normal-to-compare-data-to-distributions.html"><span class="header-section-number">B</span> Q-Q normal to compare data to distributions</a></li>
<li><a class="" href="qq-and-pp-plots.html"><span class="header-section-number">C</span> QQ and PP Plots</a></li>
<li><a class="" href="visualizing-residuals.html"><span class="header-section-number">D</span> Visualizing residuals</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/f0nzie/machine_learning_compilation">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="predicting-flu-outcome-comparing-eight-classification-algorithms" class="section level1">
<h1>
<span class="header-section-number">28</span> Predicting Flu outcome comparing eight classification algorithms<a class="anchor" aria-label="anchor" href="#predicting-flu-outcome-comparing-eight-classification-algorithms"><i class="fas fa-link"></i></a>
</h1>
<ul>
<li>Datasets: <code>fluH7N9_china_2013</code>
</li>
<li>Algorithms: <em>RF, GLMNET, KNN, PDA, LDA, NSC, C5, PLS</em>
</li>
</ul>
<div id="introduction-13" class="section level2">
<h2>
<span class="header-section-number">28.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-13"><i class="fas fa-link"></i></a>
</h2>
<p>Among the many nice R packages containing data collections is the <a href="https://mran.microsoft.com/web/packages/outbreaks/outbreaks.pdf">outbreaks</a> package. It contains datsets on epidemics and among them is data from the 2013 outbreak of <a href="http://www.who.int/influenza/human_animal_interface/faq_H7N9/en/">influenza A H7N9</a> in <a href="http://www.who.int/influenza/human_animal_interface/influenza_h7n9/ChinaH7N9JointMissionReport2013u.pdf?ua=1">China</a> as analysed by Kucharski et al. (2014):</p>
<blockquote>
<p>A. Kucharski, H. Mills, A. Pinsent, C. Fraser, M. Van Kerkhove, C. A. Donnelly, and S. Riley. 2014. Distinguishing between reservoir exposure and human-to-human transmission for emerging pathogens using case onset data. PLOS Currents Outbreaks. Mar 7, edition 1. doi: 10.1371/currents.outbreaks.e1473d9bfc99d080ca242139a06c455f.</p>
</blockquote>
<blockquote>
<p>A. Kucharski, H. Mills, A. Pinsent, C. Fraser, M. Van Kerkhove, C. A. Donnelly, and S. Riley. 2014. Data from: Distinguishing between reservoir exposure and human-to-human transmission for emerging pathogens using case onset data. Dryad Digital Repository. <a href="http://dx.doi.org/10.5061/dryad.2g43n" class="uri">http://dx.doi.org/10.5061/dryad.2g43n</a>.</p>
</blockquote>
<div id="algorithms-1" class="section level3">
<h3>
<span class="header-section-number">28.1.1</span> Algorithms<a class="anchor" aria-label="anchor" href="#algorithms-1"><i class="fas fa-link"></i></a>
</h3>
<p>We compare these classification algorithms:</p>
<ol style="list-style-type: decimal">
<li>Random Forest</li>
<li>GLM net</li>
<li>k-Nearest Neighbors</li>
<li>Penalized Discriminant Analysis</li>
<li>Stabilized Linear Discriminant Analysis</li>
<li>Nearest Shrunken Centroids</li>
<li>Single C5.0 Tree</li>
<li>Partial Least Squares</li>
</ol>
</div>
<div id="workflow-3" class="section level3">
<h3>
<span class="header-section-number">28.1.2</span> Workflow<a class="anchor" aria-label="anchor" href="#workflow-3"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Load dataset</li>
<li>Data wrangling</li>
</ol>
<ul>
<li>Many dates as one variable: <code>gather</code>
</li>
<li>Convert group to factor: <code>factor</code>
</li>
<li>Change dates descriptions: <code>dplyr::mapvalues</code>
</li>
<li>Set several provinces as Other: <code>mapvalues</code>
</li>
<li>Convert gender to factor</li>
<li>Convert province to factor</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Features visualization</li>
</ol>
<ul>
<li>Area density plot of Month vs Age by Province, by date group, by outcome, by gender</li>
<li>Number of flu cases by gender, by province</li>
<li>Age density plot of flu cases by outcome</li>
<li>Days passed from outset by province, by age, by gender, by outcome</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Feature engineering</li>
</ol>
<ul>
<li>Generate new features</li>
<li>Gender to numeric</li>
<li>Provinces to binary classifiers</li>
<li>Outcome to binary classifier</li>
<li>Impute missing data: <code>mice</code>
</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Split dataset in training, validation and test sets<br>
</li>
<li>Feature importance</li>
</ol>
<ul>
<li>with Decision Trees</li>
<li>with Random Forest</li>
<li>Wrangling dataset</li>
<li>Plot Importance vs Variable</li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li>Impact on Datasets<br>
</li>
</ol>
<ul>
<li>Density plot of training, validation and test datasets</li>
<li>Features vs outcome by age, days onset to hospital, day onset to outcome</li>
</ul>
<ol start="8" style="list-style-type: decimal">
<li>Train models on training validation dataset</li>
</ol>
<ul>
<li>
<p>Numeric and visual Comparison of models</p>
<ul>
<li>Accuracy</li>
<li>Kappa</li>
</ul>
</li>
<li>
<p>Compare predictions on training validation set</p>
<ul>
<li>Create dataset for results</li>
<li>New variable for outcome</li>
</ul>
</li>
</ul>
<ol start="11" style="list-style-type: decimal">
<li>Predicting on unknown outcomes on training data<br>
</li>
</ol>
<ul>
<li>
<p>Numeric and visual Comparison of models</p>
<ul>
<li>Accuracy</li>
<li>Kappa</li>
</ul>
</li>
<li>
<p>Compare predictions on training validation set</p>
<ul>
<li>Create dataset for results</li>
<li>New variable for outcome</li>
</ul>
</li>
<li><p>Calculate predicted outcome</p></li>
<li><p>Save to CSV file</p></li>
<li><p>Calculate recovery cases</p></li>
<li><p>Summarize outcome</p></li>
<li><p>Plot month vs log2-ratio of recovery vs death, by gender, by age, by date group</p></li>
</ul>
</div>
<div id="can-we-predict-flu-outcome-with-machine-learning-in-r" class="section level3">
<h3>
<span class="header-section-number">28.1.3</span> Can we predict flu outcome with Machine Learning in R?<a class="anchor" aria-label="anchor" href="#can-we-predict-flu-outcome-with-machine-learning-in-r"><i class="fas fa-link"></i></a>
</h3>
<p>I will be using their data as an example to show how to use Machine Learning algorithms for predicting disease outcome.</p>
<p>To do so, I selected and extracted features from the raw data, including age, days between onset and outcome, gender, whether the patients were hospitalized, etc. Missing values were imputed and different model algorithms were used to predict outcome (death or recovery). The prediction accuracy, sensitivity and specificity. The thus prepared dataset was divided into training and testing subsets. The test subset contained all cases with an unknown outcome. Before I applied the models to the test data, I further split the training data into validation subsets.</p>
<p>The tested modeling algorithms were similarly successful at predicting the outcomes of the validation data. To decide on final classifications, I compared predictions from all models and defined the outcome “Death” or “Recovery” as a function of all models, whereas classifications with a low prediction probability were flagged as “uncertain”. Accounting for this uncertainty led to a 100% correct classification of the validation test set.</p>
<p>The training cases with unknown outcome were then classified based on the same algorithms. From 57 unknown cases, 14 were classified as “Recovery”, 10 as “Death” and 33 as uncertain.</p>
<p>In a Part 2, I am looking at how extreme gradient boosting performs on this dataset.</p>
<hr>
<p><strong>Disclaimer:</strong> I am not an expert in Machine Learning. Everything I know, I taught myself during the last months. So, if you see any mistakes or have tips and tricks for improvement, please don’t hesitate to let me know! Thanks. :-)</p>
</div>
</div>
<div id="the-data-1" class="section level2">
<h2>
<span class="header-section-number">28.2</span> The data<a class="anchor" aria-label="anchor" href="#the-data-1"><i class="fas fa-link"></i></a>
</h2>
<p>The dataset contains case ID, date of onset, date of hospitalization, date of outcome, gender, age, province and of course the outcome: Death or Recovery. I can already see that there are a couple of missing values in the data, which I will deal with later.</p>
<div class="sourceCode" id="cb610"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>

<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/reconhub/outbreaks">"outbreaks"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"outbreaks"</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: outbreaks</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/reconhub/outbreaks">outbreaks</a></span><span class="op">)</span>

<span class="va">fluH7N9_china_2013_backup</span> <span class="op">&lt;-</span> <span class="va">fluH7N9_china_2013</span>

<span class="va">fluH7N9_china_2013</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013</span><span class="op">$</span><span class="va">age</span> <span class="op">==</span> <span class="st">"?"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">fluH7N9_china_2013</span><span class="op">$</span><span class="va">case_ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"case"</span>, 
                                    <span class="va">fluH7N9_china_2013</span><span class="op">$</span><span class="va">case_id</span>, 
                                    sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013</span><span class="op">)</span>
<span class="co">#&gt;   case_id date_of_onset date_of_hospitalisation date_of_outcome outcome gender age province case_ID</span>
<span class="co">#&gt; 1       1    2013-02-19                    &lt;NA&gt;      2013-03-04   Death      m  87 Shanghai  case_1</span>
<span class="co">#&gt; 2       2    2013-02-27              2013-03-03      2013-03-10   Death      m  27 Shanghai  case_2</span>
<span class="co">#&gt; 3       3    2013-03-09              2013-03-19      2013-04-09   Death      f  35    Anhui  case_3</span>
<span class="co">#&gt; 4       4    2013-03-19              2013-03-27            &lt;NA&gt;    &lt;NA&gt;      f  45  Jiangsu  case_4</span>
<span class="co">#&gt; 5       5    2013-03-19              2013-03-30      2013-05-15 Recover      f  48  Jiangsu  case_5</span>
<span class="co">#&gt; 6       6    2013-03-21              2013-03-28      2013-04-26   Death      f  32  Jiangsu  case_6</span></code></pre></div>
<p>Before I start preparing the data for Machine Learning, I want to get an idea of the distribution of the data points and their different variables by plotting.</p>
<p>Most provinces have only a handful of cases, so I am combining them into the category “other” and keep only Jiangsu, Shanghai and Zhejian and separate provinces.</p>
<div class="sourceCode" id="cb611"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make tidy data, clean up and simplify</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>

<span class="co"># put different type of dates in one variable (Date)</span>
<span class="va">fluH7N9_china_2013_gather</span> <span class="op">&lt;-</span> <span class="va">fluH7N9_china_2013</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">Group</span>, <span class="va">Date</span>, <span class="va">date_of_onset</span><span class="op">:</span><span class="va">date_of_outcome</span><span class="op">)</span>

<span class="co"># convert Group to factor</span>
<span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">Group</span>, 
                                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_of_onset"</span>, 
                                                     <span class="st">"date_of_hospitalisation"</span>, 
                                                     <span class="st">"date_of_outcome"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># change the dates description with plyr::mapvalues</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr">plyr</a></span><span class="op">)</span>
<span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_of_onset"</span>, <span class="st">"date_of_hospitalisation"</span>, <span class="st">"date_of_outcome"</span><span class="op">)</span>
<span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Date of onset"</span>, <span class="st">"Date of hospitalisation"</span>, <span class="st">"Date of outcome"</span><span class="op">)</span>
<span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">Group</span>, 
                                             from <span class="op">=</span> <span class="va">from</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">)</span>

<span class="co"># change additional provinces to Other</span>
<span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Anhui"</span>, <span class="st">"Beijing"</span>, <span class="st">"Fujian"</span>, <span class="st">"Guangdong"</span>, <span class="st">"Hebei"</span>, <span class="st">"Henan"</span>, 
          <span class="st">"Hunan"</span>, <span class="st">"Jiangxi"</span>, <span class="st">"Shandong"</span>, <span class="st">"Taiwan"</span><span class="op">)</span>
<span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">province</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">province</span>, 
            from <span class="op">=</span> <span class="va">from</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">)</span>

<span class="co"># convert gender to factor</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span>, <span class="st">"unknown"</span><span class="op">)</span>

<span class="co"># replace NA in gender by "unknown</span>
<span class="va">is_na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span>
<span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">[</span><span class="va">is_na</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"unknown"</span>

<span class="co"># convert province to factor</span>
<span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">province</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">province</span>, 
                                             levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Jiangsu"</span>,  <span class="st">"Shanghai"</span>, 
                                                        <span class="st">"Zhejiang"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb612"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="va">my_theme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">base_size</span> <span class="op">=</span> <span class="fl">12</span>, <span class="va">base_family</span> <span class="op">=</span> <span class="st">"sans"</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_size</span>, base_family <span class="op">=</span> <span class="va">base_family</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,
    panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,
    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"aliceblue"</span><span class="op">)</span>,
    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"lightgrey"</span>, color <span class="op">=</span> <span class="st">"grey"</span>, 
                                    size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">12</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
    legend.justification <span class="op">=</span> <span class="st">"top"</span>, 
    legend.box <span class="op">=</span> <span class="st">"horizontal"</span>,
    legend.box.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,
    legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, fill <span class="op">=</span> <span class="cn">NA</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb613"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fluH7N9_china_2013_gather</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density2d</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">..level..</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"polygon"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">outcome</span>, shape <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    fill <span class="op">=</span> <span class="st">"Outcome"</span>,
    color <span class="op">=</span> <span class="st">"Outcome"</span>,
    alpha <span class="op">=</span> <span class="st">"Level"</span>,
    shape <span class="op">=</span> <span class="st">"Gender"</span>,
    x <span class="op">=</span> <span class="st">"Date in 2013"</span>,
    y <span class="op">=</span> <span class="st">"Age"</span>,
    title <span class="op">=</span> <span class="st">"2013 Influenza A H7N9 cases in China"</span>,
    subtitle <span class="op">=</span> <span class="st">"Dataset from 'outbreaks' package (Kucharski et al. 2014)"</span>,
    caption <span class="op">=</span> <span class="st">""</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">Group</span> <span class="op">~</span> <span class="va">province</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 149 rows containing non-finite values (stat_density2d).</span>
<span class="co">#&gt; Warning: Removed 149 rows containing missing values (geom_point).</span></code></pre></div>
<div class="inline-figure"><img src="305-algo-comparison_330-class_flu_outcome-sglander_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>This plot shows the dates of onset, hospitalization and outcome (if known) of each data point. Outcome is marked by color and age shown on the y-axis. Gender is marked by point shape.</p>
<p>The density distribution of date by age for the cases seems to indicate that older people died more frequently in the Jiangsu and Zhejiang province than in Shanghai and in other provinces.</p>
<p>When we look at the distribution of points along the time axis, it suggests that their might be a positive correlation between the likelihood of death and an early onset or early outcome.</p>
<p>I also want to know how many cases there are for each gender and province and compare the genders’ age distribution.</p>
<div class="sourceCode" id="cb614"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># more tidy data. first remove age</span>
<span class="va">fluH7N9_china_2013_gather_2</span> <span class="op">&lt;-</span> <span class="va">fluH7N9_china_2013_gather</span><span class="op">[</span>, <span class="op">-</span><span class="fl">4</span><span class="op">]</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">group_2</span>, <span class="va">value</span>, <span class="va">gender</span><span class="op">:</span><span class="va">province</span><span class="op">)</span>
<span class="co">#&gt; Warning: attributes are not identical across measure variables;</span>
<span class="co">#&gt; they will be dropped</span>

<span class="co"># change descriptions</span>
<span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"f"</span>, <span class="st">"unknown"</span>, <span class="st">"Other"</span><span class="op">)</span>
<span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span>, <span class="st">"Unknown gender"</span>, <span class="st">"Other province"</span><span class="op">)</span>
<span class="va">fluH7N9_china_2013_gather_2</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather_2</span><span class="op">$</span><span class="va">value</span>, 
                                               from <span class="op">=</span> <span class="va">from</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">)</span>
<span class="co"># convert to factor</span>
<span class="va">fluH7N9_china_2013_gather_2</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather_2</span><span class="op">$</span><span class="va">value</span>, 
                                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>, <span class="st">"Male"</span>, 
                                                       <span class="st">"Unknown gender"</span>, 
                                                       <span class="st">"Jiangsu"</span>, <span class="st">"Shanghai"</span>, 
                                                       <span class="st">"Zhejiang"</span>, <span class="st">"Other 
                                                       province"</span><span class="op">)</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fluH7N9_china_2013_gather_2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, 
                                                     fill <span class="op">=</span> <span class="va">outcome</span>, 
                                                     color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    color <span class="op">=</span> <span class="st">""</span>,
    fill <span class="op">=</span> <span class="st">""</span>,
    x <span class="op">=</span> <span class="st">""</span>,
    y <span class="op">=</span> <span class="st">"Count"</span>,
    title <span class="op">=</span> <span class="st">"2013 Influenza A H7N9 cases in China"</span>,
    subtitle <span class="op">=</span> <span class="st">"Gender and Province numbers of flu cases"</span>,
    caption <span class="op">=</span> <span class="st">""</span>
  <span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fluH7N9_china_2013_gather</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, 
                                                   fill <span class="op">=</span> <span class="va">outcome</span>, 
                                                   color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    color <span class="op">=</span> <span class="st">""</span>,
    fill <span class="op">=</span> <span class="st">""</span>,
    x <span class="op">=</span> <span class="st">"Age"</span>,
    y <span class="op">=</span> <span class="st">"Density"</span>,
    title <span class="op">=</span> <span class="st">""</span>,
    subtitle <span class="op">=</span> <span class="st">"Age distribution of flu cases"</span>,
    caption <span class="op">=</span> <span class="st">""</span>
  <span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 6 rows containing non-finite values (stat_density).</span></code></pre></div>
<div class="inline-figure"><img src="305-algo-comparison_330-class_flu_outcome-sglander_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>In the dataset, there are more male than female cases and correspondingly, we see more deaths, recoveries and unknown outcomes in men than in women. This is potentially a problem later on for modeling because the inherent likelihoods for outcome are not directly comparable between the sexes.</p>
<p>Most unknown outcomes were recorded in Zhejiang. Similarly to gender, we don’t have an equal distribution of data points across provinces either.</p>
<p>When we look at the age distribution it is obvious that people who died tended to be slightly older than those who recovered. The density curve of unknown outcomes is more similar to that of death than of recovery, suggesting that among these people there might have been more deaths than recoveries.</p>
<p>And lastly, I want to plot how many days passed between onset, hospitalization and outcome for each case.</p>
<div class="sourceCode" id="cb615"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fluH7N9_china_2013_gather</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, 
                                             color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">outcome</span>, shape <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">case_ID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">province</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    color <span class="op">=</span> <span class="st">"Outcome"</span>,
    shape <span class="op">=</span> <span class="st">"Gender"</span>,
    x <span class="op">=</span> <span class="st">"Date in 2013"</span>,
    y <span class="op">=</span> <span class="st">"Age"</span>,
    title <span class="op">=</span> <span class="st">"2013 Influenza A H7N9 cases in China"</span>,
    subtitle <span class="op">=</span> <span class="st">"Dataset from 'outbreaks' package (Kucharski et al. 2014)"</span>,
    caption <span class="op">=</span> <span class="st">"\nTime from onset of flu to outcome."</span>
  <span class="op">)</span>
<span class="co">#&gt; Warning: Removed 149 rows containing missing values (geom_point).</span>
<span class="co">#&gt; Warning: Removed 122 row(s) containing missing values (geom_path).</span></code></pre></div>
<div class="inline-figure"><img src="305-algo-comparison_330-class_flu_outcome-sglander_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>This plot shows that there are many missing values in the dates, so it is hard to draw a general conclusion.</p>
<p><br></p>
</div>
<div id="features-1" class="section level2">
<h2>
<span class="header-section-number">28.3</span> Features<a class="anchor" aria-label="anchor" href="#features-1"><i class="fas fa-link"></i></a>
</h2>
<p>In Machine Learning-speak features are the variables used for model training. Using the right features dramatically influences the accuracy of the model. Because we don’t have many features, I am keeping age as it is, but I am also generating new features:</p>
<ul>
<li><p>from the date information I am calculating the days between onset and outcome and between onset and hospitalization</p></li>
<li><p>I am converting gender into numeric values with 1 for female and 0 for male</p></li>
<li><p>similarly, I am converting provinces to binary classifiers (yes == 1, no == 0) for Shanghai, Zhejiang, Jiangsu and other provinces</p></li>
<li><p>the same binary classification is given for whether a case was hospitalised, and whether they had an early onset or early outcome (earlier than the median date)</p></li>
</ul>
<div class="sourceCode" id="cb616"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># convert gender, provinces to discrete and numeric values</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following object is masked from 'package:gridExtra':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     combine</span>
<span class="co">#&gt; The following objects are masked from 'package:plyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     arrange, count, desc, failwith, id, mutate, rename, summarise, summarize</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>

<span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">fluH7N9_china_2013</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_of_hospitalisation</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
         gender_f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"f"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
         province_Jiangsu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">province</span> <span class="op">==</span> <span class="st">"Jiangsu"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
         province_Shanghai <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">province</span> <span class="op">==</span> <span class="st">"Shanghai"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
         province_Zhejiang <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">province</span> <span class="op">==</span> <span class="st">"Zhejiang"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
         province_other <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">province</span> <span class="op">==</span> <span class="st">"Zhejiang"</span> <span class="op">|</span> 
                                             <span class="va">province</span> <span class="op">==</span> <span class="st">"Jiangsu"</span> <span class="op">|</span> 
                                             <span class="va">province</span> <span class="op">==</span> <span class="st">"Shanghai"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
         days_onset_to_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" days"</span>, <span class="st">""</span>,
                <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">date_of_outcome</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span> <span class="op">-</span> 
                <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">date_of_onset</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         
         days_onset_to_hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" days"</span>, <span class="st">""</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">date_of_hospitalisation</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span> <span class="op">-</span> 
            <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">date_of_onset</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span>,
         early_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">date_of_onset</span> <span class="op">&lt;</span> 
                        <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">date_of_onset</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
         early_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">date_of_outcome</span> <span class="op">&lt;</span> 
                        <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">date_of_outcome</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># print</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dataset</span><span class="op">$</span><span class="va">case_ID</span>
<span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">dataset</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span>
<span class="co">#&gt;        outcome age hospital gender_f province_Jiangsu province_Shanghai province_Zhejiang province_other days_onset_to_outcome days_onset_to_hospital early_onset early_outcome</span>
<span class="co">#&gt; case_1   Death  87        0        0                0                 1                 0              0                    13                     NA           1             1</span>
<span class="co">#&gt; case_2   Death  27        1        0                0                 1                 0              0                    11                      4           1             1</span>
<span class="co">#&gt; case_3   Death  35        1        1                0                 0                 0              1                    31                     10           1             1</span>
<span class="co">#&gt; case_4    &lt;NA&gt;  45        1        1                1                 0                 0              0                    NA                      8           1          &lt;NA&gt;</span>
<span class="co">#&gt; case_5 Recover  48        1        1                1                 0                 0              0                    57                     11           1             0</span>
<span class="co">#&gt; case_6   Death  32        1        1                1                 0                 0              0                    36                      7           1             1</span></code></pre></div>
<div class="sourceCode" id="cb617"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt;   Death Recover    NA's </span>
<span class="co">#&gt;      32      47      57</span></code></pre></div>
<div id="imputing-missing-values-1" class="section level3">
<h3>
<span class="header-section-number">28.3.1</span> Imputing missing values<a class="anchor" aria-label="anchor" href="#imputing-missing-values-1"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://www.r-bloggers.com/imputing-missing-data-with-r-mice-package/" class="uri">https://www.r-bloggers.com/imputing-missing-data-with-r-mice-package/</a></p>
<p>When looking at the dataset I created for modeling, it is obvious that we have quite a few missing values.</p>
<p>The missing values from the outcome column are what I want to predict but for the rest I would either have to remove the entire row from the data or impute the missing information. I decided to try the latter with the <code>mice</code> package.</p>
<div class="sourceCode" id="cb618"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stefvanbuuren/mice">mice</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'mice'</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     cbind, rbind</span>

<span class="va">dataset_impute</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mice/man/mice.html">mice</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>,  print <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># remove outcome</span>
<span class="co">#&gt; Warning: Number of logged events: 150</span>
<span class="va">impute_complete</span> <span class="op">&lt;-</span> <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mice/man/complete.mids.html">complete</a></span><span class="op">(</span><span class="va">dataset_impute</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># return 1st imputed dataset</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">impute_complete</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span>
<span class="va">impute_complete</span>
<span class="co">#&gt;          age hospital gender_f province_Jiangsu province_Shanghai province_Zhejiang province_other days_onset_to_outcome days_onset_to_hospital early_onset early_outcome</span>
<span class="co">#&gt; case_1    87        0        0                0                 1                 0              0                    13                      6           1             1</span>
<span class="co">#&gt; case_2    27        1        0                0                 1                 0              0                    11                      4           1             1</span>
<span class="co">#&gt; case_3    35        1        1                0                 0                 0              1                    31                     10           1             1</span>
<span class="co">#&gt; case_4    45        1        1                1                 0                 0              0                    14                      8           1             1</span>
<span class="co">#&gt; case_5    48        1        1                1                 0                 0              0                    57                     11           1             0</span>
<span class="co">#&gt; case_6    32        1        1                1                 0                 0              0                    36                      7           1             1</span>
<span class="co">#&gt; case_7    83        1        0                1                 0                 0              0                    20                      9           1             1</span>
<span class="co">#&gt; case_8    38        1        0                0                 0                 1              0                    20                     11           1             1</span>
<span class="co">#&gt; case_9    67        1        0                0                 0                 1              0                     7                      0           1             1</span>
<span class="co">#&gt; case_10   48        1        0                0                 1                 0              0                     6                      4           1             1</span>
<span class="co">#&gt; case_11   64        1        0                0                 0                 1              0                     6                      2           1             1</span>
<span class="co">#&gt; case_12   52        0        1                0                 1                 0              0                     7                      7           1             1</span>
<span class="co">#&gt; case_13   67        1        1                0                 1                 0              0                    12                      3           1             1</span>
<span class="co">#&gt; case_14    4        0        0                0                 1                 0              0                    10                      5           1             1</span>
<span class="co">#&gt; case_15   61        0        1                1                 0                 0              0                    32                      4           1             0</span>
<span class="co">#&gt; case_16   79        0        0                1                 0                 0              0                    38                      4           1             0</span>
<span class="co">#&gt; case_17   74        1        0                0                 1                 0              0                    14                      6           1             1</span>
<span class="co">#&gt; case_18   66        1        0                0                 1                 0              0                    20                      4           1             1</span>
<span class="co">#&gt; case_19   59        1        0                0                 1                 0              0                    67                      5           1             0</span>
<span class="co">#&gt; case_20   55        1        0                0                 0                 0              1                    22                      4           1             1</span>
<span class="co">#&gt; case_21   67        1        0                0                 1                 0              0                    23                      1           1             1</span>
<span class="co">#&gt; case_22   85        1        0                1                 0                 0              0                    31                      4           1             0</span>
<span class="co">#&gt; case_23   25        1        1                1                 0                 0              0                    46                      0           1             0</span>
<span class="co">#&gt; case_24   64        0        0                0                 1                 0              0                     6                      5           1             1</span>
<span class="co">#&gt; case_25   62        1        0                0                 1                 0              0                    35                      0           1             0</span>
<span class="co">#&gt; case_26   77        1        0                0                 1                 0              0                    11                      4           1             1</span>
<span class="co">#&gt; case_27   51        1        1                0                 0                 1              0                    37                     27           1             1</span>
<span class="co">#&gt; case_28   79        0        0                0                 0                 1              0                    32                      0           1             0</span>
<span class="co">#&gt; case_29   76        1        1                0                 1                 0              0                    32                      4           1             0</span>
<span class="co">#&gt; case_30   81        0        1                0                 1                 0              0                    23                      0           1             0</span>
<span class="co">#&gt; case_31   70        0        0                1                 0                 0              0                    32                      4           1             0</span>
<span class="co">#&gt; case_32   74        0        0                1                 0                 0              0                    38                      4           1             0</span>
<span class="co">#&gt; case_33   65        0        0                0                 0                 1              0                    24                      8           1             0</span>
<span class="co">#&gt; case_34   74        1        0                0                 1                 0              0                    11                      5           1             1</span>
<span class="co">#&gt; case_35   83        1        1                0                 1                 0              0                    38                      5           1             0</span>
<span class="co">#&gt; case_36   68        0        0                0                 1                 0              0                    17                      4           1             1</span>
<span class="co">#&gt; case_37   31        0        0                1                 0                 0              0                    45                      7           1             0</span>
<span class="co">#&gt; case_38   56        0        0                1                 0                 0              0                    23                      7           1             0</span>
<span class="co">#&gt; case_39   66        1        0                0                 0                 1              0                    13                      0           0             1</span>
<span class="co">#&gt; case_40   74        1        0                0                 0                 1              0                     6                      5           1             1</span>
<span class="co">#&gt; case_41   54        1        1                0                 0                 1              0                    23                      6           1             1</span>
<span class="co">#&gt; case_42   53        1        0                0                 1                 0              0                    11                      7           1             1</span>
<span class="co">#&gt; case_43   86        1        0                0                 1                 0              0                    18                      3           1             1</span>
<span class="co">#&gt; case_44    7        1        1                0                 0                 0              1                     6                      0           0             1</span>
<span class="co">#&gt; case_45   56        1        0                0                 1                 0              0                    86                      3           1             0</span>
<span class="co">#&gt; case_46   77        0        1                1                 0                 0              0                     9                      0           1             1</span>
<span class="co">#&gt; case_47   72        0        0                1                 0                 0              0                    32                      5           1             0</span>
<span class="co">#&gt; case_48   65        1        0                0                 0                 1              0                    20                      6           1             1</span>
<span class="co">#&gt; case_49   38        1        0                0                 0                 1              0                    28                      5           1             0</span>
<span class="co">#&gt; case_50   34        1        0                0                 0                 0              1                    17                      3           1             0</span>
<span class="co">#&gt; case_51   65        1        0                0                 0                 0              1                    15                      2           0             1</span>
<span class="co">#&gt; case_52   64        0        1                0                 0                 1              0                    17                      7           1             1</span>
<span class="co">#&gt; case_53   62        0        1                0                 0                 1              0                    22                      7           1             1</span>
<span class="co">#&gt; case_54   75        0        0                0                 0                 1              0                    37                      7           1             0</span>
<span class="co">#&gt; case_55   79        0        0                0                 0                 1              0                    18                      7           0             0</span>
<span class="co">#&gt; case_56   73        1        0                0                 1                 0              0                    11                      6           1             1</span>
<span class="co">#&gt; case_57   54        1        0                0                 1                 0              0                    13                      4           0             1</span>
<span class="co">#&gt; case_58   78        1        0                0                 1                 0              0                    31                      4           1             0</span>
<span class="co">#&gt; case_59   50        0        0                1                 0                 0              0                    37                      7           1             0</span>
<span class="co">#&gt; case_60   26        0        0                1                 0                 0              0                    18                      4           0             1</span>
<span class="co">#&gt; case_61   60        0        0                1                 0                 0              0                    10                      4           1             1</span>
<span class="co">#&gt; case_62   68        0        1                0                 0                 1              0                    11                      5           1             1</span>
<span class="co">#&gt; case_63   60        0        0                0                 0                 0              1                    26                      3           0             0</span>
<span class="co">#&gt; case_64   56        0        0                1                 0                 0              0                    16                      4           0             0</span>
<span class="co">#&gt; case_65   21        0        1                1                 0                 0              0                    37                      4           1             0</span>
<span class="co">#&gt; case_66   72        0        0                1                 0                 0              0                    32                      3           0             0</span>
<span class="co">#&gt; case_67   56        0        0                0                 0                 1              0                    31                      3           0             0</span>
<span class="co">#&gt; case_68   57        0        0                0                 0                 1              0                     6                     10           0             1</span>
<span class="co">#&gt; case_69   62        0        0                0                 0                 1              0                     8                      7           0             1</span>
<span class="co">#&gt; case_70   58        0        1                0                 0                 1              0                    10                     11           0             1</span>
<span class="co">#&gt; case_71   72        0        1                0                 0                 1              0                    13                      6           0             0</span>
<span class="co">#&gt; case_72   47        1        0                0                 1                 0              0                    17                      5           0             0</span>
<span class="co">#&gt; case_73   69        0        0                0                 1                 0              0                     7                      4           0             1</span>
<span class="co">#&gt; case_74   54        0        0                0                 1                 0              0                    17                      6           1             0</span>
<span class="co">#&gt; case_75   83        0        0                0                 1                 0              0                     6                      4           1             1</span>
<span class="co">#&gt; case_76   55        0        0                0                 1                 0              0                     6                      7           1             1</span>
<span class="co">#&gt; case_77    2        0        0                0                 1                 0              0                    13                      7           1             0</span>
<span class="co">#&gt; case_78   89        1        0                0                 1                 0              0                    17                      4           0             0</span>
<span class="co">#&gt; case_79   37        0        1                0                 0                 1              0                    16                      0           0             0</span>
<span class="co">#&gt; case_80   74        0        0                0                 0                 1              0                    22                      3           0             0</span>
<span class="co">#&gt; case_81   86        0        0                0                 0                 1              0                    10                      6           0             1</span>
<span class="co">#&gt; case_82   41        0        0                0                 0                 1              0                     8                     10           0             1</span>
<span class="co">#&gt; case_83   38        0        0                0                 0                 0              1                    23                      4           0             0</span>
<span class="co">#&gt; case_84   26        0        1                1                 0                 0              0                    13                      1           1             1</span>
<span class="co">#&gt; case_85   80        1        1                0                 1                 0              0                    13                      7           0             1</span>
<span class="co">#&gt; case_86   54        0        1                0                 0                 1              0                    10                      3           0             1</span>
<span class="co">#&gt; case_87   69        0        0                0                 0                 1              0                     8                      3           0             1</span>
<span class="co">#&gt; case_88    4        0        0                0                 0                 0              1                    11                      0           0             0</span>
<span class="co">#&gt; case_89   54        1        0                1                 0                 0              0                    36                      6           0             0</span>
<span class="co">#&gt; case_90   43        1        0                0                 0                 1              0                     9                      3           0             1</span>
<span class="co">#&gt; case_91   48        1        0                0                 0                 1              0                    16                      6           0             0</span>
<span class="co">#&gt; case_92   66        1        1                0                 0                 1              0                    13                      7           0             1</span>
<span class="co">#&gt; case_93   56        0        0                0                 0                 1              0                    17                      0           0             0</span>
<span class="co">#&gt; case_94   35        0        1                0                 0                 1              0                    13                      6           0             0</span>
<span class="co">#&gt; case_95   37        0        0                0                 0                 1              0                     7                      4           1             1</span>
<span class="co">#&gt; case_96   43        0        0                1                 0                 0              0                    37                      4           1             0</span>
<span class="co">#&gt; case_97   75        1        1                0                 1                 0              0                    22                      5           0             0</span>
<span class="co">#&gt; case_98   76        0        0                0                 0                 1              0                    13                      3           0             1</span>
<span class="co">#&gt; case_99   68        0        1                0                 0                 1              0                     6                      7           0             1</span>
<span class="co">#&gt; case_100  58        0        0                0                 0                 1              0                    20                      7           0             0</span>
<span class="co">#&gt; case_101  79        0        1                0                 0                 1              0                    13                      3           0             1</span>
<span class="co">#&gt; case_102  81        0        0                0                 0                 1              0                    32                      6           0             0</span>
<span class="co">#&gt; case_103  68        1        0                1                 0                 0              0                    37                      6           0             0</span>
<span class="co">#&gt; case_104  54        0        1                0                 0                 1              0                    20                      7           0             0</span>
<span class="co">#&gt; case_105  32        0        0                0                 0                 1              0                    22                      6           0             0</span>
<span class="co">#&gt; case_106  36        1        0                0                 0                 0              1                    30                      6           0             0</span>
<span class="co">#&gt; case_107  91        0        0                0                 0                 0              1                    21                     10           0             0</span>
<span class="co">#&gt; case_108  84        0        0                0                 0                 1              0                    13                      3           0             0</span>
<span class="co">#&gt; case_109  62        0        0                0                 0                 1              0                     6                      0           0             1</span>
<span class="co">#&gt; case_110  53        1        0                0                 0                 0              1                     9                      4           0             0</span>
<span class="co">#&gt; case_111  56        0        0                0                 0                 0              1                    22                      5           0             0</span>
<span class="co">#&gt; case_112  69        0        0                0                 0                 0              1                    10                      1           0             0</span>
<span class="co">#&gt; case_113  60        0        1                0                 0                 1              0                    13                      3           0             0</span>
<span class="co">#&gt; case_114  50        0        1                0                 0                 1              0                    10                      6           0             1</span>
<span class="co">#&gt; case_115  38        0        0                0                 0                 1              0                    16                      5           0             0</span>
<span class="co">#&gt; case_116  65        1        0                0                 0                 0              1                    21                      5           0             0</span>
<span class="co">#&gt; case_117  76        0        1                0                 0                 0              1                    28                      5           0             0</span>
<span class="co">#&gt; case_118  49        0        0                1                 0                 0              0                    18                      5           0             1</span>
<span class="co">#&gt; case_119  36        0        0                1                 0                 0              0                    26                      4           0             0</span>
<span class="co">#&gt; case_120  60        0        0                1                 0                 0              0                    31                      7           1             0</span>
<span class="co">#&gt; case_121  64        1        1                0                 0                 0              1                    30                      5           0             0</span>
<span class="co">#&gt; case_122  38        0        0                0                 0                 1              0                     2                      3           0             1</span>
<span class="co">#&gt; case_123  54        1        0                0                 0                 0              1                    16                      7           0             0</span>
<span class="co">#&gt; case_124  80        0        0                0                 0                 0              1                    17                      7           0             0</span>
<span class="co">#&gt; case_125  31        0        1                0                 0                 0              1                    20                      0           0             0</span>
<span class="co">#&gt; case_126  80        1        0                0                 0                 0              1                    24                     10           0             0</span>
<span class="co">#&gt; case_127   4        0        0                0                 0                 0              1                     9                      4           0             0</span>
<span class="co">#&gt; case_128  58        1        0                0                 0                 0              1                    22                      7           0             0</span>
<span class="co">#&gt; case_129  69        1        0                0                 0                 0              1                    28                      4           0             0</span>
<span class="co">#&gt; case_130  69        1        0                0                 0                 0              1                    30                      1           0             0</span>
<span class="co">#&gt; case_131   9        1        0                0                 0                 0              1                    11                      1           0             0</span>
<span class="co">#&gt; case_132  79        1        1                0                 0                 0              1                    18                      0           0             1</span>
<span class="co">#&gt; case_133   6        1        0                0                 0                 0              1                     2                      0           0             0</span>
<span class="co">#&gt; case_134  15        1        0                1                 0                 0              0                     7                      1           0             0</span>
<span class="co">#&gt; case_135  61        1        1                0                 0                 0              1                    32                      3           0             0</span>
<span class="co">#&gt; case_136  51        1        1                0                 0                 0              1                     8                      1           0             1</span></code></pre></div>
<div class="sourceCode" id="cb619"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataset_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">[</span>, <span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, 
                          <span class="co"># mice::complete(dataset_impute, 1), </span>
                          <span class="va">impute_complete</span>,
                          by <span class="op">=</span> <span class="st">"row.names"</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">dataset_complete</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dataset_complete</span><span class="op">$</span><span class="va">Row.names</span>
<span class="va">dataset_complete</span> <span class="op">&lt;-</span> <span class="va">dataset_complete</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">dataset_complete</span>
<span class="co">#&gt;          outcome age hospital gender_f province_Jiangsu province_Shanghai province_Zhejiang province_other days_onset_to_outcome days_onset_to_hospital early_onset early_outcome</span>
<span class="co">#&gt; case_1     Death  87        0        0                0                 1                 0              0                    13                      6           1             1</span>
<span class="co">#&gt; case_10    Death  48        1        0                0                 1                 0              0                     6                      4           1             1</span>
<span class="co">#&gt; case_100    &lt;NA&gt;  58        0        0                0                 0                 1              0                    20                      7           0             0</span>
<span class="co">#&gt; case_101    &lt;NA&gt;  79        0        1                0                 0                 1              0                    13                      3           0             1</span>
<span class="co">#&gt; case_102    &lt;NA&gt;  81        0        0                0                 0                 1              0                    32                      6           0             0</span>
<span class="co">#&gt; case_103    &lt;NA&gt;  68        1        0                1                 0                 0              0                    37                      6           0             0</span>
<span class="co">#&gt; case_104    &lt;NA&gt;  54        0        1                0                 0                 1              0                    20                      7           0             0</span>
<span class="co">#&gt; case_105    &lt;NA&gt;  32        0        0                0                 0                 1              0                    22                      6           0             0</span>
<span class="co">#&gt; case_106 Recover  36        1        0                0                 0                 0              1                    30                      6           0             0</span>
<span class="co">#&gt; case_107   Death  91        0        0                0                 0                 0              1                    21                     10           0             0</span>
<span class="co">#&gt; case_108    &lt;NA&gt;  84        0        0                0                 0                 1              0                    13                      3           0             0</span>
<span class="co">#&gt; case_109    &lt;NA&gt;  62        0        0                0                 0                 1              0                     6                      0           0             1</span>
<span class="co">#&gt; case_11    Death  64        1        0                0                 0                 1              0                     6                      2           1             1</span>
<span class="co">#&gt; case_110    &lt;NA&gt;  53        1        0                0                 0                 0              1                     9                      4           0             0</span>
<span class="co">#&gt; case_111   Death  56        0        0                0                 0                 0              1                    22                      5           0             0</span>
<span class="co">#&gt; case_112    &lt;NA&gt;  69        0        0                0                 0                 0              1                    10                      1           0             0</span>
<span class="co">#&gt; case_113    &lt;NA&gt;  60        0        1                0                 0                 1              0                    13                      3           0             0</span>
<span class="co">#&gt; case_114    &lt;NA&gt;  50        0        1                0                 0                 1              0                    10                      6           0             1</span>
<span class="co">#&gt; case_115    &lt;NA&gt;  38        0        0                0                 0                 1              0                    16                      5           0             0</span>
<span class="co">#&gt; case_116 Recover  65        1        0                0                 0                 0              1                    21                      5           0             0</span>
<span class="co">#&gt; case_117 Recover  76        0        1                0                 0                 0              1                    28                      5           0             0</span>
<span class="co">#&gt; case_118    &lt;NA&gt;  49        0        0                1                 0                 0              0                    18                      5           0             1</span>
<span class="co">#&gt; case_119 Recover  36        0        0                1                 0                 0              0                    26                      4           0             0</span>
<span class="co">#&gt; case_12    Death  52        0        1                0                 1                 0              0                     7                      7           1             1</span>
<span class="co">#&gt; case_120    &lt;NA&gt;  60        0        0                1                 0                 0              0                    31                      7           1             0</span>
<span class="co">#&gt; case_121   Death  64        1        1                0                 0                 0              1                    30                      5           0             0</span>
<span class="co">#&gt; case_122    &lt;NA&gt;  38        0        0                0                 0                 1              0                     2                      3           0             1</span>
<span class="co">#&gt; case_123   Death  54        1        0                0                 0                 0              1                    16                      7           0             0</span>
<span class="co">#&gt; case_124 Recover  80        0        0                0                 0                 0              1                    17                      7           0             0</span>
<span class="co">#&gt; case_125 Recover  31        0        1                0                 0                 0              1                    20                      0           0             0</span>
<span class="co">#&gt; case_126    &lt;NA&gt;  80        1        0                0                 0                 0              1                    24                     10           0             0</span>
<span class="co">#&gt; case_127 Recover   4        0        0                0                 0                 0              1                     9                      4           0             0</span>
<span class="co">#&gt; case_128 Recover  58        1        0                0                 0                 0              1                    22                      7           0             0</span>
<span class="co">#&gt; case_129 Recover  69        1        0                0                 0                 0              1                    28                      4           0             0</span>
<span class="co">#&gt; case_13    Death  67        1        1                0                 1                 0              0                    12                      3           1             1</span>
<span class="co">#&gt; case_130    &lt;NA&gt;  69        1        0                0                 0                 0              1                    30                      1           0             0</span>
<span class="co">#&gt; case_131 Recover   9        1        0                0                 0                 0              1                    11                      1           0             0</span>
<span class="co">#&gt; case_132    &lt;NA&gt;  79        1        1                0                 0                 0              1                    18                      0           0             1</span>
<span class="co">#&gt; case_133 Recover   6        1        0                0                 0                 0              1                     2                      0           0             0</span>
<span class="co">#&gt; case_134 Recover  15        1        0                1                 0                 0              0                     7                      1           0             0</span>
<span class="co">#&gt; case_135   Death  61        1        1                0                 0                 0              1                    32                      3           0             0</span>
<span class="co">#&gt; case_136    &lt;NA&gt;  51        1        1                0                 0                 0              1                     8                      1           0             1</span>
<span class="co">#&gt; case_14  Recover   4        0        0                0                 1                 0              0                    10                      5           1             1</span>
<span class="co">#&gt; case_15     &lt;NA&gt;  61        0        1                1                 0                 0              0                    32                      4           1             0</span>
<span class="co">#&gt; case_16     &lt;NA&gt;  79        0        0                1                 0                 0              0                    38                      4           1             0</span>
<span class="co">#&gt; case_17    Death  74        1        0                0                 1                 0              0                    14                      6           1             1</span>
<span class="co">#&gt; case_18  Recover  66        1        0                0                 1                 0              0                    20                      4           1             1</span>
<span class="co">#&gt; case_19    Death  59        1        0                0                 1                 0              0                    67                      5           1             0</span>
<span class="co">#&gt; case_2     Death  27        1        0                0                 1                 0              0                    11                      4           1             1</span>
<span class="co">#&gt; case_20  Recover  55        1        0                0                 0                 0              1                    22                      4           1             1</span>
<span class="co">#&gt; case_21  Recover  67        1        0                0                 1                 0              0                    23                      1           1             1</span>
<span class="co">#&gt; case_22     &lt;NA&gt;  85        1        0                1                 0                 0              0                    31                      4           1             0</span>
<span class="co">#&gt; case_23  Recover  25        1        1                1                 0                 0              0                    46                      0           1             0</span>
<span class="co">#&gt; case_24    Death  64        0        0                0                 1                 0              0                     6                      5           1             1</span>
<span class="co">#&gt; case_25  Recover  62        1        0                0                 1                 0              0                    35                      0           1             0</span>
<span class="co">#&gt; case_26    Death  77        1        0                0                 1                 0              0                    11                      4           1             1</span>
<span class="co">#&gt; case_27  Recover  51        1        1                0                 0                 1              0                    37                     27           1             1</span>
<span class="co">#&gt; case_28     &lt;NA&gt;  79        0        0                0                 0                 1              0                    32                      0           1             0</span>
<span class="co">#&gt; case_29  Recover  76        1        1                0                 1                 0              0                    32                      4           1             0</span>
<span class="co">#&gt; case_3     Death  35        1        1                0                 0                 0              1                    31                     10           1             1</span>
<span class="co">#&gt; case_30  Recover  81        0        1                0                 1                 0              0                    23                      0           1             0</span>
<span class="co">#&gt; case_31     &lt;NA&gt;  70        0        0                1                 0                 0              0                    32                      4           1             0</span>
<span class="co">#&gt; case_32     &lt;NA&gt;  74        0        0                1                 0                 0              0                    38                      4           1             0</span>
<span class="co">#&gt; case_33  Recover  65        0        0                0                 0                 1              0                    24                      8           1             0</span>
<span class="co">#&gt; case_34    Death  74        1        0                0                 1                 0              0                    11                      5           1             1</span>
<span class="co">#&gt; case_35    Death  83        1        1                0                 1                 0              0                    38                      5           1             0</span>
<span class="co">#&gt; case_36  Recover  68        0        0                0                 1                 0              0                    17                      4           1             1</span>
<span class="co">#&gt; case_37  Recover  31        0        0                1                 0                 0              0                    45                      7           1             0</span>
<span class="co">#&gt; case_38     &lt;NA&gt;  56        0        0                1                 0                 0              0                    23                      7           1             0</span>
<span class="co">#&gt; case_39     &lt;NA&gt;  66        1        0                0                 0                 1              0                    13                      0           0             1</span>
<span class="co">#&gt; case_4      &lt;NA&gt;  45        1        1                1                 0                 0              0                    14                      8           1             1</span>
<span class="co">#&gt; case_40     &lt;NA&gt;  74        1        0                0                 0                 1              0                     6                      5           1             1</span>
<span class="co">#&gt; case_41     &lt;NA&gt;  54        1        1                0                 0                 1              0                    23                      6           1             1</span>
<span class="co">#&gt; case_42     &lt;NA&gt;  53        1        0                0                 1                 0              0                    11                      7           1             1</span>
<span class="co">#&gt; case_43    Death  86        1        0                0                 1                 0              0                    18                      3           1             1</span>
<span class="co">#&gt; case_44  Recover   7        1        1                0                 0                 0              1                     6                      0           0             1</span>
<span class="co">#&gt; case_45    Death  56        1        0                0                 1                 0              0                    86                      3           1             0</span>
<span class="co">#&gt; case_46    Death  77        0        1                1                 0                 0              0                     9                      0           1             1</span>
<span class="co">#&gt; case_47     &lt;NA&gt;  72        0        0                1                 0                 0              0                    32                      5           1             0</span>
<span class="co">#&gt; case_48     &lt;NA&gt;  65        1        0                0                 0                 1              0                    20                      6           1             1</span>
<span class="co">#&gt; case_49  Recover  38        1        0                0                 0                 1              0                    28                      5           1             0</span>
<span class="co">#&gt; case_5   Recover  48        1        1                1                 0                 0              0                    57                     11           1             0</span>
<span class="co">#&gt; case_50  Recover  34        1        0                0                 0                 0              1                    17                      3           1             0</span>
<span class="co">#&gt; case_51  Recover  65        1        0                0                 0                 0              1                    15                      2           0             1</span>
<span class="co">#&gt; case_52     &lt;NA&gt;  64        0        1                0                 0                 1              0                    17                      7           1             1</span>
<span class="co">#&gt; case_53    Death  62        0        1                0                 0                 1              0                    22                      7           1             1</span>
<span class="co">#&gt; case_54     &lt;NA&gt;  75        0        0                0                 0                 1              0                    37                      7           1             0</span>
<span class="co">#&gt; case_55  Recover  79        0        0                0                 0                 1              0                    18                      7           0             0</span>
<span class="co">#&gt; case_56     &lt;NA&gt;  73        1        0                0                 1                 0              0                    11                      6           1             1</span>
<span class="co">#&gt; case_57  Recover  54        1        0                0                 1                 0              0                    13                      4           0             1</span>
<span class="co">#&gt; case_58  Recover  78        1        0                0                 1                 0              0                    31                      4           1             0</span>
<span class="co">#&gt; case_59  Recover  50        0        0                1                 0                 0              0                    37                      7           1             0</span>
<span class="co">#&gt; case_6     Death  32        1        1                1                 0                 0              0                    36                      7           1             1</span>
<span class="co">#&gt; case_60  Recover  26        0        0                1                 0                 0              0                    18                      4           0             1</span>
<span class="co">#&gt; case_61    Death  60        0        0                1                 0                 0              0                    10                      4           1             1</span>
<span class="co">#&gt; case_62     &lt;NA&gt;  68        0        1                0                 0                 1              0                    11                      5           1             1</span>
<span class="co">#&gt; case_63     &lt;NA&gt;  60        0        0                0                 0                 0              1                    26                      3           0             0</span>
<span class="co">#&gt; case_64  Recover  56        0        0                1                 0                 0              0                    16                      4           0             0</span>
<span class="co">#&gt; case_65  Recover  21        0        1                1                 0                 0              0                    37                      4           1             0</span>
<span class="co">#&gt; case_66     &lt;NA&gt;  72        0        0                1                 0                 0              0                    32                      3           0             0</span>
<span class="co">#&gt; case_67     &lt;NA&gt;  56        0        0                0                 0                 1              0                    31                      3           0             0</span>
<span class="co">#&gt; case_68     &lt;NA&gt;  57        0        0                0                 0                 1              0                     6                     10           0             1</span>
<span class="co">#&gt; case_69     &lt;NA&gt;  62        0        0                0                 0                 1              0                     8                      7           0             1</span>
<span class="co">#&gt; case_7     Death  83        1        0                1                 0                 0              0                    20                      9           1             1</span>
<span class="co">#&gt; case_70     &lt;NA&gt;  58        0        1                0                 0                 1              0                    10                     11           0             1</span>
<span class="co">#&gt; case_71     &lt;NA&gt;  72        0        1                0                 0                 1              0                    13                      6           0             0</span>
<span class="co">#&gt; case_72  Recover  47        1        0                0                 1                 0              0                    17                      5           0             0</span>
<span class="co">#&gt; case_73  Recover  69        0        0                0                 1                 0              0                     7                      4           0             1</span>
<span class="co">#&gt; case_74  Recover  54        0        0                0                 1                 0              0                    17                      6           1             0</span>
<span class="co">#&gt; case_75    Death  83        0        0                0                 1                 0              0                     6                      4           1             1</span>
<span class="co">#&gt; case_76    Death  55        0        0                0                 1                 0              0                     6                      7           1             1</span>
<span class="co">#&gt; case_77  Recover   2        0        0                0                 1                 0              0                    13                      7           1             0</span>
<span class="co">#&gt; case_78    Death  89        1        0                0                 1                 0              0                    17                      4           0             0</span>
<span class="co">#&gt; case_79  Recover  37        0        1                0                 0                 1              0                    16                      0           0             0</span>
<span class="co">#&gt; case_8     Death  38        1        0                0                 0                 1              0                    20                     11           1             1</span>
<span class="co">#&gt; case_80     &lt;NA&gt;  74        0        0                0                 0                 1              0                    22                      3           0             0</span>
<span class="co">#&gt; case_81    Death  86        0        0                0                 0                 1              0                    10                      6           0             1</span>
<span class="co">#&gt; case_82  Recover  41        0        0                0                 0                 1              0                     8                     10           0             1</span>
<span class="co">#&gt; case_83  Recover  38        0        0                0                 0                 0              1                    23                      4           0             0</span>
<span class="co">#&gt; case_84     &lt;NA&gt;  26        0        1                1                 0                 0              0                    13                      1           1             1</span>
<span class="co">#&gt; case_85     &lt;NA&gt;  80        1        1                0                 1                 0              0                    13                      7           0             1</span>
<span class="co">#&gt; case_86     &lt;NA&gt;  54        0        1                0                 0                 1              0                    10                      3           0             1</span>
<span class="co">#&gt; case_87    Death  69        0        0                0                 0                 1              0                     8                      3           0             1</span>
<span class="co">#&gt; case_88     &lt;NA&gt;   4        0        0                0                 0                 0              1                    11                      0           0             0</span>
<span class="co">#&gt; case_89  Recover  54        1        0                1                 0                 0              0                    36                      6           0             0</span>
<span class="co">#&gt; case_9      &lt;NA&gt;  67        1        0                0                 0                 1              0                     7                      0           1             1</span>
<span class="co">#&gt; case_90     &lt;NA&gt;  43        1        0                0                 0                 1              0                     9                      3           0             1</span>
<span class="co">#&gt; case_91  Recover  48        1        0                0                 0                 1              0                    16                      6           0             0</span>
<span class="co">#&gt; case_92     &lt;NA&gt;  66        1        1                0                 0                 1              0                    13                      7           0             1</span>
<span class="co">#&gt; case_93     &lt;NA&gt;  56        0        0                0                 0                 1              0                    17                      0           0             0</span>
<span class="co">#&gt; case_94  Recover  35        0        1                0                 0                 1              0                    13                      6           0             0</span>
<span class="co">#&gt; case_95     &lt;NA&gt;  37        0        0                0                 0                 1              0                     7                      4           1             1</span>
<span class="co">#&gt; case_96     &lt;NA&gt;  43        0        0                1                 0                 0              0                    37                      4           1             0</span>
<span class="co">#&gt; case_97  Recover  75        1        1                0                 1                 0              0                    22                      5           0             0</span>
<span class="co">#&gt; case_98    Death  76        0        0                0                 0                 1              0                    13                      3           0             1</span>
<span class="co">#&gt; case_99     &lt;NA&gt;  68        0        1                0                 0                 1              0                     6                      7           0             1</span></code></pre></div>
<div class="sourceCode" id="cb620"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"NAs before imput: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span>
<span class="co">#&gt; NAs before imput:  277</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt;   Death Recover    NA's </span>
<span class="co">#&gt;      32      47      57</span></code></pre></div>
<div class="sourceCode" id="cb621"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"NAs after imput: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dataset_complete</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span>
<span class="co">#&gt; NAs after imput:  57</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dataset_complete</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt;   Death Recover    NA's </span>
<span class="co">#&gt;      32      47      57</span></code></pre></div>
<p><br></p>
</div>
</div>
<div id="test-train-and-validation-data-sets-1" class="section level2">
<h2>
<span class="header-section-number">28.4</span> Test, train and validation data sets<a class="anchor" aria-label="anchor" href="#test-train-and-validation-data-sets-1"><i class="fas fa-link"></i></a>
</h2>
<p>For building the model, I am separating the imputed data frame into training and test data. Test data are the 57 cases with unknown outcome.</p>
<p>The training data will be further divided for validation of the models: 70% of the training data will be kept for model building and the remaining 30% will be used for model testing.</p>
<p>I am using the <code>caret</code> package for modeling:</p>
<div class="sourceCode" id="cb622"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dataset_complete</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span>
<span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">dataset_complete</span><span class="op">[</span><span class="op">-</span><span class="va">train_index</span>, <span class="op">]</span>     <span class="co"># 79x12</span>
<span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="va">dataset_complete</span><span class="op">[</span><span class="va">train_index</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>    <span class="co"># 57x11</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: lattice</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">val_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">$</span><span class="va">outcome</span>, p <span class="op">=</span> <span class="fl">0.7</span>, list<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">val_train_data</span> <span class="op">&lt;-</span> <span class="va">train_data</span><span class="op">[</span><span class="va">val_index</span>, <span class="op">]</span>
<span class="va">val_test_data</span>  <span class="op">&lt;-</span> <span class="va">train_data</span><span class="op">[</span><span class="op">-</span><span class="va">val_index</span>, <span class="op">]</span>
<span class="va">val_train_X</span> <span class="op">&lt;-</span> <span class="va">val_train_data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">val_test_X</span> <span class="op">&lt;-</span> <span class="va">val_test_data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></code></pre></div>
<div id="decision-trees" class="section level3">
<h3>
<span class="header-section-number">28.4.1</span> Decision trees<a class="anchor" aria-label="anchor" href="#decision-trees"><i class="fas fa-link"></i></a>
</h3>
<p>To get an idea about how each feature contributes to the prediction of the outcome, I first built a decision tree based on the training data using <code>rpart</code> and <code>rattle</code>.</p>
<div class="sourceCode" id="cb623"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart">rpart</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rattle.togaware.com/">rattle</a></span><span class="op">)</span>
<span class="co">#&gt; Rattle: A free graphical interface for data science with R.</span>
<span class="co">#&gt; Version 5.3.0 Copyright (c) 2006-2018 Togaware Pty Ltd.</span>
<span class="co">#&gt; Type 'rattle()' to shake, rattle, and roll your data.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.org/rpart-plot">rpart.plot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html">rpart</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, method <span class="op">=</span> <span class="st">"class"</span>, 
             control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.control.html">rpart.control</a></span><span class="op">(</span>xval <span class="op">=</span> <span class="fl">10</span>, minbucket <span class="op">=</span> <span class="fl">2</span>, cp <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, 
             parms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>split <span class="op">=</span> <span class="st">"information"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/rattle/man/fancyRpartPlot.html">fancyRpartPlot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-algo-comparison_330-class_flu_outcome-sglander_files/figure-html/model-rpart-run-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>This randomly generated decision tree shows that cases with an early outcome were most likely to die when they were 68 or older, when they also had an early onset and when they were sick for fewer than 13 days. If a person was not among the first cases and was younger than 52, they had a good chance of recovering, but if they were 82 or older, they were more likely to die from the flu.</p>
</div>
<div id="feature-importance-1" class="section level3">
<h3>
<span class="header-section-number">28.4.2</span> Feature Importance<a class="anchor" aria-label="anchor" href="#feature-importance-1"><i class="fas fa-link"></i></a>
</h3>
<p>Not all of the features I created will be equally important to the model. The decision tree already gave me an idea of which features might be most important but I also want to estimate feature importance using a Random Forest approach with repeated cross validation.</p>
<div class="sourceCode" id="cb624"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># prepare training scheme</span>
<span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"repeatedcv"</span>, number <span class="op">=</span> <span class="fl">10</span>, repeats <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># train the model</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span>, method <span class="op">=</span> <span class="st">"rf"</span>, 
               preProcess <span class="op">=</span> <span class="cn">NULL</span>, trControl <span class="op">=</span> <span class="va">control</span><span class="op">)</span>

<span class="co"># estimate variable importance</span>
<span class="va">importance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html">varImp</a></span><span class="op">(</span><span class="va">model</span>, scale<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb625"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"hospital1"</span>, <span class="st">"gender_f1"</span>, <span class="st">"province_Jiangsu1"</span>, 
          <span class="st">"province_Shanghai1"</span>, <span class="st">"province_Zhejiang1"</span>, <span class="st">"province_other1"</span>, 
          <span class="st">"days_onset_to_outcome"</span>, <span class="st">"days_onset_to_hospital"</span>, <span class="st">"early_onset1"</span>, 
          <span class="st">"early_outcome1"</span> <span class="op">)</span>

<span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Age"</span>, <span class="st">"Hospital"</span>, <span class="st">"Female"</span>, <span class="st">"Jiangsu"</span>, <span class="st">"Shanghai"</span>, <span class="st">"Zhejiang"</span>,
        <span class="st">"Other province"</span>, <span class="st">"Days onset to outcome"</span>, <span class="st">"Days onset to hospital"</span>, 
        <span class="st">"Early onset"</span>, <span class="st">"Early outcome"</span> <span class="op">)</span>

<span class="va">importance_df_1</span> <span class="op">&lt;-</span> <span class="va">importance</span><span class="op">$</span><span class="va">importance</span>
<span class="va">importance_df_1</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">importance_df_1</span><span class="op">)</span>

<span class="va">importance_df_1</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">importance_df_1</span><span class="op">$</span><span class="va">group</span>, 
                                           from <span class="op">=</span> <span class="va">from</span>, 
                                           to <span class="op">=</span> <span class="va">to</span><span class="op">)</span>
<span class="va">f</span> <span class="op">=</span> <span class="va">importance_df_1</span><span class="op">[</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html">order</a></span><span class="op">(</span><span class="va">importance_df_1</span><span class="op">$</span><span class="va">Overall</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="st">"group"</span><span class="op">]</span>

<span class="va">importance_df_2</span> <span class="op">&lt;-</span> <span class="va">importance_df_1</span>
<span class="va">importance_df_2</span><span class="op">$</span><span class="va">Overall</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="va">importance_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mice/man/cbind.html">rbind</a></span><span class="op">(</span><span class="va">importance_df_1</span>, <span class="va">importance_df_2</span><span class="op">)</span>

<span class="co"># setting factor levels</span>
<span class="va">importance_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/transform.data.table.html">within</a></span><span class="op">(</span><span class="va">importance_df</span>, <span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">group</span>, levels <span class="op">=</span> <span class="va">f</span><span class="op">)</span><span class="op">)</span>
<span class="va">importance_df_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/transform.data.table.html">within</a></span><span class="op">(</span><span class="va">importance_df_1</span>, <span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">group</span>, levels <span class="op">=</span> <span class="va">f</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">importance_df_1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Overall</span>, y <span class="op">=</span> <span class="va">group</span>, 
                                         color <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">importance_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Overall</span>, y <span class="op">=</span> <span class="va">group</span>, color <span class="op">=</span> <span class="va">group</span>, 
                                      group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"Set1"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,
        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Importance"</span>,
    y <span class="op">=</span> <span class="st">""</span>,
    title <span class="op">=</span> <span class="st">"2013 Influenza A H7N9 cases in China"</span>,
    subtitle <span class="op">=</span> <span class="st">"Scaled feature importance"</span>,
    caption <span class="op">=</span> <span class="st">"\nDetermined with Random Forest and
    repeated cross validation (10 repeats, 10 times)"</span>
  <span class="op">)</span>
<span class="co">#&gt; Warning in brewer.pal(1, "Set1"): minimal value for n is 3, returning requested palette with 3 different levels</span></code></pre></div>
<div class="inline-figure"><img src="305-algo-comparison_330-class_flu_outcome-sglander_files/figure-html/plot-var-importance-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>This tells me that age is the most important determining factor for predicting disease outcome, followed by days between onset an outcome, early outcome and days between onset and hospitalization.</p>
<p><br></p>
</div>
<div id="feature-plot" class="section level3">
<h3>
<span class="header-section-number">28.4.3</span> Feature Plot<a class="anchor" aria-label="anchor" href="#feature-plot"><i class="fas fa-link"></i></a>
</h3>
<p>Before I start actually building models, I want to check whether the distribution of feature values is comparable between training, validation and test datasets.</p>
<div class="sourceCode" id="cb626"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tidy dataframe of 11 variables for plotting features for all datasets</span>
<span class="co"># dataset_complete: 136x12. test + val_train + val_test</span>
<span class="va">dataset_complete_gather</span> <span class="op">&lt;-</span> <span class="va">dataset_complete</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">dataset_complete</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>, 
                      <span class="st">"Test Data"</span>, 
               <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">dataset_complete</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">val_train_data</span><span class="op">)</span>, 
                      <span class="st">"Validation Train Data"</span>,
               <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">dataset_complete</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">val_test_data</span><span class="op">)</span>, 
                      <span class="st">"Validation Test Data"</span>, <span class="st">"NA"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         case_ID <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">value</span>, <span class="va">age</span><span class="op">:</span><span class="va">early_outcome</span><span class="op">)</span>
<span class="co">#&gt; Warning: attributes are not identical across measure variables;</span>
<span class="co">#&gt; they will be dropped</span>

<span class="co"># map values in group to more readable</span>
<span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"hospital"</span>, <span class="st">"gender_f"</span>, <span class="st">"province_Jiangsu"</span>, <span class="st">"province_Shanghai"</span>, 
          <span class="st">"province_Zhejiang"</span>, <span class="st">"province_other"</span>, <span class="st">"days_onset_to_outcome"</span>, 
          <span class="st">"days_onset_to_hospital"</span>, <span class="st">"early_onset"</span>,  <span class="st">"early_outcome"</span> <span class="op">)</span>
<span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Age"</span>, <span class="st">"Hospital"</span>, <span class="st">"Female"</span>, <span class="st">"Jiangsu"</span>, <span class="st">"Shanghai"</span>, <span class="st">"Zhejiang"</span>, 
        <span class="st">"Other province"</span>, <span class="st">"Days onset to outcome"</span>, <span class="st">"Days onset to hospital"</span>, 
        <span class="st">"Early onset"</span>, <span class="st">"Early outcome"</span> <span class="op">)</span>
<span class="va">dataset_complete_gather</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">dataset_complete_gather</span><span class="op">$</span><span class="va">group</span>, 
                      from <span class="op">=</span> <span class="va">from</span>, 
                      to <span class="op">=</span> <span class="va">to</span><span class="op">)</span></code></pre></div>
</div>
<div id="plot-distribution-of-features-in-each-dataset" class="section level3">
<h3>
<span class="header-section-number">28.4.4</span> Plot distribution of features in each dataset<a class="anchor" aria-label="anchor" href="#plot-distribution-of-features-in-each-dataset"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb627"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot features all datasets</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dataset_complete_gather</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">outcome</span>, color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">set</span> <span class="op">~</span> <span class="va">group</span>, ncol <span class="op">=</span> <span class="fl">11</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Value"</span>,
    y <span class="op">=</span> <span class="st">"Density"</span>,
    title <span class="op">=</span> <span class="st">"2013 Influenza A H7N9 cases in China"</span>,
    subtitle <span class="op">=</span> <span class="st">"Features for classifying outcome"</span>,
    caption <span class="op">=</span> <span class="st">"\nDensity distribution of all features used for 
    classification of flu outcome."</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-algo-comparison_330-class_flu_outcome-sglander_files/figure-html/plot-datasets-distribution-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="plot-3-features-vs-outcome-all-datasets" class="section level3">
<h3>
<span class="header-section-number">28.4.5</span> Plot 3 features vs outcome, all datasets<a class="anchor" aria-label="anchor" href="#plot-3-features-vs-outcome-all-datasets"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb628"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot three groups vs outcome</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span><span class="va">dataset_complete_gather</span>, 
              <span class="va">group</span> <span class="op">==</span> <span class="st">"Age"</span> <span class="op">|</span> 
              <span class="va">group</span> <span class="op">==</span> <span class="st">"Days onset to hospital"</span> <span class="op">|</span> 
              <span class="va">group</span> <span class="op">==</span> <span class="st">"Days onset to outcome"</span><span class="op">)</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">outcome</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, fill<span class="op">=</span><span class="va">set</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, type <span class="op">=</span> <span class="st">"div "</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">group</span>, ncol <span class="op">=</span> <span class="fl">3</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    fill <span class="op">=</span> <span class="st">""</span>,
    x <span class="op">=</span> <span class="st">"Outcome"</span>,
    y <span class="op">=</span> <span class="st">"Value"</span>,
    title <span class="op">=</span> <span class="st">"2013 Influenza A H7N9 cases in China"</span>,
    subtitle <span class="op">=</span> <span class="st">"Features for classifying outcome"</span>,
    caption <span class="op">=</span> <span class="st">"\nBoxplot of the features age, days from onset to 
    hospitalisation and days from onset to outcome."</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-algo-comparison_330-class_flu_outcome-sglander_files/figure-html/unnamed-chunk-14-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Luckily, the distributions looks reasonably similar between the validation and test data, except for a few outliers.</p>
<p><br></p>
</div>
</div>
<div id="comparing-machine-learning-algorithms" class="section level2">
<h2>
<span class="header-section-number">28.5</span> Comparing Machine Learning algorithms<a class="anchor" aria-label="anchor" href="#comparing-machine-learning-algorithms"><i class="fas fa-link"></i></a>
</h2>
<p>Before I try to predict the outcome of the unknown cases, I am testing the models’ accuracy with the validation datasets on a couple of algorithms. I have chosen only a few more well known algorithms, but <code>caret</code> implements many more.</p>
<p>I have chosen to not do any preprocessing because I was worried that the different data distributions with continuous variables (e.g. age) and binary variables (i.e. 0, 1 classification of e.g. hospitalisation) would lead to problems.</p>
<ul>
<li>Random Forest</li>
<li>GLM net</li>
<li>k-Nearest Neighbors</li>
<li>Penalized Discriminant Analysis</li>
<li>Stabilized Linear Discriminant Analysis</li>
<li>Nearest Shrunken Centroids</li>
<li>Single C5.0 Tree</li>
<li>Partial Least Squares</li>
</ul>
<div class="sourceCode" id="cb629"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"repeatedcv"</span>, 
                              number <span class="op">=</span> <span class="fl">10</span>, 
                              repeats <span class="op">=</span> <span class="fl">10</span>, 
                              verboseIter <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><br></p>
<div id="random-forest-2" class="section level3">
<h3>
<span class="header-section-number">28.5.1</span> Random Forest<a class="anchor" aria-label="anchor" href="#random-forest-2"><i class="fas fa-link"></i></a>
</h3>
<p>Random Forests predictions are based on the generation of multiple classification trees. This model classified 14 out of 23 cases correctly.</p>
<div class="sourceCode" id="cb630"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model_rf</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">val_train_data</span>,
                             method <span class="op">=</span> <span class="st">"rf"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_rf</span>
<span class="co">#&gt; Random Forest </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 56 samples</span>
<span class="co">#&gt; 11 predictors</span>
<span class="co">#&gt;  2 classes: 'Death', 'Recover' </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; No pre-processing</span>
<span class="co">#&gt; Resampling: Cross-Validated (10 fold, repeated 10 times) </span>
<span class="co">#&gt; Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... </span>
<span class="co">#&gt; Resampling results across tuning parameters:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   mtry  Accuracy  Kappa</span>
<span class="co">#&gt;    2    0.687     0.340</span>
<span class="co">#&gt;    6    0.732     0.432</span>
<span class="co">#&gt;   11    0.726     0.423</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Accuracy was used to select the optimal model using the largest value.</span>
<span class="co">#&gt; The final value used for the model was mtry = 6.</span></code></pre></div>
<div class="sourceCode" id="cb631"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_rf</span>, <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">val_test_data</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Reference</span>
<span class="co">#&gt; Prediction Death Recover</span>
<span class="co">#&gt;    Death       3       0</span>
<span class="co">#&gt;    Recover     6      14</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.739         </span>
<span class="co">#&gt;                  95% CI : (0.516, 0.898)</span>
<span class="co">#&gt;     No Information Rate : 0.609         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : 0.1421        </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : 0.378         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 0.0412        </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.333         </span>
<span class="co">#&gt;             Specificity : 1.000         </span>
<span class="co">#&gt;          Pos Pred Value : 1.000         </span>
<span class="co">#&gt;          Neg Pred Value : 0.700         </span>
<span class="co">#&gt;              Prevalence : 0.391         </span>
<span class="co">#&gt;          Detection Rate : 0.130         </span>
<span class="co">#&gt;    Detection Prevalence : 0.130         </span>
<span class="co">#&gt;       Balanced Accuracy : 0.667         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : Death         </span>
<span class="co">#&gt; </span></code></pre></div>
<p><br></p>
</div>
<div id="glm-net" class="section level3">
<h3>
<span class="header-section-number">28.5.2</span> GLM net<a class="anchor" aria-label="anchor" href="#glm-net"><i class="fas fa-link"></i></a>
</h3>
<p>Lasso or elastic net regularization for generalized linear model regression are based on linear regression models and is useful when we have feature correlation in our model.</p>
<p>This model classified 13 out of 23 cases correctly.</p>
<div class="sourceCode" id="cb632"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model_glmnet</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">val_train_data</span>,
                             method <span class="op">=</span> <span class="st">"glmnet"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_glmnet</span>
<span class="co">#&gt; glmnet </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 56 samples</span>
<span class="co">#&gt; 11 predictors</span>
<span class="co">#&gt;  2 classes: 'Death', 'Recover' </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; No pre-processing</span>
<span class="co">#&gt; Resampling: Cross-Validated (10 fold, repeated 10 times) </span>
<span class="co">#&gt; Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... </span>
<span class="co">#&gt; Resampling results across tuning parameters:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   alpha  lambda    Accuracy  Kappa</span>
<span class="co">#&gt;   0.10   0.000491  0.671     0.324</span>
<span class="co">#&gt;   0.10   0.004909  0.669     0.318</span>
<span class="co">#&gt;   0.10   0.049093  0.680     0.339</span>
<span class="co">#&gt;   0.55   0.000491  0.671     0.324</span>
<span class="co">#&gt;   0.55   0.004909  0.671     0.322</span>
<span class="co">#&gt;   0.55   0.049093  0.695     0.365</span>
<span class="co">#&gt;   1.00   0.000491  0.671     0.324</span>
<span class="co">#&gt;   1.00   0.004909  0.672     0.326</span>
<span class="co">#&gt;   1.00   0.049093  0.714     0.414</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Accuracy was used to select the optimal model using the largest value.</span>
<span class="co">#&gt; The final values used for the model were alpha = 1 and lambda = 0.0491.</span></code></pre></div>
<div class="sourceCode" id="cb633"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_glmnet</span>, <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">val_test_data</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Reference</span>
<span class="co">#&gt; Prediction Death Recover</span>
<span class="co">#&gt;    Death       3       2</span>
<span class="co">#&gt;    Recover     6      12</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.652         </span>
<span class="co">#&gt;                  95% CI : (0.427, 0.836)</span>
<span class="co">#&gt;     No Information Rate : 0.609         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : 0.422         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : 0.207         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 0.289         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.333         </span>
<span class="co">#&gt;             Specificity : 0.857         </span>
<span class="co">#&gt;          Pos Pred Value : 0.600         </span>
<span class="co">#&gt;          Neg Pred Value : 0.667         </span>
<span class="co">#&gt;              Prevalence : 0.391         </span>
<span class="co">#&gt;          Detection Rate : 0.130         </span>
<span class="co">#&gt;    Detection Prevalence : 0.217         </span>
<span class="co">#&gt;       Balanced Accuracy : 0.595         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : Death         </span>
<span class="co">#&gt; </span></code></pre></div>
<p><br></p>
</div>
<div id="k-nearest-neighbors" class="section level3">
<h3>
<span class="header-section-number">28.5.3</span> k-Nearest Neighbors<a class="anchor" aria-label="anchor" href="#k-nearest-neighbors"><i class="fas fa-link"></i></a>
</h3>
<p>k-nearest neighbors predicts based on point distances with predefined constants. This model classified 14 out of 23 cases correctly.</p>
<div class="sourceCode" id="cb634"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model_kknn</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">val_train_data</span>,
                             method <span class="op">=</span> <span class="st">"kknn"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_kknn</span>
<span class="co">#&gt; k-Nearest Neighbors </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 56 samples</span>
<span class="co">#&gt; 11 predictors</span>
<span class="co">#&gt;  2 classes: 'Death', 'Recover' </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; No pre-processing</span>
<span class="co">#&gt; Resampling: Cross-Validated (10 fold, repeated 10 times) </span>
<span class="co">#&gt; Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... </span>
<span class="co">#&gt; Resampling results across tuning parameters:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   kmax  Accuracy  Kappa</span>
<span class="co">#&gt;   5     0.666     0.313</span>
<span class="co">#&gt;   7     0.653     0.274</span>
<span class="co">#&gt;   9     0.648     0.263</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Tuning parameter 'distance' was held constant at a value of 2</span>
<span class="co">#&gt; Tuning parameter 'kernel' was held constant at a value of optimal</span>
<span class="co">#&gt; Accuracy was used to select the optimal model using the largest value.</span>
<span class="co">#&gt; The final values used for the model were kmax = 5, distance = 2 and kernel = optimal.</span></code></pre></div>
<div class="sourceCode" id="cb635"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_kknn</span>, <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">val_test_data</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Reference</span>
<span class="co">#&gt; Prediction Death Recover</span>
<span class="co">#&gt;    Death       5       3</span>
<span class="co">#&gt;    Recover     4      11</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.696         </span>
<span class="co">#&gt;                  95% CI : (0.471, 0.868)</span>
<span class="co">#&gt;     No Information Rate : 0.609         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : 0.264         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : 0.348         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 1.000         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.556         </span>
<span class="co">#&gt;             Specificity : 0.786         </span>
<span class="co">#&gt;          Pos Pred Value : 0.625         </span>
<span class="co">#&gt;          Neg Pred Value : 0.733         </span>
<span class="co">#&gt;              Prevalence : 0.391         </span>
<span class="co">#&gt;          Detection Rate : 0.217         </span>
<span class="co">#&gt;    Detection Prevalence : 0.348         </span>
<span class="co">#&gt;       Balanced Accuracy : 0.671         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : Death         </span>
<span class="co">#&gt; </span></code></pre></div>
<p><br></p>
</div>
<div id="penalized-discriminant-analysis" class="section level3">
<h3>
<span class="header-section-number">28.5.4</span> Penalized Discriminant Analysis<a class="anchor" aria-label="anchor" href="#penalized-discriminant-analysis"><i class="fas fa-link"></i></a>
</h3>
<p>Penalized Discriminant Analysis is the penalized linear discriminant analysis and is also useful for when we have highly correlated features. This model classified 14 out of 23 cases correctly.</p>
<div class="sourceCode" id="cb636"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model_pda</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">val_train_data</span>,
                             method <span class="op">=</span> <span class="st">"pda"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_pda</span>
<span class="co">#&gt; Penalized Discriminant Analysis </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 56 samples</span>
<span class="co">#&gt; 11 predictors</span>
<span class="co">#&gt;  2 classes: 'Death', 'Recover' </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; No pre-processing</span>
<span class="co">#&gt; Resampling: Cross-Validated (10 fold, repeated 10 times) </span>
<span class="co">#&gt; Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... </span>
<span class="co">#&gt; Resampling results across tuning parameters:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   lambda  Accuracy  Kappa</span>
<span class="co">#&gt;   0e+00     NaN       NaN</span>
<span class="co">#&gt;   1e-04   0.681     0.343</span>
<span class="co">#&gt;   1e-01   0.681     0.343</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Accuracy was used to select the optimal model using the largest value.</span>
<span class="co">#&gt; The final value used for the model was lambda = 1e-04.</span></code></pre></div>
<div class="sourceCode" id="cb637"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_pda</span>, <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">val_test_data</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Reference</span>
<span class="co">#&gt; Prediction Death Recover</span>
<span class="co">#&gt;    Death       3       2</span>
<span class="co">#&gt;    Recover     6      12</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.652         </span>
<span class="co">#&gt;                  95% CI : (0.427, 0.836)</span>
<span class="co">#&gt;     No Information Rate : 0.609         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : 0.422         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : 0.207         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 0.289         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.333         </span>
<span class="co">#&gt;             Specificity : 0.857         </span>
<span class="co">#&gt;          Pos Pred Value : 0.600         </span>
<span class="co">#&gt;          Neg Pred Value : 0.667         </span>
<span class="co">#&gt;              Prevalence : 0.391         </span>
<span class="co">#&gt;          Detection Rate : 0.130         </span>
<span class="co">#&gt;    Detection Prevalence : 0.217         </span>
<span class="co">#&gt;       Balanced Accuracy : 0.595         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : Death         </span>
<span class="co">#&gt; </span></code></pre></div>
<p><br></p>
</div>
<div id="stabilized-linear-discriminant-analysis" class="section level3">
<h3>
<span class="header-section-number">28.5.5</span> Stabilized Linear Discriminant Analysis<a class="anchor" aria-label="anchor" href="#stabilized-linear-discriminant-analysis"><i class="fas fa-link"></i></a>
</h3>
<p>Stabilized Linear Discriminant Analysis is designed for high-dimensional data and correlated co-variables. This model classified 15 out of 23 cases correctly.</p>
<div class="sourceCode" id="cb638"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model_slda</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">val_train_data</span>,
                             method <span class="op">=</span> <span class="st">"slda"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_slda</span>
<span class="co">#&gt; Stabilized Linear Discriminant Analysis </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 56 samples</span>
<span class="co">#&gt; 11 predictors</span>
<span class="co">#&gt;  2 classes: 'Death', 'Recover' </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; No pre-processing</span>
<span class="co">#&gt; Resampling: Cross-Validated (10 fold, repeated 10 times) </span>
<span class="co">#&gt; Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... </span>
<span class="co">#&gt; Resampling results:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Accuracy  Kappa</span>
<span class="co">#&gt;   0.682     0.358</span></code></pre></div>
<div class="sourceCode" id="cb639"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_slda</span>, <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">val_test_data</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Reference</span>
<span class="co">#&gt; Prediction Death Recover</span>
<span class="co">#&gt;    Death       3       3</span>
<span class="co">#&gt;    Recover     6      11</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.609         </span>
<span class="co">#&gt;                  95% CI : (0.385, 0.803)</span>
<span class="co">#&gt;     No Information Rate : 0.609         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : 0.590         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : 0.127         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 0.505         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.333         </span>
<span class="co">#&gt;             Specificity : 0.786         </span>
<span class="co">#&gt;          Pos Pred Value : 0.500         </span>
<span class="co">#&gt;          Neg Pred Value : 0.647         </span>
<span class="co">#&gt;              Prevalence : 0.391         </span>
<span class="co">#&gt;          Detection Rate : 0.130         </span>
<span class="co">#&gt;    Detection Prevalence : 0.261         </span>
<span class="co">#&gt;       Balanced Accuracy : 0.560         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : Death         </span>
<span class="co">#&gt; </span></code></pre></div>
<p><br></p>
</div>
<div id="nearest-shrunken-centroids" class="section level3">
<h3>
<span class="header-section-number">28.5.6</span> Nearest Shrunken Centroids<a class="anchor" aria-label="anchor" href="#nearest-shrunken-centroids"><i class="fas fa-link"></i></a>
</h3>
<p>Nearest Shrunken Centroids computes a standardized centroid for each class and shrinks each centroid toward the overall centroid for all classes. This model classified 15 out of 23 cases correctly.</p>
<div class="sourceCode" id="cb640"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model_pam</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">val_train_data</span>,
                             method <span class="op">=</span> <span class="st">"pam"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="co">#&gt; 12345678910111213141516171819202122232425262728293011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111</span>
<span class="va">model_pam</span>
<span class="co">#&gt; Nearest Shrunken Centroids </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 56 samples</span>
<span class="co">#&gt; 11 predictors</span>
<span class="co">#&gt;  2 classes: 'Death', 'Recover' </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; No pre-processing</span>
<span class="co">#&gt; Resampling: Cross-Validated (10 fold, repeated 10 times) </span>
<span class="co">#&gt; Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... </span>
<span class="co">#&gt; Resampling results across tuning parameters:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   threshold  Accuracy  Kappa</span>
<span class="co">#&gt;   0.142      0.709     0.416</span>
<span class="co">#&gt;   2.065      0.714     0.382</span>
<span class="co">#&gt;   3.987      0.590     0.000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Accuracy was used to select the optimal model using the largest value.</span>
<span class="co">#&gt; The final value used for the model was threshold = 2.06.</span></code></pre></div>
<div class="sourceCode" id="cb641"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_pam</span>, <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">val_test_data</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Reference</span>
<span class="co">#&gt; Prediction Death Recover</span>
<span class="co">#&gt;    Death       1       3</span>
<span class="co">#&gt;    Recover     8      11</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.522         </span>
<span class="co">#&gt;                  95% CI : (0.306, 0.732)</span>
<span class="co">#&gt;     No Information Rate : 0.609         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : 0.857         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : -0.115        </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 0.228         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.1111        </span>
<span class="co">#&gt;             Specificity : 0.7857        </span>
<span class="co">#&gt;          Pos Pred Value : 0.2500        </span>
<span class="co">#&gt;          Neg Pred Value : 0.5789        </span>
<span class="co">#&gt;              Prevalence : 0.3913        </span>
<span class="co">#&gt;          Detection Rate : 0.0435        </span>
<span class="co">#&gt;    Detection Prevalence : 0.1739        </span>
<span class="co">#&gt;       Balanced Accuracy : 0.4484        </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : Death         </span>
<span class="co">#&gt; </span></code></pre></div>
<p><br></p>
</div>
<div id="single-c5.0-tree" class="section level3">
<h3>
<span class="header-section-number">28.5.7</span> Single C5.0 Tree<a class="anchor" aria-label="anchor" href="#single-c5.0-tree"><i class="fas fa-link"></i></a>
</h3>
<p>C5.0 is another tree-based modeling algorithm. This model classified 15 out of 23 cases correctly.</p>
<div class="sourceCode" id="cb642"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model_C5.0Tree</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">val_train_data</span>,
                             method <span class="op">=</span> <span class="st">"C5.0Tree"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_C5.0Tree</span>
<span class="co">#&gt; Single C5.0 Tree </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 56 samples</span>
<span class="co">#&gt; 11 predictors</span>
<span class="co">#&gt;  2 classes: 'Death', 'Recover' </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; No pre-processing</span>
<span class="co">#&gt; Resampling: Cross-Validated (10 fold, repeated 10 times) </span>
<span class="co">#&gt; Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... </span>
<span class="co">#&gt; Resampling results:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Accuracy  Kappa</span>
<span class="co">#&gt;   0.696     0.359</span></code></pre></div>
<div class="sourceCode" id="cb643"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_C5.0Tree</span>, <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">val_test_data</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Reference</span>
<span class="co">#&gt; Prediction Death Recover</span>
<span class="co">#&gt;    Death       4       1</span>
<span class="co">#&gt;    Recover     5      13</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.739         </span>
<span class="co">#&gt;                  95% CI : (0.516, 0.898)</span>
<span class="co">#&gt;     No Information Rate : 0.609         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : 0.142         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : 0.405         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 0.221         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.444         </span>
<span class="co">#&gt;             Specificity : 0.929         </span>
<span class="co">#&gt;          Pos Pred Value : 0.800         </span>
<span class="co">#&gt;          Neg Pred Value : 0.722         </span>
<span class="co">#&gt;              Prevalence : 0.391         </span>
<span class="co">#&gt;          Detection Rate : 0.174         </span>
<span class="co">#&gt;    Detection Prevalence : 0.217         </span>
<span class="co">#&gt;       Balanced Accuracy : 0.687         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : Death         </span>
<span class="co">#&gt; </span></code></pre></div>
<p><br></p>
</div>
<div id="partial-least-squares" class="section level3">
<h3>
<span class="header-section-number">28.5.8</span> Partial Least Squares<a class="anchor" aria-label="anchor" href="#partial-least-squares"><i class="fas fa-link"></i></a>
</h3>
<p>modeling with correlated features. This model classified 15 out of 23 cases correctly.</p>
<div class="sourceCode" id="cb644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model_pls</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">val_train_data</span>,
                             method <span class="op">=</span> <span class="st">"pls"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_pls</span>
<span class="co">#&gt; Partial Least Squares </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 56 samples</span>
<span class="co">#&gt; 11 predictors</span>
<span class="co">#&gt;  2 classes: 'Death', 'Recover' </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; No pre-processing</span>
<span class="co">#&gt; Resampling: Cross-Validated (10 fold, repeated 10 times) </span>
<span class="co">#&gt; Summary of sample sizes: 51, 49, 50, 51, 49, 51, ... </span>
<span class="co">#&gt; Resampling results across tuning parameters:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   ncomp  Accuracy  Kappa</span>
<span class="co">#&gt;   1      0.663     0.315</span>
<span class="co">#&gt;   2      0.676     0.341</span>
<span class="co">#&gt;   3      0.691     0.376</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Accuracy was used to select the optimal model using the largest value.</span>
<span class="co">#&gt; The final value used for the model was ncomp = 3.</span></code></pre></div>
<div class="sourceCode" id="cb645"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_pls</span>, <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">val_test_data</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Reference</span>
<span class="co">#&gt; Prediction Death Recover</span>
<span class="co">#&gt;    Death       2       3</span>
<span class="co">#&gt;    Recover     7      11</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.565         </span>
<span class="co">#&gt;                  95% CI : (0.345, 0.768)</span>
<span class="co">#&gt;     No Information Rate : 0.609         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : 0.742         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : 0.009         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 0.343         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.222         </span>
<span class="co">#&gt;             Specificity : 0.786         </span>
<span class="co">#&gt;          Pos Pred Value : 0.400         </span>
<span class="co">#&gt;          Neg Pred Value : 0.611         </span>
<span class="co">#&gt;              Prevalence : 0.391         </span>
<span class="co">#&gt;          Detection Rate : 0.087         </span>
<span class="co">#&gt;    Detection Prevalence : 0.217         </span>
<span class="co">#&gt;       Balanced Accuracy : 0.504         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : Death         </span>
<span class="co">#&gt; </span></code></pre></div>
<p><br></p>
</div>
</div>
<div id="comparing-accuracy-of-models-1" class="section level2">
<h2>
<span class="header-section-number">28.6</span> Comparing accuracy of models<a class="anchor" aria-label="anchor" href="#comparing-accuracy-of-models-1"><i class="fas fa-link"></i></a>
</h2>
<p>All models were similarly accurate.</p>
<div id="summary-accuracy-and-kappa" class="section level3">
<h3>
<span class="header-section-number">28.6.1</span> Summary Accuracy and Kappa<a class="anchor" aria-label="anchor" href="#summary-accuracy-and-kappa"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb646"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a list of models</span>
<span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>rf       <span class="op">=</span> <span class="va">model_rf</span>, 
               glmnet   <span class="op">=</span> <span class="va">model_glmnet</span>, 
               kknn     <span class="op">=</span> <span class="va">model_kknn</span>, 
               pda      <span class="op">=</span> <span class="va">model_pda</span>, 
               slda     <span class="op">=</span> <span class="va">model_slda</span>,
               pam      <span class="op">=</span> <span class="va">model_pam</span>, 
               C5.0Tree <span class="op">=</span> <span class="va">model_C5.0Tree</span>, 
               pls      <span class="op">=</span> <span class="va">model_pls</span><span class="op">)</span>

<span class="co"># Resample the models</span>
<span class="va">resample_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/resamples.html">resamples</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span>

<span class="co"># Generate a summary</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">resample_results</span>, metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Kappa"</span>, <span class="st">"Accuracy"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; summary.resamples(object = resample_results, metric = c("Kappa", "Accuracy"))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Models: rf, glmnet, kknn, pda, slda, pam, C5.0Tree, pls </span>
<span class="co">#&gt; Number of resamples: 100 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Kappa </span>
<span class="co">#&gt;            Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's</span>
<span class="co">#&gt; rf       -0.500   0.167  0.545 0.432   0.667    1    0</span>
<span class="co">#&gt; glmnet   -0.667   0.167  0.545 0.414   0.667    1    0</span>
<span class="co">#&gt; kknn     -0.667   0.125  0.333 0.313   0.615    1    0</span>
<span class="co">#&gt; pda      -0.667   0.142  0.333 0.343   0.615    1    0</span>
<span class="co">#&gt; slda     -0.667   0.167  0.367 0.358   0.615    1    0</span>
<span class="co">#&gt; pam      -0.667   0.167  0.545 0.382   0.571    1    0</span>
<span class="co">#&gt; C5.0Tree -0.667   0.167  0.333 0.359   0.615    1    0</span>
<span class="co">#&gt; pls      -0.667   0.167  0.333 0.376   0.667    1    0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Accuracy </span>
<span class="co">#&gt;           Min. 1st Qu. Median  Mean 3rd Qu. Max. NA's</span>
<span class="co">#&gt; rf       0.333   0.600  0.800 0.732   0.833    1    0</span>
<span class="co">#&gt; glmnet   0.167   0.600  0.800 0.714   0.833    1    0</span>
<span class="co">#&gt; kknn     0.167   0.600  0.667 0.666   0.800    1    0</span>
<span class="co">#&gt; pda      0.167   0.593  0.667 0.681   0.800    1    0</span>
<span class="co">#&gt; slda     0.167   0.600  0.667 0.682   0.800    1    0</span>
<span class="co">#&gt; pam      0.200   0.600  0.800 0.714   0.800    1    0</span>
<span class="co">#&gt; C5.0Tree 0.167   0.600  0.667 0.696   0.800    1    0</span>
<span class="co">#&gt; pls      0.167   0.600  0.667 0.691   0.833    1    0</span></code></pre></div>
<div class="sourceCode" id="cb647"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/mice/man/bwplot.mids.html">bwplot</a></span><span class="op">(</span><span class="va">resample_results</span> , metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Kappa"</span>,<span class="st">"Accuracy"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-algo-comparison_330-class_flu_outcome-sglander_files/figure-html/unnamed-chunk-25-1.png" width="70%" style="display: block; margin: auto;"></div>
<p><br></p>
</div>
<div id="combined-results-of-predicting-validation-test-samples" class="section level3">
<h3>
<span class="header-section-number">28.6.2</span> Combined results of predicting validation test samples<a class="anchor" aria-label="anchor" href="#combined-results-of-predicting-validation-test-samples"><i class="fas fa-link"></i></a>
</h3>
<p>To compare the predictions from all models, I summed up the prediction probabilities for <code>Death</code> and <code>Recovery</code> from all models and calculated the log2 of the ratio between the summed probabilities for Recovery by the summed probabilities for <code>Death</code>. All cases with a log2 ratio bigger than 1.5 were defined as <code>Recover</code>, cases with a <span class="math inline">\(log2\)</span> ratio below -1.5 were defined as <code>Death</code>, and the remaining cases were defined as uncertain.</p>
<div class="sourceCode" id="cb648"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  randomForest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_rf</span>, newdata <span class="op">=</span> <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  glmnet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_glmnet</span>, newdata <span class="op">=</span> <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  kknn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_kknn</span>, newdata <span class="op">=</span> <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  pda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_pda</span>, newdata <span class="op">=</span> <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  slda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_slda</span>, newdata <span class="op">=</span> <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  pam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_pam</span>, newdata <span class="op">=</span> <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  C5.0Tree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_C5.0Tree</span>, newdata <span class="op">=</span> <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  pls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_pls</span>, newdata <span class="op">=</span> <span class="va">val_test_data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span><span class="op">)</span>

<span class="va">results</span><span class="op">$</span><span class="va">sum_Death</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"Death"</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">results</span><span class="op">$</span><span class="va">sum_Recover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"Recover"</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">results</span><span class="op">$</span><span class="va">log2_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/H2OFrame.html">log2</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">sum_Recover</span><span class="op">/</span><span class="va">results</span><span class="op">$</span><span class="va">sum_Death</span><span class="op">)</span>
<span class="va">results</span><span class="op">$</span><span class="va">true_outcome</span> <span class="op">&lt;-</span> <span class="va">val_test_data</span><span class="op">$</span><span class="va">outcome</span>
<span class="va">results</span><span class="op">$</span><span class="va">pred_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">log2_ratio</span> <span class="op">&gt;</span> <span class="fl">1.5</span>, <span class="st">"Recover"</span>, 
              <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">log2_ratio</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1.5</span>, <span class="st">"Death"</span>, <span class="st">"uncertain"</span><span class="op">)</span><span class="op">)</span>
<span class="va">results</span><span class="op">$</span><span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">pred_outcome</span> <span class="op">==</span> <span class="va">results</span><span class="op">$</span><span class="va">true_outcome</span>, <span class="st">"CORRECT"</span>, 
              <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">pred_outcome</span> <span class="op">==</span> <span class="st">"uncertain"</span>, <span class="st">"uncertain"</span>, <span class="st">"wrong"</span><span class="op">)</span><span class="op">)</span>
<span class="va">results</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;          sum_Death sum_Recover log2_ratio true_outcome pred_outcome prediction</span>
<span class="co">#&gt; case_10      4.237        3.76    -0.1709        Death    uncertain  uncertain</span>
<span class="co">#&gt; case_11      5.181        2.82    -0.8778        Death    uncertain  uncertain</span>
<span class="co">#&gt; case_116     2.412        5.59     1.2123      Recover    uncertain  uncertain</span>
<span class="co">#&gt; case_12      5.219        2.78    -0.9085        Death    uncertain  uncertain</span>
<span class="co">#&gt; case_121     2.356        5.64     1.2606        Death    uncertain  uncertain</span>
<span class="co">#&gt; case_127     0.694        7.31     3.3972      Recover      Recover    CORRECT</span>
<span class="co">#&gt; case_131     0.685        7.31     3.4164      Recover      Recover    CORRECT</span>
<span class="co">#&gt; case_133     0.649        7.35     3.5024      Recover      Recover    CORRECT</span>
<span class="co">#&gt; case_135     2.027        5.97     1.5589        Death      Recover      wrong</span>
<span class="co">#&gt; case_2       2.161        5.84     1.4337        Death    uncertain  uncertain</span>
<span class="co">#&gt; case_20      3.144        4.86     0.6272      Recover    uncertain  uncertain</span>
<span class="co">#&gt; case_30      4.493        3.51    -0.3576      Recover    uncertain  uncertain</span>
<span class="co">#&gt; case_45      2.594        5.41     1.0590        Death    uncertain  uncertain</span>
<span class="co">#&gt; case_5       3.019        4.98     0.7227      Recover    uncertain  uncertain</span>
<span class="co">#&gt; case_55      3.925        4.08     0.0543      Recover    uncertain  uncertain</span>
<span class="co">#&gt; case_59      1.894        6.11     1.6886      Recover      Recover    CORRECT</span>
<span class="co">#&gt; case_72      2.545        5.46     1.1002      Recover    uncertain  uncertain</span>
<span class="co">#&gt; case_74      2.339        5.66     1.2748      Recover    uncertain  uncertain</span>
<span class="co">#&gt; case_77      0.845        7.15     3.0819      Recover      Recover    CORRECT</span>
<span class="co">#&gt; case_8       2.237        5.76     1.3650        Death    uncertain  uncertain</span>
<span class="co">#&gt; case_89      1.712        6.29     1.8772      Recover      Recover    CORRECT</span>
<span class="co">#&gt; case_97      2.959        5.04     0.7687      Recover    uncertain  uncertain</span>
<span class="co">#&gt; case_98      4.798        3.20    -0.5833        Death    uncertain  uncertain</span></code></pre></div>
<p>All predictions based on all models were either correct or uncertain.</p>
<p><br></p>
</div>
</div>
<div id="predicting-unknown-outcomes" class="section level2">
<h2>
<span class="header-section-number">28.7</span> Predicting unknown outcomes<a class="anchor" aria-label="anchor" href="#predicting-unknown-outcomes"><i class="fas fa-link"></i></a>
</h2>
<p>The above models will now be used to predict the outcome of cases with unknown fate.</p>
<div class="sourceCode" id="cb649"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">train_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"repeatedcv"</span>, 
                              number <span class="op">=</span> <span class="fl">10</span>, 
                              repeats <span class="op">=</span> <span class="fl">10</span>, 
                              verboseIter <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model_rf</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">train_data</span>,
                             method <span class="op">=</span> <span class="st">"rf"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_glmnet</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">train_data</span>,
                             method <span class="op">=</span> <span class="st">"glmnet"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_kknn</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">train_data</span>,
                             method <span class="op">=</span> <span class="st">"kknn"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_pda</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">train_data</span>,
                             method <span class="op">=</span> <span class="st">"pda"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="co">#&gt; Warning: predictions failed for Fold01.Rep01: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold02.Rep01: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold03.Rep01: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold04.Rep01: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold05.Rep01: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold06.Rep01: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold07.Rep01: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold08.Rep01: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold09.Rep01: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold10.Rep01: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold01.Rep02: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold02.Rep02: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold03.Rep02: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold04.Rep02: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold05.Rep02: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold06.Rep02: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold07.Rep02: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold08.Rep02: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold09.Rep02: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold10.Rep02: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold01.Rep03: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold02.Rep03: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold03.Rep03: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold04.Rep03: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold05.Rep03: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold06.Rep03: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold07.Rep03: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold08.Rep03: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold09.Rep03: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold10.Rep03: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold01.Rep04: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold02.Rep04: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold03.Rep04: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold04.Rep04: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold05.Rep04: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold06.Rep04: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold07.Rep04: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold08.Rep04: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold09.Rep04: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold10.Rep04: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold01.Rep05: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold02.Rep05: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold03.Rep05: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold04.Rep05: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold05.Rep05: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold06.Rep05: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold07.Rep05: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold08.Rep05: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold09.Rep05: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold10.Rep05: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold01.Rep06: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold02.Rep06: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold03.Rep06: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold04.Rep06: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold05.Rep06: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold06.Rep06: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold07.Rep06: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold08.Rep06: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold09.Rep06: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold10.Rep06: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold01.Rep07: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold02.Rep07: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold03.Rep07: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold04.Rep07: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold05.Rep07: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold06.Rep07: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold07.Rep07: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold08.Rep07: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold09.Rep07: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold10.Rep07: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold01.Rep08: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold02.Rep08: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold03.Rep08: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold04.Rep08: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold05.Rep08: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold06.Rep08: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold07.Rep08: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold08.Rep08: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold09.Rep08: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold10.Rep08: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold01.Rep09: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold02.Rep09: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold03.Rep09: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold04.Rep09: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold05.Rep09: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold06.Rep09: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold07.Rep09: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold08.Rep09: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold09.Rep09: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold10.Rep09: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold01.Rep10: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold02.Rep10: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold03.Rep10: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold04.Rep10: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold05.Rep10: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold06.Rep10: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold07.Rep10: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold08.Rep10: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold09.Rep10: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning: predictions failed for Fold10.Rep10: lambda=0e+00 Error in mindist[l] &lt;- ndist[l] : </span>
<span class="co">#&gt;   NAs are not allowed in subscripted assignments</span>
<span class="co">#&gt; Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo, : There were missing values in resampled performance measures.</span>
<span class="co">#&gt; Warning in train.default(x, y, weights = w, ...): missing values found in aggregated results</span>
<span class="va">model_slda</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">train_data</span>,
                             method <span class="op">=</span> <span class="st">"slda"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_pam</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">train_data</span>,
                             method <span class="op">=</span> <span class="st">"pam"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="co">#&gt; 12345678910111213141516171819202122232425262728293011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111</span>
<span class="va">model_C5.0Tree</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">train_data</span>,
                             method <span class="op">=</span> <span class="st">"C5.0Tree"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>
<span class="va">model_pls</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
                             data <span class="op">=</span> <span class="va">train_data</span>,
                             method <span class="op">=</span> <span class="st">"pls"</span>,
                             preProcess <span class="op">=</span> <span class="cn">NULL</span>,
                             trControl <span class="op">=</span> <span class="va">train_control</span><span class="op">)</span>

<span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>rf <span class="op">=</span> <span class="va">model_rf</span>, 
               glmnet   <span class="op">=</span> <span class="va">model_glmnet</span>, 
               kknn     <span class="op">=</span> <span class="va">model_kknn</span>, 
               pda      <span class="op">=</span> <span class="va">model_pda</span>, 
               slda     <span class="op">=</span> <span class="va">model_slda</span>,
               pam      <span class="op">=</span> <span class="va">model_pam</span>, 
               C5.0Tree <span class="op">=</span> <span class="va">model_C5.0Tree</span>, 
               pls      <span class="op">=</span> <span class="va">model_pls</span><span class="op">)</span>

<span class="co"># Resample the models</span>
<span class="va">resample_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/resamples.html">resamples</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/mice/man/bwplot.mids.html">bwplot</a></span><span class="op">(</span><span class="va">resample_results</span> , metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Kappa"</span>,<span class="st">"Accuracy"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="305-algo-comparison_330-class_flu_outcome-sglander_files/figure-html/model-train-all-run-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Here again, the accuracy is similar in all models.</p>
<div id="final-results" class="section level3">
<h3>
<span class="header-section-number">28.7.1</span> Final results<a class="anchor" aria-label="anchor" href="#final-results"><i class="fas fa-link"></i></a>
</h3>
<p>The final results are calculated as described above.</p>
<div class="sourceCode" id="cb650"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  randomForest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_rf</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  glmnet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_glmnet</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  kknn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_kknn</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  pda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_pda</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  slda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_slda</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  pam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_pam</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  C5.0Tree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_C5.0Tree</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span>,
  pls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_pls</span>, newdata <span class="op">=</span> <span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span><span class="op">)</span>

<span class="va">results</span><span class="op">$</span><span class="va">sum_Death</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"Death"</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">results</span><span class="op">$</span><span class="va">sum_Recover</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"Recover"</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">results</span><span class="op">$</span><span class="va">log2_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/H2OFrame.html">log2</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">sum_Recover</span><span class="op">/</span><span class="va">results</span><span class="op">$</span><span class="va">sum_Death</span><span class="op">)</span>
<span class="va">results</span><span class="op">$</span><span class="va">predicted_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">log2_ratio</span> <span class="op">&gt;</span> <span class="fl">1.5</span>, <span class="st">"Recover"</span>, 
                                    <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">log2_ratio</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1.5</span>, <span class="st">"Death"</span>, 
                                           <span class="st">"uncertain"</span><span class="op">)</span><span class="op">)</span>
<span class="va">results</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;          sum_Death sum_Recover log2_ratio predicted_outcome</span>
<span class="co">#&gt; case_100     1.854        6.15     1.7287           Recover</span>
<span class="co">#&gt; case_101     5.432        2.57    -1.0807         uncertain</span>
<span class="co">#&gt; case_102     2.806        5.19     0.8887         uncertain</span>
<span class="co">#&gt; case_103     2.342        5.66     1.2729         uncertain</span>
<span class="co">#&gt; case_104     1.744        6.26     1.8432           Recover</span>
<span class="co">#&gt; case_105     0.955        7.04     2.8828           Recover</span>
<span class="co">#&gt; case_108     4.489        3.51    -0.3543         uncertain</span>
<span class="co">#&gt; case_109     4.515        3.48    -0.3736         uncertain</span>
<span class="co">#&gt; case_110     2.411        5.59     1.2132         uncertain</span>
<span class="co">#&gt; case_112     2.632        5.37     1.0281         uncertain</span>
<span class="co">#&gt; case_113     2.198        5.80     1.4004         uncertain</span>
<span class="co">#&gt; case_114     3.339        4.66     0.4810         uncertain</span>
<span class="co">#&gt; case_115     1.112        6.89     2.6307           Recover</span>
<span class="co">#&gt; case_118     2.778        5.22     0.9109         uncertain</span>
<span class="co">#&gt; case_120     2.213        5.79     1.3868         uncertain</span>
<span class="co">#&gt; case_122     3.235        4.77     0.5590         uncertain</span>
<span class="co">#&gt; case_126     3.186        4.81     0.5952         uncertain</span>
<span class="co">#&gt; case_130     2.300        5.70     1.3091         uncertain</span>
<span class="co">#&gt; case_132     4.473        3.53    -0.3427         uncertain</span>
<span class="co">#&gt; case_136     3.281        4.72     0.5243         uncertain</span>
<span class="co">#&gt; case_15      2.270        5.73     1.3355         uncertain</span>
<span class="co">#&gt; case_16      2.820        5.18     0.8772         uncertain</span>
<span class="co">#&gt; case_22      4.779        3.22    -0.5689         uncertain</span>
<span class="co">#&gt; case_28      2.862        5.14     0.8445         uncertain</span>
<span class="co">#&gt; case_31      2.412        5.59     1.2117         uncertain</span>
<span class="co">#&gt; case_32      2.591        5.41     1.0616         uncertain</span>
<span class="co">#&gt; case_38      2.060        5.94     1.5280           Recover</span>
<span class="co">#&gt; case_39      4.749        3.25    -0.5466         uncertain</span>
<span class="co">#&gt; case_4       5.342        2.66    -1.0074         uncertain</span>
<span class="co">#&gt; case_40      6.550        1.45    -2.1750             Death</span>
<span class="co">#&gt; case_41      4.611        3.39    -0.4441         uncertain</span>
<span class="co">#&gt; case_42      5.570        2.43    -1.1966         uncertain</span>
<span class="co">#&gt; case_47      2.563        5.44     1.0850         uncertain</span>
<span class="co">#&gt; case_48      4.850        3.15    -0.6224         uncertain</span>
<span class="co">#&gt; case_52      4.709        3.29    -0.5173         uncertain</span>
<span class="co">#&gt; case_54      2.718        5.28     0.9586         uncertain</span>
<span class="co">#&gt; case_56      6.394        1.61    -1.9933             Death</span>
<span class="co">#&gt; case_62      6.048        1.95    -1.6319             Death</span>
<span class="co">#&gt; case_63      2.337        5.66     1.2766         uncertain</span>
<span class="co">#&gt; case_66      2.176        5.82     1.4205         uncertain</span>
<span class="co">#&gt; case_67      1.893        6.11     1.6895           Recover</span>
<span class="co">#&gt; case_68      3.907        4.09     0.0672         uncertain</span>
<span class="co">#&gt; case_69      4.465        3.53    -0.3370         uncertain</span>
<span class="co">#&gt; case_70      3.885        4.12     0.0833         uncertain</span>
<span class="co">#&gt; case_71      2.524        5.48     1.1172         uncertain</span>
<span class="co">#&gt; case_80      2.759        5.24     0.9261         uncertain</span>
<span class="co">#&gt; case_84      3.661        4.34     0.2448         uncertain</span>
<span class="co">#&gt; case_85      4.921        3.08    -0.6762         uncertain</span>
<span class="co">#&gt; case_86      3.563        4.44     0.3164         uncertain</span>
<span class="co">#&gt; case_88      0.566        7.43     3.7160           Recover</span>
<span class="co">#&gt; case_9       5.981        2.02    -1.5665             Death</span>
<span class="co">#&gt; case_90      3.570        4.43     0.3116         uncertain</span>
<span class="co">#&gt; case_92      4.664        3.34    -0.4835         uncertain</span>
<span class="co">#&gt; case_93      2.056        5.94     1.5319           Recover</span>
<span class="co">#&gt; case_95      4.495        3.50    -0.3589         uncertain</span>
<span class="co">#&gt; case_96      1.313        6.69     2.3482           Recover</span>
<span class="co">#&gt; case_99      4.799        3.20    -0.5839         uncertain</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span><span class="op">(</span><span class="va">results</span>, <span class="st">"results_prediction_unknown_outcome_ML_part1.txt"</span>, 
            col.names <span class="op">=</span> <span class="cn">T</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb651"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">predicted_outcome</span> <span class="op">==</span> <span class="st">"Recover"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   sum_Death sum_Recover log2_ratio predicted_outcome</span>
<span class="co">#&gt; 1     1.854        6.15       1.73           Recover</span>
<span class="co">#&gt; 2     1.744        6.26       1.84           Recover</span>
<span class="co">#&gt; 3     0.955        7.04       2.88           Recover</span>
<span class="co">#&gt; 4     1.112        6.89       2.63           Recover</span>
<span class="co">#&gt; 5     2.060        5.94       1.53           Recover</span>
<span class="co">#&gt; 6     1.893        6.11       1.69           Recover</span>
<span class="co">#&gt; 7     0.566        7.43       3.72           Recover</span>
<span class="co">#&gt; 8     2.056        5.94       1.53           Recover</span>
<span class="co">#&gt; 9     1.313        6.69       2.35           Recover</span></code></pre></div>
</div>
<div id="predicted-outcome" class="section level3">
<h3>
<span class="header-section-number">28.7.2</span> Predicted outcome<a class="anchor" aria-label="anchor" href="#predicted-outcome"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb652"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">predicted_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 x 2</span>
<span class="co">#&gt;   predicted_outcome     n</span>
<span class="co">#&gt;   &lt;chr&gt;             &lt;int&gt;</span>
<span class="co">#&gt; 1 Death                 4</span>
<span class="co">#&gt; 2 Recover               9</span>
<span class="co">#&gt; 3 uncertain            44</span></code></pre></div>
<p>From 57 cases, 14 were defined as Recover, 3 as Death and 40 as uncertain.</p>
<div class="sourceCode" id="cb653"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span><span class="op">]</span>,
                          <span class="va">fluH7N9_china_2013</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013</span><span class="op">$</span><span class="va">case_ID</span> 
                                                   <span class="op">%in%</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span>, 
                          by.x <span class="op">=</span> <span class="st">"row.names"</span>, by.y <span class="op">=</span> <span class="st">"case_ID"</span><span class="op">)</span>
<span class="co"># results_combined &lt;- results_combined[, -c(2, 3, 8, 9)]</span>
<span class="va">results_combined</span> <span class="op">&lt;-</span> <span class="va">results_combined</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span><span class="op">]</span>
<span class="va">results_combined</span>
<span class="co">#&gt;    log2_ratio predicted_outcome case_id date_of_onset date_of_hospitalisation gender age  province</span>
<span class="co">#&gt; 1      1.7287           Recover     100    2013-04-16                    &lt;NA&gt;      m  58  Zhejiang</span>
<span class="co">#&gt; 2     -1.0807         uncertain     101    2013-04-13                    &lt;NA&gt;      f  79  Zhejiang</span>
<span class="co">#&gt; 3      0.8887         uncertain     102    2013-04-12                    &lt;NA&gt;      m  81  Zhejiang</span>
<span class="co">#&gt; 4      1.2729         uncertain     103    2013-04-13              2013-04-19      m  68   Jiangsu</span>
<span class="co">#&gt; 5      1.8432           Recover     104    2013-04-16                    &lt;NA&gt;      f  54  Zhejiang</span>
<span class="co">#&gt; 6      2.8828           Recover     105    2013-04-14                    &lt;NA&gt;      m  32  Zhejiang</span>
<span class="co">#&gt; 7     -0.3543         uncertain     108    2013-04-15                    &lt;NA&gt;      m  84  Zhejiang</span>
<span class="co">#&gt; 8     -0.3736         uncertain     109    2013-04-15                    &lt;NA&gt;      m  62  Zhejiang</span>
<span class="co">#&gt; 9      1.2132         uncertain     110    2013-04-12              2013-04-16      m  53    Taiwan</span>
<span class="co">#&gt; 10     1.0281         uncertain     112    2013-04-17                    &lt;NA&gt;      m  69   Jiangxi</span>
<span class="co">#&gt; 11     1.4004         uncertain     113    2013-04-15                    &lt;NA&gt;      f  60  Zhejiang</span>
<span class="co">#&gt; 12     0.4810         uncertain     114    2013-04-18                    &lt;NA&gt;      f  50  Zhejiang</span>
<span class="co">#&gt; 13     2.6307           Recover     115    2013-04-17                    &lt;NA&gt;      m  38  Zhejiang</span>
<span class="co">#&gt; 14     0.9109         uncertain     118    2013-04-17                    &lt;NA&gt;      m  49   Jiangsu</span>
<span class="co">#&gt; 15     1.3868         uncertain     120    2013-03-08                    &lt;NA&gt;      m  60   Jiangsu</span>
<span class="co">#&gt; 16     0.5590         uncertain     122    2013-04-18                    &lt;NA&gt;      m  38  Zhejiang</span>
<span class="co">#&gt; 17     0.5952         uncertain     126    2013-04-17              2013-04-27      m  80    Fujian</span>
<span class="co">#&gt; 18     1.3091         uncertain     130    2013-04-29              2013-04-30      m  69    Fujian</span>
<span class="co">#&gt; 19    -0.3427         uncertain     132    2013-05-03              2013-05-03      f  79   Jiangxi</span>
<span class="co">#&gt; 20     0.5243         uncertain     136    2013-07-27              2013-07-28      f  51 Guangdong</span>
<span class="co">#&gt; 21     1.3355         uncertain      15    2013-03-20                    &lt;NA&gt;      f  61   Jiangsu</span>
<span class="co">#&gt; 22     0.8772         uncertain      16    2013-03-21                    &lt;NA&gt;      m  79   Jiangsu</span>
<span class="co">#&gt; 23    -0.5689         uncertain      22    2013-03-28              2013-04-01      m  85   Jiangsu</span>
<span class="co">#&gt; 24     0.8445         uncertain      28    2013-03-29                    &lt;NA&gt;      m  79  Zhejiang</span>
<span class="co">#&gt; 25     1.2117         uncertain      31    2013-03-29                    &lt;NA&gt;      m  70   Jiangsu</span>
<span class="co">#&gt; 26     1.0616         uncertain      32    2013-04-02                    &lt;NA&gt;      m  74   Jiangsu</span>
<span class="co">#&gt; 27     1.5280           Recover      38    2013-04-03                    &lt;NA&gt;      m  56   Jiangsu</span>
<span class="co">#&gt; 28    -0.5466         uncertain      39    2013-04-08              2013-04-08      m  66  Zhejiang</span>
<span class="co">#&gt; 29    -1.0074         uncertain       4    2013-03-19              2013-03-27      f  45   Jiangsu</span>
<span class="co">#&gt; 30    -2.1750             Death      40    2013-04-06              2013-04-11      m  74  Zhejiang</span>
<span class="co">#&gt; 31    -0.4441         uncertain      41    2013-04-06              2013-04-12      f  54  Zhejiang</span>
<span class="co">#&gt; 32    -1.1966         uncertain      42    2013-04-03              2013-04-10      m  53  Shanghai</span>
<span class="co">#&gt; 33     1.0850         uncertain      47    2013-04-01                    &lt;NA&gt;      m  72   Jiangsu</span>
<span class="co">#&gt; 34    -0.6224         uncertain      48    2013-04-03              2013-04-09      m  65  Zhejiang</span>
<span class="co">#&gt; 35    -0.5173         uncertain      52    2013-04-06                    &lt;NA&gt;      f  64  Zhejiang</span>
<span class="co">#&gt; 36     0.9586         uncertain      54    2013-04-06                    &lt;NA&gt;      m  75  Zhejiang</span>
<span class="co">#&gt; 37    -1.9933             Death      56    2013-04-05              2013-04-11      m  73  Shanghai</span>
<span class="co">#&gt; 38    -1.6319             Death      62    2013-04-03                    &lt;NA&gt;      f  68  Zhejiang</span>
<span class="co">#&gt; 39     1.2766         uncertain      63    2013-04-10                    &lt;NA&gt;      m  60     Anhui</span>
<span class="co">#&gt; 40     1.4205         uncertain      66          &lt;NA&gt;                    &lt;NA&gt;      m  72   Jiangsu</span>
<span class="co">#&gt; 41     1.6895           Recover      67    2013-04-12                    &lt;NA&gt;      m  56  Zhejiang</span>
<span class="co">#&gt; 42     0.0672         uncertain      68    2013-04-10                    &lt;NA&gt;      m  57  Zhejiang</span>
<span class="co">#&gt; 43    -0.3370         uncertain      69    2013-04-10                    &lt;NA&gt;      m  62  Zhejiang</span>
<span class="co">#&gt; 44     0.0833         uncertain      70    2013-04-11                    &lt;NA&gt;      f  58  Zhejiang</span>
<span class="co">#&gt; 45     1.1172         uncertain      71    2013-04-10                    &lt;NA&gt;      f  72  Zhejiang</span>
<span class="co">#&gt; 46     0.9261         uncertain      80    2013-04-08                    &lt;NA&gt;      m  74  Zhejiang</span>
<span class="co">#&gt; 47     0.2448         uncertain      84          &lt;NA&gt;                    &lt;NA&gt;      f  26   Jiangsu</span>
<span class="co">#&gt; 48    -0.6762         uncertain      85    2013-04-09              2013-04-16      f  80  Shanghai</span>
<span class="co">#&gt; 49     0.3164         uncertain      86    2013-04-13                    &lt;NA&gt;      f  54  Zhejiang</span>
<span class="co">#&gt; 50     3.7160           Recover      88          &lt;NA&gt;                    &lt;NA&gt;      m   4   Beijing</span>
<span class="co">#&gt; 51    -1.5665             Death       9    2013-03-25              2013-03-25      m  67  Zhejiang</span>
<span class="co">#&gt; 52     0.3116         uncertain      90    2013-04-12              2013-04-15      m  43  Zhejiang</span>
<span class="co">#&gt; 53    -0.4835         uncertain      92    2013-04-10              2013-04-17      f  66  Zhejiang</span>
<span class="co">#&gt; 54     1.5319           Recover      93    2013-04-11                    &lt;NA&gt;      m  56  Zhejiang</span>
<span class="co">#&gt; 55    -0.3589         uncertain      95    2013-03-30                    &lt;NA&gt;      m  37  Zhejiang</span>
<span class="co">#&gt; 56     2.3482           Recover      96    2013-04-07                    &lt;NA&gt;      m  43   Jiangsu</span>
<span class="co">#&gt; 57    -0.5839         uncertain      99    2013-04-12                    &lt;NA&gt;      f  68  Zhejiang</span></code></pre></div>
<div class="sourceCode" id="cb654"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tidy dataframe for plotting</span>
<span class="va">results_combined_gather</span> <span class="op">&lt;-</span> <span class="va">results_combined</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">group_dates</span>, <span class="va">date</span>, <span class="va">date_of_onset</span><span class="op">:</span><span class="va">date_of_hospitalisation</span><span class="op">)</span>

<span class="va">results_combined_gather</span><span class="op">$</span><span class="va">group_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">results_combined_gather</span><span class="op">$</span><span class="va">group_dates</span>, 
                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_of_onset"</span>, <span class="st">"date_of_hospitalisation"</span><span class="op">)</span><span class="op">)</span>

<span class="va">results_combined_gather</span><span class="op">$</span><span class="va">group_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">results_combined_gather</span><span class="op">$</span><span class="va">group_dates</span>, 
                            from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_of_onset"</span>, <span class="st">"date_of_hospitalisation"</span><span class="op">)</span>, 
                              to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Date of onset"</span>, <span class="st">"Date of hospitalisation"</span><span class="op">)</span><span class="op">)</span>

<span class="va">results_combined_gather</span><span class="op">$</span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">results_combined_gather</span><span class="op">$</span><span class="va">gender</span>, 
                                            from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"m"</span><span class="op">)</span>, 
                                             to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">results_combined_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">results_combined_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span>, 
                                            <span class="st">"unknown"</span><span class="op">)</span>
<span class="va">results_combined_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">results_combined_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"unknown"</span></code></pre></div>
<div class="sourceCode" id="cb655"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">results_combined_gather</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">log2_ratio</span>, 
                                           color <span class="op">=</span> <span class="va">predicted_outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">~</span> <span class="va">group_dates</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    color <span class="op">=</span> <span class="st">"Predicted outcome"</span>,
    size <span class="op">=</span> <span class="st">"Age"</span>,
    x <span class="op">=</span> <span class="st">"Date in 2013"</span>,
    y <span class="op">=</span> <span class="st">"log2 ratio of prediction Recover vs Death"</span>,
    title <span class="op">=</span> <span class="st">"2013 Influenza A H7N9 cases in China"</span>,
    subtitle <span class="op">=</span> <span class="st">"Predicted outcome"</span>,
    caption <span class="op">=</span> <span class="st">""</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 42 rows containing missing values (geom_point).</span></code></pre></div>
<div class="inline-figure"><img src="305-algo-comparison_330-class_flu_outcome-sglander_files/figure-html/unnamed-chunk-30-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>The comparison of date of onset, data of hospitalization, gender and age with predicted outcome shows that predicted deaths were associated with older age than predicted recoveries. Date of onset does not show an obvious bias in either direction.</p>
<p><br></p>
</div>
</div>
<div id="conclusions-1" class="section level2">
<h2>
<span class="header-section-number">28.8</span> Conclusions<a class="anchor" aria-label="anchor" href="#conclusions-1"><i class="fas fa-link"></i></a>
</h2>
<p>This dataset posed a couple of difficulties to begin with, like unequal distribution of data points across variables and missing data. This makes the modeling inherently prone to flaws. However, real life data isn’t perfect either, so I went ahead and tested the modeling success anyway.</p>
<p>By accounting for uncertain classification with low predictions probability, the validation data could be classified accurately. However, for a more accurate model, these few cases don’t give enough information to reliably predict the outcome. More cases, more information (i.e. more features) and fewer missing data would improve the modeling outcome.</p>
<p>Also, this example is only applicable for this specific case of flu. In order to be able to draw more general conclusions about flu outcome, other cases and additional information, for example on medical parameters like preexisting medical conditions, disase parameters, demographic information, etc. would be necessary.</p>
<p>All in all, this dataset served as a nice example of the possibilities (and pitfalls) of machine learning applications and showcases a basic workflow for building prediction models with R.</p>
<p>For a comparison of feature selection methods see here.</p>
<p>If you see any mistakes or have tips and tricks for improvement, please don’t hesitate to let me know! Thanks. :-)</p>
<hr>
<div class="sourceCode" id="cb656"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 3.6.3 (2020-02-29)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Debian GNU/Linux 10 (buster)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/libopenblasp-r0.3.5.so</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C              LC_PAPER=en_US.UTF-8       LC_NAME=C                  LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] grid      stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt;  [1] RColorBrewer_1.1-2 rpart.plot_3.0.8   rattle_5.3.0       rpart_4.1-15       caret_6.0-86       lattice_0.20-38    mice_3.8.0         dplyr_0.8.5        gridExtra_2.3      ggplot2_3.3.0      plyr_1.8.6         tidyr_1.0.2        outbreaks_1.5.0   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] nlme_3.1-144         fs_1.4.1             lubridate_1.7.8      C50_0.1.3            tools_3.6.3          backports_1.1.6      bslib_0.2.2.9000     utf8_1.1.4           R6_2.4.1             colorspace_1.4-1     nnet_7.3-12          withr_2.2.0          tidyselect_1.0.0     downlit_0.2.1.9000   compiler_3.6.3       mda_0.4-10           cli_2.0.2            glmnet_3.0-2         xml2_1.3.2           isoband_0.2.1        Cubist_0.2.3         labeling_0.3         bookdown_0.21.4      sass_0.2.0.9005      scales_1.1.0         mvtnorm_1.1-0        randomForest_4.6-14  rappdirs_0.3.1       stringr_1.4.0        digest_0.6.25        rmarkdown_2.5.3      pkgconfig_2.0.3      htmltools_0.5.0.9003 rlang_0.4.5          shape_1.4.4          jquerylib_0.1.2      farver_2.0.3         generics_0.0.2       jsonlite_1.6.1       ModelMetrics_1.2.2.2 magrittr_1.5         Formula_1.2-3        Matrix_1.2-18        fansi_0.4.1          Rcpp_1.0.4.6         munsell_0.5.0        partykit_1.2-7      </span>
<span class="co">#&gt; [48] lifecycle_0.2.0      stringi_1.4.6        pROC_1.16.2          yaml_2.2.1           inum_1.0-1           MASS_7.3-51.5        pamr_1.56.1          recipes_0.1.10       pls_2.7-2            crayon_1.3.4         splines_3.6.3        knitr_1.28           pillar_1.4.3         igraph_1.2.5         reshape2_1.4.4       codetools_0.2-16     stats4_3.6.3         glue_1.4.0           evaluate_0.14        data.table_1.12.8    vctrs_0.2.4          foreach_1.5.0        gtable_0.3.0         purrr_0.3.4          assertthat_0.2.1     xfun_0.19.4          gower_0.2.1          prodlim_2019.11.13   libcoin_1.0-5        broom_0.5.6          e1071_1.7-3          class_7.3-15         survival_3.1-8       timeDate_3043.102    tibble_3.0.1         iterators_1.0.12     kknn_1.3.1           cluster_2.1.0        lava_1.6.7           ellipsis_0.3.0       ipred_0.9-9</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="classification-on-bad-loans.html"><span class="header-section-number">27</span> Classification on bad loans</a></div>
<div class="next"><a href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#predicting-flu-outcome-comparing-eight-classification-algorithms"><span class="header-section-number">28</span> Predicting Flu outcome comparing eight classification algorithms</a></li>
<li>
<a class="nav-link" href="#introduction-13"><span class="header-section-number">28.1</span> Introduction</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#algorithms-1"><span class="header-section-number">28.1.1</span> Algorithms</a></li>
<li><a class="nav-link" href="#workflow-3"><span class="header-section-number">28.1.2</span> Workflow</a></li>
<li><a class="nav-link" href="#can-we-predict-flu-outcome-with-machine-learning-in-r"><span class="header-section-number">28.1.3</span> Can we predict flu outcome with Machine Learning in R?</a></li>
</ul>
</li>
<li><a class="nav-link" href="#the-data-1"><span class="header-section-number">28.2</span> The data</a></li>
<li>
<a class="nav-link" href="#features-1"><span class="header-section-number">28.3</span> Features</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#imputing-missing-values-1"><span class="header-section-number">28.3.1</span> Imputing missing values</a></li></ul>
</li>
<li>
<a class="nav-link" href="#test-train-and-validation-data-sets-1"><span class="header-section-number">28.4</span> Test, train and validation data sets</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#decision-trees"><span class="header-section-number">28.4.1</span> Decision trees</a></li>
<li><a class="nav-link" href="#feature-importance-1"><span class="header-section-number">28.4.2</span> Feature Importance</a></li>
<li><a class="nav-link" href="#feature-plot"><span class="header-section-number">28.4.3</span> Feature Plot</a></li>
<li><a class="nav-link" href="#plot-distribution-of-features-in-each-dataset"><span class="header-section-number">28.4.4</span> Plot distribution of features in each dataset</a></li>
<li><a class="nav-link" href="#plot-3-features-vs-outcome-all-datasets"><span class="header-section-number">28.4.5</span> Plot 3 features vs outcome, all datasets</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#comparing-machine-learning-algorithms"><span class="header-section-number">28.5</span> Comparing Machine Learning algorithms</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#random-forest-2"><span class="header-section-number">28.5.1</span> Random Forest</a></li>
<li><a class="nav-link" href="#glm-net"><span class="header-section-number">28.5.2</span> GLM net</a></li>
<li><a class="nav-link" href="#k-nearest-neighbors"><span class="header-section-number">28.5.3</span> k-Nearest Neighbors</a></li>
<li><a class="nav-link" href="#penalized-discriminant-analysis"><span class="header-section-number">28.5.4</span> Penalized Discriminant Analysis</a></li>
<li><a class="nav-link" href="#stabilized-linear-discriminant-analysis"><span class="header-section-number">28.5.5</span> Stabilized Linear Discriminant Analysis</a></li>
<li><a class="nav-link" href="#nearest-shrunken-centroids"><span class="header-section-number">28.5.6</span> Nearest Shrunken Centroids</a></li>
<li><a class="nav-link" href="#single-c5.0-tree"><span class="header-section-number">28.5.7</span> Single C5.0 Tree</a></li>
<li><a class="nav-link" href="#partial-least-squares"><span class="header-section-number">28.5.8</span> Partial Least Squares</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#comparing-accuracy-of-models-1"><span class="header-section-number">28.6</span> Comparing accuracy of models</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#summary-accuracy-and-kappa"><span class="header-section-number">28.6.1</span> Summary Accuracy and Kappa</a></li>
<li><a class="nav-link" href="#combined-results-of-predicting-validation-test-samples"><span class="header-section-number">28.6.2</span> Combined results of predicting validation test samples</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#predicting-unknown-outcomes"><span class="header-section-number">28.7</span> Predicting unknown outcomes</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#final-results"><span class="header-section-number">28.7.1</span> Final results</a></li>
<li><a class="nav-link" href="#predicted-outcome"><span class="header-section-number">28.7.2</span> Predicted outcome</a></li>
</ul>
</li>
<li><a class="nav-link" href="#conclusions-1"><span class="header-section-number">28.8</span> Conclusions</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/f0nzie/machine_learning_compilation/blob/master/305-algo-comparison_330-class_flu_outcome-sglander.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/f0nzie/machine_learning_compilation/edit/master/305-algo-comparison_330-class_flu_outcome-sglander.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Machine Learning Compilation</strong>" was written by Several authors. Compiled by Alfonso R. Reyes. It was last built on 2020-11-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
