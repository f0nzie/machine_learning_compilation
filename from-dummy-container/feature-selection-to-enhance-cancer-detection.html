<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 Feature Selection to enhance cancer detection | A Machine Learning Compilation</title>
<meta name="author" content="Several authors. Compiled by Alfonso R. Reyes">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Machine Learning Compilation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preface</a></li>
<li class="book-part">The Basics of Machine Learning</li>
<li><a class="" href="introduction-to-pca.html"><span class="header-section-number">2</span> Introduction to PCA</a></li>
<li><a class="" href="comparison-of-two-pca-packages.html"><span class="header-section-number">3</span> Comparison of two PCA packages</a></li>
<li><a class="" href="detailed-study-of-principal-component-analysis.html"><span class="header-section-number">4</span> Detailed study of Principal Component Analysis</a></li>
<li><a class="" href="detection-of-diabetes-using-logistic-regression.html"><span class="header-section-number">5</span> Detection of diabetes using Logistic Regression</a></li>
<li><a class="" href="sensitivity-analysis-for-a-neural-network.html"><span class="header-section-number">6</span> Sensitivity analysis for a neural network</a></li>
<li><a class="" href="data-visualization-for-ml-models.html"><span class="header-section-number">7</span> Data Visualization for ML models</a></li>
<li class="book-part">Feature Engineering</li>
<li><a class="" href="ten-methods-to-assess-variable-importance.html"><span class="header-section-number">8</span> Ten methods to assess Variable Importance</a></li>
<li><a class="" href="employee-attrition-using-feature-importance.html"><span class="header-section-number">9</span> Employee Attrition using Feature Importance</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="a-gentle-introduction-to-support-vector-machines.html"><span class="header-section-number">10</span> A gentle introduction to Support Vector Machines</a></li>
<li><a class="" href="broad-view-of-svm.html"><span class="header-section-number">11</span> Broad view of SVM</a></li>
<li><a class="active" href="feature-selection-to-enhance-cancer-detection.html"><span class="header-section-number">12</span> Feature Selection to enhance cancer detection</a></li>
<li><a class="" href="dealing-with-unbalanced-data.html"><span class="header-section-number">13</span> Dealing with unbalanced data</a></li>
<li><a class="" href="imputting-missing-values-with-random-forest.html"><span class="header-section-number">14</span> Imputting missing values with Random Forest</a></li>
<li><a class="" href="tuning-of-support-vector-machine-prediction.html"><span class="header-section-number">15</span> Tuning of Support Vector Machine prediction</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="introduction-to-algorithms-for-classification.html"><span class="header-section-number">16</span> Introduction to algorithms for Classification</a></li>
<li><a class="" href="comparing-classification-algorithms.html"><span class="header-section-number">17</span> Comparing Classification algorithms</a></li>
<li><a class="" href="who-buys-social-network-ads.html"><span class="header-section-number">18</span> Who buys Social Network ads</a></li>
<li><a class="" href="predicting-ozone-levels.html"><span class="header-section-number">19</span> Predicting Ozone levels</a></li>
<li><a class="" href="building-a-naive-bayes-classifier.html"><span class="header-section-number">20</span> Building a Naive Bayes Classifier</a></li>
<li><a class="" href="linear-and-non-linear-algorithms-for-classification.html"><span class="header-section-number">21</span> Linear and Non-Linear Algorithms for Classification</a></li>
<li><a class="" href="detect-mines-vs-rocks-with-random-forest.html"><span class="header-section-number">22</span> Detect mines vs rocks with Random Forest</a></li>
<li><a class="" href="predicting-the-type-of-glass.html"><span class="header-section-number">23</span> Predicting the type of glass</a></li>
<li><a class="" href="naive-bayes-for-sms-spam.html"><span class="header-section-number">24</span> Naive Bayes for SMS spam</a></li>
<li><a class="" href="vehicles-classiification-with-decision-trees.html"><span class="header-section-number">25</span> Vehicles classiification with Decision Trees</a></li>
<li><a class="" href="applying-naive-bayes-on-the-titanic-case.html"><span class="header-section-number">26</span> Applying Naive-Bayes on the Titanic case</a></li>
<li><a class="" href="classification-on-bad-loans.html"><span class="header-section-number">27</span> Classification on bad loans</a></li>
<li><a class="" href="predicting-flu-outcome-comparing-eight-classification-algorithms.html"><span class="header-section-number">28</span> Predicting Flu outcome comparing eight classification algorithms</a></li>
<li><a class="" href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></li>
<li><a class="" href="prediction-of-arrhythmia-with-deep-neural-nets.html"><span class="header-section-number">30</span> Prediction of arrhythmia with deep neural nets</a></li>
<li class="book-part">Linear Regression</li>
<li><a class="" href="linear-regression-with-islr.html"><span class="header-section-number">31</span> Linear Regression with ISLR</a></li>
<li><a class="" href="evaluation-of-three-linear-regression-models.html"><span class="header-section-number">32</span> Evaluation of three linear regression models</a></li>
<li><a class="" href="comparison-of-six-linear-regression-algorithms.html"><span class="header-section-number">33</span> Comparison of six Linear Regression algorithms</a></li>
<li><a class="" href="comparing-regression-models.html"><span class="header-section-number">34</span> Comparing regression models</a></li>
<li><a class="" href="finding-the-factors-of-happiness.html"><span class="header-section-number">35</span> Finding the factors of happiness</a></li>
<li><a class="" href="regression-with-a-neural-network.html"><span class="header-section-number">36</span> Regression with a neural network</a></li>
<li><a class="" href="comparing-multiple-regression-vs-a-neural-network.html"><span class="header-section-number">37</span> Comparing Multiple Regression vs a Neural Network</a></li>
<li><a class="" href="temperature-modeling-using-nested-dataframes.html"><span class="header-section-number">38</span> Temperature modeling using nested dataframes</a></li>
<li class="book-part">Neural Networks</li>
<li><a class="" href="credit-scoring-with-neuralnet.html"><span class="header-section-number">39</span> Credit Scoring with neuralnet</a></li>
<li><a class="" href="wine-classification-with-neuralnet.html"><span class="header-section-number">40</span> Wine classification with neuralnet</a></li>
<li><a class="" href="predicting-the-rating-of-cereals.html"><span class="header-section-number">41</span> Predicting the rating of cereals</a></li>
<li><a class="" href="fitting-a-linear-model-with-neural-networks.html"><span class="header-section-number">42</span> Fitting a linear model with neural networks</a></li>
<li><a class="" href="visualization-of-neural-networks.html"><span class="header-section-number">43</span> Visualization of neural networks</a></li>
<li><a class="" href="build-a-fully-connected-r-neural-network-from-scratch.html"><span class="header-section-number">44</span> Build a fully connected R neural network from scratch</a></li>
<li><a class="" href="tuning-hyperparameters-in-a-neural-network.html"><span class="header-section-number">45</span> Tuning Hyperparameters in a Neural Network</a></li>
<li><a class="" href="deep-learning-tips-for-classification-and-regression.html"><span class="header-section-number">46</span> Deep Learning tips for Classification and Regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="what-is-dot-hat-in-a-regression-output.html"><span class="header-section-number">A</span> What is dot hat in a regression output</a></li>
<li><a class="" href="q-q-normal-to-compare-data-to-distributions.html"><span class="header-section-number">B</span> Q-Q normal to compare data to distributions</a></li>
<li><a class="" href="qq-and-pp-plots.html"><span class="header-section-number">C</span> QQ and PP Plots</a></li>
<li><a class="" href="visualizing-residuals.html"><span class="header-section-number">D</span> Visualizing residuals</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/f0nzie/machine_learning_compilation">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="feature-selection-to-enhance-cancer-detection" class="section level1">
<h1>
<span class="header-section-number">12</span> Feature Selection to enhance cancer detection<a class="anchor" aria-label="anchor" href="#feature-selection-to-enhance-cancer-detection"><i class="fas fa-link"></i></a>
</h1>
<ul>
<li>Datasets: <code>breast-cancer-wisconsin.data</code>
</li>
<li>Algorithms:
<ul>
<li>PCA</li>
<li>Random Forest</li>
<li>Recursive Feature Elimination</li>
<li>Genetic Algorithm</li>
</ul>
</li>
</ul>
<p>Source: <a href="https://shiring.github.io/machine_learning/2017/01/15/rfe_ga_post" class="uri">https://shiring.github.io/machine_learning/2017/01/15/rfe_ga_post</a></p>
<div id="read-and-process-the-data" class="section level2">
<h2>
<span class="header-section-number">12.1</span> Read and process the data<a class="anchor" aria-label="anchor" href="#read-and-process-the-data"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">data_raw_dir</span>, <span class="st">"breast-cancer-wisconsin.data"</span><span class="op">)</span>, 
                      header <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># assign the column names</span>
<span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sample_code_number"</span>, <span class="st">"clump_thickness"</span>, 
                       <span class="st">"uniformity_of_cell_size"</span>, <span class="st">"uniformity_of_cell_shape"</span>,
                       <span class="st">"marginal_adhesion"</span>, <span class="st">"single_epithelial_cell_size"</span>, 
                       <span class="st">"bare_nuclei"</span>, <span class="st">"bland_chromatin"</span>, <span class="st">"normal_nucleoli"</span>, 
                       <span class="st">"mitosis"</span>, <span class="st">"classes"</span><span class="op">)</span>

<span class="co"># change classes from numeric to character</span>
<span class="va">bc_data</span><span class="op">$</span><span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">$</span><span class="va">classes</span> <span class="op">==</span> <span class="st">"2"</span>, <span class="st">"benign"</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">$</span><span class="va">classes</span> <span class="op">==</span> <span class="st">"4"</span>, <span class="st">"malignant"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="co"># if query sign make NA</span>
<span class="va">bc_data</span><span class="op">[</span><span class="va">bc_data</span> <span class="op">==</span> <span class="st">"?"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>

<span class="co"># how many NAs are in the data</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 16</span></code></pre></div>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">)</span>
<span class="co">#&gt;  [1] "sample_code_number"          "clump_thickness"            </span>
<span class="co">#&gt;  [3] "uniformity_of_cell_size"     "uniformity_of_cell_shape"   </span>
<span class="co">#&gt;  [5] "marginal_adhesion"           "single_epithelial_cell_size"</span>
<span class="co">#&gt;  [7] "bare_nuclei"                 "bland_chromatin"            </span>
<span class="co">#&gt;  [9] "normal_nucleoli"             "mitosis"                    </span>
<span class="co">#&gt; [11] "classes"</span></code></pre></div>
<div id="missing-data" class="section level3">
<h3>
<span class="header-section-number">12.1.1</span> Missing data<a class="anchor" aria-label="anchor" href="#missing-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># impute missing data</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stefvanbuuren/mice">mice</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'mice'</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     cbind, rbind</span>

<span class="co"># skip these columns: sample_code_number and classes</span>
<span class="co"># convert to numeric</span>
<span class="va">bc_data</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/apply.html">apply</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># impute but mute</span>
<span class="va">dataset_impute</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mice/man/mice.html">mice</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,  print <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># bind "classes" with the rest. skip "sample_code_number"</span>
<span class="va">bc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mice/man/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">[</span>, <span class="fl">11</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, 
                 <span class="fu">mice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mice/man/complete.mids.html">complete</a></span><span class="op">(</span><span class="va">dataset_impute</span>, action <span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">bc_data</span><span class="op">$</span><span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span>

<span class="co"># how many benign and malignant cases are there?</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span>
<span class="co">#&gt;    benign malignant </span>
<span class="co">#&gt;       458       241</span></code></pre></div>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># confirm NAs have been removed</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span></code></pre></div>
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    699 obs. of  10 variables:</span>
<span class="co">#&gt;  $ classes                    : Factor w/ 2 levels "benign","malignant": 1 1 1 1 1 2 1 1 1 1 ...</span>
<span class="co">#&gt;  $ clump_thickness            : num  5 5 3 6 4 8 1 2 2 4 ...</span>
<span class="co">#&gt;  $ uniformity_of_cell_size    : num  1 4 1 8 1 10 1 1 1 2 ...</span>
<span class="co">#&gt;  $ uniformity_of_cell_shape   : num  1 4 1 8 1 10 1 2 1 1 ...</span>
<span class="co">#&gt;  $ marginal_adhesion          : num  1 5 1 1 3 8 1 1 1 1 ...</span>
<span class="co">#&gt;  $ single_epithelial_cell_size: num  2 7 2 3 2 7 2 2 2 2 ...</span>
<span class="co">#&gt;  $ bare_nuclei                : num  1 10 2 4 1 10 10 1 1 1 ...</span>
<span class="co">#&gt;  $ bland_chromatin            : num  3 3 3 3 3 9 3 3 1 2 ...</span>
<span class="co">#&gt;  $ normal_nucleoli            : num  1 2 1 7 1 7 1 1 1 1 ...</span>
<span class="co">#&gt;  $ mitosis                    : num  1 1 1 1 1 1 1 1 5 1 ...</span></code></pre></div>
</div>
</div>
<div id="principal-component-analysis-pca" class="section level2">
<h2>
<span class="header-section-number">12.2</span> Principal Component Analysis (PCA)<a class="anchor" aria-label="anchor" href="#principal-component-analysis-pca"><i class="fas fa-link"></i></a>
</h2>
<p>To get an idea about the dimensionality and variance of the datasets, I am first looking at PCA plots for samples and features. The first two principal components (PCs) show the two components that explain the majority of variation in the data.</p>
<p>After defining my custom <code>ggplot2</code> theme, I am creating a function that performs the PCA (using the <code>pcaGoPromoter</code> package), calculates ellipses of the data points (with the <code>ellipse</code> package) and produces the plot with <code>ggplot2</code>. Some of the features in datasets 2 and 3 are not very distinct and overlap in the PCA plots, therefore I am also plotting hierarchical clustering dendrograms.</p>
<div id="theme" class="section level4">
<h4>
<span class="header-section-number">12.2.0.1</span> theme<a class="anchor" aria-label="anchor" href="#theme"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plotting theme</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="va">my_theme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">base_size</span> <span class="op">=</span> <span class="fl">12</span>, <span class="va">base_family</span> <span class="op">=</span> <span class="st">"sans"</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_size</span>, base_family <span class="op">=</span> <span class="va">base_family</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,
    panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,
    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"aliceblue"</span><span class="op">)</span>,
    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"navy"</span>, color <span class="op">=</span> <span class="st">"navy"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">12</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"right"</span>,
    legend.justification <span class="op">=</span> <span class="st">"top"</span>, 
    legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, fill <span class="op">=</span> <span class="cn">NA</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="pca-function" class="section level4">
<h4>
<span class="header-section-number">12.2.0.2</span> PCA function<a class="anchor" aria-label="anchor" href="#pca-function"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># function for PCA plotting</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">pcaGoPromoter</span><span class="op">)</span>                  <span class="co"># install from BioConductor</span>
<span class="co">#&gt; Loading required package: ellipse</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ellipse'</span>
<span class="co">#&gt; The following object is masked from 'package:graphics':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     pairs</span>
<span class="co">#&gt; Loading required package: Biostrings</span>
<span class="co">#&gt; Loading required package: BiocGenerics</span>
<span class="co">#&gt; Loading required package: parallel</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'BiocGenerics'</span>
<span class="co">#&gt; The following objects are masked from 'package:parallel':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,</span>
<span class="co">#&gt;     clusterExport, clusterMap, parApply, parCapply, parLapply,</span>
<span class="co">#&gt;     parLapplyLB, parRapply, parSapply, parSapplyLB</span>
<span class="co">#&gt; The following objects are masked from 'package:mice':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     cbind, rbind</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     IQR, mad, sd, var, xtabs</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     anyDuplicated, append, as.data.frame, basename, cbind, colnames,</span>
<span class="co">#&gt;     dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,</span>
<span class="co">#&gt;     grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,</span>
<span class="co">#&gt;     order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,</span>
<span class="co">#&gt;     rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,</span>
<span class="co">#&gt;     union, unique, unsplit, which, which.max, which.min</span>
<span class="co">#&gt; Loading required package: S4Vectors</span>
<span class="co">#&gt; Loading required package: stats4</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'S4Vectors'</span>
<span class="co">#&gt; The following object is masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     expand.grid</span>
<span class="co">#&gt; Loading required package: IRanges</span>
<span class="co">#&gt; Loading required package: XVector</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'Biostrings'</span>
<span class="co">#&gt; The following object is masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     strsplit</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ellipse</span><span class="op">)</span>

<span class="va">pca_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">groups</span>, <span class="va">title</span>, <span class="va">print_ellipse</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co"># perform pca and extract scores for all principal components: PC1:PC9</span>
  <span class="va">pcaOutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pcaGoPromoter/man/pca.html">pca</a></span><span class="op">(</span><span class="va">data</span>, printDropped <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">pcaOutput2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">pcaOutput</span><span class="op">$</span><span class="va">scores</span><span class="op">)</span>
  
  <span class="co"># define groups for plotting. will group the classes</span>
  <span class="va">pcaOutput2</span><span class="op">$</span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="va">groups</span>
  
  <span class="co"># when plotting samples calculate ellipses for plotting </span>
  <span class="co"># (when plotting features, there are no replicates)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">print_ellipse</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># group and summarize by classes: benign, malignant</span>
    <span class="co"># centroids w/3 columns: groups, PC1, PC2</span>
    <span class="va">centroids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mice/man/cbind.html">cbind</a></span><span class="op">(</span><span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span> <span class="op">~</span> <span class="va">groups</span>, <span class="va">pcaOutput2</span>, <span class="va">mean</span><span class="op">)</span>
    <span class="co"># bind for the two groups (classes)</span>
    <span class="co"># conf.rgn w/3 columns: groups, PC1, PC2</span>
    <span class="va">conf.rgn</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">pcaOutput2</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>,
                 <span class="co"># ellipse data for PC1 and PC2</span>
                 <span class="fu"><a href="https://rdrr.io/pkg/ellipse/man/ellipse.html">ellipse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">pcaOutput2</span><span class="op">[</span><span class="va">pcaOutput2</span><span class="op">$</span><span class="va">groups</span> <span class="op">==</span> <span class="va">t</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,
                       centre <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">centroids</span><span class="op">[</span><span class="va">centroids</span><span class="op">$</span><span class="va">groups</span> <span class="op">==</span> <span class="va">t</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,
                       level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span>,
                 stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    
    <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pcaOutput2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, 
                                          group <span class="op">=</span> <span class="va">groups</span>, 
                                          color <span class="op">=</span> <span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">conf.rgn</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">groups</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="co"># ellipses</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">title</span>,
           color <span class="op">=</span> <span class="st">""</span>,
           fill <span class="op">=</span> <span class="st">""</span>,
           x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC1: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.round.html">round</a></span><span class="op">(</span><span class="va">pcaOutput</span><span class="op">$</span><span class="va">pov</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, 
                      <span class="st">"% variance"</span><span class="op">)</span>,
           y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC2: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.round.html">round</a></span><span class="op">(</span><span class="va">pcaOutput</span><span class="op">$</span><span class="va">pov</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, 
                      <span class="st">"% variance"</span><span class="op">)</span><span class="op">)</span>
    
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    
    <span class="co"># if &lt; 10 groups (e.g. the predictor classes) have colors from RColorBrewer</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">pcaOutput2</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
      
      <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pcaOutput2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, 
                                            group <span class="op">=</span> <span class="va">groups</span>, 
                                            color <span class="op">=</span> <span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span> 
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">title</span>,
             color <span class="op">=</span> <span class="st">""</span>,
             fill <span class="op">=</span> <span class="st">""</span>,
             x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC1: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.round.html">round</a></span><span class="op">(</span><span class="va">pcaOutput</span><span class="op">$</span><span class="va">pov</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, 
                        <span class="st">"% variance"</span><span class="op">)</span>,
             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC2: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.round.html">round</a></span><span class="op">(</span><span class="va">pcaOutput</span><span class="op">$</span><span class="va">pov</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, 
                        <span class="st">"% variance"</span><span class="op">)</span><span class="op">)</span>
      
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
      <span class="co"># otherwise use the default rainbow colors</span>
      <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pcaOutput2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, 
                                            group <span class="op">=</span> <span class="va">groups</span>, color <span class="op">=</span> <span class="va">groups</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span> 
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">title</span>,
             color <span class="op">=</span> <span class="st">""</span>,
             fill <span class="op">=</span> <span class="st">""</span>,
             x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC1: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.round.html">round</a></span><span class="op">(</span><span class="va">pcaOutput</span><span class="op">$</span><span class="va">pov</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, 
                        <span class="st">"% variance"</span><span class="op">)</span>,
             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"PC2: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.round.html">round</a></span><span class="op">(</span><span class="va">pcaOutput</span><span class="op">$</span><span class="va">pov</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, 
                        <span class="st">"% variance"</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
  
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'gridExtra'</span>
<span class="co">#&gt; The following object is masked from 'package:BiocGenerics':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     combine</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>

<span class="co"># plot all data. one row is a feature</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">pca_func</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span>, 
               groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span>, 
               title <span class="op">=</span> <span class="st">"Breast cancer dataset 1: Samples"</span><span class="op">)</span>

<span class="co"># plot features only. features as columns</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">pca_func</span><span class="op">(</span>data <span class="op">=</span> <span class="va">bc_data</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, 
               groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, 
               title <span class="op">=</span> <span class="st">"Breast cancer dataset 1: Features"</span>, print_ellipse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="105-classification_229-breast_cancer-sglander_files/figure-html/plot-pca-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/dist.html">dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"complete"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">h_1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="105-classification_229-breast_cancer-sglander_files/figure-html/plot-dendrogram-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="density-plots-vs-class" class="section level3">
<h3>
<span class="header-section-number">12.2.1</span> density plots vs class<a class="anchor" aria-label="anchor" href="#density-plots-vs-class"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># density plot showing the feature vs classes</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'tidyr'</span>
<span class="co">#&gt; The following object is masked from 'package:S4Vectors':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     expand</span>

<span class="co"># gather data. from column clump_thickness to mitosis</span>
<span class="va">bc_data_gather</span> <span class="op">&lt;-</span> <span class="va">bc_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">measure</span>, <span class="va">value</span>, <span class="va">clump_thickness</span><span class="op">:</span><span class="va">mitosis</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bc_data_gather</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">classes</span>, color <span class="op">=</span> <span class="va">classes</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">measure</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="105-classification_229-breast_cancer-sglander_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="feature-importance" class="section level2">
<h2>
<span class="header-section-number">12.3</span> Feature importance<a class="anchor" aria-label="anchor" href="#feature-importance"><i class="fas fa-link"></i></a>
</h2>
<p>To get an idea about the feature’s respective importances, I’m running Random Forest models with 10 x 10 cross validation using the <code>caret</code> package. If I wanted to use feature importance to select features for modeling, I would need to perform it on the training data instead of on the complete dataset. But here, I only want to use it to get acquainted with my data. I am again defining a function that estimates the feature importance and produces a plot.</p>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: lattice</span>
<span class="co"># library(doParallel) # parallel processing</span>
<span class="co"># registerDoParallel()</span>

<span class="co"># prepare training scheme</span>
<span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"repeatedcv"</span>, number <span class="op">=</span> <span class="fl">10</span>, repeats <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">feature_imp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">title</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># estimate variable importance</span>
  <span class="va">importance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html">varImp</a></span><span class="op">(</span><span class="va">model</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="co"># prepare dataframes for plotting</span>
  <span class="va">importance_df_1</span> <span class="op">&lt;-</span> <span class="va">importance</span><span class="op">$</span><span class="va">importance</span>
  <span class="va">importance_df_1</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">importance_df_1</span><span class="op">)</span>
  
  <span class="va">importance_df_2</span> <span class="op">&lt;-</span> <span class="va">importance_df_1</span>
  <span class="va">importance_df_2</span><span class="op">$</span><span class="va">Overall</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="va">importance_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mice/man/cbind.html">rbind</a></span><span class="op">(</span><span class="va">importance_df_1</span>, <span class="va">importance_df_2</span><span class="op">)</span>
  
  <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">importance_df_1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Overall</span>, 
                                           y <span class="op">=</span> <span class="va">group</span>, 
                                           color <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">importance_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Overall</span>, 
                                        y <span class="op">=</span> <span class="va">group</span>, 
                                        color <span class="op">=</span> <span class="va">group</span>, 
                                        group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="st">"Importance"</span>,
      y <span class="op">=</span> <span class="st">""</span>,
      title <span class="op">=</span> <span class="va">title</span>,
      subtitle <span class="op">=</span> <span class="st">"Scaled feature importance"</span>,
      caption <span class="op">=</span> <span class="st">"\nDetermined with Random Forest and
      repeated cross validation (10 repeats, 10 times)"</span>
    <span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># train the model</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">imp_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">classes</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">bc_data</span>, method <span class="op">=</span> <span class="st">"rf"</span>, 
               preProcess <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scale"</span>, <span class="st">"center"</span><span class="op">)</span>, 
               trControl <span class="op">=</span> <span class="va">control</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">feature_imp</span><span class="op">(</span><span class="va">imp_1</span>, title <span class="op">=</span> <span class="st">"Breast cancer dataset 1"</span><span class="op">)</span>
<span class="va">p1</span></code></pre></div>
<div class="inline-figure"><img src="105-classification_229-breast_cancer-sglander_files/figure-html/plot-featureImportance-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="feature-selection" class="section level2">
<h2>
<span class="header-section-number">12.4</span> Feature Selection<a class="anchor" aria-label="anchor" href="#feature-selection"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>By correlation</li>
<li>By Recursive Feature Elimination</li>
<li>By Genetic Algorithm</li>
</ol>
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">bc_data_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span><span class="va">bc_data</span><span class="op">$</span><span class="va">classes</span>, p <span class="op">=</span> <span class="fl">0.7</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">bc_data_train</span> <span class="op">&lt;-</span> <span class="va">bc_data</span><span class="op">[</span><span class="va">bc_data_index</span>, <span class="op">]</span>
<span class="va">bc_data_test</span>  <span class="op">&lt;-</span> <span class="va">bc_data</span><span class="op">[</span><span class="op">-</span><span class="va">bc_data_index</span>, <span class="op">]</span></code></pre></div>
<div id="correlation" class="section level3">
<h3>
<span class="header-section-number">12.4.1</span> Correlation<a class="anchor" aria-label="anchor" href="#correlation"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot">corrplot</a></span><span class="op">)</span>
<span class="co">#&gt; corrplot 0.84 loaded</span>

<span class="co"># calculate correlation matrix</span>
<span class="va">corMatMy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.cor.html">cor</a></span><span class="op">(</span><span class="va">bc_data_train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span><span class="op">(</span><span class="va">corMatMy</span>, order <span class="op">=</span> <span class="st">"hclust"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="105-classification_229-breast_cancer-sglander_files/figure-html/plot-correlation-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Apply correlation filter at 0.70,</span>
<span class="va">highlyCor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bc_data_train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/findCorrelation.html">findCorrelation</a></span><span class="op">(</span><span class="va">corMatMy</span>, 
                                                           cutoff <span class="op">=</span> <span class="fl">0.7</span>, 
                                                           verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt; Compare row 2  and column  3 with corr  0.9 </span>
<span class="co">#&gt;   Means:  0.709 vs 0.595 so flagging column 2 </span>
<span class="co">#&gt; Compare row 3  and column  7 with corr  0.737 </span>
<span class="co">#&gt;   Means:  0.674 vs 0.572 so flagging column 3 </span>
<span class="co">#&gt; All correlations &lt;= 0.7</span></code></pre></div>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># which variables are flagged for removal?</span>
<span class="va">highlyCor</span>
<span class="co">#&gt; [1] "uniformity_of_cell_size"  "uniformity_of_cell_shape"</span></code></pre></div>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># then we remove these variables</span>
<span class="va">bc_data_cor</span> <span class="op">&lt;-</span> <span class="va">bc_data_train</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bc_data_train</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">highlyCor</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bc_data_cor</span><span class="op">)</span>
<span class="co">#&gt; [1] "classes"                     "clump_thickness"            </span>
<span class="co">#&gt; [3] "marginal_adhesion"           "single_epithelial_cell_size"</span>
<span class="co">#&gt; [5] "bare_nuclei"                 "bland_chromatin"            </span>
<span class="co">#&gt; [7] "normal_nucleoli"             "mitosis"</span></code></pre></div>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># confirm features were removed</span>
<span class="va">outersect</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>,
         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
 
<span class="fu">outersect</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bc_data_cor</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bc_data_train</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "uniformity_of_cell_shape" "uniformity_of_cell_size"</span></code></pre></div>
<blockquote>
<p>Four features removed</p>
</blockquote>
</div>
<div id="recursive-feature-elimination-rfe-1" class="section level3">
<h3>
<span class="header-section-number">12.4.2</span> Recursive Feature Elimination (RFE)<a class="anchor" aria-label="anchor" href="#recursive-feature-elimination-rfe-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ensure the results are repeatable</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span>

<span class="co"># define the control using a random forest selection function with cross validation</span>
<span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/rfeControl.html">rfeControl</a></span><span class="op">(</span>functions <span class="op">=</span> <span class="va">rfFuncs</span>, method <span class="op">=</span> <span class="st">"cv"</span>, number <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># run the RFE algorithm</span>
<span class="va">results_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/rfe.html">rfe</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bc_data_train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, 
                 y <span class="op">=</span> <span class="va">bc_data_train</span><span class="op">$</span><span class="va">classes</span>, 
                 sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>, 
                 rfeControl <span class="op">=</span> <span class="va">control</span><span class="op">)</span>

<span class="co"># chosen features</span>
<span class="fu"><a href="https://rdrr.io/pkg/caret/man/predictors.html">predictors</a></span><span class="op">(</span><span class="va">results_1</span><span class="op">)</span>
<span class="co">#&gt; [1] "bare_nuclei"                 "clump_thickness"            </span>
<span class="co">#&gt; [3] "normal_nucleoli"             "uniformity_of_cell_size"    </span>
<span class="co">#&gt; [5] "uniformity_of_cell_shape"    "single_epithelial_cell_size"</span>
<span class="co">#&gt; [7] "bland_chromatin"             "marginal_adhesion"</span></code></pre></div>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># subset the chosen features</span>
<span class="va">sel_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bc_data_train</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/predictors.html">predictors</a></span><span class="op">(</span><span class="va">results_1</span><span class="op">)</span><span class="op">)</span>
<span class="va">bc_data_rfe</span> <span class="op">&lt;-</span> <span class="va">bc_data_train</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">sel_cols</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bc_data_rfe</span><span class="op">)</span>
<span class="co">#&gt; [1] "classes"                     "clump_thickness"            </span>
<span class="co">#&gt; [3] "uniformity_of_cell_size"     "uniformity_of_cell_shape"   </span>
<span class="co">#&gt; [5] "marginal_adhesion"           "single_epithelial_cell_size"</span>
<span class="co">#&gt; [7] "bare_nuclei"                 "bland_chromatin"            </span>
<span class="co">#&gt; [9] "normal_nucleoli"</span></code></pre></div>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># confirm features removed by RFE</span>
<span class="fu">outersect</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bc_data_rfe</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bc_data_train</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "mitosis"</span></code></pre></div>
<blockquote>
<p>No features removed with RFE</p>
</blockquote>
</div>
<div id="genetic-algorithm-ga" class="section level3">
<h3>
<span class="header-section-number">12.4.3</span> Genetic Algorithm (GA)<a class="anchor" aria-label="anchor" href="#genetic-algorithm-ga"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following object is masked from 'package:gridExtra':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     combine</span>
<span class="co">#&gt; The following objects are masked from 'package:Biostrings':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     collapse, intersect, setdiff, setequal, union</span>
<span class="co">#&gt; The following object is masked from 'package:XVector':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     slice</span>
<span class="co">#&gt; The following objects are masked from 'package:IRanges':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     collapse, desc, intersect, setdiff, slice, union</span>
<span class="co">#&gt; The following objects are masked from 'package:S4Vectors':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     first, intersect, rename, setdiff, setequal, union</span>
<span class="co">#&gt; The following objects are masked from 'package:BiocGenerics':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     combine, intersect, setdiff, union</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>

<span class="va">ga_ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/safsControl.html">gafsControl</a></span><span class="op">(</span>functions <span class="op">=</span> <span class="va">rfGA</span>, <span class="co"># Assess fitness with RF</span>
                       method <span class="op">=</span> <span class="st">"cv"</span>,    <span class="co"># 10 fold cross validation</span>
                       genParallel <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Use parallel programming</span>
                       allowParallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">lev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"malignant"</span>, <span class="st">"benign"</span><span class="op">)</span>     <span class="co"># Set the levels</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/gafs.default.html">gafs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bc_data_train</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">bc_data_train</span><span class="op">$</span><span class="va">classes</span>,
                   iters <span class="op">=</span> <span class="fl">10</span>, <span class="co"># generations of algorithm</span>
                   popSize <span class="op">=</span> <span class="fl">5</span>, <span class="co"># population size for each generation</span>
                   levels <span class="op">=</span> <span class="va">lev</span>,
                   gafsControl <span class="op">=</span> <span class="va">ga_ctrl</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'recipes'</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     step</span></code></pre></div>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">model_1</span><span class="op">)</span> <span class="co"># Plot mean fitness (AUC) by generation</span></code></pre></div>
<div class="inline-figure"><img src="105-classification_229-breast_cancer-sglander_files/figure-html/plot-auc-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># features</span>
<span class="va">model_1</span><span class="op">$</span><span class="va">ga</span><span class="op">$</span><span class="va">final</span>
<span class="co">#&gt; [1] "clump_thickness"          "uniformity_of_cell_size" </span>
<span class="co">#&gt; [3] "uniformity_of_cell_shape" "marginal_adhesion"       </span>
<span class="co">#&gt; [5] "bare_nuclei"              "bland_chromatin"         </span>
<span class="co">#&gt; [7] "normal_nucleoli"</span></code></pre></div>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># select features</span>
<span class="va">sel_cols_ga</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bc_data_train</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">model_1</span><span class="op">$</span><span class="va">ga</span><span class="op">$</span><span class="va">final</span><span class="op">)</span>
<span class="va">bc_data_ga</span> <span class="op">&lt;-</span> <span class="va">bc_data_train</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">sel_cols_ga</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bc_data_ga</span><span class="op">)</span>
<span class="co">#&gt; [1] "classes"                  "clump_thickness"         </span>
<span class="co">#&gt; [3] "uniformity_of_cell_size"  "uniformity_of_cell_shape"</span>
<span class="co">#&gt; [5] "marginal_adhesion"        "bare_nuclei"             </span>
<span class="co">#&gt; [7] "bland_chromatin"          "normal_nucleoli"</span></code></pre></div>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># features removed GA</span>
<span class="fu">outersect</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bc_data_ga</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bc_data_train</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "mitosis"                     "single_epithelial_cell_size"</span></code></pre></div>
<blockquote>
<p>Two features removed with GA.</p>
</blockquote>
</div>
</div>
<div id="model-comparison" class="section level2">
<h2>
<span class="header-section-number">12.5</span> Model comparison<a class="anchor" aria-label="anchor" href="#model-comparison"><i class="fas fa-link"></i></a>
</h2>
<div id="using-all-features" class="section level3">
<h3>
<span class="header-section-number">12.5.1</span> Using all features<a class="anchor" aria-label="anchor" href="#using-all-features"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">27</span><span class="op">)</span>
<span class="va">model_bc_data_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">classes</span> <span class="op">~</span> <span class="va">.</span>,
                           data <span class="op">=</span> <span class="va">bc_data_train</span>,
                           method <span class="op">=</span> <span class="st">"rf"</span>,
                           preProcess <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scale"</span>, <span class="st">"center"</span><span class="op">)</span>,
                           trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"repeatedcv"</span>, 
                                                    number <span class="op">=</span> <span class="fl">5</span>, repeats <span class="op">=</span> <span class="fl">10</span>,
                                                    verboseIter <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># confusion matrix </span>
<span class="va">cm_all_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_bc_data_all</span>, <span class="va">bc_data_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">bc_data_test</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span>
<span class="va">cm_all_1</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;            Reference</span>
<span class="co">#&gt; Prediction  benign malignant</span>
<span class="co">#&gt;   benign       131         2</span>
<span class="co">#&gt;   malignant      6        70</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.962         </span>
<span class="co">#&gt;                  95% CI : (0.926, 0.983)</span>
<span class="co">#&gt;     No Information Rate : 0.656         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : &lt;2e-16        </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : 0.916         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 0.289         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.956         </span>
<span class="co">#&gt;             Specificity : 0.972         </span>
<span class="co">#&gt;          Pos Pred Value : 0.985         </span>
<span class="co">#&gt;          Neg Pred Value : 0.921         </span>
<span class="co">#&gt;              Prevalence : 0.656         </span>
<span class="co">#&gt;          Detection Rate : 0.627         </span>
<span class="co">#&gt;    Detection Prevalence : 0.636         </span>
<span class="co">#&gt;       Balanced Accuracy : 0.964         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : benign        </span>
<span class="co">#&gt; </span></code></pre></div>
</div>
<div id="compare-selection-methods" class="section level3">
<h3>
<span class="header-section-number">12.5.2</span> Compare selection methods<a class="anchor" aria-label="anchor" href="#compare-selection-methods"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compare features selected by the three methods</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/talgalili/gplots">gplots</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'gplots'</span>
<span class="co">#&gt; The following object is masked from 'package:IRanges':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     space</span>
<span class="co">#&gt; The following object is masked from 'package:S4Vectors':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     space</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     lowess</span>

<span class="va">venn_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>cor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bc_data_cor</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,
                  rfe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bc_data_rfe</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,
                  ga  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bc_data_ga</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>

<span class="va">venn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gplots/man/venn.html">venn</a></span><span class="op">(</span><span class="va">venn_list</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="105-classification_229-breast_cancer-sglander_files/figure-html/unnamed-chunk-19-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">venn</span>
<span class="co">#&gt;     num cor rfe ga</span>
<span class="co">#&gt; 000   0   0   0  0</span>
<span class="co">#&gt; 001   0   0   0  1</span>
<span class="co">#&gt; 010   0   0   1  0</span>
<span class="co">#&gt; 011   2   0   1  1</span>
<span class="co">#&gt; 100   1   1   0  0</span>
<span class="co">#&gt; 101   0   1   0  1</span>
<span class="co">#&gt; 110   1   1   1  0</span>
<span class="co">#&gt; 111   5   1   1  1</span>
<span class="co">#&gt; attr(,"intersections")</span>
<span class="co">#&gt; attr(,"intersections")$`cor:rfe:ga`</span>
<span class="co">#&gt; [1] "clump_thickness"   "marginal_adhesion" "bare_nuclei"      </span>
<span class="co">#&gt; [4] "bland_chromatin"   "normal_nucleoli"  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"intersections")$cor</span>
<span class="co">#&gt; [1] "mitosis"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"intersections")$`rfe:ga`</span>
<span class="co">#&gt; [1] "uniformity_of_cell_size"  "uniformity_of_cell_shape"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"intersections")$`cor:rfe`</span>
<span class="co">#&gt; [1] "single_epithelial_cell_size"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "venn"</span></code></pre></div>
<blockquote>
<p>4 out of 10 features were chosen by all three methods; the biggest overlap is seen between GA and RFE with 7 features. RFE and GA both retained 8 features for modeling, compared to only 5 based on the correlation method.</p>
</blockquote>
</div>
<div id="correlation-1" class="section level3">
<h3>
<span class="header-section-number">12.5.3</span> Correlation<a class="anchor" aria-label="anchor" href="#correlation-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># correlation</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">127</span><span class="op">)</span>
<span class="va">model_bc_data_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">classes</span> <span class="op">~</span> <span class="va">.</span>,
                 data <span class="op">=</span> <span class="va">bc_data_cor</span>,
                 method <span class="op">=</span> <span class="st">"rf"</span>,
                 preProcess <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scale"</span>, <span class="st">"center"</span><span class="op">)</span>,
                 trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"repeatedcv"</span>, number <span class="op">=</span> <span class="fl">5</span>, repeats <span class="op">=</span> <span class="fl">10</span>, verboseIter <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cm_cor_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_bc_data_cor</span>, <span class="va">bc_data_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">bc_data_test</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span>
<span class="va">cm_cor_1</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;            Reference</span>
<span class="co">#&gt; Prediction  benign malignant</span>
<span class="co">#&gt;   benign       130         4</span>
<span class="co">#&gt;   malignant      7        68</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.947         </span>
<span class="co">#&gt;                  95% CI : (0.908, 0.973)</span>
<span class="co">#&gt;     No Information Rate : 0.656         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : &lt;2e-16        </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : 0.885         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 0.546         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.949         </span>
<span class="co">#&gt;             Specificity : 0.944         </span>
<span class="co">#&gt;          Pos Pred Value : 0.970         </span>
<span class="co">#&gt;          Neg Pred Value : 0.907         </span>
<span class="co">#&gt;              Prevalence : 0.656         </span>
<span class="co">#&gt;          Detection Rate : 0.622         </span>
<span class="co">#&gt;    Detection Prevalence : 0.641         </span>
<span class="co">#&gt;       Balanced Accuracy : 0.947         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : benign        </span>
<span class="co">#&gt; </span></code></pre></div>
</div>
<div id="recursive-feature-elimination" class="section level3">
<h3>
<span class="header-section-number">12.5.4</span> Recursive Feature Elimination<a class="anchor" aria-label="anchor" href="#recursive-feature-elimination"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">127</span><span class="op">)</span>
<span class="va">model_bc_data_rfe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">classes</span> <span class="op">~</span> <span class="va">.</span>,
                           data <span class="op">=</span> <span class="va">bc_data_rfe</span>,
                           method <span class="op">=</span> <span class="st">"rf"</span>,
                           preProcess <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scale"</span>, <span class="st">"center"</span><span class="op">)</span>,
                           trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"repeatedcv"</span>, 
                                                    number <span class="op">=</span> <span class="fl">5</span>, repeats <span class="op">=</span> <span class="fl">10</span>, 
                                                    verboseIter <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cm_rfe_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_bc_data_rfe</span>, <span class="va">bc_data_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">bc_data_test</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span>
<span class="va">cm_rfe_1</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;            Reference</span>
<span class="co">#&gt; Prediction  benign malignant</span>
<span class="co">#&gt;   benign       130         3</span>
<span class="co">#&gt;   malignant      7        69</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.952         </span>
<span class="co">#&gt;                  95% CI : (0.914, 0.977)</span>
<span class="co">#&gt;     No Information Rate : 0.656         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : &lt;2e-16        </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : 0.895         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 0.343         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.949         </span>
<span class="co">#&gt;             Specificity : 0.958         </span>
<span class="co">#&gt;          Pos Pred Value : 0.977         </span>
<span class="co">#&gt;          Neg Pred Value : 0.908         </span>
<span class="co">#&gt;              Prevalence : 0.656         </span>
<span class="co">#&gt;          Detection Rate : 0.622         </span>
<span class="co">#&gt;    Detection Prevalence : 0.636         </span>
<span class="co">#&gt;       Balanced Accuracy : 0.954         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : benign        </span>
<span class="co">#&gt; </span></code></pre></div>
</div>
<div id="ga" class="section level3">
<h3>
<span class="header-section-number">12.5.5</span> GA<a class="anchor" aria-label="anchor" href="#ga"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">127</span><span class="op">)</span>
<span class="va">model_bc_data_ga</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">classes</span> <span class="op">~</span> <span class="va">.</span>,
                           data <span class="op">=</span> <span class="va">bc_data_ga</span>,
                           method <span class="op">=</span> <span class="st">"rf"</span>,
                           preProcess <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scale"</span>, <span class="st">"center"</span><span class="op">)</span>,
                           trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"repeatedcv"</span>, 
                                                    number <span class="op">=</span> <span class="fl">5</span>, repeats <span class="op">=</span> <span class="fl">10</span>, 
                                                    verboseIter <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cm_ga_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_bc_data_ga</span>, <span class="va">bc_data_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="va">bc_data_test</span><span class="op">$</span><span class="va">classes</span><span class="op">)</span>
<span class="va">cm_ga_1</span>
<span class="co">#&gt; Confusion Matrix and Statistics</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;            Reference</span>
<span class="co">#&gt; Prediction  benign malignant</span>
<span class="co">#&gt;   benign       131         2</span>
<span class="co">#&gt;   malignant      6        70</span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                Accuracy : 0.962         </span>
<span class="co">#&gt;                  95% CI : (0.926, 0.983)</span>
<span class="co">#&gt;     No Information Rate : 0.656         </span>
<span class="co">#&gt;     P-Value [Acc &gt; NIR] : &lt;2e-16        </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;                   Kappa : 0.916         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;  Mcnemar's Test P-Value : 0.289         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;             Sensitivity : 0.956         </span>
<span class="co">#&gt;             Specificity : 0.972         </span>
<span class="co">#&gt;          Pos Pred Value : 0.985         </span>
<span class="co">#&gt;          Neg Pred Value : 0.921         </span>
<span class="co">#&gt;              Prevalence : 0.656         </span>
<span class="co">#&gt;          Detection Rate : 0.627         </span>
<span class="co">#&gt;    Detection Prevalence : 0.636         </span>
<span class="co">#&gt;       Balanced Accuracy : 0.964         </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt;        'Positive' Class : benign        </span>
<span class="co">#&gt; </span></code></pre></div>
</div>
</div>
<div id="create-comparison-tables" class="section level2">
<h2>
<span class="header-section-number">12.6</span> Create comparison tables<a class="anchor" aria-label="anchor" href="#create-comparison-tables"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># take "overall" variable only from Confusion Matrix</span>
<span class="va">overall</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="fl">1</span>, 
           model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"cor"</span>, <span class="st">"rfe"</span>, <span class="st">"ga"</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,
           <span class="fu"><a href="https://rdrr.io/pkg/mice/man/cbind.html">rbind</a></span><span class="op">(</span><span class="va">cm_all_1</span><span class="op">$</span><span class="va">overall</span>,
                 <span class="va">cm_cor_1</span><span class="op">$</span><span class="va">overall</span>,
                 <span class="va">cm_rfe_1</span><span class="op">$</span><span class="va">overall</span>,
                 <span class="va">cm_ga_1</span><span class="op">$</span><span class="va">overall</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># convert to tidy data</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="va">overall_gather</span> <span class="op">&lt;-</span> <span class="va">overall</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">%&gt;%</span>     <span class="co"># take the first columns:</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">measure</span>, <span class="va">value</span>, <span class="va">Accuracy</span><span class="op">:</span><span class="va">Kappa</span><span class="op">)</span> <span class="co"># dataset, model, Accuracy and Kappa</span></code></pre></div>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># take "byClass" variable only from Confusion Matrix</span>
<span class="va">byClass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="fl">1</span>,
                      model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"cor"</span>, <span class="st">"rfe"</span>, <span class="st">"ga"</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/mice/man/cbind.html">rbind</a></span><span class="op">(</span><span class="va">cm_all_1</span><span class="op">$</span><span class="va">byClass</span>,
                      <span class="va">cm_cor_1</span><span class="op">$</span><span class="va">byClass</span>,
                      <span class="va">cm_rfe_1</span><span class="op">$</span><span class="va">byClass</span>,
                      <span class="va">cm_ga_1</span><span class="op">$</span><span class="va">byClass</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># convert to tidy data</span>
<span class="va">byClass_gather</span> <span class="op">&lt;-</span> <span class="va">byClass</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">7</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span>      <span class="co"># select columns: dataset, model</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">measure</span>, <span class="va">value</span>, <span class="va">Sensitivity</span><span class="op">:</span><span class="va">Precision</span><span class="op">)</span> <span class="co"># Sensitiv, Specific, Precis</span></code></pre></div>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># join the two tables</span>
<span class="va">overall_byClass_gather</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mice/man/cbind.html">rbind</a></span><span class="op">(</span><span class="va">overall_gather</span>, <span class="va">byClass_gather</span><span class="op">)</span>
<span class="va">overall_byClass_gather</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/transform.data.table.html">within</a></span><span class="op">(</span>
  <span class="va">overall_byClass_gather</span>, <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">model</span>, 
                                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"cor"</span>, <span class="st">"rfe"</span>, <span class="st">"ga"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  
                                          <span class="co"># convert to factor</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">overall_byClass_gather</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">model</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">measure</span>, 
                                   shape <span class="op">=</span> <span class="va">measure</span>, group <span class="op">=</span> <span class="va">measure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">dataset</span> <span class="op">~</span> <span class="va">.</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Feature Selection method"</span>,
    y <span class="op">=</span> <span class="st">"Value"</span>,
    color <span class="op">=</span> <span class="st">""</span>,
    shape <span class="op">=</span> <span class="st">""</span>,
    title <span class="op">=</span> <span class="st">"Comparison of feature selection methods"</span>,
    subtitle <span class="op">=</span> <span class="st">"in three breast cancer datasets"</span>,
    caption <span class="op">=</span> <span class="st">"\nBreast Cancer Wisconsin (Diagnostic) Data Sets: 1, 2 &amp; 3
    Street et al., 1993;
    all: no feature selection
    cor: features with correlation &gt; 0.7 removed
    rfe: Recursive Feature Elimination
    ga: Genetic Algorithm"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="105-classification_229-breast_cancer-sglander_files/figure-html/unnamed-chunk-26-1.png" width="70%" style="display: block; margin: auto;"></div>
<ol style="list-style-type: decimal">
<li>Less accurate: selection of features by correlation</li>
<li>More accurate: genetic algorithm</li>
<li>Including all features is more accurate to removing features by correlation.</li>
</ol>
</div>
<div id="notes" class="section level2">
<h2>
<span class="header-section-number">12.7</span> Notes<a class="anchor" aria-label="anchor" href="#notes"><i class="fas fa-link"></i></a>
</h2>
<p><code>pcaGoPromoter</code> is a BioConductor package. Its dependencies are <code>BioGenerics</code>, <code>AnnotationDbi</code> and <code>BioStrings</code>, which at their turn require <code>DBI</code> and <code>RSQLite</code> packages from CRAN. Install first those from CRAN, and then move to install <code>pcaGoPromoter</code>.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="broad-view-of-svm.html"><span class="header-section-number">11</span> Broad view of SVM</a></div>
<div class="next"><a href="dealing-with-unbalanced-data.html"><span class="header-section-number">13</span> Dealing with unbalanced data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#feature-selection-to-enhance-cancer-detection"><span class="header-section-number">12</span> Feature Selection to enhance cancer detection</a></li>
<li>
<a class="nav-link" href="#read-and-process-the-data"><span class="header-section-number">12.1</span> Read and process the data</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#missing-data"><span class="header-section-number">12.1.1</span> Missing data</a></li></ul>
</li>
<li>
<a class="nav-link" href="#principal-component-analysis-pca"><span class="header-section-number">12.2</span> Principal Component Analysis (PCA)</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#density-plots-vs-class"><span class="header-section-number">12.2.1</span> density plots vs class</a></li></ul>
</li>
<li><a class="nav-link" href="#feature-importance"><span class="header-section-number">12.3</span> Feature importance</a></li>
<li>
<a class="nav-link" href="#feature-selection"><span class="header-section-number">12.4</span> Feature Selection</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#correlation"><span class="header-section-number">12.4.1</span> Correlation</a></li>
<li><a class="nav-link" href="#recursive-feature-elimination-rfe-1"><span class="header-section-number">12.4.2</span> Recursive Feature Elimination (RFE)</a></li>
<li><a class="nav-link" href="#genetic-algorithm-ga"><span class="header-section-number">12.4.3</span> Genetic Algorithm (GA)</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#model-comparison"><span class="header-section-number">12.5</span> Model comparison</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#using-all-features"><span class="header-section-number">12.5.1</span> Using all features</a></li>
<li><a class="nav-link" href="#compare-selection-methods"><span class="header-section-number">12.5.2</span> Compare selection methods</a></li>
<li><a class="nav-link" href="#correlation-1"><span class="header-section-number">12.5.3</span> Correlation</a></li>
<li><a class="nav-link" href="#recursive-feature-elimination"><span class="header-section-number">12.5.4</span> Recursive Feature Elimination</a></li>
<li><a class="nav-link" href="#ga"><span class="header-section-number">12.5.5</span> GA</a></li>
</ul>
</li>
<li><a class="nav-link" href="#create-comparison-tables"><span class="header-section-number">12.6</span> Create comparison tables</a></li>
<li><a class="nav-link" href="#notes"><span class="header-section-number">12.7</span> Notes</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/f0nzie/machine_learning_compilation/blob/master/105-classification_229-breast_cancer-sglander.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/f0nzie/machine_learning_compilation/edit/master/105-classification_229-breast_cancer-sglander.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Machine Learning Compilation</strong>" was written by Several authors. Compiled by Alfonso R. Reyes. It was last built on 2020-11-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
