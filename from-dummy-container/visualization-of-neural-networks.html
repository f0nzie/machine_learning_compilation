<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 43 Visualization of neural networks | A Machine Learning Compilation</title>
<meta name="author" content="Several authors. Compiled by Alfonso R. Reyes">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Machine Learning Compilation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preface</a></li>
<li class="book-part">The Basics of Machine Learning</li>
<li><a class="" href="introduction-to-pca.html"><span class="header-section-number">2</span> Introduction to PCA</a></li>
<li><a class="" href="comparison-of-two-pca-packages.html"><span class="header-section-number">3</span> Comparison of two PCA packages</a></li>
<li><a class="" href="detailed-study-of-principal-component-analysis.html"><span class="header-section-number">4</span> Detailed study of Principal Component Analysis</a></li>
<li><a class="" href="detection-of-diabetes-using-logistic-regression.html"><span class="header-section-number">5</span> Detection of diabetes using Logistic Regression</a></li>
<li><a class="" href="sensitivity-analysis-for-a-neural-network.html"><span class="header-section-number">6</span> Sensitivity analysis for a neural network</a></li>
<li><a class="" href="data-visualization-for-ml-models.html"><span class="header-section-number">7</span> Data Visualization for ML models</a></li>
<li class="book-part">Feature Engineering</li>
<li><a class="" href="ten-methods-to-assess-variable-importance.html"><span class="header-section-number">8</span> Ten methods to assess Variable Importance</a></li>
<li><a class="" href="employee-attrition-using-feature-importance.html"><span class="header-section-number">9</span> Employee Attrition using Feature Importance</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="a-gentle-introduction-to-support-vector-machines.html"><span class="header-section-number">10</span> A gentle introduction to Support Vector Machines</a></li>
<li><a class="" href="broad-view-of-svm.html"><span class="header-section-number">11</span> Broad view of SVM</a></li>
<li><a class="" href="feature-selection-to-enhance-cancer-detection.html"><span class="header-section-number">12</span> Feature Selection to enhance cancer detection</a></li>
<li><a class="" href="dealing-with-unbalanced-data.html"><span class="header-section-number">13</span> Dealing with unbalanced data</a></li>
<li><a class="" href="imputting-missing-values-with-random-forest.html"><span class="header-section-number">14</span> Imputting missing values with Random Forest</a></li>
<li><a class="" href="tuning-of-support-vector-machine-prediction.html"><span class="header-section-number">15</span> Tuning of Support Vector Machine prediction</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="introduction-to-algorithms-for-classification.html"><span class="header-section-number">16</span> Introduction to algorithms for Classification</a></li>
<li><a class="" href="comparing-classification-algorithms.html"><span class="header-section-number">17</span> Comparing Classification algorithms</a></li>
<li><a class="" href="who-buys-social-network-ads.html"><span class="header-section-number">18</span> Who buys Social Network ads</a></li>
<li><a class="" href="predicting-ozone-levels.html"><span class="header-section-number">19</span> Predicting Ozone levels</a></li>
<li><a class="" href="building-a-naive-bayes-classifier.html"><span class="header-section-number">20</span> Building a Naive Bayes Classifier</a></li>
<li><a class="" href="linear-and-non-linear-algorithms-for-classification.html"><span class="header-section-number">21</span> Linear and Non-Linear Algorithms for Classification</a></li>
<li><a class="" href="detect-mines-vs-rocks-with-random-forest.html"><span class="header-section-number">22</span> Detect mines vs rocks with Random Forest</a></li>
<li><a class="" href="predicting-the-type-of-glass.html"><span class="header-section-number">23</span> Predicting the type of glass</a></li>
<li><a class="" href="naive-bayes-for-sms-spam.html"><span class="header-section-number">24</span> Naive Bayes for SMS spam</a></li>
<li><a class="" href="vehicles-classiification-with-decision-trees.html"><span class="header-section-number">25</span> Vehicles classiification with Decision Trees</a></li>
<li><a class="" href="applying-naive-bayes-on-the-titanic-case.html"><span class="header-section-number">26</span> Applying Naive-Bayes on the Titanic case</a></li>
<li><a class="" href="classification-on-bad-loans.html"><span class="header-section-number">27</span> Classification on bad loans</a></li>
<li><a class="" href="predicting-flu-outcome-comparing-eight-classification-algorithms.html"><span class="header-section-number">28</span> Predicting Flu outcome comparing eight classification algorithms</a></li>
<li><a class="" href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></li>
<li><a class="" href="prediction-of-arrhythmia-with-deep-neural-nets.html"><span class="header-section-number">30</span> Prediction of arrhythmia with deep neural nets</a></li>
<li class="book-part">Linear Regression</li>
<li><a class="" href="linear-regression-with-islr.html"><span class="header-section-number">31</span> Linear Regression with ISLR</a></li>
<li><a class="" href="evaluation-of-three-linear-regression-models.html"><span class="header-section-number">32</span> Evaluation of three linear regression models</a></li>
<li><a class="" href="comparison-of-six-linear-regression-algorithms.html"><span class="header-section-number">33</span> Comparison of six Linear Regression algorithms</a></li>
<li><a class="" href="comparing-regression-models.html"><span class="header-section-number">34</span> Comparing regression models</a></li>
<li><a class="" href="finding-the-factors-of-happiness.html"><span class="header-section-number">35</span> Finding the factors of happiness</a></li>
<li><a class="" href="regression-with-a-neural-network.html"><span class="header-section-number">36</span> Regression with a neural network</a></li>
<li><a class="" href="comparing-multiple-regression-vs-a-neural-network.html"><span class="header-section-number">37</span> Comparing Multiple Regression vs a Neural Network</a></li>
<li><a class="" href="temperature-modeling-using-nested-dataframes.html"><span class="header-section-number">38</span> Temperature modeling using nested dataframes</a></li>
<li class="book-part">Neural Networks</li>
<li><a class="" href="credit-scoring-with-neuralnet.html"><span class="header-section-number">39</span> Credit Scoring with neuralnet</a></li>
<li><a class="" href="wine-classification-with-neuralnet.html"><span class="header-section-number">40</span> Wine classification with neuralnet</a></li>
<li><a class="" href="predicting-the-rating-of-cereals.html"><span class="header-section-number">41</span> Predicting the rating of cereals</a></li>
<li><a class="" href="fitting-a-linear-model-with-neural-networks.html"><span class="header-section-number">42</span> Fitting a linear model with neural networks</a></li>
<li><a class="active" href="visualization-of-neural-networks.html"><span class="header-section-number">43</span> Visualization of neural networks</a></li>
<li><a class="" href="build-a-fully-connected-r-neural-network-from-scratch.html"><span class="header-section-number">44</span> Build a fully connected R neural network from scratch</a></li>
<li><a class="" href="tuning-hyperparameters-in-a-neural-network.html"><span class="header-section-number">45</span> Tuning Hyperparameters in a Neural Network</a></li>
<li><a class="" href="deep-learning-tips-for-classification-and-regression.html"><span class="header-section-number">46</span> Deep Learning tips for Classification and Regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="what-is-dot-hat-in-a-regression-output.html"><span class="header-section-number">A</span> What is dot hat in a regression output</a></li>
<li><a class="" href="q-q-normal-to-compare-data-to-distributions.html"><span class="header-section-number">B</span> Q-Q normal to compare data to distributions</a></li>
<li><a class="" href="qq-and-pp-plots.html"><span class="header-section-number">C</span> QQ and PP Plots</a></li>
<li><a class="" href="visualizing-residuals.html"><span class="header-section-number">D</span> Visualizing residuals</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/f0nzie/machine_learning_compilation">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="visualization-of-neural-networks" class="section level1">
<h1>
<span class="header-section-number">43</span> Visualization of neural networks<a class="anchor" aria-label="anchor" href="#visualization-of-neural-networks"><i class="fas fa-link"></i></a>
</h1>
<p><a href="https://beckmw.wordpress.com/tag/neuralnet/" class="uri">https://beckmw.wordpress.com/tag/neuralnet/</a></p>
<p>In my last post I said I wasn’t going to write anymore about neural networks (i.e., multilayer feedforward perceptron, supervised ANN, etc.). That was a lie. I’ve received several requests to update the neural network plotting function described in the original post. As previously explained, R does not provide a lot of options for visualizing neural networks. The only option I know of is a plotting method for objects from the neuralnet package. This may be my opinion, but I think this plot leaves much to be desired (see below). Also, no plotting methods exist for neural networks created in other packages, i.e., nnet and RSNNS. These packages are the only ones listed on the CRAN task view, so I’ve updated my original plotting function to work with all three. Additionally, I’ve added a new option for plotting a raw weight vector to allow use with neural networks created elsewhere. This blog describes these changes, as well as some new arguments added to the original function.</p>
<p>As usual, I’ll simulate some data to use for creating the neural networks. The dataset contains eight input variables and two output variables. The final dataset is a data frame with all variables, as well as separate data frames for the input and output variables. I’ve retained separate datasets based on the syntax for each package.</p>
<div class="sourceCode" id="cb1017"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">clusterGeneration</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: MASS</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/collectivemedia/tictoc">tictoc</a></span><span class="op">)</span>
 
<span class="va">seed.val</span><span class="op">&lt;-</span> <span class="fl">12345</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed.val</span><span class="op">)</span>
 
<span class="va">num.vars</span><span class="op">&lt;-</span><span class="fl">8</span>
<span class="va">num.obs</span><span class="op">&lt;-</span><span class="fl">1000</span>
 
<span class="co"># input variables</span>
<span class="va">cov.mat</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/clusterGeneration/man/genPositiveDefMat.html">genPositiveDefMat</a></span><span class="op">(</span><span class="va">num.vars</span>,covMethod<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"unifcorrmat"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Sigma</span>
<span class="va">rand.vars</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="va">num.obs</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">num.vars</span><span class="op">)</span>,Sigma<span class="op">=</span><span class="va">cov.mat</span><span class="op">)</span>
 
<span class="co"># output variables</span>
<span class="va">parms</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num.vars</span>,<span class="op">-</span><span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>
<span class="va">y1</span> <span class="op">&lt;-</span> <span class="va">rand.vars</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">parms</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">num.obs</span>,sd<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="va">parms2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num.vars</span>,<span class="op">-</span><span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>
<span class="va">y2</span> <span class="op">&lt;-</span> <span class="va">rand.vars</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">parms2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">num.obs</span>,sd<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
 
<span class="co"># final datasets</span>
<span class="va">rand.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">rand.vars</span><span class="op">)</span>
<span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">y1</span>,<span class="va">y2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Y1'</span>,<span class="st">'Y2'</span><span class="op">)</span>
<span class="va">dat.in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">resp</span>, <span class="va">rand.vars</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb1018"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">dat.in</span><span class="op">)</span>
<span class="co">#&gt; Rows: 1,000</span>
<span class="co">#&gt; Columns: 10</span>
<span class="co">#&gt; $ Y1 &lt;dbl&gt; 25.442, -14.578, -36.214, 15.216, -6.393, -20.849, -28.665, -87.36…</span>
<span class="co">#&gt; $ Y2 &lt;dbl&gt; 16.9, 38.8, 31.2, -31.2, 93.3, 11.7, 59.7, -103.5, -49.8, 50.1, 28…</span>
<span class="co">#&gt; $ X1 &lt;dbl&gt; 3.138, -0.705, -4.373, 0.837, 0.787, 1.923, -1.419, 1.121, -0.423,…</span>
<span class="co">#&gt; $ X2 &lt;dbl&gt; 0.1945, -0.3016, 0.7734, 1.3112, 3.5056, 1.2453, 3.8002, -0.1646, …</span>
<span class="co">#&gt; $ X3 &lt;dbl&gt; -1.795, -2.596, 2.308, 4.081, -3.921, 1.473, -0.926, 7.101, 2.366,…</span>
<span class="co">#&gt; $ X4 &lt;dbl&gt; -2.7216, 3.0589, 1.2455, 3.4607, 2.3775, -2.9833, 2.6669, -0.3046,…</span>
<span class="co">#&gt; $ X5 &lt;dbl&gt; 0.0407, 0.7602, -3.0217, -4.2799, 2.0859, 1.4765, 0.0561, 2.8328, …</span>
<span class="co">#&gt; $ X6 &lt;dbl&gt; -1.4820, -0.5014, 0.0603, -1.8551, 2.2817, 1.7386, 1.7450, -2.8279…</span>
<span class="co">#&gt; $ X7 &lt;dbl&gt; -0.7169, -0.3618, -1.5283, 4.2026, -6.1548, -0.3545, -6.0284, 9.52…</span>
<span class="co">#&gt; $ X8 &lt;dbl&gt; 1.152, 1.810, -1.357, 0.598, -1.425, -1.210, -1.004, 2.494, -0.702…</span></code></pre></div>
<p>The various neural network packages are used to create separate models for plotting.</p>
<div class="sourceCode" id="cb1019"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first model with nnet</span>
<span class="co">#nnet function from nnet package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">nnet</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed.val</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">rand.vars</span>, <span class="va">resp</span>, data <span class="op">=</span> <span class="va">dat.in</span>, size <span class="op">=</span> <span class="fl">10</span>, linout <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; # weights:  112</span>
<span class="co">#&gt; initial  value 4784162.893260 </span>
<span class="co">#&gt; iter  10 value 1794537.980652</span>
<span class="co">#&gt; iter  20 value 1577753.498759</span>
<span class="co">#&gt; iter  30 value 1485254.945754</span>
<span class="co">#&gt; iter  40 value 1449238.248497</span>
<span class="co">#&gt; iter  50 value 1427720.291593</span>
<span class="co">#&gt; iter  60 value 1416950.633230</span>
<span class="co">#&gt; iter  70 value 1405977.228751</span>
<span class="co">#&gt; iter  80 value 1392096.965794</span>
<span class="co">#&gt; iter  90 value 1365158.497142</span>
<span class="co">#&gt; iter 100 value 1358854.803800</span>
<span class="co">#&gt; final  value 1358854.803800 </span>
<span class="co">#&gt; stopped after 100 iterations</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 0.162 sec elapsed</span></code></pre></div>
<div class="sourceCode" id="cb1020"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># nn &lt;- neuralnet(form.in,</span>
<span class="co">#                 data = dat.sc,</span>
<span class="co">#                 # hidden = c(13, 10, 3),</span>
<span class="co">#                 hidden = c(5),</span>
<span class="co">#                 act.fct = "tanh",</span>
<span class="co">#                 linear.output = FALSE,</span>
<span class="co">#                 lifesign = "minimal")</span></code></pre></div>
<div class="sourceCode" id="cb1021"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 2nd model with neuralnet</span>
<span class="co"># neuralnet function from neuralnet package, notice use of only one response</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bips-hb/neuralnet">neuralnet</a></span><span class="op">)</span>

<span class="va">softplus</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/H2OFrame.html">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="va">sigmoid</span>  <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/H2OFrame.html">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>

<span class="va">dat.sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/scale.html">scale</a></span><span class="op">(</span><span class="va">dat.in</span><span class="op">)</span>
<span class="va">form.in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="st">'Y1 ~ X1+X2+X3+X4+X5+X6+X7+X8'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed.val</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html">neuralnet</a></span><span class="op">(</span><span class="va">form.in</span>, data <span class="op">=</span> <span class="va">dat.sc</span>, hidden <span class="op">=</span> <span class="fl">10</span>, lifesign <span class="op">=</span> <span class="st">"minimal"</span>,
                  linear.output <span class="op">=</span> <span class="cn">FALSE</span>,
                  act.fct <span class="op">=</span> <span class="st">"tanh"</span><span class="op">)</span>
<span class="co">#&gt; hidden: 10    thresh: 0.01    rep: 1/1    steps:   26361 error: 160.06372    time: 26.03 secs</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 26.043 sec elapsed</span></code></pre></div>
<div class="sourceCode" id="cb1022"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># third model with RSNNS</span>
<span class="co"># mlp function from RSNNS package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cbergmeir/RSNNS">RSNNS</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: Rcpp</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed.val</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RSNNS/man/mlp.html">mlp</a></span><span class="op">(</span><span class="va">rand.vars</span>, <span class="va">resp</span>, size <span class="op">=</span> <span class="fl">10</span>, linOut <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 0.305 sec elapsed</span></code></pre></div>
<p>I’ve noticed some differences between the functions that could lead to some confusion. For simplicity, the above code represents my interpretation of the most direct way to create a neural network in each package. Be very aware that direct comparison of results is not advised given that the default arguments differ between the packages. A few key differences are as follows, although many others should be noted. First, the functions differ in the methods for passing the primary input variables.</p>
<p>The <code>nnet</code> function can take separate (or combined) x and y inputs as data frames or as a formula, the <code>neuralnet</code> function can only use a formula as input, and the mlp function can only take a data frame as combined or separate variables as input. As far as I know, the neuralnet function is not capable of modelling multiple response variables, unless the response is a categorical variable that uses one node for each outcome. Additionally, the default output for the neuralnet function is linear, whereas the opposite is true for the other two functions.</p>
<p>Specifics aside, here’s how to use the updated plot function. Note that the same syntax is used to plot each model</p>
<div class="sourceCode" id="cb1023"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import the function from Github</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: usethis</span>
<span class="fu"><a href="https://devtools.r-lib.org//reference/source_url.html">source_url</a></span><span class="op">(</span><span class="st">'https://gist.githubusercontent.com/fawda123/7471137/raw/466c1474d0a505ff044412703516c34f1a4684a5/nnet_plot_update.r'</span><span class="op">)</span>
<span class="co">#&gt; SHA-1 hash of file is 74c80bd5ddbc17ab3ae5ece9c0ed9beb612e87ef</span>
 
<span class="co"># plot each model</span>
<span class="fu">plot.nnet</span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: scales</span>
<span class="co">#&gt; Loading required package: reshape</span>
<span class="fu">plot.nnet</span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span> 
<span class="fu">plot.nnet</span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span>
<span class="co">#&gt; Warning in plot.nnet(mod3): Bias layer not applicable for rsnns object</span></code></pre></div>
<p><img src="602-nn-regression_903-visualization_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;"><img src="602-nn-regression_903-visualization_files/figure-html/unnamed-chunk-4-2.png" width="70%" style="display: block; margin: auto;"><img src="602-nn-regression_903-visualization_files/figure-html/unnamed-chunk-4-3.png" width="70%" style="display: block; margin: auto;"></p>
<p>The plotting function can also now be used with an arbitrary weight vector, rather than a specific model object. The struct argument must also be included if this option is used. I thought the easiest way to use the plotting function with your own weights was to have the input weights as a numeric vector, including bias layers. I’ve shown how this can be done using the weights directly from mod1 for simplicity.</p>
<div class="sourceCode" id="cb1024"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wts.in</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">wts</span>
<span class="va">struct</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="va">n</span>
<span class="fu">plot.nnet</span><span class="op">(</span><span class="va">wts.in</span>,struct<span class="op">=</span><span class="va">struct</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="602-nn-regression_903-visualization_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Note that <code>wts.in</code> is a numeric vector with length equal to the expected given the architecture (i.e., for 8 10 2 network, 100 connection weights plus 12 bias weights). The plot should look the same as the plot for the neural network from nnet.</p>
<p>The weights in the input vector need to be in a specific order for correct plotting. I realize this is not clear by looking directly at wt.in but this was the simplest approach I could think of. The weight vector shows the weights for each hidden node in sequence, starting with the bias input for each node, then the weights for each output node in sequence, starting with the bias input for each output node. Note that the bias layer has to be included even if the network was not created with biases. If this is the case, simply input a random number where the bias values should go and use the argument bias=F. I’ll show the correct order of the weights using an example with plot.nn from the neuralnet package since the weights are included directly on the plot.</p>
<p>If we pretend that the above figure wasn’t created in R, we would input the mod.in argument for the updated plotting function as follows. Also note that struct must be included if using this approach.</p>
<div class="sourceCode" id="cb1025"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod.in</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">13.12</span>,<span class="fl">1.49</span>,<span class="fl">0.16</span>,<span class="op">-</span><span class="fl">0.11</span>,<span class="op">-</span><span class="fl">0.19</span>,<span class="op">-</span><span class="fl">0.16</span>,<span class="fl">0.56</span>,<span class="op">-</span><span class="fl">0.52</span>,<span class="fl">0.81</span><span class="op">)</span>
<span class="va">struct</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">#two inputs, two hidden, one output </span>
<span class="fu">plot.nnet</span><span class="op">(</span><span class="va">mod.in</span>, struct<span class="op">=</span><span class="va">struct</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="602-nn-regression_903-visualization_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Note the comparability with the figure created using the neuralnet package. That is, larger weights have thicker lines and color indicates sign (+ black, – grey).</p>
<p>One of these days I’ll actually put these functions in a package. In the meantime, please let me know if any bugs are encountered.</p>
<div id="caret-and-plot-nn" class="section level2">
<h2>
<span class="header-section-number">43.1</span> caret and plot NN<a class="anchor" aria-label="anchor" href="#caret-and-plot-nn"><i class="fas fa-link"></i></a>
</h2>
<p>I’ve changed the function to work with neural networks created using the train function from the caret package. The link above is updated but you can also grab it here.</p>
<div class="sourceCode" id="cb1026"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: lattice</span>
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'caret'</span>
<span class="co">#&gt; The following objects are masked from 'package:RSNNS':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     confusionMatrix, train</span>
<span class="va">mod4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Y1</span> <span class="op">~</span><span class="va">.</span>, method<span class="op">=</span><span class="st">'nnet'</span>, data<span class="op">=</span><span class="va">dat.in</span>, linout<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb1027"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot.nnet</span><span class="op">(</span><span class="va">mod4</span>,nid<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; Warning in plot.nnet(mod4, nid = T): Using best nnet model from train output</span></code></pre></div>
<div class="inline-figure"><img src="602-nn-regression_903-visualization_files/figure-html/unnamed-chunk-7-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb1028"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fact</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span><span class="op">)</span>,size<span class="op">=</span><span class="va">num.obs</span>,replace<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="va">form.in</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="st">'cbind(Y2,Y1)~X1+X2+X3+fact'</span><span class="op">)</span>
<span class="va">mod5</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">form.in</span>,data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/mice/man/cbind.html">cbind</a></span><span class="op">(</span><span class="va">dat.in</span>,<span class="va">fact</span><span class="op">)</span>,size<span class="op">=</span><span class="fl">10</span>,linout<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; # weights:  82</span>
<span class="co">#&gt; initial  value 4799569.423556 </span>
<span class="co">#&gt; iter  10 value 2864553.218126</span>
<span class="co">#&gt; iter  20 value 2595828.194160</span>
<span class="co">#&gt; iter  30 value 2517965.483939</span>
<span class="co">#&gt; iter  40 value 2464882.178242</span>
<span class="co">#&gt; iter  50 value 2444238.701539</span>
<span class="co">#&gt; iter  60 value 2424302.507241</span>
<span class="co">#&gt; iter  70 value 2395226.893106</span>
<span class="co">#&gt; iter  80 value 2375603.533929</span>
<span class="co">#&gt; iter  90 value 2339340.538338</span>
<span class="co">#&gt; iter 100 value 2300041.821875</span>
<span class="co">#&gt; final  value 2300041.821875 </span>
<span class="co">#&gt; stopped after 100 iterations</span>
<span class="fu">plot.nnet</span><span class="op">(</span><span class="va">mod5</span>,nid<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="602-nn-regression_903-visualization_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="multiple-hidden-layers" class="section level2">
<h2>
<span class="header-section-number">43.2</span> Multiple hidden layers<a class="anchor" aria-label="anchor" href="#multiple-hidden-layers"><i class="fas fa-link"></i></a>
</h2>
<p>More updates… I’ve now modified the function to plot multiple hidden layers for networks created using the mlp function in the <code>RSNNS</code> package and neuralnet in the neuralnet package. As far as I know, these are the only neural network functions in R that can create multiple hidden layers. All others use a single hidden layer. I have not tested the plotting function using manual input for the weight vectors with multiple hidden layers. My guess is it won’t work but I can’t be bothered to change the function unless it’s specifically requested. The updated function can be grabbed here (all above links to the function have also been changed).</p>
<div class="sourceCode" id="cb1029"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cbergmeir/RSNNS">RSNNS</a></span><span class="op">)</span>
 
<span class="co"># neural net with three hidden layers, 9, 11, and 8 nodes in each</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">mod</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/RSNNS/man/mlp.html">mlp</a></span><span class="op">(</span><span class="va">rand.vars</span>, <span class="va">resp</span>, 
          size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span>,<span class="fl">11</span>,<span class="fl">8</span><span class="op">)</span>, 
          linOut <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 0.461 sec elapsed</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,family<span class="op">=</span><span class="st">'serif'</span><span class="op">)</span>
<span class="fu">plot.nnet</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
<span class="co">#&gt; Warning in plot.nnet(mod): Bias layer not applicable for rsnns object</span></code></pre></div>
<div class="inline-figure"><img src="602-nn-regression_903-visualization_files/figure-html/run-rsnns-hidden_layers-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="binary-predictors" class="section level2">
<h2>
<span class="header-section-number">43.3</span> Binary predictors<a class="anchor" aria-label="anchor" href="#binary-predictors"><i class="fas fa-link"></i></a>
</h2>
<p>Here’s an example using the <code>neuralnet</code> function with binary predictors and categorical outputs (credit to Tao Ma for the model code).</p>
<div class="sourceCode" id="cb1030"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bips-hb/neuralnet">neuralnet</a></span><span class="op">)</span>
 
<span class="co">#response</span>
<span class="va">AND</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">7</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">OR</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">7</span><span class="op">)</span><span class="op">)</span>
 
<span class="co"># response with predictors</span>
<span class="va">binary.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="va">AND</span>, <span class="va">OR</span><span class="op">)</span>
 
<span class="co">#model</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">tic</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuralnet/man/neuralnet.html">neuralnet</a></span><span class="op">(</span><span class="va">AND</span><span class="op">+</span><span class="va">OR</span> <span class="op">~</span> <span class="va">Var1</span><span class="op">+</span><span class="va">Var2</span><span class="op">+</span><span class="va">Var3</span>,
                 <span class="va">binary.data</span>, hidden <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">12</span>,<span class="fl">8</span><span class="op">)</span>, 
                 rep <span class="op">=</span> <span class="fl">10</span>, 
                 err.fct<span class="op">=</span><span class="st">"ce"</span>, 
                 linear.output<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 0.075 sec elapsed</span>
<span class="co">#plot ouput</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,family<span class="op">=</span><span class="st">'serif'</span><span class="op">)</span>
<span class="fu">plot.nnet</span><span class="op">(</span><span class="va">net</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="602-nn-regression_903-visualization_files/figure-html/unnamed-chunk-9-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="color-coding-the-input-layer" class="section level2">
<h2>
<span class="header-section-number">43.4</span> color coding the input layer<a class="anchor" aria-label="anchor" href="#color-coding-the-input-layer"><i class="fas fa-link"></i></a>
</h2>
<p>The color vector argument (circle.col) for the nodes was changed to allow a separate color vector for the input layer.</p>
<p>The following example shows how this can be done using relative importance of the input variables to color-code the first layer.</p>
<div class="sourceCode" id="cb1031"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># example showing use of separate colors for input layer</span>
<span class="co"># color based on relative importance using 'gar.fun'</span>
 
<span class="co">##</span>
<span class="co">#create input data</span>
<span class="va">seed.val</span><span class="op">&lt;-</span><span class="fl">3</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">seed.val</span><span class="op">)</span>
  
<span class="va">num.vars</span><span class="op">&lt;-</span><span class="fl">8</span>
<span class="va">num.obs</span><span class="op">&lt;-</span><span class="fl">1000</span>
  
<span class="co">#input variables</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">clusterGeneration</span><span class="op">)</span>
<span class="va">cov.mat</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/clusterGeneration/man/genPositiveDefMat.html">genPositiveDefMat</a></span><span class="op">(</span><span class="va">num.vars</span>,covMethod<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"unifcorrmat"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Sigma</span>
<span class="va">rand.vars</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="va">num.obs</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">num.vars</span><span class="op">)</span>,Sigma<span class="op">=</span><span class="va">cov.mat</span><span class="op">)</span>
  
<span class="co"># output variables</span>
<span class="va">parms</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num.vars</span>,<span class="op">-</span><span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>
<span class="va">y1</span><span class="op">&lt;-</span><span class="va">rand.vars</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">parms</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">num.obs</span>,sd<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
 
<span class="co"># final datasets</span>
<span class="va">rand.vars</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">rand.vars</span><span class="op">)</span>
<span class="va">resp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">'Y1'</span>
<span class="va">dat.in</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">resp</span>,<span class="va">rand.vars</span><span class="op">)</span>
 
<span class="co">##</span>
<span class="co"># create model</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">nnet</a></span><span class="op">)</span>
<span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">rand.vars</span>,<span class="va">resp</span>,data<span class="op">=</span><span class="va">dat.in</span>,size<span class="op">=</span><span class="fl">10</span>,linout<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; # weights:  101</span>
<span class="co">#&gt; initial  value 844959.580478 </span>
<span class="co">#&gt; iter  10 value 543616.101824</span>
<span class="co">#&gt; iter  20 value 479986.887834</span>
<span class="co">#&gt; iter  30 value 465607.581653</span>
<span class="co">#&gt; iter  40 value 454224.889175</span>
<span class="co">#&gt; iter  50 value 448045.215005</span>
<span class="co">#&gt; iter  60 value 445024.634696</span>
<span class="co">#&gt; iter  70 value 442353.392985</span>
<span class="co">#&gt; iter  80 value 438868.995558</span>
<span class="co">#&gt; iter  90 value 435409.869319</span>
<span class="co">#&gt; iter 100 value 432831.005169</span>
<span class="co">#&gt; final  value 432831.005169 </span>
<span class="co">#&gt; stopped after 100 iterations</span>
 
<span class="co">##</span>
<span class="co"># relative importance function</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="fu"><a href="https://devtools.r-lib.org//reference/source_url.html">source_url</a></span><span class="op">(</span><span class="st">'https://gist.github.com/fawda123/6206737/raw/2e1bc9cbc48d1a56d2a79dd1d33f414213f5f1b1/gar_fun.r'</span><span class="op">)</span>
<span class="co">#&gt; SHA-1 hash of file is 9faa58824c46956c3ff78081696290d9b32d845f</span>
 
<span class="co"># relative importance of input variables for Y1</span>
<span class="va">rel.imp</span> <span class="op">&lt;-</span> <span class="fu">gar.fun</span><span class="op">(</span><span class="st">'Y1'</span>,<span class="va">mod1</span>,bar.plot<span class="op">=</span><span class="cn">F</span><span class="op">)</span><span class="op">$</span><span class="va">rel.imp</span>
 
<span class="co">#color vector based on relative importance of input values</span>
<span class="va">cols</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'green'</span>,<span class="st">'red'</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="va">num.vars</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/frank.html">rank</a></span><span class="op">(</span><span class="va">rel.imp</span><span class="op">)</span><span class="op">]</span>
 
<span class="co">##</span>
<span class="co">#plotting function</span>
<span class="fu"><a href="https://devtools.r-lib.org//reference/source_url.html">source_url</a></span><span class="op">(</span><span class="st">'https://gist.githubusercontent.com/fawda123/7471137/raw/466c1474d0a505ff044412703516c34f1a4684a5/nnet_plot_update.r'</span><span class="op">)</span>
<span class="co">#&gt; SHA-1 hash of file is 74c80bd5ddbc17ab3ae5ece9c0ed9beb612e87ef</span>
  
<span class="co">#plot model with new color vector</span>
<span class="co">#separate colors for input vectors using a list for 'circle.col'</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">mod1</span>,circle.col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">cols</span>,<span class="st">'lightblue'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="602-nn-regression_903-visualization_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="fitting-a-linear-model-with-neural-networks.html"><span class="header-section-number">42</span> Fitting a linear model with neural networks</a></div>
<div class="next"><a href="build-a-fully-connected-r-neural-network-from-scratch.html"><span class="header-section-number">44</span> Build a fully connected R neural network from scratch</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#visualization-of-neural-networks"><span class="header-section-number">43</span> Visualization of neural networks</a></li>
<li><a class="nav-link" href="#caret-and-plot-nn"><span class="header-section-number">43.1</span> caret and plot NN</a></li>
<li><a class="nav-link" href="#multiple-hidden-layers"><span class="header-section-number">43.2</span> Multiple hidden layers</a></li>
<li><a class="nav-link" href="#binary-predictors"><span class="header-section-number">43.3</span> Binary predictors</a></li>
<li><a class="nav-link" href="#color-coding-the-input-layer"><span class="header-section-number">43.4</span> color coding the input layer</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/f0nzie/machine_learning_compilation/blob/master/602-nn-regression_903-visualization.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/f0nzie/machine_learning_compilation/edit/master/602-nn-regression_903-visualization.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Machine Learning Compilation</strong>" was written by Several authors. Compiled by Alfonso R. Reyes. It was last built on 2020-11-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
