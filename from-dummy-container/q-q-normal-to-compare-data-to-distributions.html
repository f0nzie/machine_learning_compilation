<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>B Q-Q normal to compare data to distributions | A Machine Learning Compilation</title>
<meta name="author" content="Several authors. Compiled by Alfonso R. Reyes">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Machine Learning Compilation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preface</a></li>
<li class="book-part">The Basics of Machine Learning</li>
<li><a class="" href="introduction-to-pca.html"><span class="header-section-number">2</span> Introduction to PCA</a></li>
<li><a class="" href="comparison-of-two-pca-packages.html"><span class="header-section-number">3</span> Comparison of two PCA packages</a></li>
<li><a class="" href="detailed-study-of-principal-component-analysis.html"><span class="header-section-number">4</span> Detailed study of Principal Component Analysis</a></li>
<li><a class="" href="detection-of-diabetes-using-logistic-regression.html"><span class="header-section-number">5</span> Detection of diabetes using Logistic Regression</a></li>
<li><a class="" href="sensitivity-analysis-for-a-neural-network.html"><span class="header-section-number">6</span> Sensitivity analysis for a neural network</a></li>
<li><a class="" href="data-visualization-for-ml-models.html"><span class="header-section-number">7</span> Data Visualization for ML models</a></li>
<li class="book-part">Feature Engineering</li>
<li><a class="" href="ten-methods-to-assess-variable-importance.html"><span class="header-section-number">8</span> Ten methods to assess Variable Importance</a></li>
<li><a class="" href="employee-attrition-using-feature-importance.html"><span class="header-section-number">9</span> Employee Attrition using Feature Importance</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="a-gentle-introduction-to-support-vector-machines.html"><span class="header-section-number">10</span> A gentle introduction to Support Vector Machines</a></li>
<li><a class="" href="broad-view-of-svm.html"><span class="header-section-number">11</span> Broad view of SVM</a></li>
<li><a class="" href="feature-selection-to-enhance-cancer-detection.html"><span class="header-section-number">12</span> Feature Selection to enhance cancer detection</a></li>
<li><a class="" href="dealing-with-unbalanced-data.html"><span class="header-section-number">13</span> Dealing with unbalanced data</a></li>
<li><a class="" href="imputting-missing-values-with-random-forest.html"><span class="header-section-number">14</span> Imputting missing values with Random Forest</a></li>
<li><a class="" href="tuning-of-support-vector-machine-prediction.html"><span class="header-section-number">15</span> Tuning of Support Vector Machine prediction</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="introduction-to-algorithms-for-classification.html"><span class="header-section-number">16</span> Introduction to algorithms for Classification</a></li>
<li><a class="" href="comparing-classification-algorithms.html"><span class="header-section-number">17</span> Comparing Classification algorithms</a></li>
<li><a class="" href="who-buys-social-network-ads.html"><span class="header-section-number">18</span> Who buys Social Network ads</a></li>
<li><a class="" href="predicting-ozone-levels.html"><span class="header-section-number">19</span> Predicting Ozone levels</a></li>
<li><a class="" href="building-a-naive-bayes-classifier.html"><span class="header-section-number">20</span> Building a Naive Bayes Classifier</a></li>
<li><a class="" href="linear-and-non-linear-algorithms-for-classification.html"><span class="header-section-number">21</span> Linear and Non-Linear Algorithms for Classification</a></li>
<li><a class="" href="detect-mines-vs-rocks-with-random-forest.html"><span class="header-section-number">22</span> Detect mines vs rocks with Random Forest</a></li>
<li><a class="" href="predicting-the-type-of-glass.html"><span class="header-section-number">23</span> Predicting the type of glass</a></li>
<li><a class="" href="naive-bayes-for-sms-spam.html"><span class="header-section-number">24</span> Naive Bayes for SMS spam</a></li>
<li><a class="" href="vehicles-classiification-with-decision-trees.html"><span class="header-section-number">25</span> Vehicles classiification with Decision Trees</a></li>
<li><a class="" href="applying-naive-bayes-on-the-titanic-case.html"><span class="header-section-number">26</span> Applying Naive-Bayes on the Titanic case</a></li>
<li><a class="" href="classification-on-bad-loans.html"><span class="header-section-number">27</span> Classification on bad loans</a></li>
<li><a class="" href="predicting-flu-outcome-comparing-eight-classification-algorithms.html"><span class="header-section-number">28</span> Predicting Flu outcome comparing eight classification algorithms</a></li>
<li><a class="" href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></li>
<li><a class="" href="prediction-of-arrhythmia-with-deep-neural-nets.html"><span class="header-section-number">30</span> Prediction of arrhythmia with deep neural nets</a></li>
<li class="book-part">Linear Regression</li>
<li><a class="" href="linear-regression-with-islr.html"><span class="header-section-number">31</span> Linear Regression with ISLR</a></li>
<li><a class="" href="evaluation-of-three-linear-regression-models.html"><span class="header-section-number">32</span> Evaluation of three linear regression models</a></li>
<li><a class="" href="comparison-of-six-linear-regression-algorithms.html"><span class="header-section-number">33</span> Comparison of six Linear Regression algorithms</a></li>
<li><a class="" href="comparing-regression-models.html"><span class="header-section-number">34</span> Comparing regression models</a></li>
<li><a class="" href="finding-the-factors-of-happiness.html"><span class="header-section-number">35</span> Finding the factors of happiness</a></li>
<li><a class="" href="regression-with-a-neural-network.html"><span class="header-section-number">36</span> Regression with a neural network</a></li>
<li><a class="" href="comparing-multiple-regression-vs-a-neural-network.html"><span class="header-section-number">37</span> Comparing Multiple Regression vs a Neural Network</a></li>
<li><a class="" href="temperature-modeling-using-nested-dataframes.html"><span class="header-section-number">38</span> Temperature modeling using nested dataframes</a></li>
<li class="book-part">Neural Networks</li>
<li><a class="" href="credit-scoring-with-neuralnet.html"><span class="header-section-number">39</span> Credit Scoring with neuralnet</a></li>
<li><a class="" href="wine-classification-with-neuralnet.html"><span class="header-section-number">40</span> Wine classification with neuralnet</a></li>
<li><a class="" href="predicting-the-rating-of-cereals.html"><span class="header-section-number">41</span> Predicting the rating of cereals</a></li>
<li><a class="" href="fitting-a-linear-model-with-neural-networks.html"><span class="header-section-number">42</span> Fitting a linear model with neural networks</a></li>
<li><a class="" href="visualization-of-neural-networks.html"><span class="header-section-number">43</span> Visualization of neural networks</a></li>
<li><a class="" href="build-a-fully-connected-r-neural-network-from-scratch.html"><span class="header-section-number">44</span> Build a fully connected R neural network from scratch</a></li>
<li><a class="" href="tuning-hyperparameters-in-a-neural-network.html"><span class="header-section-number">45</span> Tuning Hyperparameters in a Neural Network</a></li>
<li><a class="" href="deep-learning-tips-for-classification-and-regression.html"><span class="header-section-number">46</span> Deep Learning tips for Classification and Regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="what-is-dot-hat-in-a-regression-output.html"><span class="header-section-number">A</span> What is dot hat in a regression output</a></li>
<li><a class="active" href="q-q-normal-to-compare-data-to-distributions.html"><span class="header-section-number">B</span> Q-Q normal to compare data to distributions</a></li>
<li><a class="" href="qq-and-pp-plots.html"><span class="header-section-number">C</span> QQ and PP Plots</a></li>
<li><a class="" href="visualizing-residuals.html"><span class="header-section-number">D</span> Visualizing residuals</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hadley/r-pkgs">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="q-q-normal-to-compare-data-to-distributions" class="section level1">
<h1>
<span class="header-section-number">B</span> Q-Q normal to compare data to distributions<a class="anchor" aria-label="anchor" href="#q-q-normal-to-compare-data-to-distributions"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-27" class="section level2">
<h2>
<span class="header-section-number">B.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-27"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://mgimond.github.io/ES218/Week06a.html" class="uri">https://mgimond.github.io/ES218/Week06a.html</a></p>
<p>Thus far, we have used the quantile-quantile plots to compare the distributions between two empirical (i.e. observational) datasets. This is sometimes referred to as an empirical <strong>Q-Q</strong> plot. We can also use the q-q plot to compare an <em>empirical</em> observation to a <em>theoretical</em> observation (i.e. one defined mathematically). Such a plot is usually referred to as a <strong>theoretical Q-Q plot</strong>. Examples of popular theoretical observations are the normal distribution (aka the Gaussian distribution), the <strong>chi-square</strong> distribution, and the exponential distribution just to name a few.</p>
<div class="inline-figure"><img src="999-misc_111c-qq_comparing_distributions_files/figure-html/unnamed-chunk-1-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="why-we-want-to-compare-emprirical-vs-theoretical-distributions" class="section level2">
<h2>
<span class="header-section-number">B.2</span> Why we want to compare emprirical vs theoretical distributions<a class="anchor" aria-label="anchor" href="#why-we-want-to-compare-emprirical-vs-theoretical-distributions"><i class="fas fa-link"></i></a>
</h2>
<p>There are many reasons we might want to compare empirical data to theoretical distributions:</p>
<ul>
<li><p>A theoretical distribution is easy to parameterize. For example, if the shape of the distribution of a batch of numbers can be approximated by a normal distribution we can reduce the complexity of our data to just two values: the mean and the standard deviation.</p></li>
<li><p>If data can be approximated by certain theoretical distributions, then many mainstream statistical procedures can be applied to the data.</p></li>
<li><p>In inferential statistics, knowing that a sample was derived from a population whose distribution follows a theoretical distribution allows us to derive certain properties of the population from the sample. For example, if we know that a sample comes from a normally distributed population, we can define confidence intervals for the sample mean using a <strong>t-distribution</strong>.</p></li>
<li><p>Modeling the distribution of the observed data can provide insight into the underlying process that generated the data.</p></li>
</ul>
<p>But very few empirical datasets follow any theoretical distributions exactly. So the questions usually ends up being “how well does theoretical distribution X fit my data?”</p>
<p>The theoretical quantile-quantile plot is a tool to explore how a batch of numbers deviates from a theoretical distribution and to visually assess whether the difference is significant for the purpose of the analysis. In the following examples, we will compare empirical data to the normal distribution using the normal quantile-quantile plot.</p>
</div>
<div id="the-normal-q-q-plot" class="section level2">
<h2>
<span class="header-section-number">B.3</span> The normal q-q plot<a class="anchor" aria-label="anchor" href="#the-normal-q-q-plot"><i class="fas fa-link"></i></a>
</h2>
<p>The normal q-q plot is just a special case of the empirical q-q plot we’ve explored so far; the difference being that we assign the normal distribution quantiles to the x-axis.</p>
<div id="drawing-a-normal-q-q-plot-from-scratch" class="section level3">
<h3>
<span class="header-section-number">B.3.1</span> Drawing a normal q-q plot from scratch<a class="anchor" aria-label="anchor" href="#drawing-a-normal-q-q-plot-from-scratch"><i class="fas fa-link"></i></a>
</h3>
<p>In the following example, we’ll compare the Alto 1 group to a normal distribution. First, we’ll extract the Alto 1 height values and save them as an atomic vector object using dplyr’s piping operations.</p>
<p>However, dplyr’s operations will return a dataframe–even if a single column is selected. To force the output to an atomic vector, we’ll pipe the subset to <code><a href="https://dplyr.tidyverse.org/reference/pull.html">pull(height)</a></code> which will extract the height column into a plain vector element.</p>
<div class="sourceCode" id="cb1092"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following object is masked from 'package:gridExtra':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     combine</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>

<span class="va">df</span>   <span class="op">&lt;-</span> <span class="fu">lattice</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/lattice/man/singer.html">singer</a></span>
<span class="va">alto</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span>  
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">voice.part</span> <span class="op">==</span> <span class="st">"Alto 1"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="va">print</span>
<span class="co">#&gt;  [1] 60 61 61 61 61 62 62 62 63 63 63 63 64 64 64 65 65 65 65 66 66 66 66 66 66</span>
<span class="co">#&gt; [26] 66 67 67 67 67 68 68 69 70 72</span></code></pre></div>
<p>Next, we need to find the matching normal distribution quantiles. We first find the f-values for alto, then use qnorm to find the matching normal distribution values from those same f-values</p>
<div class="sourceCode" id="cb1093"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">alto</span><span class="op">)</span>
<span class="va">fi</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">alto</span><span class="op">)</span>
<span class="va">fi</span>
<span class="co">#&gt;  [1] 0.0143 0.0429 0.0714 0.1000 0.1286 0.1571 0.1857 0.2143 0.2429 0.2714</span>
<span class="co">#&gt; [11] 0.3000 0.3286 0.3571 0.3857 0.4143 0.4429 0.4714 0.5000 0.5286 0.5571</span>
<span class="co">#&gt; [21] 0.5857 0.6143 0.6429 0.6714 0.7000 0.7286 0.7571 0.7857 0.8143 0.8429</span>
<span class="co">#&gt; [31] 0.8714 0.9000 0.9286 0.9571 0.9857</span>
<span class="va">x.norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="va">fi</span><span class="op">)</span>
<span class="va">x.norm</span>
<span class="co">#&gt;  [1] -2.1893 -1.7185 -1.4652 -1.2816 -1.1332 -1.0063 -0.8938 -0.7916 -0.6971</span>
<span class="co">#&gt; [10] -0.6085 -0.5244 -0.4439 -0.3661 -0.2905 -0.2165 -0.1437 -0.0717  0.0000</span>
<span class="co">#&gt; [19]  0.0717  0.1437  0.2165  0.2905  0.3661  0.4439  0.5244  0.6085  0.6971</span>
<span class="co">#&gt; [28]  0.7916  0.8938  1.0063  1.1332  1.2816  1.4652  1.7185  2.1893</span></code></pre></div>
<div class="sourceCode" id="cb1094"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">x.norm</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="999-misc_111c-qq_comparing_distributions_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Now we can plot the sorted alto values against the normal values.</p>
<div class="sourceCode" id="cb1095"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span> <span class="va">alto</span> <span class="op">~</span> <span class="va">x.norm</span>, type<span class="op">=</span><span class="st">"p"</span>, xlab<span class="op">=</span><span class="st">"Normal quantiles"</span>, pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="999-misc_111c-qq_comparing_distributions_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>When comparing a batch of numbers to a theoretical distribution on a q-q plot, we are looking for significant deviation from a straight line. To make it easier to judge straightness, we can fit a line to the points. Note that we are not creating a 45° (or x=y) slope; the range of values between both sets of numbers do not match. Here, we are only seeking the straightness of the points.</p>
<p>There are many ways one can fit a line to the data, Cleveland opts to fit a line to the first and third quartile of the q-q plot. The following chunk of code identifies the quantiles for both the alto dataset and the theoretical normal distribution. It then computes the slope and intercept from these coordinates.</p>
<div class="sourceCode" id="cb1096"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Find 1st and 3rd quartile for the Alto 1 data</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">alto</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span>, type<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
<span class="va">y</span>
<span class="co">#&gt;  25%  75% </span>
<span class="co">#&gt; 63.0 66.8</span></code></pre></div>
<div class="sourceCode" id="cb1097"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Find the 1st and 3rd quartile of the normal distribution</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; [1] -0.674  0.674</span></code></pre></div>
<div class="sourceCode" id="cb1098"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Now we can compute the intercept and slope of the line that passes</span>
<span class="co"># through these points</span>
<span class="va">slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">int</span>   <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">slope</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></code></pre></div>
<p>Next, we add the line to the plot.</p>
<div class="sourceCode" id="cb1099"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span> <span class="va">alto</span> <span class="op">~</span> <span class="va">x.norm</span>, type<span class="op">=</span><span class="st">"p"</span>, xlab<span class="op">=</span><span class="st">"Normal quantiles"</span>, pch<span class="op">=</span><span class="fl">20</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="va">int</span>, b<span class="op">=</span><span class="va">slope</span> <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="999-misc_111c-qq_comparing_distributions_files/figure-html/unnamed-chunk-9-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="using-rs-built-in-functions" class="section level2">
<h2>
<span class="header-section-number">B.4</span> Using R’s built-in functions<a class="anchor" aria-label="anchor" href="#using-rs-built-in-functions"><i class="fas fa-link"></i></a>
</h2>
<p>R has two built-in functions that facilitate the plot building task when comparing a batch to a normal distribution: <code>qqnorm</code> and <code>qqline.</code> Note that the function <code>qqline</code> allows the user to define the quantile method via the qtype= parameter. Here, we set it to 5 to match our choice of f-value calculation.</p>
<div class="sourceCode" id="cb1100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html">qqnorm</a></span><span class="op">(</span><span class="va">alto</span><span class="op">)</span>           <span class="co"># plot the points</span>
<span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html">qqline</a></span><span class="op">(</span><span class="va">alto</span>, qtype<span class="op">=</span><span class="fl">5</span><span class="op">)</span>  <span class="co"># plot the line</span></code></pre></div>
<div class="inline-figure"><img src="999-misc_111c-qq_comparing_distributions_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>That’s it. Just two lines of code!</p>
</div>
<div id="using-the-ggplot2-plotting-environment" class="section level2">
<h2>
<span class="header-section-number">B.5</span> Using the ggplot2 plotting environment<a class="anchor" aria-label="anchor" href="#using-the-ggplot2-plotting-environment"><i class="fas fa-link"></i></a>
</h2>
<p>We can take advantage of the <code><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">stat_qq()</a></code> function to plot the points, but the equation for the line must be computed manually (as was done earlier). Those steps will be repeated here.</p>
<div class="sourceCode" id="cb1101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># normal distribution</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="co"># Find the slope and intercept of the line that passes through the 1st and 3rd</span>
<span class="co"># quartile of the normal q-q plot</span>

<span class="va">y</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">alto</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span>, type<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="co"># Find the 1st and 3rd quartiles</span>
<span class="va">x</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>                 <span class="co"># Find the matching normal values on the x-axis</span>
<span class="va">slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>                     <span class="co"># Compute the line slope</span>
<span class="va">int</span>   <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">slope</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>                   <span class="co"># Compute the line intercept</span>

<span class="co"># Generate normal q-q plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample<span class="op">=</span><span class="va">alto</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">stat_qq</a></span><span class="op">(</span>distribution<span class="op">=</span><span class="va">qnorm</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="va">int</span>, slope<span class="op">=</span><span class="va">slope</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Height"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="999-misc_111c-qq_comparing_distributions_files/figure-html/unnamed-chunk-11-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb1102"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">qq_any</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">var</span>, <span class="va">f</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># Find the slope and intercept of the line that passes through the 1st and 3rd</span>
    <span class="co"># quartile of the normal q-q plot</span>
    
    <span class="va">y</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">var</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span>, type<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="co"># Find the 1st and 3rd quartiles</span>
    <span class="va">x</span>     <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>                 <span class="co"># Find the matching normal values x-axis</span>
    <span class="va">slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>                     <span class="co"># Compute the line slope</span>
    <span class="va">int</span>   <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">slope</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>                   <span class="co"># Compute the line intercept</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">var</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">stat_qq</a></span><span class="op">(</span>distribution <span class="op">=</span> <span class="va">f</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="va">int</span>, slope<span class="op">=</span><span class="va">slope</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># two function only, for the moment</span>
<span class="fu">qq_any</span><span class="op">(</span><span class="va">alto</span>, <span class="va">qexp</span><span class="op">)</span>
<span class="fu">qq_any</span><span class="op">(</span><span class="va">alto</span>, <span class="va">qnorm</span><span class="op">)</span></code></pre></div>
<p><img src="999-misc_111c-qq_comparing_distributions_files/figure-html/unnamed-chunk-12-1.png" width="70%" style="display: block; margin: auto;"><img src="999-misc_111c-qq_comparing_distributions_files/figure-html/unnamed-chunk-12-2.png" width="70%" style="display: block; margin: auto;"></p>
<p>We can, of course, make use of ggplot’s faceting function to generate trellised plots. For example, the following plot replicates Cleveland’s figure 2.11 (except for the layout which we’ll setup as a single row of plots instead). But first, we will need to compute the slopes for each singer group. We’ll use dplyr’s piping operations to create a new dataframe with singer group name, slope and intercept.</p>
<div class="sourceCode" id="cb1103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">intsl</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">voice.part</span><span class="op">)</span> <span class="op">%&gt;%</span> 
       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>q25    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">height</span>,<span class="fl">0.25</span>, type<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,
                 q75    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">height</span>,<span class="fl">0.75</span>, type<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,
                 norm25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span> <span class="fl">0.25</span><span class="op">)</span>,
                 norm75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span> <span class="fl">0.75</span><span class="op">)</span>,
                 slope  <span class="op">=</span> <span class="op">(</span><span class="va">q25</span> <span class="op">-</span> <span class="va">q75</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">norm25</span> <span class="op">-</span> <span class="va">norm75</span><span class="op">)</span>,
                 int    <span class="op">=</span> <span class="va">q25</span> <span class="op">-</span> <span class="va">slope</span> <span class="op">*</span> <span class="va">norm25</span><span class="op">)</span> <span class="op">%&gt;%</span>
       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">voice.part</span>, <span class="va">slope</span>, <span class="va">int</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="va">print</span>
<span class="co">#&gt; # A tibble: 8 x 3</span>
<span class="co">#&gt;   voice.part slope   int</span>
<span class="co">#&gt;   &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Bass 2      2.97  72  </span>
<span class="co">#&gt; 2 Bass 1      2.22  70.5</span>
<span class="co">#&gt; 3 Tenor 2     1.48  70  </span>
<span class="co">#&gt; 4 Tenor 1     3.89  68.6</span>
<span class="co">#&gt; 5 Alto 2      2.22  65.5</span>
<span class="co">#&gt; 6 Alto 1      2.78  64.9</span>
<span class="co">#&gt; # … with 2 more rows</span></code></pre></div>
<p>It’s important that the <code>voice.part</code> names match those in <code>df</code> letter-for-letter so that when ggplot is called, it will know which facet to assign the slope and intercept values to via <code>geom_abline</code>.</p>
<div class="sourceCode" id="cb1104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">stat_qq</a></span><span class="op">(</span>distribution <span class="op">=</span> <span class="va">qnorm</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">intsl</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="va">int</span>, slope<span class="op">=</span><span class="va">slope</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">voice.part</span>, nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Height"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="999-misc_111c-qq_comparing_distributions_files/figure-html/unnamed-chunk-14-1.png" width="70%" style="display: block; margin: auto;"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="what-is-dot-hat-in-a-regression-output.html"><span class="header-section-number">A</span> What is dot hat in a regression output</a></div>
<div class="next"><a href="qq-and-pp-plots.html"><span class="header-section-number">C</span> QQ and PP Plots</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#q-q-normal-to-compare-data-to-distributions"><span class="header-section-number">B</span> Q-Q normal to compare data to distributions</a></li>
<li><a class="nav-link" href="#introduction-27"><span class="header-section-number">B.1</span> Introduction</a></li>
<li><a class="nav-link" href="#why-we-want-to-compare-emprirical-vs-theoretical-distributions"><span class="header-section-number">B.2</span> Why we want to compare emprirical vs theoretical distributions</a></li>
<li>
<a class="nav-link" href="#the-normal-q-q-plot"><span class="header-section-number">B.3</span> The normal q-q plot</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#drawing-a-normal-q-q-plot-from-scratch"><span class="header-section-number">B.3.1</span> Drawing a normal q-q plot from scratch</a></li></ul>
</li>
<li><a class="nav-link" href="#using-rs-built-in-functions"><span class="header-section-number">B.4</span> Using R’s built-in functions</a></li>
<li><a class="nav-link" href="#using-the-ggplot2-plotting-environment"><span class="header-section-number">B.5</span> Using the ggplot2 plotting environment</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hadley/r-pkgs/blob/master/999-misc_111c-qq_comparing_distributions.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hadley/r-pkgs/edit/master/999-misc_111c-qq_comparing_distributions.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Machine Learning Compilation</strong>" was written by Several authors. Compiled by Alfonso R. Reyes. It was last built on 2020-11-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
