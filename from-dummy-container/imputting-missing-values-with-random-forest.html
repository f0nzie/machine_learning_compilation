<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 14 Imputting missing values with Random Forest | A Machine Learning Compilation</title>
<meta name="author" content="Several authors. Compiled by Alfonso R. Reyes">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Machine Learning Compilation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preface</a></li>
<li class="book-part">The Basics of Machine Learning</li>
<li><a class="" href="introduction-to-pca.html"><span class="header-section-number">2</span> Introduction to PCA</a></li>
<li><a class="" href="comparison-of-two-pca-packages.html"><span class="header-section-number">3</span> Comparison of two PCA packages</a></li>
<li><a class="" href="detailed-study-of-principal-component-analysis.html"><span class="header-section-number">4</span> Detailed study of Principal Component Analysis</a></li>
<li><a class="" href="detection-of-diabetes-using-logistic-regression.html"><span class="header-section-number">5</span> Detection of diabetes using Logistic Regression</a></li>
<li><a class="" href="sensitivity-analysis-for-a-neural-network.html"><span class="header-section-number">6</span> Sensitivity analysis for a neural network</a></li>
<li><a class="" href="data-visualization-for-ml-models.html"><span class="header-section-number">7</span> Data Visualization for ML models</a></li>
<li class="book-part">Feature Engineering</li>
<li><a class="" href="ten-methods-to-assess-variable-importance.html"><span class="header-section-number">8</span> Ten methods to assess Variable Importance</a></li>
<li><a class="" href="employee-attrition-using-feature-importance.html"><span class="header-section-number">9</span> Employee Attrition using Feature Importance</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="a-gentle-introduction-to-support-vector-machines.html"><span class="header-section-number">10</span> A gentle introduction to Support Vector Machines</a></li>
<li><a class="" href="broad-view-of-svm.html"><span class="header-section-number">11</span> Broad view of SVM</a></li>
<li><a class="" href="feature-selection-to-enhance-cancer-detection.html"><span class="header-section-number">12</span> Feature Selection to enhance cancer detection</a></li>
<li><a class="" href="dealing-with-unbalanced-data.html"><span class="header-section-number">13</span> Dealing with unbalanced data</a></li>
<li><a class="active" href="imputting-missing-values-with-random-forest.html"><span class="header-section-number">14</span> Imputting missing values with Random Forest</a></li>
<li><a class="" href="tuning-of-support-vector-machine-prediction.html"><span class="header-section-number">15</span> Tuning of Support Vector Machine prediction</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="introduction-to-algorithms-for-classification.html"><span class="header-section-number">16</span> Introduction to algorithms for Classification</a></li>
<li><a class="" href="comparing-classification-algorithms.html"><span class="header-section-number">17</span> Comparing Classification algorithms</a></li>
<li><a class="" href="who-buys-social-network-ads.html"><span class="header-section-number">18</span> Who buys Social Network ads</a></li>
<li><a class="" href="predicting-ozone-levels.html"><span class="header-section-number">19</span> Predicting Ozone levels</a></li>
<li><a class="" href="building-a-naive-bayes-classifier.html"><span class="header-section-number">20</span> Building a Naive Bayes Classifier</a></li>
<li><a class="" href="linear-and-non-linear-algorithms-for-classification.html"><span class="header-section-number">21</span> Linear and Non-Linear Algorithms for Classification</a></li>
<li><a class="" href="detect-mines-vs-rocks-with-random-forest.html"><span class="header-section-number">22</span> Detect mines vs rocks with Random Forest</a></li>
<li><a class="" href="predicting-the-type-of-glass.html"><span class="header-section-number">23</span> Predicting the type of glass</a></li>
<li><a class="" href="naive-bayes-for-sms-spam.html"><span class="header-section-number">24</span> Naive Bayes for SMS spam</a></li>
<li><a class="" href="vehicles-classiification-with-decision-trees.html"><span class="header-section-number">25</span> Vehicles classiification with Decision Trees</a></li>
<li><a class="" href="applying-naive-bayes-on-the-titanic-case.html"><span class="header-section-number">26</span> Applying Naive-Bayes on the Titanic case</a></li>
<li><a class="" href="classification-on-bad-loans.html"><span class="header-section-number">27</span> Classification on bad loans</a></li>
<li><a class="" href="predicting-flu-outcome-comparing-eight-classification-algorithms.html"><span class="header-section-number">28</span> Predicting Flu outcome comparing eight classification algorithms</a></li>
<li><a class="" href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></li>
<li><a class="" href="prediction-of-arrhythmia-with-deep-neural-nets.html"><span class="header-section-number">30</span> Prediction of arrhythmia with deep neural nets</a></li>
<li class="book-part">Linear Regression</li>
<li><a class="" href="linear-regression-with-islr.html"><span class="header-section-number">31</span> Linear Regression with ISLR</a></li>
<li><a class="" href="evaluation-of-three-linear-regression-models.html"><span class="header-section-number">32</span> Evaluation of three linear regression models</a></li>
<li><a class="" href="comparison-of-six-linear-regression-algorithms.html"><span class="header-section-number">33</span> Comparison of six Linear Regression algorithms</a></li>
<li><a class="" href="comparing-regression-models.html"><span class="header-section-number">34</span> Comparing regression models</a></li>
<li><a class="" href="finding-the-factors-of-happiness.html"><span class="header-section-number">35</span> Finding the factors of happiness</a></li>
<li><a class="" href="regression-with-a-neural-network.html"><span class="header-section-number">36</span> Regression with a neural network</a></li>
<li><a class="" href="comparing-multiple-regression-vs-a-neural-network.html"><span class="header-section-number">37</span> Comparing Multiple Regression vs a Neural Network</a></li>
<li><a class="" href="temperature-modeling-using-nested-dataframes.html"><span class="header-section-number">38</span> Temperature modeling using nested dataframes</a></li>
<li class="book-part">Neural Networks</li>
<li><a class="" href="credit-scoring-with-neuralnet.html"><span class="header-section-number">39</span> Credit Scoring with neuralnet</a></li>
<li><a class="" href="wine-classification-with-neuralnet.html"><span class="header-section-number">40</span> Wine classification with neuralnet</a></li>
<li><a class="" href="predicting-the-rating-of-cereals.html"><span class="header-section-number">41</span> Predicting the rating of cereals</a></li>
<li><a class="" href="fitting-a-linear-model-with-neural-networks.html"><span class="header-section-number">42</span> Fitting a linear model with neural networks</a></li>
<li><a class="" href="visualization-of-neural-networks.html"><span class="header-section-number">43</span> Visualization of neural networks</a></li>
<li><a class="" href="build-a-fully-connected-r-neural-network-from-scratch.html"><span class="header-section-number">44</span> Build a fully connected R neural network from scratch</a></li>
<li><a class="" href="tuning-hyperparameters-in-a-neural-network.html"><span class="header-section-number">45</span> Tuning Hyperparameters in a Neural Network</a></li>
<li><a class="" href="deep-learning-tips-for-classification-and-regression.html"><span class="header-section-number">46</span> Deep Learning tips for Classification and Regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="what-is-dot-hat-in-a-regression-output.html"><span class="header-section-number">A</span> What is dot hat in a regression output</a></li>
<li><a class="" href="q-q-normal-to-compare-data-to-distributions.html"><span class="header-section-number">B</span> Q-Q normal to compare data to distributions</a></li>
<li><a class="" href="qq-and-pp-plots.html"><span class="header-section-number">C</span> QQ and PP Plots</a></li>
<li><a class="" href="visualizing-residuals.html"><span class="header-section-number">D</span> Visualizing residuals</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/f0nzie/machine_learning_compilation">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="imputting-missing-values-with-random-forest" class="section level1">
<h1>
<span class="header-section-number">14</span> Imputting missing values with Random Forest<a class="anchor" aria-label="anchor" href="#imputting-missing-values-with-random-forest"><i class="fas fa-link"></i></a>
</h1>
<div id="flu-prediction.-fluh7n9_china_2013-dataset" class="section level2">
<h2>
<span class="header-section-number">14.1</span> Flu Prediction. <code>fluH7N9_china_2013</code> dataset<a class="anchor" aria-label="anchor" href="#flu-prediction.-fluh7n9_china_2013-dataset"><i class="fas fa-link"></i></a>
</h2>
<p>Source: <a href="https://shirinsplayground.netlify.com/2018/04/flu_prediction/" class="uri">https://shirinsplayground.netlify.com/2018/04/flu_prediction/</a></p>
<div class="sourceCode" id="cb358"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/reconhub/outbreaks">outbreaks</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr">plyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stefvanbuuren/mice">mice</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tibble.tidyverse.org/">"tibble"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyr.tidyverse.org">"tidyr"</a></span><span class="op">)</span></code></pre></div>
<p>Since I migrated my blog from Github Pages to blogdown and Netlify, I wanted to start migrating (most of) my old posts too - and use that opportunity to update them and make sure the code still works.</p>
<p>Here I am updating my very first machine learning post from 27 Nov 2016: Can we predict flu deaths with Machine Learning and R?. Changes are marked as bold comments.</p>
<p>The main changes I made are:</p>
<ul>
<li><p>using the tidyverse more consistently throughout the analysis</p></li>
<li><p>focusing on comparing multiple imputations from the mice package, rather than comparing different algorithms</p></li>
<li><p>using purrr, map(), nest() and unnest() to model and predict the machine learning algorithm over the different imputed datasets</p></li>
</ul>
<hr>
<p>Among the many nice R packages containing data collections is the <code>outbreaks</code> package. It contains a dataset on epidemics and among them is data from the 2013 outbreak of influenza A H7N9 in China as analysed by Kucharski et al. (2014):</p>
<blockquote>
<p>A. Kucharski, H. Mills, A. Pinsent, C. Fraser, M. Van Kerkhove, C. A. Donnelly, and S. Riley. 2014. Distinguishing between reservoir exposure and human-to-human transmission for emerging pathogens using case onset data. PLOS Currents Outbreaks. Mar 7, edition 1. doi: 10.1371/currents.outbreaks.e1473d9bfc99d080ca242139a06c455f.</p>
</blockquote>
<blockquote>
<p>A. Kucharski, H. Mills, A. Pinsent, C. Fraser, M. Van Kerkhove, C. A. Donnelly, and S. Riley. 2014. Data from: Distinguishing between reservoir exposure and human-to-human transmission for emerging pathogens using case onset data. Dryad Digital Repository. <a href="http://dx.doi.org/10.5061/dryad.2g43n" class="uri">http://dx.doi.org/10.5061/dryad.2g43n</a>.</p>
</blockquote>
<p>I will be using their data as an example to show how to use Machine Learning algorithms for predicting disease outcome.</p>
</div>
<div id="the-data" class="section level2">
<h2>
<span class="header-section-number">14.2</span> The data<a class="anchor" aria-label="anchor" href="#the-data"><i class="fas fa-link"></i></a>
</h2>
<p>The dataset contains case ID, date of onset, date of hospitalization, date of outcome, gender, age, province and of course outcome: Death or Recovery.</p>
<div id="pre-processing" class="section level3">
<h3>
<span class="header-section-number">14.2.1</span> Pre-processing<a class="anchor" aria-label="anchor" href="#pre-processing"><i class="fas fa-link"></i></a>
</h3>
<p>Change: variable names (i.e. column names) have been renamed, dots have been replaced with underscores, letters are all lower case now.</p>
<p>Change: I am using the tidyverse notation more consistently.</p>
<p>First, I’m doing some preprocessing, including:</p>
<ul>
<li>renaming missing data as NA</li>
<li>adding an ID column</li>
<li>setting column types</li>
<li>gathering date columns</li>
<li>changing factor names of dates (to make them look nicer in plots) and of province (to combine provinces with few cases)</li>
</ul>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">from1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_of_onset"</span>, <span class="st">"date_of_hospitalisation"</span>, <span class="st">"date_of_outcome"</span><span class="op">)</span>
<span class="va">to1</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date of onset"</span>, <span class="st">"date of hospitalisation"</span>, <span class="st">"date of outcome"</span><span class="op">)</span>
<span class="va">from2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Anhui"</span>, <span class="st">"Beijing"</span>, <span class="st">"Fujian"</span>, <span class="st">"Guangdong"</span>, <span class="st">"Hebei"</span>, <span class="st">"Henan"</span>, 
           <span class="st">"Hunan"</span>, <span class="st">"Jiangxi"</span>, <span class="st">"Shandong"</span>, <span class="st">"Taiwan"</span><span class="op">)</span>
<span class="va">to2</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="fl">10</span><span class="op">)</span>

<span class="va">fluH7N9_china_2013</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013</span><span class="op">$</span><span class="va">age</span> <span class="op">==</span> <span class="st">"?"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">fluH7N9_china_2013_gather</span> <span class="op">&lt;-</span> <span class="va">fluH7N9_china_2013</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html">mutate</a></span><span class="op">(</span>case_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"case"</span>, <span class="va">case_id</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>,
         age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">Group</span>, <span class="va">Date</span>, <span class="va">date_of_onset</span><span class="op">:</span><span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html">mutate</a></span><span class="op">(</span>Group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">Group</span>, from <span class="op">=</span> <span class="va">from1</span>, to <span class="op">=</span> <span class="va">to1</span><span class="op">)</span><span class="op">)</span>,
         province <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mapvalues.html">mapvalues</a></span><span class="op">(</span><span class="va">province</span>, from <span class="op">=</span> <span class="va">from2</span>, to <span class="op">=</span> <span class="va">to2</span><span class="op">)</span><span class="op">)</span>

<span class="va">fluH7N9_china_2013</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html">as.tibble</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013</span><span class="op">)</span>
<span class="co">#&gt; Warning: `as.tibble()` is deprecated as of tibble 2.0.0.</span>
<span class="co">#&gt; Please use `as_tibble()` instead.</span>
<span class="co">#&gt; The signature and semantics have changed, see `?as_tibble`.</span>
<span class="co">#&gt; This warning is displayed once every 8 hours.</span>
<span class="co">#&gt; Call `lifecycle::last_warnings()` to see where this warning was generated.</span>
<span class="va">fluH7N9_china_2013_gather</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html">as.tibble</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 136 x 8</span>
<span class="co">#&gt;   case_id date_of_onset date_of_hospita… date_of_outcome outcome gender age  </span>
<span class="co">#&gt;   &lt;fct&gt;   &lt;date&gt;        &lt;date&gt;           &lt;date&gt;          &lt;fct&gt;   &lt;fct&gt;  &lt;fct&gt;</span>
<span class="co">#&gt; 1 1       2013-02-19    NA               2013-03-04      Death   m      87   </span>
<span class="co">#&gt; 2 2       2013-02-27    2013-03-03       2013-03-10      Death   m      27   </span>
<span class="co">#&gt; 3 3       2013-03-09    2013-03-19       2013-04-09      Death   f      35   </span>
<span class="co">#&gt; 4 4       2013-03-19    2013-03-27       NA              &lt;NA&gt;    f      45   </span>
<span class="co">#&gt; 5 5       2013-03-19    2013-03-30       2013-05-15      Recover f      48   </span>
<span class="co">#&gt; 6 6       2013-03-21    2013-03-28       2013-04-26      Death   f      32   </span>
<span class="co">#&gt; # … with 130 more rows, and 1 more variable: province &lt;fct&gt;</span></code></pre></div>
<p>I’m also adding a third gender level for unknown gender</p>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span>, <span class="st">"unknown"</span><span class="op">)</span>
<span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"unknown"</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fluH7N9_china_2013_gather</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 408 x 7</span>
<span class="co">#&gt;   case_id outcome gender   age province Group         Date      </span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;fct&gt;   &lt;fct&gt;  &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;         &lt;date&gt;    </span>
<span class="co">#&gt; 1 case_1  Death   m         58 Shanghai date of onset 2013-02-19</span>
<span class="co">#&gt; 2 case_2  Death   m          7 Shanghai date of onset 2013-02-27</span>
<span class="co">#&gt; 3 case_3  Death   f         11 Other    date of onset 2013-03-09</span>
<span class="co">#&gt; 4 case_4  &lt;NA&gt;    f         18 Jiangsu  date of onset 2013-03-19</span>
<span class="co">#&gt; 5 case_5  Recover f         20 Jiangsu  date of onset 2013-03-19</span>
<span class="co">#&gt; 6 case_6  Death   f          9 Jiangsu  date of onset 2013-03-21</span>
<span class="co">#&gt; # … with 402 more rows</span></code></pre></div>
<p>For plotting, I am defining a custom ggplot2 theme:</p>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_theme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">base_size</span> <span class="op">=</span> <span class="fl">12</span>, <span class="va">base_family</span> <span class="op">=</span> <span class="st">"sans"</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_size</span>, base_family <span class="op">=</span> <span class="va">base_family</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,
    panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,
    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"aliceblue"</span><span class="op">)</span>,
    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"lightgrey"</span>, color <span class="op">=</span> <span class="st">"grey"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">12</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
    legend.justification <span class="op">=</span> <span class="st">"top"</span>, 
    legend.box <span class="op">=</span> <span class="st">"horizontal"</span>,
    legend.box.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,
    legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, fill <span class="op">=</span> <span class="cn">NA</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>And use that theme to visualize the data:</p>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fluH7N9_china_2013_gather</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">age</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">stat_density2d</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">..level..</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"polygon"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">outcome</span>, shape <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html">geom_rug</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    fill <span class="op">=</span> <span class="st">"Outcome"</span>,
    color <span class="op">=</span> <span class="st">"Outcome"</span>,
    alpha <span class="op">=</span> <span class="st">"Level"</span>,
    shape <span class="op">=</span> <span class="st">"Gender"</span>,
    x <span class="op">=</span> <span class="st">"Date in 2013"</span>,
    y <span class="op">=</span> <span class="st">"Age"</span>,
    title <span class="op">=</span> <span class="st">"2013 Influenza A H7N9 cases in China"</span>,
    subtitle <span class="op">=</span> <span class="st">"Dataset from 'outbreaks' package (Kucharski et al. 2014)"</span>,
    caption <span class="op">=</span> <span class="st">""</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">Group</span> <span class="op">~</span> <span class="va">province</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 149 rows containing non-finite values (stat_density2d).</span>
<span class="co">#&gt; Warning: Removed 149 rows containing missing values (geom_point).</span></code></pre></div>
<div class="inline-figure"><img src="105-fe-meta_230-missing_data_flu-sglander_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fluH7N9_china_2013_gather</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">age</span>, color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">outcome</span>, shape <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">case_id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">province</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">17</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    color <span class="op">=</span> <span class="st">"Outcome"</span>,
    shape <span class="op">=</span> <span class="st">"Gender"</span>,
    x <span class="op">=</span> <span class="st">"Date in 2013"</span>,
    y <span class="op">=</span> <span class="st">"Age"</span>,
    title <span class="op">=</span> <span class="st">"2013 Influenza A H7N9 cases in China"</span>,
    subtitle <span class="op">=</span> <span class="st">"Dataset from 'outbreaks' package (Kucharski et al. 2014)"</span>,
    caption <span class="op">=</span> <span class="st">"\nTime from onset of flu to outcome."</span>
  <span class="op">)</span>
<span class="co">#&gt; Warning: Removed 149 rows containing missing values (geom_point).</span>
<span class="co">#&gt; Warning: Removed 122 row(s) containing missing values (geom_path).</span></code></pre></div>
<div class="inline-figure"><img src="105-fe-meta_230-missing_data_flu-sglander_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="features" class="section level2">
<h2>
<span class="header-section-number">14.3</span> Features<a class="anchor" aria-label="anchor" href="#features"><i class="fas fa-link"></i></a>
</h2>
<p>In machine learning-speak features are what we call the variables used for model training. Using the right features dramatically influences the accuracy and success of your model.</p>
<p>For this example, I am keeping age, but I am also generating new features from the date information and converting gender and province into numerical values.</p>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">delta_dates</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">onset</span>, <span class="va">ref</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">d2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">onset</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
    <span class="va">d1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">ref</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" days"</span>, <span class="st">""</span>, <span class="va">d1</span> <span class="op">-</span> <span class="va">d2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">fluH7N9_china_2013</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html">mutate</a></span><span class="op">(</span>
      hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_of_hospitalisation</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, 
      gender_f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"f"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, 
      province_Jiangsu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">province</span> <span class="op">==</span> <span class="st">"Jiangsu"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, 
      province_Shanghai <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">province</span> <span class="op">==</span> <span class="st">"Shanghai"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, 
      province_Zhejiang <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">province</span> <span class="op">==</span> <span class="st">"Zhejiang"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, 
      province_other <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">province</span> <span class="op">==</span> <span class="st">"Zhejiang"</span> 
                                           <span class="op">|</span> <span class="va">province</span> <span class="op">==</span> <span class="st">"Jiangsu"</span> 
                                           <span class="op">|</span> <span class="va">province</span> <span class="op">==</span> <span class="st">"Shanghai"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
      
      days_onset_to_outcome <span class="op">=</span> <span class="fu">delta_dates</span><span class="op">(</span><span class="va">date_of_onset</span>, <span class="va">date_of_outcome</span><span class="op">)</span>,
      days_onset_to_hospital <span class="op">=</span> <span class="fu">delta_dates</span><span class="op">(</span><span class="va">date_of_onset</span>, <span class="va">date_of_hospitalisation</span><span class="op">)</span>,
      age <span class="op">=</span> <span class="va">age</span>,
      early_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">date_of_onset</span> <span class="op">&lt;</span> 
                                     <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">date_of_onset</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
      early_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/h2o.ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">date_of_outcome</span> <span class="op">&lt;</span>
                                       <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">date_of_outcome</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/subset.data.table.html">subset</a></span><span class="op">(</span>select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>
<span class="co"># convert tibble to data.frame; tibble causing error</span>
<span class="va">dataset_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">dataset_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dataset_df</span><span class="op">$</span><span class="va">case_id</span>
<span class="va">dataset_df</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dataset_df</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">dataset_df</span>     <span class="co"># copy to dataset object</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span>
<span class="co">#&gt; Rows: 136</span>
<span class="co">#&gt; Columns: 13</span>
<span class="co">#&gt; $ case_id                &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,…</span>
<span class="co">#&gt; $ outcome                &lt;fct&gt; Death, Death, Death, NA, Recover, Death, Death…</span>
<span class="co">#&gt; $ age                    &lt;dbl&gt; 87, 27, 35, 45, 48, 32, 83, 38, 67, 48, 64, 52…</span>
<span class="co">#&gt; $ hospital               &lt;dbl&gt; 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0…</span>
<span class="co">#&gt; $ gender_f               &lt;dbl&gt; 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0…</span>
<span class="co">#&gt; $ province_Jiangsu       &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1…</span>
<span class="co">#&gt; $ province_Shanghai      &lt;dbl&gt; 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0…</span>
<span class="co">#&gt; $ province_Zhejiang      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ province_other         &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ days_onset_to_outcome  &lt;dbl&gt; 13, 11, 31, NA, 57, 36, 20, 20, NA, 6, 6, 7, 1…</span>
<span class="co">#&gt; $ days_onset_to_hospital &lt;dbl&gt; NA, 4, 10, 8, 11, 7, 9, 11, 0, 4, 2, NA, 3, NA…</span>
<span class="co">#&gt; $ early_onset            &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span>
<span class="co">#&gt; $ early_outcome          &lt;dbl&gt; 1, 1, 1, NA, 0, 1, 1, 1, NA, 1, 1, 1, 1, 1, NA…</span></code></pre></div>
<div class="sourceCode" id="cb366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span>
<span class="co">#&gt;   Death Recover    NA's </span>
<span class="co">#&gt;      32      47      57</span></code></pre></div>
</div>
<div id="imputing-missing-values" class="section level2">
<h2>
<span class="header-section-number">14.4</span> Imputing missing values<a class="anchor" aria-label="anchor" href="#imputing-missing-values"><i class="fas fa-link"></i></a>
</h2>
<p>I am using the <code>mice</code> package for imputing missing values</p>
<p>Note: Since publishing this blogpost I learned that the idea behind using mice is to compare different imputations to see how stable they are, instead of picking one imputed set as fixed for the remainder of the analysis. Therefore, I changed the focus of this post a little bit: in the old post I compared many different algorithms and their outcome; in this updated version I am only showing the <strong>Random Forest</strong> algorithm and focus on <strong>comparing the different imputed datasets</strong>. I am ignoring feature importance and feature plots because nothing changed compared to the old post.</p>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the missing data in a matrix by variables</span>
<span class="va">md_pattern</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mice/man/md.pattern.html">md.pattern</a></span><span class="op">(</span><span class="va">dataset</span>, rotate.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="105-fe-meta_230-missing_data_flu-sglander_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dataset[, -2] would not work anymore in tibbles</span>
<span class="va">dataset_impute</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mice/man/mice.html">mice</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dataset</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span><span class="op">]</span>,  print <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Warning: Number of logged events: 150</span></code></pre></div>
<div id="generate-a-dataframe-of-five-imputting-strategies" class="section level3">
<h3>
<span class="header-section-number">14.4.1</span> Generate a dataframe of five imputting strategies<a class="anchor" aria-label="anchor" href="#generate-a-dataframe-of-five-imputting-strategies"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>by default, mice() calculates five (m = 5) imputed data sets</li>
<li>we can combine them all in one output with the complete(“long”) function</li>
<li>I did not want to impute missing values in the outcome column, so I have to merge it back in with the imputed data</li>
</ul>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># c(1,2): case_id, outcome</span>
<span class="va">datasets_complete</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join.html">right_join</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span>, 
                           <span class="fu"><a href="https://rdrr.io/pkg/mice/man/complete.mids.html">complete</a></span><span class="op">(</span><span class="va">dataset_impute</span>, <span class="st">"long"</span><span class="op">)</span>,
                           by <span class="op">=</span> <span class="st">"case_id"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html">mutate</a></span><span class="op">(</span>.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/as.factor.html">as.factor</a></span><span class="op">(</span><span class="va">.imp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">.id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Rows: 680</span>
<span class="co">#&gt; Columns: 14</span>
<span class="co">#&gt; $ case_id                &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,…</span>
<span class="co">#&gt; $ outcome                &lt;fct&gt; Death, Death, Death, NA, Recover, Death, Death…</span>
<span class="co">#&gt; $ .imp                   &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span>
<span class="co">#&gt; $ age                    &lt;dbl&gt; 87, 27, 35, 45, 48, 32, 83, 38, 67, 48, 64, 52…</span>
<span class="co">#&gt; $ hospital               &lt;dbl&gt; 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0…</span>
<span class="co">#&gt; $ gender_f               &lt;dbl&gt; 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0…</span>
<span class="co">#&gt; $ province_Jiangsu       &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1…</span>
<span class="co">#&gt; $ province_Shanghai      &lt;dbl&gt; 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0…</span>
<span class="co">#&gt; $ province_Zhejiang      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ province_other         &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ days_onset_to_outcome  &lt;dbl&gt; 13, 11, 31, 57, 57, 36, 20, 20, 6, 6, 6, 7, 12…</span>
<span class="co">#&gt; $ days_onset_to_hospital &lt;dbl&gt; 4, 4, 10, 8, 11, 7, 9, 11, 0, 4, 2, 0, 3, 1, 7…</span>
<span class="co">#&gt; $ early_onset            &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span>
<span class="co">#&gt; $ early_outcome          &lt;dbl&gt; 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></code></pre></div>
<p>Let’s compare the distributions of the five different imputed datasets:</p>
</div>
<div id="plot-effect-of-imputting-on-features" class="section level3">
<h3>
<span class="header-section-number">14.4.2</span> plot effect of imputting on features<a class="anchor" aria-label="anchor" href="#plot-effect-of-imputting-on-features"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb370"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datasets_complete</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">age</span><span class="op">:</span><span class="va">early_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">.imp</span>, color <span class="op">=</span> <span class="va">.imp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">x</span>, ncol <span class="op">=</span> <span class="fl">3</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="105-fe-meta_230-missing_data_flu-sglander_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="test-train-and-validation-data-sets" class="section level2">
<h2>
<span class="header-section-number">14.5</span> Test, train and validation data sets<a class="anchor" aria-label="anchor" href="#test-train-and-validation-data-sets"><i class="fas fa-link"></i></a>
</h2>
<p>Now, we can go ahead with machine learning!</p>
<p>The dataset contains a few missing values in the outcome column; those will be the test set used for final predictions (see the old blog post for this).</p>
<div class="sourceCode" id="cb371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">datasets_complete</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">datasets_complete</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 285</span>
<span class="co">#&gt; [1] 395</span></code></pre></div>
<div class="sourceCode" id="cb372"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">datasets_complete</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span>
<span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">datasets_complete</span><span class="op">[</span><span class="op">-</span><span class="va">train_index</span>, <span class="op">]</span>
<span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="va">datasets_complete</span><span class="op">[</span><span class="va">train_index</span>, <span class="op">-</span><span class="fl">2</span><span class="op">]</span>       <span class="co"># remove variable outcome</span></code></pre></div>
<div class="sourceCode" id="cb373"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">)</span>
<span class="co">#&gt; Rows: 395</span>
<span class="co">#&gt; Columns: 14</span>
<span class="co">#&gt; $ case_id                &lt;dbl&gt; 1, 2, 3, 5, 6, 7, 8, 10, 11, 12, 13, 14, 17, 1…</span>
<span class="co">#&gt; $ outcome                &lt;fct&gt; Death, Death, Death, Recover, Death, Death, De…</span>
<span class="co">#&gt; $ .imp                   &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span>
<span class="co">#&gt; $ age                    &lt;dbl&gt; 87, 27, 35, 48, 32, 83, 38, 48, 64, 52, 67, 4,…</span>
<span class="co">#&gt; $ hospital               &lt;dbl&gt; 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1…</span>
<span class="co">#&gt; $ gender_f               &lt;dbl&gt; 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ province_Jiangsu       &lt;dbl&gt; 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ province_Shanghai      &lt;dbl&gt; 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0…</span>
<span class="co">#&gt; $ province_Zhejiang      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ province_other         &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1…</span>
<span class="co">#&gt; $ days_onset_to_outcome  &lt;dbl&gt; 13, 11, 31, 57, 36, 20, 20, 6, 6, 7, 12, 10, 1…</span>
<span class="co">#&gt; $ days_onset_to_hospital &lt;dbl&gt; 4, 4, 10, 11, 7, 9, 11, 4, 2, 0, 3, 1, 6, 4, 5…</span>
<span class="co">#&gt; $ early_onset            &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span>
<span class="co">#&gt; $ early_outcome          &lt;dbl&gt; 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1…</span></code></pre></div>
<div class="sourceCode" id="cb374"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># outcome variable removed</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>
<span class="co">#&gt; Rows: 285</span>
<span class="co">#&gt; Columns: 13</span>
<span class="co">#&gt; $ case_id                &lt;dbl&gt; 4, 9, 15, 16, 22, 28, 31, 32, 38, 39, 40, 41, …</span>
<span class="co">#&gt; $ .imp                   &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span>
<span class="co">#&gt; $ age                    &lt;dbl&gt; 45, 67, 61, 79, 85, 79, 70, 74, 56, 66, 74, 54…</span>
<span class="co">#&gt; $ hospital               &lt;dbl&gt; 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0…</span>
<span class="co">#&gt; $ gender_f               &lt;dbl&gt; 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1…</span>
<span class="co">#&gt; $ province_Jiangsu       &lt;dbl&gt; 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0…</span>
<span class="co">#&gt; $ province_Shanghai      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0…</span>
<span class="co">#&gt; $ province_Zhejiang      &lt;dbl&gt; 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1…</span>
<span class="co">#&gt; $ province_other         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span>
<span class="co">#&gt; $ days_onset_to_outcome  &lt;dbl&gt; 57, 6, 37, 30, 21, 17, 14, 13, 11, 15, 10, 22,…</span>
<span class="co">#&gt; $ days_onset_to_hospital &lt;dbl&gt; 8, 0, 7, 11, 4, 6, 4, 6, 4, 0, 5, 6, 7, 3, 6, …</span>
<span class="co">#&gt; $ early_onset            &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1…</span>
<span class="co">#&gt; $ early_outcome          &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1…</span></code></pre></div>
<p>The remainder of the data will be used for modeling. Here, I am splitting the data into 70% training and 30% test data.</p>
<p>Because I want to model each imputed dataset separately, I am using the <code><a href="https://tidyr.tidyverse.org/reference/nest.html">nest()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> functions.</p>
<div class="sourceCode" id="cb375"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_data_nest</span> <span class="op">&lt;-</span> <span class="va">train_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">.imp</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt; # Groups:   .imp [5]</span>
<span class="co">#&gt;   .imp  data              </span>
<span class="co">#&gt;   &lt;fct&gt; &lt;list&gt;            </span>
<span class="co">#&gt; 1 1     &lt;tibble [79 × 13]&gt;</span>
<span class="co">#&gt; 2 2     &lt;tibble [79 × 13]&gt;</span>
<span class="co">#&gt; 3 3     &lt;tibble [79 × 13]&gt;</span>
<span class="co">#&gt; 4 4     &lt;tibble [79 × 13]&gt;</span>
<span class="co">#&gt; 5 5     &lt;tibble [79 × 13]&gt;</span></code></pre></div>
<div class="sourceCode" id="cb376"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># split the training data in validation training and validation test</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>
<span class="va">val_data</span> <span class="op">&lt;-</span> <span class="va">train_data_nest</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html">mutate</a></span><span class="op">(</span>val_index <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">outcome</span>, 
                                                     p <span class="op">=</span> <span class="fl">0.7</span>, 
                                               list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,
         val_train_data <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">val_index</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">[</span><span class="va">.y</span>, <span class="op">]</span><span class="op">)</span>,
         val_test_data  <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">val_index</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">[</span><span class="op">-</span><span class="va">.y</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Warning: The `i` argument of ``[`()` can't be a matrix as of tibble 3.0.0.</span>
<span class="co">#&gt; Convert to a vector.</span>
<span class="co">#&gt; This warning is displayed once every 8 hours.</span>
<span class="co">#&gt; Call `lifecycle::last_warnings()` to see where this warning was generated.</span>
<span class="co">#&gt; # A tibble: 5 x 5</span>
<span class="co">#&gt; # Groups:   .imp [5]</span>
<span class="co">#&gt;   .imp  data              val_index          val_train_data    val_test_data    </span>
<span class="co">#&gt;   &lt;fct&gt; &lt;list&gt;            &lt;list&gt;             &lt;list&gt;            &lt;list&gt;           </span>
<span class="co">#&gt; 1 1     &lt;tibble [79 × 13… &lt;int[,1] [56 × 1]&gt; &lt;tibble [56 × 13… &lt;tibble [23 × 13…</span>
<span class="co">#&gt; 2 2     &lt;tibble [79 × 13… &lt;int[,1] [56 × 1]&gt; &lt;tibble [56 × 13… &lt;tibble [23 × 13…</span>
<span class="co">#&gt; 3 3     &lt;tibble [79 × 13… &lt;int[,1] [56 × 1]&gt; &lt;tibble [56 × 13… &lt;tibble [23 × 13…</span>
<span class="co">#&gt; 4 4     &lt;tibble [79 × 13… &lt;int[,1] [56 × 1]&gt; &lt;tibble [56 × 13… &lt;tibble [23 × 13…</span>
<span class="co">#&gt; 5 5     &lt;tibble [79 × 13… &lt;int[,1] [56 × 1]&gt; &lt;tibble [56 × 13… &lt;tibble [23 × 13…</span></code></pre></div>
</div>
<div id="machine-learning-algorithms" class="section level2">
<h2>
<span class="header-section-number">14.6</span> Machine Learning algorithms<a class="anchor" aria-label="anchor" href="#machine-learning-algorithms"><i class="fas fa-link"></i></a>
</h2>
<div id="random-forest" class="section level3">
<h3>
<span class="header-section-number">14.6.1</span> Random Forest<a class="anchor" aria-label="anchor" href="#random-forest"><i class="fas fa-link"></i></a>
</h3>
<p>To make the code tidier, I am first defining the modeling function with the parameters I want.</p>
<div class="sourceCode" id="cb377"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">.</span>,
               data <span class="op">=</span> <span class="va">df</span>,
               method <span class="op">=</span> <span class="st">"rf"</span>,
               preProcess <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"scale"</span>, <span class="st">"center"</span><span class="op">)</span>,
               trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"repeatedcv"</span>, 
                                        number <span class="op">=</span> <span class="fl">5</span>, 
                                        repeats <span class="op">=</span> <span class="fl">3</span>, 
                                        verboseIter <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="add-model-and-prediction-to-nested-dataframe-and-calculate" class="section level3">
<h3>
<span class="header-section-number">14.6.2</span> Add model and prediction to nested dataframe and calculate<a class="anchor" aria-label="anchor" href="#add-model-and-prediction-to-nested-dataframe-and-calculate"><i class="fas fa-link"></i></a>
</h3>
<p>Next, I am using the nested tibble from before to map() the model function, predict the outcome and calculate confusion matrices.</p>
<div id="add-model-list-column" class="section level4">
<h4>
<span class="header-section-number">14.6.2.1</span> add model list-column<a class="anchor" aria-label="anchor" href="#add-model-list-column"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb378"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">val_data_model</span> <span class="op">&lt;-</span> <span class="va">val_data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">val_train_data</span>, <span class="op">~</span> <span class="fu">model_function</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">val_index</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 x 5</span>
<span class="co">#&gt; # Groups:   .imp [5]</span>
<span class="co">#&gt;   .imp  data               val_train_data     val_test_data      model  </span>
<span class="co">#&gt;   &lt;fct&gt; &lt;list&gt;             &lt;list&gt;             &lt;list&gt;             &lt;list&gt; </span>
<span class="co">#&gt; 1 1     &lt;tibble [79 × 13]&gt; &lt;tibble [56 × 13]&gt; &lt;tibble [23 × 13]&gt; &lt;train&gt;</span>
<span class="co">#&gt; 2 2     &lt;tibble [79 × 13]&gt; &lt;tibble [56 × 13]&gt; &lt;tibble [23 × 13]&gt; &lt;train&gt;</span>
<span class="co">#&gt; 3 3     &lt;tibble [79 × 13]&gt; &lt;tibble [56 × 13]&gt; &lt;tibble [23 × 13]&gt; &lt;train&gt;</span>
<span class="co">#&gt; 4 4     &lt;tibble [79 × 13]&gt; &lt;tibble [56 × 13]&gt; &lt;tibble [23 × 13]&gt; &lt;train&gt;</span>
<span class="co">#&gt; 5 5     &lt;tibble [79 × 13]&gt; &lt;tibble [56 × 13]&gt; &lt;tibble [23 × 13]&gt; &lt;train&gt;</span></code></pre></div>
</div>
<div id="add-prediction-and-confusion-matrix-list-columns" class="section level4">
<h4>
<span class="header-section-number">14.6.2.2</span> add prediction and confusion matrix list-columns<a class="anchor" aria-label="anchor" href="#add-prediction-and-confusion-matrix-list-columns"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb379"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>
<span class="va">val_data_model</span> <span class="op">&lt;-</span> <span class="va">val_data_model</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html">mutate</a></span><span class="op">(</span>
         predict <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">val_test_data</span>, <span class="op">~</span> 
                            <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>prediction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         predict_prob <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">val_test_data</span>, <span class="op">~</span> 
                            <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="va">.y</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, 
                            prediction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         confusion_matrix <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">val_test_data</span>, <span class="va">predict</span>, <span class="op">~</span> 
                                     <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">outcome</span>, <span class="va">.y</span><span class="op">$</span><span class="va">prediction</span><span class="op">)</span><span class="op">)</span>,
         confusion_matrix_tbl <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">confusion_matrix</span>, <span class="op">~</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html">as.tibble</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">table</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 x 9</span>
<span class="co">#&gt; # Groups:   .imp [5]</span>
<span class="co">#&gt;   .imp  data  val_train_data val_test_data model predict predict_prob</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;lis&gt; &lt;list&gt;         &lt;list&gt;        &lt;lis&gt; &lt;list&gt;  &lt;list&gt;      </span>
<span class="co">#&gt; 1 1     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… &lt;df[,3] [23…</span>
<span class="co">#&gt; 2 2     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… &lt;df[,3] [23…</span>
<span class="co">#&gt; 3 3     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… &lt;df[,3] [23…</span>
<span class="co">#&gt; 4 4     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… &lt;df[,3] [23…</span>
<span class="co">#&gt; 5 5     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… &lt;df[,3] [23…</span>
<span class="co">#&gt; # … with 2 more variables: confusion_matrix &lt;list&gt;, confusion_matrix_tbl &lt;list&gt;</span></code></pre></div>
<blockquote>
<p>Finally, we have a nested dataframe of 5 rows or cases, one per imputting strategy with its corresponding models and prediction results.</p>
</blockquote>
</div>
</div>
</div>
<div id="comparing-accuracy-of-models" class="section level2">
<h2>
<span class="header-section-number">14.7</span> Comparing accuracy of models<a class="anchor" aria-label="anchor" href="#comparing-accuracy-of-models"><i class="fas fa-link"></i></a>
</h2>
<p>To compare how the different imputations did, I am plotting the confusion matrices:</p>
<div class="sourceCode" id="cb380"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">val_data_model_unnest</span> <span class="op">&lt;-</span> <span class="va">val_data_model</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">confusion_matrix_tbl</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 x 11</span>
<span class="co">#&gt; # Groups:   .imp [5]</span>
<span class="co">#&gt;   .imp  data  val_train_data val_test_data model predict predict_prob</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;lis&gt; &lt;list&gt;         &lt;list&gt;        &lt;lis&gt; &lt;list&gt;  &lt;list&gt;      </span>
<span class="co">#&gt; 1 1     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… &lt;df[,3] [23…</span>
<span class="co">#&gt; 2 1     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… &lt;df[,3] [23…</span>
<span class="co">#&gt; 3 1     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… &lt;df[,3] [23…</span>
<span class="co">#&gt; 4 1     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… &lt;df[,3] [23…</span>
<span class="co">#&gt; 5 2     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… &lt;df[,3] [23…</span>
<span class="co">#&gt; 6 2     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… &lt;df[,3] [23…</span>
<span class="co">#&gt; # … with 14 more rows, and 4 more variables: confusion_matrix &lt;list&gt;,</span>
<span class="co">#&gt; #   Prediction &lt;chr&gt;, Reference &lt;chr&gt;, n &lt;int&gt;</span></code></pre></div>
<div class="sourceCode" id="cb381"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">val_data_model_unnest</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Prediction</span>, y <span class="op">=</span> <span class="va">Reference</span>, fill <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.imp</span>, ncol <span class="op">=</span> <span class="fl">5</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="105-fe-meta_230-missing_data_flu-sglander_files/figure-html/unnamed-chunk-24-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>and the prediction probabilities for correct and wrong predictions:</p>
<div class="sourceCode" id="cb382"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">val_data_model_gather</span> <span class="op">&lt;-</span> <span class="va">val_data_model</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">predict_prob</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">prediction.Death</span><span class="op">:</span><span class="va">prediction.Recover</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 230 x 11</span>
<span class="co">#&gt; # Groups:   .imp [5]</span>
<span class="co">#&gt;   .imp  data  val_train_data val_test_data model predict outcome</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;lis&gt; &lt;list&gt;         &lt;list&gt;        &lt;lis&gt; &lt;list&gt;  &lt;fct&gt;  </span>
<span class="co">#&gt; 1 1     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… Death  </span>
<span class="co">#&gt; 2 1     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… Recover</span>
<span class="co">#&gt; 3 1     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… Death  </span>
<span class="co">#&gt; 4 1     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… Death  </span>
<span class="co">#&gt; 5 1     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… Recover</span>
<span class="co">#&gt; 6 1     &lt;tib… &lt;tibble [56 ×… &lt;tibble [23 … &lt;tra… &lt;df[,1… Recover</span>
<span class="co">#&gt; # … with 224 more rows, and 4 more variables: confusion_matrix &lt;list&gt;,</span>
<span class="co">#&gt; #   confusion_matrix_tbl &lt;list&gt;, x &lt;chr&gt;, y &lt;dbl&gt;</span></code></pre></div>
<div class="sourceCode" id="cb383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">val_data_model_gather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.imp</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Set1"</span>, na.value <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">my_theme</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="105-fe-meta_230-missing_data_flu-sglander_files/figure-html/unnamed-chunk-26-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>Hope, you found that example interesting and helpful!</p>
<div class="sourceCode" id="cb384"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 3.6.3 (2020-02-29)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Debian GNU/Linux 10 (buster)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/libopenblasp-r0.3.5.so</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span>
<span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span>
<span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             </span>
<span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span>
<span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt;  [1] caret_6.0-86    lattice_0.20-38 mice_3.8.0      plyr_1.8.6     </span>
<span class="co">#&gt;  [5] forcats_0.5.0   stringr_1.4.0   dplyr_0.8.5     purrr_0.3.4    </span>
<span class="co">#&gt;  [9] readr_1.3.1     tidyr_1.0.2     tibble_3.0.1    ggplot2_3.3.0  </span>
<span class="co">#&gt; [13] tidyverse_1.3.0 outbreaks_1.5.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] nlme_3.1-144         fs_1.4.1             lubridate_1.7.8     </span>
<span class="co">#&gt;  [4] RColorBrewer_1.1-2   httr_1.4.1           tools_3.6.3         </span>
<span class="co">#&gt;  [7] backports_1.1.6      bslib_0.2.2.9000     utf8_1.1.4          </span>
<span class="co">#&gt; [10] R6_2.4.1             rpart_4.1-15         DBI_1.1.0           </span>
<span class="co">#&gt; [13] colorspace_1.4-1     nnet_7.3-12          withr_2.2.0         </span>
<span class="co">#&gt; [16] tidyselect_1.0.0     downlit_0.2.1.9000   compiler_3.6.3      </span>
<span class="co">#&gt; [19] cli_2.0.2            rvest_0.3.5          xml2_1.3.2          </span>
<span class="co">#&gt; [22] isoband_0.2.1        labeling_0.3         bookdown_0.21.4     </span>
<span class="co">#&gt; [25] sass_0.2.0.9005      scales_1.1.0         randomForest_4.6-14 </span>
<span class="co">#&gt; [28] rappdirs_0.3.1       digest_0.6.25        rmarkdown_2.5.3     </span>
<span class="co">#&gt; [31] pkgconfig_2.0.3      htmltools_0.5.0.9003 dbplyr_1.4.3        </span>
<span class="co">#&gt; [34] rlang_0.4.5          readxl_1.3.1         rstudioapi_0.11     </span>
<span class="co">#&gt; [37] farver_2.0.3         jquerylib_0.1.2      generics_0.0.2      </span>
<span class="co">#&gt; [40] jsonlite_1.6.1       ModelMetrics_1.2.2.2 magrittr_1.5        </span>
<span class="co">#&gt; [43] Matrix_1.2-18        Rcpp_1.0.4.6         munsell_0.5.0       </span>
<span class="co">#&gt; [46] fansi_0.4.1          lifecycle_0.2.0      stringi_1.4.6       </span>
<span class="co">#&gt; [49] pROC_1.16.2          yaml_2.2.1           MASS_7.3-51.5       </span>
<span class="co">#&gt; [52] recipes_0.1.10       grid_3.6.3           crayon_1.3.4        </span>
<span class="co">#&gt; [55] haven_2.2.0          splines_3.6.3        hms_0.5.3           </span>
<span class="co">#&gt; [58] knitr_1.28           pillar_1.4.3         reshape2_1.4.4      </span>
<span class="co">#&gt; [61] codetools_0.2-16     stats4_3.6.3         reprex_0.3.0        </span>
<span class="co">#&gt; [64] glue_1.4.0           evaluate_0.14        data.table_1.12.8   </span>
<span class="co">#&gt; [67] modelr_0.1.6         vctrs_0.2.4          foreach_1.5.0       </span>
<span class="co">#&gt; [70] cellranger_1.1.0     gtable_0.3.0         assertthat_0.2.1    </span>
<span class="co">#&gt; [73] xfun_0.19.4          gower_0.2.1          prodlim_2019.11.13  </span>
<span class="co">#&gt; [76] broom_0.5.6          e1071_1.7-3          class_7.3-15        </span>
<span class="co">#&gt; [79] survival_3.1-8       timeDate_3043.102    iterators_1.0.12    </span>
<span class="co">#&gt; [82] lava_1.6.7           ellipsis_0.3.0       ipred_0.9-9</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="dealing-with-unbalanced-data.html"><span class="header-section-number">13</span> Dealing with unbalanced data</a></div>
<div class="next"><a href="tuning-of-support-vector-machine-prediction.html"><span class="header-section-number">15</span> Tuning of Support Vector Machine prediction</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#imputting-missing-values-with-random-forest"><span class="header-section-number">14</span> Imputting missing values with Random Forest</a></li>
<li><a class="nav-link" href="#flu-prediction.-fluh7n9_china_2013-dataset"><span class="header-section-number">14.1</span> Flu Prediction. fluH7N9_china_2013 dataset</a></li>
<li>
<a class="nav-link" href="#the-data"><span class="header-section-number">14.2</span> The data</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#pre-processing"><span class="header-section-number">14.2.1</span> Pre-processing</a></li></ul>
</li>
<li><a class="nav-link" href="#features"><span class="header-section-number">14.3</span> Features</a></li>
<li>
<a class="nav-link" href="#imputing-missing-values"><span class="header-section-number">14.4</span> Imputing missing values</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#generate-a-dataframe-of-five-imputting-strategies"><span class="header-section-number">14.4.1</span> Generate a dataframe of five imputting strategies</a></li>
<li><a class="nav-link" href="#plot-effect-of-imputting-on-features"><span class="header-section-number">14.4.2</span> plot effect of imputting on features</a></li>
</ul>
</li>
<li><a class="nav-link" href="#test-train-and-validation-data-sets"><span class="header-section-number">14.5</span> Test, train and validation data sets</a></li>
<li>
<a class="nav-link" href="#machine-learning-algorithms"><span class="header-section-number">14.6</span> Machine Learning algorithms</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#random-forest"><span class="header-section-number">14.6.1</span> Random Forest</a></li>
<li><a class="nav-link" href="#add-model-and-prediction-to-nested-dataframe-and-calculate"><span class="header-section-number">14.6.2</span> Add model and prediction to nested dataframe and calculate</a></li>
</ul>
</li>
<li><a class="nav-link" href="#comparing-accuracy-of-models"><span class="header-section-number">14.7</span> Comparing accuracy of models</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/f0nzie/machine_learning_compilation/blob/master/105-fe-meta_230-missing_data_flu-sglander.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/f0nzie/machine_learning_compilation/edit/master/105-fe-meta_230-missing_data_flu-sglander.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Machine Learning Compilation</strong>" was written by Several authors. Compiled by Alfonso R. Reyes. It was last built on 2020-11-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
