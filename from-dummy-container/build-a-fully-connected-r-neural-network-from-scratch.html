<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 44 Build a fully connected R neural network from scratch | A Machine Learning Compilation</title>
<meta name="author" content="Several authors. Compiled by Alfonso R. Reyes">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Machine Learning Compilation</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preface</a></li>
<li class="book-part">The Basics of Machine Learning</li>
<li><a class="" href="introduction-to-pca.html"><span class="header-section-number">2</span> Introduction to PCA</a></li>
<li><a class="" href="comparison-of-two-pca-packages.html"><span class="header-section-number">3</span> Comparison of two PCA packages</a></li>
<li><a class="" href="detailed-study-of-principal-component-analysis.html"><span class="header-section-number">4</span> Detailed study of Principal Component Analysis</a></li>
<li><a class="" href="detection-of-diabetes-using-logistic-regression.html"><span class="header-section-number">5</span> Detection of diabetes using Logistic Regression</a></li>
<li><a class="" href="sensitivity-analysis-for-a-neural-network.html"><span class="header-section-number">6</span> Sensitivity analysis for a neural network</a></li>
<li><a class="" href="data-visualization-for-ml-models.html"><span class="header-section-number">7</span> Data Visualization for ML models</a></li>
<li class="book-part">Feature Engineering</li>
<li><a class="" href="ten-methods-to-assess-variable-importance.html"><span class="header-section-number">8</span> Ten methods to assess Variable Importance</a></li>
<li><a class="" href="employee-attrition-using-feature-importance.html"><span class="header-section-number">9</span> Employee Attrition using Feature Importance</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="a-gentle-introduction-to-support-vector-machines.html"><span class="header-section-number">10</span> A gentle introduction to Support Vector Machines</a></li>
<li><a class="" href="broad-view-of-svm.html"><span class="header-section-number">11</span> Broad view of SVM</a></li>
<li><a class="" href="feature-selection-to-enhance-cancer-detection.html"><span class="header-section-number">12</span> Feature Selection to enhance cancer detection</a></li>
<li><a class="" href="dealing-with-unbalanced-data.html"><span class="header-section-number">13</span> Dealing with unbalanced data</a></li>
<li><a class="" href="imputting-missing-values-with-random-forest.html"><span class="header-section-number">14</span> Imputting missing values with Random Forest</a></li>
<li><a class="" href="tuning-of-support-vector-machine-prediction.html"><span class="header-section-number">15</span> Tuning of Support Vector Machine prediction</a></li>
<li class="book-part">Classification</li>
<li><a class="" href="introduction-to-algorithms-for-classification.html"><span class="header-section-number">16</span> Introduction to algorithms for Classification</a></li>
<li><a class="" href="comparing-classification-algorithms.html"><span class="header-section-number">17</span> Comparing Classification algorithms</a></li>
<li><a class="" href="who-buys-social-network-ads.html"><span class="header-section-number">18</span> Who buys Social Network ads</a></li>
<li><a class="" href="predicting-ozone-levels.html"><span class="header-section-number">19</span> Predicting Ozone levels</a></li>
<li><a class="" href="building-a-naive-bayes-classifier.html"><span class="header-section-number">20</span> Building a Naive Bayes Classifier</a></li>
<li><a class="" href="linear-and-non-linear-algorithms-for-classification.html"><span class="header-section-number">21</span> Linear and Non-Linear Algorithms for Classification</a></li>
<li><a class="" href="detect-mines-vs-rocks-with-random-forest.html"><span class="header-section-number">22</span> Detect mines vs rocks with Random Forest</a></li>
<li><a class="" href="predicting-the-type-of-glass.html"><span class="header-section-number">23</span> Predicting the type of glass</a></li>
<li><a class="" href="naive-bayes-for-sms-spam.html"><span class="header-section-number">24</span> Naive Bayes for SMS spam</a></li>
<li><a class="" href="vehicles-classiification-with-decision-trees.html"><span class="header-section-number">25</span> Vehicles classiification with Decision Trees</a></li>
<li><a class="" href="applying-naive-bayes-on-the-titanic-case.html"><span class="header-section-number">26</span> Applying Naive-Bayes on the Titanic case</a></li>
<li><a class="" href="classification-on-bad-loans.html"><span class="header-section-number">27</span> Classification on bad loans</a></li>
<li><a class="" href="predicting-flu-outcome-comparing-eight-classification-algorithms.html"><span class="header-section-number">28</span> Predicting Flu outcome comparing eight classification algorithms</a></li>
<li><a class="" href="a-detailed-study-of-bike-sharing-demand.html"><span class="header-section-number">29</span> A detailed study of bike sharing demand</a></li>
<li><a class="" href="prediction-of-arrhythmia-with-deep-neural-nets.html"><span class="header-section-number">30</span> Prediction of arrhythmia with deep neural nets</a></li>
<li class="book-part">Linear Regression</li>
<li><a class="" href="linear-regression-with-islr.html"><span class="header-section-number">31</span> Linear Regression with ISLR</a></li>
<li><a class="" href="evaluation-of-three-linear-regression-models.html"><span class="header-section-number">32</span> Evaluation of three linear regression models</a></li>
<li><a class="" href="comparison-of-six-linear-regression-algorithms.html"><span class="header-section-number">33</span> Comparison of six Linear Regression algorithms</a></li>
<li><a class="" href="comparing-regression-models.html"><span class="header-section-number">34</span> Comparing regression models</a></li>
<li><a class="" href="finding-the-factors-of-happiness.html"><span class="header-section-number">35</span> Finding the factors of happiness</a></li>
<li><a class="" href="regression-with-a-neural-network.html"><span class="header-section-number">36</span> Regression with a neural network</a></li>
<li><a class="" href="comparing-multiple-regression-vs-a-neural-network.html"><span class="header-section-number">37</span> Comparing Multiple Regression vs a Neural Network</a></li>
<li><a class="" href="temperature-modeling-using-nested-dataframes.html"><span class="header-section-number">38</span> Temperature modeling using nested dataframes</a></li>
<li class="book-part">Neural Networks</li>
<li><a class="" href="credit-scoring-with-neuralnet.html"><span class="header-section-number">39</span> Credit Scoring with neuralnet</a></li>
<li><a class="" href="wine-classification-with-neuralnet.html"><span class="header-section-number">40</span> Wine classification with neuralnet</a></li>
<li><a class="" href="predicting-the-rating-of-cereals.html"><span class="header-section-number">41</span> Predicting the rating of cereals</a></li>
<li><a class="" href="fitting-a-linear-model-with-neural-networks.html"><span class="header-section-number">42</span> Fitting a linear model with neural networks</a></li>
<li><a class="" href="visualization-of-neural-networks.html"><span class="header-section-number">43</span> Visualization of neural networks</a></li>
<li><a class="active" href="build-a-fully-connected-r-neural-network-from-scratch.html"><span class="header-section-number">44</span> Build a fully connected R neural network from scratch</a></li>
<li><a class="" href="tuning-hyperparameters-in-a-neural-network.html"><span class="header-section-number">45</span> Tuning Hyperparameters in a Neural Network</a></li>
<li><a class="" href="deep-learning-tips-for-classification-and-regression.html"><span class="header-section-number">46</span> Deep Learning tips for Classification and Regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="what-is-dot-hat-in-a-regression-output.html"><span class="header-section-number">A</span> What is dot hat in a regression output</a></li>
<li><a class="" href="q-q-normal-to-compare-data-to-distributions.html"><span class="header-section-number">B</span> Q-Q normal to compare data to distributions</a></li>
<li><a class="" href="qq-and-pp-plots.html"><span class="header-section-number">C</span> QQ and PP Plots</a></li>
<li><a class="" href="visualizing-residuals.html"><span class="header-section-number">D</span> Visualizing residuals</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hadley/r-pkgs">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="build-a-fully-connected-r-neural-network-from-scratch" class="section level1">
<h1>
<span class="header-section-number">44</span> Build a fully connected R neural network from scratch<a class="anchor" aria-label="anchor" href="#build-a-fully-connected-r-neural-network-from-scratch"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-24" class="section level2">
<h2>
<span class="header-section-number">44.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-24"><i class="fas fa-link"></i></a>
</h2>
<p><a href="http://www.parallelr.com/r-deep-neural-network-from-scratch/" class="uri">http://www.parallelr.com/r-deep-neural-network-from-scratch/</a></p>
<div class="sourceCode" id="cb1032"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bips-hb/neuralnet">neuralnet</a></span><span class="op">)</span>

<span class="co"># Copyright 2016: www.ParallelR.com</span>
<span class="co"># Parallel Blog : R For Deep Learning (I): Build Fully Connected Neural Network From Scratch</span>
<span class="co"># Classification by 2-layers DNN and tested by iris dataset</span>
<span class="co"># Author: Peng Zhao, patric.zhao@gmail.com</span>

<span class="co"># Prediction</span>
<span class="va">predict.dnn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span> <span class="op">=</span> <span class="va">X.test</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># new data, transfer to matrix</span>
  <span class="va">new.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
  
  <span class="co"># Feed Forwad</span>
  <span class="va">hidden.layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html">sweep</a></span><span class="op">(</span><span class="va">new.data</span> <span class="op">%*%</span> <span class="va">model</span><span class="op">$</span><span class="va">W1</span> ,<span class="fl">2</span>, <span class="va">model</span><span class="op">$</span><span class="va">b1</span>, <span class="st">'+'</span><span class="op">)</span>
  <span class="co"># neurons : Rectified Linear</span>
  <span class="va">hidden.layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="va">hidden.layer</span>, <span class="fl">0</span><span class="op">)</span>
  <span class="va">score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html">sweep</a></span><span class="op">(</span><span class="va">hidden.layer</span> <span class="op">%*%</span> <span class="va">model</span><span class="op">$</span><span class="va">W2</span>, <span class="fl">2</span>, <span class="va">model</span><span class="op">$</span><span class="va">b2</span>, <span class="st">'+'</span><span class="op">)</span>
  
  <span class="co"># Loss Function: softmax</span>
  <span class="va">score.exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span>
  <span class="va">probs</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sweep.html">sweep</a></span><span class="op">(</span><span class="va">score.exp</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">score.exp</span><span class="op">)</span>, <span class="st">'/'</span><span class="op">)</span> 
  
  <span class="co"># select max possiblity</span>
  <span class="va">labels.predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/maxCol.html">max.col</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">labels.predicted</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Train: build and train a 2-layers neural network </span>
<span class="va">train.dnn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">traindata</span><span class="op">=</span><span class="va">data</span>, <span class="va">testdata</span><span class="op">=</span><span class="cn">NULL</span>,
                  <span class="va">model</span> <span class="op">=</span> <span class="cn">NULL</span>,
                  <span class="co"># set hidden layers and neurons</span>
                  <span class="co"># currently, only support 1 hidden layer</span>
                  <span class="va">hidden</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, 
                  <span class="co"># max iteration steps</span>
                  <span class="va">maxit</span><span class="op">=</span><span class="fl">2000</span>,
                  <span class="co"># delta loss </span>
                  <span class="va">abstol</span><span class="op">=</span><span class="fl">1e-2</span>,
                  <span class="co"># learning rate</span>
                  <span class="va">lr</span> <span class="op">=</span> <span class="fl">1e-2</span>,
                  <span class="co"># regularization rate</span>
                  <span class="va">reg</span> <span class="op">=</span> <span class="fl">1e-3</span>,
                  <span class="co"># show results every 'display' step</span>
                  <span class="va">display</span> <span class="op">=</span> <span class="fl">100</span>,
                  <span class="va">random.seed</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="op">{</span>
  <span class="co"># to make the case reproducible.</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">random.seed</span><span class="op">)</span>
  
  <span class="co"># total number of training set</span>
  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">traindata</span><span class="op">)</span>
  
  <span class="co"># extract the data and label</span>
  <span class="co"># don't need atribute </span>
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span><span class="op">(</span><span class="va">traindata</span><span class="op">[</span>,<span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># correct categories represented by integer </span>
  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">traindata</span><span class="op">[</span>,<span class="va">y</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/is.factor.html">is.factor</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">}</span>
  <span class="co"># create index for both row and col</span>
  <span class="co"># create index for both row and col</span>
  <span class="va">Y.len</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>
  <span class="va">Y.set</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>
  <span class="va">Y.index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mice/man/cbind.html">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">Y.set</span><span class="op">)</span><span class="op">)</span>

  <span class="co"># create model or get model from parameter</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
       <span class="co"># number of input features</span>
       <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>
       <span class="co"># number of categories for classification</span>
       <span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>
       <span class="va">H</span> <span class="op">&lt;-</span>  <span class="va">hidden</span>
  
       <span class="co"># create and init weights and bias </span>
       <span class="va">W1</span> <span class="op">&lt;-</span> <span class="fl">0.01</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">D</span><span class="op">*</span><span class="va">H</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">D</span>, ncol<span class="op">=</span><span class="va">H</span><span class="op">)</span>
       <span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow<span class="op">=</span><span class="fl">1</span>, ncol<span class="op">=</span><span class="va">H</span><span class="op">)</span>
  
       <span class="va">W2</span> <span class="op">&lt;-</span> <span class="fl">0.01</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">H</span><span class="op">*</span><span class="va">K</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">H</span>, ncol<span class="op">=</span><span class="va">K</span><span class="op">)</span>
       <span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow<span class="op">=</span><span class="fl">1</span>, ncol<span class="op">=</span><span class="va">K</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
       <span class="va">D</span>  <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">D</span>
       <span class="va">K</span>  <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">K</span>
       <span class="va">H</span>  <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">H</span>
       <span class="va">W1</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">W1</span>
       <span class="va">b1</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">b1</span>
       <span class="va">W2</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">W2</span>
       <span class="va">b2</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">b2</span>
  <span class="op">}</span>
  
  <span class="co"># use all train data to update weights since it's a small dataset</span>
  <span class="va">batchsize</span> <span class="op">&lt;-</span> <span class="va">N</span>
  <span class="co"># init loss to a very big value</span>
  <span class="va">loss</span> <span class="op">&lt;-</span> <span class="fl">100000</span>
  
  <span class="co"># Training the network</span>
  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="kw">while</span><span class="op">(</span><span class="va">i</span> <span class="op">&lt;</span> <span class="va">maxit</span> <span class="op">&amp;&amp;</span> <span class="va">loss</span> <span class="op">&gt;</span> <span class="va">abstol</span> <span class="op">)</span> <span class="op">{</span>
    
    <span class="co"># iteration index</span>
    <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span><span class="fl">1</span>
    
    <span class="co"># forward ....</span>
    <span class="co"># 1 indicate row, 2 indicate col</span>
    <span class="va">hidden.layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html">sweep</a></span><span class="op">(</span><span class="va">X</span> <span class="op">%*%</span> <span class="va">W1</span> ,<span class="fl">2</span>, <span class="va">b1</span>, <span class="st">'+'</span><span class="op">)</span>
    <span class="co"># neurons : ReLU</span>
    <span class="va">hidden.layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="va">hidden.layer</span>, <span class="fl">0</span><span class="op">)</span>
    <span class="va">score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sweep.html">sweep</a></span><span class="op">(</span><span class="va">hidden.layer</span> <span class="op">%*%</span> <span class="va">W2</span>, <span class="fl">2</span>, <span class="va">b2</span>, <span class="st">'+'</span><span class="op">)</span>
    
    <span class="co"># softmax</span>
    <span class="va">score.exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span>
    <span class="co"># debug</span>
    <span class="va">probs</span> <span class="op">&lt;-</span> <span class="va">score.exp</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">score.exp</span><span class="op">)</span>
    
    <span class="co"># compute the loss</span>
    <span class="va">corect.logprobs</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/h2o/man/H2OFrame.html">log</a></span><span class="op">(</span><span class="va">probs</span><span class="op">[</span><span class="va">Y.index</span><span class="op">]</span><span class="op">)</span>
    <span class="va">data.loss</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">corect.logprobs</span><span class="op">)</span><span class="op">/</span><span class="va">batchsize</span>
    <span class="va">reg.loss</span>   <span class="op">&lt;-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">reg</span><span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">W1</span><span class="op">*</span><span class="va">W1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">W2</span><span class="op">*</span><span class="va">W2</span><span class="op">)</span><span class="op">)</span>
    <span class="va">loss</span> <span class="op">&lt;-</span> <span class="va">data.loss</span> <span class="op">+</span> <span class="va">reg.loss</span>
    
    <span class="co"># display results and update model</span>
    <span class="kw">if</span><span class="op">(</span> <span class="va">i</span> <span class="op">%%</span> <span class="va">display</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">testdata</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> D <span class="op">=</span> <span class="va">D</span>,
                           H <span class="op">=</span> <span class="va">H</span>,
                           K <span class="op">=</span> <span class="va">K</span>,
                           <span class="co"># weights and bias</span>
                           W1 <span class="op">=</span> <span class="va">W1</span>, 
                           b1 <span class="op">=</span> <span class="va">b1</span>, 
                           W2 <span class="op">=</span> <span class="va">W2</span>, 
                           b2 <span class="op">=</span> <span class="va">b2</span><span class="op">)</span>
            <span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu">predict.dnn</span><span class="op">(</span><span class="va">model</span>, <span class="va">testdata</span><span class="op">[</span>,<span class="op">-</span><span class="va">y</span><span class="op">]</span><span class="op">)</span>
            <span class="va">accuracy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">testdata</span><span class="op">[</span>,<span class="va">y</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="va">Y.set</span><span class="op">[</span><span class="va">labs</span><span class="op">]</span><span class="op">)</span>
            <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">loss</span>, <span class="va">accuracy</span>, <span class="st">"\n"</span><span class="op">)</span>
        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
            <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">loss</span>, <span class="st">"\n"</span><span class="op">)</span>
        <span class="op">}</span>
    <span class="op">}</span>
    
    <span class="co"># backward ....</span>
    <span class="va">dscores</span> <span class="op">&lt;-</span> <span class="va">probs</span>
    <span class="va">dscores</span><span class="op">[</span><span class="va">Y.index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dscores</span><span class="op">[</span><span class="va">Y.index</span><span class="op">]</span> <span class="op">-</span><span class="fl">1</span>
    <span class="va">dscores</span> <span class="op">&lt;-</span> <span class="va">dscores</span> <span class="op">/</span> <span class="va">batchsize</span>
    
    
    <span class="va">dW2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">hidden.layer</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">dscores</span> 
    <span class="va">db2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">dscores</span><span class="op">)</span>
    
    <span class="va">dhidden</span> <span class="op">&lt;-</span> <span class="va">dscores</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">W2</span><span class="op">)</span>
    <span class="va">dhidden</span><span class="op">[</span><span class="va">hidden.layer</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>
    
    <span class="va">dW1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">dhidden</span>
    <span class="va">db1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">dhidden</span><span class="op">)</span> 
    
    <span class="co"># update ....</span>
    <span class="va">dW2</span> <span class="op">&lt;-</span> <span class="va">dW2</span> <span class="op">+</span> <span class="va">reg</span><span class="op">*</span><span class="va">W2</span>
    <span class="va">dW1</span> <span class="op">&lt;-</span> <span class="va">dW1</span>  <span class="op">+</span> <span class="va">reg</span><span class="op">*</span><span class="va">W1</span>
    
    <span class="va">W1</span> <span class="op">&lt;-</span> <span class="va">W1</span> <span class="op">-</span> <span class="va">lr</span> <span class="op">*</span> <span class="va">dW1</span>
    <span class="va">b1</span> <span class="op">&lt;-</span> <span class="va">b1</span> <span class="op">-</span> <span class="va">lr</span> <span class="op">*</span> <span class="va">db1</span>
    
    <span class="va">W2</span> <span class="op">&lt;-</span> <span class="va">W2</span> <span class="op">-</span> <span class="va">lr</span> <span class="op">*</span> <span class="va">dW2</span>
    <span class="va">b2</span> <span class="op">&lt;-</span> <span class="va">b2</span> <span class="op">-</span> <span class="va">lr</span> <span class="op">*</span> <span class="va">db2</span>
    
   
    
  <span class="op">}</span>
  
  <span class="co"># final results</span>
  <span class="co"># creat list to store learned parameters</span>
  <span class="co"># you can add more parameters for debug and visualization</span>
  <span class="co"># such as residuals, fitted.values ...</span>
  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> D <span class="op">=</span> <span class="va">D</span>,
                 H <span class="op">=</span> <span class="va">H</span>,
                 K <span class="op">=</span> <span class="va">K</span>,
                 <span class="co"># weights and bias</span>
                 W1<span class="op">=</span> <span class="va">W1</span>, 
                 b1<span class="op">=</span> <span class="va">b1</span>, 
                 W2<span class="op">=</span> <span class="va">W2</span>, 
                 b2<span class="op">=</span> <span class="va">b2</span><span class="op">)</span>
    
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb1033"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">########################################################################</span>
<span class="co"># testing</span>
<span class="co">#######################################################################</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="co"># 0. EDA</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>
<span class="co">#&gt;   Sepal.Length   Sepal.Width    Petal.Length   Petal.Width        Species  </span>
<span class="co">#&gt;  Min.   :4.30   Min.   :2.00   Min.   :1.00   Min.   :0.1   setosa    :50  </span>
<span class="co">#&gt;  1st Qu.:5.10   1st Qu.:2.80   1st Qu.:1.60   1st Qu.:0.3   versicolor:50  </span>
<span class="co">#&gt;  Median :5.80   Median :3.00   Median :4.35   Median :1.3   virginica :50  </span>
<span class="co">#&gt;  Mean   :5.84   Mean   :3.06   Mean   :3.76   Mean   :1.2                  </span>
<span class="co">#&gt;  3rd Qu.:6.40   3rd Qu.:3.30   3rd Qu.:5.10   3rd Qu.:1.8                  </span>
<span class="co">#&gt;  Max.   :7.90   Max.   :4.40   Max.   :6.90   Max.   :2.5</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>

<span class="co"># 1. split data into test/train</span>
<span class="va">samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>,<span class="fl">25</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span><span class="op">(</span><span class="fl">51</span><span class="op">:</span><span class="fl">100</span>,<span class="fl">25</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span><span class="op">(</span><span class="fl">101</span><span class="op">:</span><span class="fl">150</span>,<span class="fl">25</span><span class="op">)</span><span class="op">)</span>

<span class="co"># 2. train model</span>
 <span class="va">ir.model</span> <span class="op">&lt;-</span> <span class="fu">train.dnn</span><span class="op">(</span>x<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, y<span class="op">=</span><span class="fl">5</span>, traindata<span class="op">=</span><span class="va">iris</span><span class="op">[</span><span class="va">samp</span>,<span class="op">]</span>, testdata<span class="op">=</span><span class="va">iris</span><span class="op">[</span><span class="op">-</span><span class="va">samp</span>,<span class="op">]</span>, hidden<span class="op">=</span><span class="fl">10</span>, maxit<span class="op">=</span><span class="fl">2000</span>, display<span class="op">=</span><span class="fl">50</span><span class="op">)</span>
<span class="co">#&gt; 50 1.1 0.333 </span>
<span class="co">#&gt; 100 1.1 0.333 </span>
<span class="co">#&gt; 150 1.09 0.333 </span>
<span class="co">#&gt; 200 1.08 0.333 </span>
<span class="co">#&gt; 250 1.05 0.333 </span>
<span class="co">#&gt; 300 1 0.333 </span>
<span class="co">#&gt; 350 0.933 0.667 </span>
<span class="co">#&gt; 400 0.855 0.667 </span>
<span class="co">#&gt; 450 0.775 0.667 </span>
<span class="co">#&gt; 500 0.689 0.667 </span>
<span class="co">#&gt; 550 0.611 0.68 </span>
<span class="co">#&gt; 600 0.552 0.693 </span>
<span class="co">#&gt; 650 0.507 0.747 </span>
<span class="co">#&gt; 700 0.473 0.84 </span>
<span class="co">#&gt; 750 0.445 0.88 </span>
<span class="co">#&gt; 800 0.421 0.92 </span>
<span class="co">#&gt; 850 0.399 0.947 </span>
<span class="co">#&gt; 900 0.379 0.96 </span>
<span class="co">#&gt; 950 0.36 0.96 </span>
<span class="co">#&gt; 1000 0.341 0.973 </span>
<span class="co">#&gt; 1050 0.324 0.973 </span>
<span class="co">#&gt; 1100 0.307 0.973 </span>
<span class="co">#&gt; 1150 0.292 0.973 </span>
<span class="co">#&gt; 1200 0.277 0.973 </span>
<span class="co">#&gt; 1250 0.263 0.973 </span>
<span class="co">#&gt; 1300 0.25 0.973 </span>
<span class="co">#&gt; 1350 0.238 0.973 </span>
<span class="co">#&gt; 1400 0.227 0.973 </span>
<span class="co">#&gt; 1450 0.216 0.973 </span>
<span class="co">#&gt; 1500 0.207 0.973 </span>
<span class="co">#&gt; 1550 0.198 0.973 </span>
<span class="co">#&gt; 1600 0.19 0.973 </span>
<span class="co">#&gt; 1650 0.183 0.973 </span>
<span class="co">#&gt; 1700 0.176 0.973 </span>
<span class="co">#&gt; 1750 0.17 0.973 </span>
<span class="co">#&gt; 1800 0.164 0.973 </span>
<span class="co">#&gt; 1850 0.158 0.973 </span>
<span class="co">#&gt; 1900 0.153 0.973 </span>
<span class="co">#&gt; 1950 0.149 0.973 </span>
<span class="co">#&gt; 2000 0.144 0.973</span>
<span class="co"># ir.model &lt;- train.dnn(x=1:4, y=5, traindata=iris[samp,], hidden=6, maxit=2000, display=50)</span></code></pre></div>
<div class="inline-figure"><img src="603-nn-classification_901-two_layer_dnn_files/figure-html/unnamed-chunk-2-1.png" width="70%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb1034"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 3. prediction</span>
<span class="co"># NOTE: if the predict is factor, we need to transfer the number into class manually.</span>
<span class="co">#       To make the code clear, I don't write this change into predict.dnn function.</span>
<span class="va">labels.dnn</span> <span class="op">&lt;-</span> <span class="fu">predict.dnn</span><span class="op">(</span><span class="va">ir.model</span>, <span class="va">iris</span><span class="op">[</span><span class="op">-</span><span class="va">samp</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>

<span class="co"># 4. verify the results</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span><span class="op">-</span><span class="va">samp</span>,<span class="fl">5</span><span class="op">]</span>, <span class="va">labels.dnn</span><span class="op">)</span>
<span class="co">#&gt;             labels.dnn</span>
<span class="co">#&gt;               1  2  3</span>
<span class="co">#&gt;   setosa     25  0  0</span>
<span class="co">#&gt;   versicolor  0 23  2</span>
<span class="co">#&gt;   virginica   0  0 25</span>
<span class="co">#          labels.dnn</span>
<span class="co">#            1  2  3</span>
<span class="co">#setosa     25  0  0</span>
<span class="co">#versicolor  0 24  1</span>
<span class="co">#virginica   0  0 25</span></code></pre></div>
<div class="sourceCode" id="cb1035"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#accuracy</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span><span class="op">-</span><span class="va">samp</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="va">labels.dnn</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.973</span>
<span class="co"># 0.98</span>

<span class="co"># 5. compare with nnet</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">nnet</a></span><span class="op">)</span>
<span class="va">ird</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">iris3</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">]</span>, <span class="va">iris3</span><span class="op">[</span>,,<span class="fl">2</span><span class="op">]</span>, <span class="va">iris3</span><span class="op">[</span>,,<span class="fl">3</span><span class="op">]</span><span class="op">)</span>,
                  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"s"</span>,<span class="fl">50</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="fl">50</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"v"</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ir.nn2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ird</span>, subset <span class="op">=</span> <span class="va">samp</span>, size <span class="op">=</span> <span class="fl">6</span>, rang <span class="op">=</span> <span class="fl">0.1</span>,
               decay <span class="op">=</span> <span class="fl">1e-2</span>, maxit <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span>
<span class="co">#&gt; # weights:  51</span>
<span class="co">#&gt; initial  value 82.293110 </span>
<span class="co">#&gt; iter  10 value 29.196376</span>
<span class="co">#&gt; iter  20 value 5.446284</span>
<span class="co">#&gt; iter  30 value 4.782022</span>
<span class="co">#&gt; iter  40 value 4.379729</span>
<span class="co">#&gt; iter  50 value 4.188725</span>
<span class="co">#&gt; iter  60 value 4.120587</span>
<span class="co">#&gt; iter  70 value 4.091706</span>
<span class="co">#&gt; iter  80 value 4.086017</span>
<span class="co">#&gt; iter  90 value 4.081664</span>
<span class="co">#&gt; iter 100 value 4.074111</span>
<span class="co">#&gt; iter 110 value 4.072894</span>
<span class="co">#&gt; iter 120 value 4.069012</span>
<span class="co">#&gt; iter 130 value 4.067691</span>
<span class="co">#&gt; iter 140 value 4.067633</span>
<span class="co">#&gt; final  value 4.067633 </span>
<span class="co">#&gt; converged</span>

           
<span class="va">labels.nnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">ir.nn2</span>, <span class="va">ird</span><span class="op">[</span><span class="op">-</span><span class="va">samp</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"class"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">ird</span><span class="op">$</span><span class="va">species</span><span class="op">[</span><span class="op">-</span><span class="va">samp</span><span class="op">]</span>, <span class="va">labels.nnet</span><span class="op">)</span>
<span class="co">#&gt;    labels.nnet</span>
<span class="co">#&gt;      c  s  v</span>
<span class="co">#&gt;   c 23  0  2</span>
<span class="co">#&gt;   s  0 25  0</span>
<span class="co">#&gt;   v  0  0 25</span>
<span class="co">#  labels.nnet</span>
<span class="co">#   c  s  v</span>
<span class="co">#c 22  0  3</span>
<span class="co">#s  0 25  0</span>
<span class="co">#v  3  0 22</span>

<span class="co"># accuracy</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ird</span><span class="op">$</span><span class="va">species</span><span class="op">[</span><span class="op">-</span><span class="va">samp</span><span class="op">]</span> <span class="op">==</span> <span class="va">labels.nnet</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.973</span>
<span class="co"># 0.96</span></code></pre></div>
<div class="sourceCode" id="cb1036"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Visualization</span>
<span class="co"># the output from screen, copy and paste here.</span>
<span class="va">data1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="st">"i loss accuracy
50 1.098421 0.3333333 
100 1.098021 0.3333333 
150 1.096843 0.3333333 
200 1.093393 0.3333333 
250 1.084069 0.3333333 
300 1.063278 0.3333333 
350 1.027273 0.3333333 
400 0.9707605 0.64 
450 0.8996356 0.6666667 
500 0.8335469 0.6666667 
550 0.7662386 0.6666667 
600 0.6914156 0.6666667 
650 0.6195753 0.68 
700 0.5620381 0.68 
750 0.5184008 0.7333333 
800 0.4844815 0.84 
850 0.4568258 0.8933333 
900 0.4331083 0.92 
950 0.4118948 0.9333333 
1000 0.392368 0.96 
1050 0.3740457 0.96 
1100 0.3566594 0.96 
1150 0.3400993 0.9866667 
1200 0.3243276 0.9866667 
1250 0.3093422 0.9866667 
1300 0.2951787 0.9866667 
1350 0.2818472 0.9866667 
1400 0.2693641 0.9866667 
1450 0.2577245 0.9866667 
1500 0.2469068 0.9866667 
1550 0.2368819 0.9866667 
1600 0.2276124 0.9866667 
1650 0.2190535 0.9866667 
1700 0.2111565 0.9866667 
1750 0.2038719 0.9866667 
1800 0.1971507 0.9866667 
1850 0.1909452 0.9866667 
1900 0.1852105 0.9866667 
1950 0.1799045 0.9866667 
2000 0.1749881 0.9866667  "</span><span class="op">)</span>

<span class="va">data.v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">data1</span>, header<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">data.v</span><span class="op">$</span><span class="va">i</span>, y<span class="op">=</span><span class="va">data.v</span><span class="op">$</span><span class="va">loss</span>, type<span class="op">=</span><span class="st">"o"</span>, col<span class="op">=</span><span class="st">"blue"</span>, pch<span class="op">=</span><span class="fl">16</span>, 
     main<span class="op">=</span><span class="st">"IRIS loss and accuracy by 2-layers DNN"</span>,
     ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.2</span><span class="op">)</span>,
     xlab<span class="op">=</span><span class="st">""</span>,
     ylab<span class="op">=</span><span class="st">""</span>,
     axe <span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">data.v</span><span class="op">$</span><span class="va">i</span>, y<span class="op">=</span><span class="va">data.v</span><span class="op">$</span><span class="va">accuracy</span>, type<span class="op">=</span><span class="st">"o"</span>, col<span class="op">=</span><span class="st">"red"</span>, pch<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">1</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2000</span>,by<span class="op">=</span><span class="fl">200</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">4</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.0</span>,by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.2</span>,by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"training step"</span>, <span class="fl">1</span>, line<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"loss of training set"</span>, <span class="fl">2</span>, line<span class="op">=</span><span class="fl">2.5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"accuracy of testing set"</span>, <span class="fl">4</span>, line<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, 
       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"loss"</span>, <span class="st">"accuracy"</span><span class="op">)</span>,
       pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">1</span><span class="op">)</span>,
       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span><span class="op">)</span>,
       lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="603-nn-classification_901-two_layer_dnn_files/figure-html/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="visualization-of-neural-networks.html"><span class="header-section-number">43</span> Visualization of neural networks</a></div>
<div class="next"><a href="tuning-hyperparameters-in-a-neural-network.html"><span class="header-section-number">45</span> Tuning Hyperparameters in a Neural Network</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#build-a-fully-connected-r-neural-network-from-scratch"><span class="header-section-number">44</span> Build a fully connected R neural network from scratch</a></li>
<li><a class="nav-link" href="#introduction-24"><span class="header-section-number">44.1</span> Introduction</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hadley/r-pkgs/blob/master/603-nn-classification_901-two_layer_dnn.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hadley/r-pkgs/edit/master/603-nn-classification_901-two_layer_dnn.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Machine Learning Compilation</strong>" was written by Several authors. Compiled by Alfonso R. Reyes. It was last built on 2020-11-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
